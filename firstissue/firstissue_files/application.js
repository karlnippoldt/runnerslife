jQuery.noConflict(),/*! jQuery UI - v1.11.4 - 2016-01-24
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, position.js, draggable.js, droppable.js, resizable.js, selectable.js, sortable.js, accordion.js, autocomplete.js, button.js, datepicker.js, dialog.js, menu.js, progressbar.js, selectmenu.js, slider.js, spinner.js, tabs.js, tooltip.js, effect.js, effect-blind.js, effect-bounce.js, effect-clip.js, effect-drop.js, effect-explode.js, effect-fade.js, effect-fold.js, effect-highlight.js, effect-puff.js, effect-pulsate.js, effect-scale.js, effect-shake.js, effect-size.js, effect-slide.js, effect-transfer.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */
function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function e(e,s){var n,o,a,r=e.nodeName.toLowerCase();return"area"===r?(n=e.parentNode,o=n.name,e.href&&o&&"map"===n.nodeName.toLowerCase()?(a=t("img[usemap='#"+o+"']")[0],!!a&&i(a)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!e.disabled:"a"===r?e.href||s:s)&&i(e)}function i(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}function s(t){for(var e,i;t.length&&t[0]!==document;){if(e=t.css("position"),("absolute"===e||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=o(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function o(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(i,"mouseout",function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",a)}function a(){t.datepicker._isDisabledDatepicker(_.inline?_.dpDiv.parent()[0]:_.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function r(e,i){t.extend(e,i);for(var s in i)null==i[s]&&(e[s]=i[s]);return e}function l(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{},t.extend(t.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({scrollParent:function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return s&&"static"===e.css("position")?!1:n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])},focusable:function(i){return e(i,!isNaN(t.attr(i,"tabindex")))},tabbable:function(i){var s=t.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&e(i,!n)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(e,i){function s(e,i,s,o){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?a["inner"+i].call(this):this.each(function(){t(this).css(o,s(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){t(this).css(o,s(this,e,!0,n)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(i){return arguments.length?e.call(this,t.camelCase(i)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.fn.extend({focus:function(e){return function(i,s){return"number"==typeof i?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),s&&s.call(e)},i)}):e.apply(this,arguments)}}(t.fn.focus),disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(e){if(void 0!==e)return this.css("zIndex",e);if(this.length)for(var i,s,n=t(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),t.ui.plugin={add:function(e,i,s){var n,o=t.ui[e].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(t,e,i,s){var n,o=t.plugins[e];if(o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)t.options[o[n][0]]&&o[n][1].apply(t.element,i)}};var d=0,h=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{s=t._data(n,"events"),s&&s.remove&&t(n).triggerHandler("remove")}catch(a){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r,l={},d=e.split(".")[0];return e=e.split(".")[1],n=d+"-"+e,s||(s=i,i=t.Widget),t.expr[":"][n.toLowerCase()]=function(e){return!!t.data(e,n)},t[d]=t[d]||{},o=t[d][e],a=t[d][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new a(t,e)},t.extend(a,o,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),r=new i,r.options=t.widget.extend({},r.options),t.each(s,function(e,s){return t.isFunction(s)?void(l[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},n=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}()):void(l[e]=s)}),a.prototype=t.widget.extend(r,{widgetEventPrefix:o?r.widgetEventPrefix||e:e},l,{constructor:a,namespace:d,widgetName:e,widgetFullName:n}),o?(t.each(o._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,a,i._proto)}),delete o._childConstructors):i._childConstructors.push(a),t.widget.bridge(e,a),a},t.widget.extend=function(e){for(var i,s,n=h.call(arguments,1),o=0,a=n.length;a>o;o++)for(i in n[o])s=n[o][i],n[o].hasOwnProperty(i)&&void 0!==s&&(e[i]=t.isPlainObject(s)?t.isPlainObject(e[i])?t.widget.extend({},e[i],s):t.widget.extend({},s):s);return e},t.widget.bridge=function(e,i){var s=i.prototype.widgetFullName||e;t.fn[e]=function(n){var o="string"==typeof n,a=h.call(arguments,1),r=this;return o?this.each(function(){var i,o=t.data(this,s);return"instance"===n?(r=o,!1):o?t.isFunction(o[n])&&"_"!==n.charAt(0)?(i=o[n].apply(o,a),i!==o&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+n+"'")}):(a.length&&(n=t.widget.extend.apply(null,[n].concat(a))),this.each(function(){var e=t.data(this,s);e?(e.option(n||{}),e._init&&e._init()):t.data(this,s,new i(n,this))})),r}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=d++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,o,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},s=e.split("."),e=s.shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!e),e&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,a){function r(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var l=s.match(/^([\w:-]*)\s*(.*)$/),d=l[1]+o.eventNamespace,h=l[2];h?n.delegate(h,d,r):i.bind(d,r)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(i).undelegate(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget;var c=!1;t(document).mouseup(function(){c=!1}),t.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!c){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,n="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),c=!0,!0)):!0}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),c=!1,!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){function e(t,e,i){return[parseFloat(t[0])*(m.test(t[0])?e/100:1),parseFloat(t[1])*(m.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function s(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}t.ui=t.ui||{};var n,o,a=Math.max,r=Math.abs,l=Math.round,d=/left|center|right/,h=/top|center|bottom/,c=/[\+\-]\d+(\.[\d]+)?%?/,u=/^\w+/,m=/%$/,p=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==n)return n;var e,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return t("body").append(s),e=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,e===i&&(i=s[0].clientWidth),s.remove(),n=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,o="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s||n?i.width():i.outerWidth(),height:s||n?i.height():i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return p.apply(this,arguments);n=t.extend({},n);var m,f,g,_,b,v,y=t(n.of),w=t.position.getWithinInfo(n.within),C=t.position.getScrollInfo(w),S=(n.collision||"flip").split(" "),k={};return v=s(y),y[0].preventDefault&&(n.at="left top"),f=v.width,g=v.height,_=v.offset,b=t.extend({},_),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=d.test(i[0])?i.concat(["center"]):h.test(i[0])?["center"].concat(i):["center","center"]),i[0]=d.test(i[0])?i[0]:"center",i[1]=h.test(i[1])?i[1]:"center",t=c.exec(i[0]),e=c.exec(i[1]),k[this]=[t?t[0]:0,e?e[0]:0],n[this]=[u.exec(i[0])[0],u.exec(i[1])[0]]}),1===S.length&&(S[1]=S[0]),"right"===n.at[0]?b.left+=f:"center"===n.at[0]&&(b.left+=f/2),"bottom"===n.at[1]?b.top+=g:"center"===n.at[1]&&(b.top+=g/2),m=e(k.at,f,g),b.left+=m[0],b.top+=m[1],this.each(function(){var s,d,h=t(this),c=h.outerWidth(),u=h.outerHeight(),p=i(this,"marginLeft"),v=i(this,"marginTop"),M=c+p+i(this,"marginRight")+C.width,T=u+v+i(this,"marginBottom")+C.height,D=t.extend({},b),I=e(k.my,h.outerWidth(),h.outerHeight());"right"===n.my[0]?D.left-=c:"center"===n.my[0]&&(D.left-=c/2),"bottom"===n.my[1]?D.top-=u:"center"===n.my[1]&&(D.top-=u/2),D.left+=I[0],D.top+=I[1],o||(D.left=l(D.left),D.top=l(D.top)),s={marginLeft:p,marginTop:v},t.each(["left","top"],function(e,i){t.ui.position[S[e]]&&t.ui.position[S[e]][i](D,{targetWidth:f,targetHeight:g,elemWidth:c,elemHeight:u,collisionPosition:s,collisionWidth:M,collisionHeight:T,offset:[m[0]+I[0],m[1]+I[1]],my:n.my,at:n.at,within:w,elem:h})}),n.using&&(d=function(t){var e=_.left-D.left,i=e+f-c,s=_.top-D.top,o=s+g-u,l={target:{element:y,left:_.left,top:_.top,width:f,height:g},element:{element:h,left:D.left,top:D.top,width:c,height:u},horizontal:0>i?"left":e>0?"right":"center",vertical:0>o?"top":s>0?"bottom":"middle"};c>f&&f>r(e+i)&&(l.horizontal="center"),u>g&&g>r(s+o)&&(l.vertical="middle"),l.important=a(r(e),r(i))>a(r(s),r(o))?"horizontal":"vertical",n.using.call(this,t,l)}),h.offset(t.extend(D,{using:d}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,o=s.width,r=t.left-e.collisionPosition.marginLeft,l=n-r,d=r+e.collisionWidth-o-n;e.collisionWidth>o?l>0&&0>=d?(i=t.left+l+e.collisionWidth-o-n,t.left+=l-i):t.left=d>0&&0>=l?n:l>d?n+o-e.collisionWidth:n:l>0?t.left+=l:d>0?t.left-=d:t.left=a(t.left-r,t.left)},top:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,o=e.within.height,r=t.top-e.collisionPosition.marginTop,l=n-r,d=r+e.collisionHeight-o-n;e.collisionHeight>o?l>0&&0>=d?(i=t.top+l+e.collisionHeight-o-n,t.top+=l-i):t.top=d>0&&0>=l?n:l>d?n+o-e.collisionHeight:n:l>0?t.top+=l:d>0?t.top-=d:t.top=a(t.top-r,t.top)}},flip:{left:function(t,e){var i,s,n=e.within,o=n.offset.left+n.scrollLeft,a=n.width,l=n.isWindow?n.scrollLeft:n.offset.left,d=t.left-e.collisionPosition.marginLeft,h=d-l,c=d+e.collisionWidth-a-l,u="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,m="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,p=-2*e.offset[0];0>h?(i=t.left+u+m+p+e.collisionWidth-a-o,(0>i||r(h)>i)&&(t.left+=u+m+p)):c>0&&(s=t.left-e.collisionPosition.marginLeft+u+m+p-l,(s>0||c>r(s))&&(t.left+=u+m+p))},top:function(t,e){var i,s,n=e.within,o=n.offset.top+n.scrollTop,a=n.height,l=n.isWindow?n.scrollTop:n.offset.top,d=t.top-e.collisionPosition.marginTop,h=d-l,c=d+e.collisionHeight-a-l,u="top"===e.my[1],m=u?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,p="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,f=-2*e.offset[1];0>h?(s=t.top+m+p+f+e.collisionHeight-a-o,(0>s||r(h)>s)&&(t.top+=m+p+f)):c>0&&(i=t.top-e.collisionPosition.marginTop+m+p+f-l,(i>0||c>r(i))&&(t.top+=m+p+f))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var e,i,s,n,a,r=document.getElementsByTagName("body")[0],l=document.createElement("div");e=document.createElement(r?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},r&&t.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(a in s)e.style[a]=s[a];e.appendChild(l),i=r||document.documentElement,i.insertBefore(e,i.firstChild),l.style.cssText="position: absolute; left: 10.7432222px;",n=t(l).offset().left,o=n>10&&11>n,e.innerHTML="",i.removeChild(e)}()}(),t.ui.position,t.widget("ui.draggable",t.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(e){var i=this.options;return this._blurActiveElement(e),this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=this.document[0];if(this.handleElement.is(e.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&t(i.activeElement).blur()}catch(s){}},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._normalizeRightBottom(),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.focus(),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper),n=s?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===n.containment?void(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,(t(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):n.containment.constructor===Array?void(this.containment=n.containment):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),s=i[0],void(s&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,s,n,o,a=this.options,r=this._isRootNode(this.scrollParent[0]),l=t.pageX,d=t.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(d=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(d=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((d-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,d=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o),"y"===a.axis&&(l=this.originalPageX),"x"===a.axis&&(d=this.originalPageY)),{top:d-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}
},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,s){var n=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,s){var n=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function(e,i,s){t.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",e),s.dropped=o.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,s){var n=t("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(e,i,s){var n=s.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(e,i,s){var n=s.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-e.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:e.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-e.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:e.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(r).scrollTop()<n.scrollSensitivity?o=t(r).scrollTop(t(r).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(r).scrollTop())<n.scrollSensitivity&&(o=t(r).scrollTop(t(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(r).scrollLeft()<n.scrollSensitivity?o=t(r).scrollLeft(t(r).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(r).scrollLeft())<n.scrollSensitivity&&(o=t(r).scrollLeft(t(r).scrollLeft()+n.scrollSpeed)))),o!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,s){var n=s.options;s.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,s){var n,o,a,r,l,d,h,c,u,m,p=s.options,f=p.snapTolerance,g=i.offset.left,_=g+s.helperProportions.width,b=i.offset.top,v=b+s.helperProportions.height;for(u=s.snapElements.length-1;u>=0;u--)l=s.snapElements[u].left-s.margins.left,d=l+s.snapElements[u].width,h=s.snapElements[u].top-s.margins.top,c=h+s.snapElements[u].height,l-f>_||g>d+f||h-f>v||b>c+f||!t.contains(s.snapElements[u].item.ownerDocument,s.snapElements[u].item)?(s.snapElements[u].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=!1):("inner"!==p.snapMode&&(n=f>=Math.abs(h-v),o=f>=Math.abs(c-b),a=f>=Math.abs(l-_),r=f>=Math.abs(d-g),n&&(i.position.top=s._convertPositionTo("relative",{top:h-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:d}).left)),m=n||o||a||r,"outer"!==p.snapMode&&(n=f>=Math.abs(h-b),o=f>=Math.abs(c-v),a=f>=Math.abs(l-g),r=f>=Math.abs(d-_),n&&(i.position.top=s._convertPositionTo("relative",{top:h,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:d-s.helperProportions.width}).left)),!s.snapElements[u].snapping&&(n||o||a||r||m)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=n||o||a||r||m)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,s){var n,o=s.options,a=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(t(a[0]).css("zIndex"),10)||0,t(a).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+a.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(e,i,s){var n=s.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?void(e=arguments[0]):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var s=t.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&t.ui.intersect(s,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,s,n){if(!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,a=(e.positionAbs||e.position.absolute).top+e.margins.top,r=o+e.helperProportions.width,l=a+e.helperProportions.height,d=i.offset.left,h=i.offset.top,c=d+i.proportions().width,u=h+i.proportions().height;switch(s){case"fit":return o>=d&&c>=r&&a>=h&&u>=l;case"intersect":return o+e.helperProportions.width/2>d&&c>r-e.helperProportions.width/2&&a+e.helperProportions.height/2>h&&u>l-e.helperProportions.height/2;case"pointer":return t(n.pageY,h,i.proportions().height)&&t(n.pageX,d,i.proportions().width);case"touch":return(a>=h&&u>=a||l>=h&&u>=l||h>a&&l>u)&&(o>=d&&c>=o||r>=d&&c>=r||d>o&&r>c);default:return!1}}}(),t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var s,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;o.length>s;s++)if(!(o[s].options.disabled||e&&!o[s].accept.call(o[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++)if(r[n]===o[s].element[0]){o[s].proportions().height=0;continue t}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,o,a=t.ui.intersect(e,this,this.options.tolerance,i),r=!a&&this.isover?"isout":a&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===n}),o.length&&(s=t(o[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.ui.droppable,t.widget("ui.resizable",t.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseInt(t,10)||0},_isNumber:function(t){return!isNaN(parseInt(t,10))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[s]>0?!0:(e[s]=1,n=e[s]>0,e[s]=0,n)},_create:function(){var e,i,s,n,o,a=this,r=this.options;if(this.element.addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),e=this.handles.split(","),this.handles={},i=0;e.length>i;i++)s=t.trim(e[i]),o="ui-resizable-"+s,n=t("<div class='ui-resizable-handle "+o+"'></div>"),n.css({zIndex:r.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(e){var i,s,n,o;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:a._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.mouseover(function(){a.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),t(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(t(this).removeClass("ui-resizable-autohide"),a._handles.show())}).mouseleave(function(){r.disabled||a.resizing||(t(this).addClass("ui-resizable-autohide"),a._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var i,s,n,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,s+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),a.addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,s,n=this.originalMousePosition,o=this.axis,a=e.pageX-n.left||0,r=e.pageY-n.top||0,l=this._change[o];return this._updatePrevProperties(),l?(i=l.apply(this,[e,a,r]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i,s,n,o,a,r,l,d=this.options,h=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:h.sizeDiff.height,o=s?0:h.sizeDiff.width,a={width:h.helper.width()-o,height:h.helper.height()-n},r=parseInt(h.element.css("left"),10)+(h.position.left-h.originalPosition.left)||null,l=parseInt(h.element.css("top"),10)+(h.position.top-h.originalPosition.top)||null,d.animate||this.element.css(t.extend(a,{top:l,left:r})),h.helper.height(h.size.height),h.helper.width(h.size.width),this._helper&&!d.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,s,n,o,a=this.options;o={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),s>o.minHeight&&(o.minHeight=s),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,a=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,r=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,d=/sw|nw|w/.test(i),h=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),a&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&d&&(t.left=r-e.minWidth),s&&d&&(t.left=r-e.maxWidth),a&&h&&(t.top=l-e.minHeight),n&&h&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseInt(s[e],10)||0,i[e]+=parseInt(n[e],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,l={width:i.size.width-r,height:i.size.height-a},d=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,h=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(l,h&&d?{top:h,left:d}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,s,n,o,a,r,l=t(this).resizable("instance"),d=l.options,h=l.element,c=d.containment,u=c instanceof t?c.get(0):/parent/.test(c)?h.parent().get(0):c;u&&(l.containerElement=t(u),/document/.test(c)||c===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(u),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=l._num(e.css("padding"+s))}),l.containerOffset=e.offset(),l.containerPosition=e.position(),l.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=l.containerOffset,n=l.containerSize.height,o=l.containerSize.width,a=l._hasScroll(u,"left")?u.scrollWidth:o,r=l._hasScroll(u)?u.scrollHeight:n,l.parentData={element:u,left:s.left,top:s.top,width:a,height:r}))},resize:function(e){var i,s,n,o,a=t(this).resizable("instance"),r=a.options,l=a.containerOffset,d=a.position,h=a._aspectRatio||e.shiftKey,c={top:0,left:0},u=a.containerElement,m=!0;u[0]!==document&&/static/.test(u.css("position"))&&(c=l),d.left<(a._helper?l.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-l.left:a.position.left-c.left),h&&(a.size.height=a.size.width/a.aspectRatio,m=!1),a.position.left=r.helper?l.left:0),d.top<(a._helper?l.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-l.top:a.position.top),h&&(a.size.width=a.size.height*a.aspectRatio,m=!1),a.position.top=a._helper?l.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-c.left:a.offset.left-l.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-c.top:a.offset.top-l.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,h&&(a.size.height=a.size.width/a.aspectRatio,m=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,h&&(a.size.width=a.size.height*a.aspectRatio,m=!1)),m||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),l=a.outerWidth()-e.sizeDiff.width,d=a.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:l,height:d}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:l,height:d})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)})})},resize:function(e,i){var s=t(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};t(n.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(s[e]||0)+(r[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function(){t(this).removeData("resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.options,s=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,l="number"==typeof s.grid?[s.grid,s.grid]:s.grid,d=l[0]||1,h=l[1]||1,c=Math.round((n.width-o.width)/d)*d,u=Math.round((n.height-o.height)/h)*h,m=o.width+c,p=o.height+u,f=s.maxWidth&&m>s.maxWidth,g=s.maxHeight&&p>s.maxHeight,_=s.minWidth&&s.minWidth>m,b=s.minHeight&&s.minHeight>p;s.grid=l,_&&(m+=d),b&&(p+=h),f&&(m-=d),g&&(p-=h),/^(se|s|e)$/.test(r)?(i.size.width=m,i.size.height=p):/^(ne)$/.test(r)?(i.size.width=m,i.size.height=p,i.position.top=a.top-u):/^(sw)$/.test(r)?(i.size.width=m,i.size.height=p,i.position.left=a.left-c):((0>=p-h||0>=m-d)&&(e=i._getPaddingPlusBorderDimensions(this)),p-h>0?(i.size.height=p,i.position.top=a.top-u):(p=h-e.height,i.size.height=p,i.position.top=a.top+o.height-p),m-d>0?(i.size.width=m,i.position.left=a.left-c):(m=d-e.width,i.size.width=m,i.position.left=a.left+o.width-m))}}),t.ui.resizable,t.widget("ui.selectable",t.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e=t(i.options.filter,i.element[0]),e.addClass("ui-selectee"),e.each(function(){var e=t(this),i=e.offset();t.data(this,"selectable-item",{element:this,$element:e,left:i.left,top:i.top,right:i.left+e.outerWidth(),bottom:i.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=e.addClass("ui-selectee"),this._mouseInit(),this.helper=t("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()
},_mouseStart:function(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(s.$element.removeClass("ui-selected"),s.selected=!1,s.$element.addClass("ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),n.$element.removeClass(s?"ui-unselecting":"ui-selected").addClass(s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,l=e.pageY;return o>r&&(i=r,r=o,o=i),a>l&&(i=l,l=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:l-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),d=!1;i&&i.element!==s.element[0]&&("touch"===n.tolerance?d=!(i.left>r||o>i.right||i.top>l||a>i.bottom):"fit"===n.tolerance&&(d=i.left>o&&r>i.right&&i.top>a&&l>i.bottom),d?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),t.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s&&(!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n))?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1)},_mouseStart:function(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,l=r+t.height,d=this.offset.click.top,h=this.offset.click.left,c="x"===this.options.axis||s+d>r&&l>s+d,u="y"===this.options.axis||e+h>o&&a>e+h,m=c&&u;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?m:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&l>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),s=e&&i,n=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return s?this.floating?o&&"right"===o||"down"===n?2:1:n&&("down"===n?2:1):!1},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],l=[],d=this._connectWith();if(d&&e)for(s=d.length-1;s>=0;s--)for(o=t(d[s],this.document[0]),n=o.length-1;n>=0;n--)a=t.data(o[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&l.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=l.length-1;s>=0;s--)l[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,l,d,h=this.items,c=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready)for(i=u.length-1;i>=0;i--)for(n=t(u[i],this.document[0]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(c.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=c.length-1;i>=0;i--)for(a=c[i][1],r=c[i][0],s=0,d=r.length;d>s;s++)l=t(r[s]),l.data(this.widgetName+"-item",a),h.push({item:l,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,n,o,a,r,l,d,h,c,u=null,m=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(u&&t.contains(this.containers[i].element[0],u.element[0]))continue;u=this.containers[i],m=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(u)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",e,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(n=1e4,o=null,h=u.floating||this._isFloating(this.currentItem),a=h?"left":"top",r=h?"width":"height",c=h?"clientX":"clientY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[m].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(l=this.items[s].item.offset()[a],d=!1,e[c]-l>this.items[s][r]/2&&(d=!0),n>Math.abs(e[c]-l)&&(n=Math.abs(e[c]-l),o=this.items[s],this.direction=d?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return void(this.currentContainer.containerCache.over||(this.containers[m]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1));o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[m].element,!0),this._trigger("change",e,this._uiHash()),this.containers[m]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",e,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.accordion",{version:"1.11.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),e.collapsible||e.active!==!1&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t()}},_createIcons:function(){var e=this.options.icons;e&&(t("<span>").addClass("ui-accordion-header-icon ui-icon "+e.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(e.header).addClass(e.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),t=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?void this._activate(e):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||this.options.active!==!1||this._activate(0),"icons"===t&&(this._destroyIcons(),e&&this._createIcons()),void("disabled"===t&&(this.element.toggleClass("ui-state-disabled",!!e).attr("aria-disabled",e),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!e))))},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,s=this.headers.length,n=this.headers.index(e.target),o=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:o=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[s-1]}o&&(t(e.target).attr("tabIndex",-1),t(o).attr("tabIndex",0),o.focus(),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().focus()},refresh:function(){var e=this.options;this._processPanels(),e.active===!1&&e.collapsible===!0||!this.headers.length?(e.active=!1,this.active=t()):e.active===!1?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var t=this.headers,e=this.panels;this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.panels=this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide(),e&&(this._off(t.not(this.headers)),this._off(e.not(this.panels)))},_refresh:function(){var e,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var e=t(this),i=e.uniqueId().attr("id"),s=e.next(),n=s.uniqueId().attr("id");e.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(e=n.height(),this.element.siblings(":visible").each(function(){var i=t(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(e-=i.outerHeight(!0))}),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===s&&(e=0,this.headers.next().each(function(){e=Math.max(e,t(this).css("height","").height())}).height(e))},_activate:function(e){var i=this._findActive(e)[0];
i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i=this.options,s=this.active,n=t(e.currentTarget),o=n[0]===s[0],a=o&&i.collapsible,r=a?t():n.next(),l=s.next(),d={oldHeader:s,oldPanel:l,newHeader:a?t():n,newPanel:r};e.preventDefault(),o&&!i.collapsible||this._trigger("beforeActivate",e,d)===!1||(i.active=a?!1:this.headers.index(n),this.active=o?t():n,this._toggle(d),s.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&s.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),o||(n.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),n.next().addClass("ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,s=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,e):(s.hide(),i.show(),this._toggleComplete(e)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(t(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(t,e,i){var s,n,o,a=this,r=0,l=t.css("box-sizing"),d=t.length&&(!e.length||t.index()<e.index()),h=this.options.animate||{},c=d&&h.down||h,u=function(){a._toggleComplete(i)};return"number"==typeof c&&(o=c),"string"==typeof c&&(n=c),n=n||c.easing||h.easing,o=o||c.duration||h.duration,e.length?t.length?(s=t.show().outerHeight(),e.animate(this.hideProps,{duration:o,easing:n,step:function(t,e){e.now=Math.round(t)}}),void t.hide().animate(this.showProps,{duration:o,easing:n,complete:u,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?"content-box"===l&&(r+=i.now):"content"!==a.options.heightStyle&&(i.now=Math.round(s-e.outerHeight()-r),r=0)}})):e.animate(this.hideProps,o,n,u):t.animate(this.showProps,o,n,u)},_toggleComplete:function(t){var e=t.oldPanel;e.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}}),t.widget("ui.menu",{version:"1.11.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target);!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&t(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){if(!this.previousFilter){var i=t(e.currentTarget);i.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(e,i)}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){t.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var e=t(this);e.data("ui-menu-submenu-carat")&&e.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(e){var i,s,n,o,a=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:a=!1,s=this.previousFilter||"",n=String.fromCharCode(e.keyCode),o=!1,clearTimeout(this.filterTimer),n===s?o=!0:n=s+n,i=this._filterMenuItems(n),i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(e.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(e,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}a&&e.preventDefault()},_activate:function(t){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(t):this.select(t))},refresh:function(){var e,i,s=this,n=this.options.icons.submenu,o=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),o.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.parent(),s=t("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(s),e.attr("aria-labelledby",i.attr("id"))}),e=o.add(this.element),i=e.find(this.options.items),i.not(".ui-menu-item").each(function(){var e=t(this);s._isDivider(e)&&e.addClass("ui-widget-content ui-menu-divider")}),i.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){"icons"===t&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(e.submenu),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!e).attr("aria-disabled",e),this._super(t,e)},focus:function(t,e){var i,s;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),s=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,s,n,o,a,r;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-s,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=e.outerHeight(),0>n?this.activeMenu.scrollTop(o+n):n+r>a&&this.activeMenu.scrollTop(o+n-a+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",t,{item:this.active}))},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this.activeMenu=s},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;this.active&&(s="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?void(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-s-n}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))):void this.next(e)},previousPage:function(e){var i,s,n;return this.active?void(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-s+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first()))):void this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(e){var i=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(t.trim(t(this).text()))})}}),t.widget("ui.autocomplete",{version:"1.11.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,s,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,a="input"===n;this.isMultiLine=o?!0:a?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return e=!0,s=!0,void(i=!0);e=!1,s=!1,i=!1;var o=t.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case o.UP:e=!0,this._keyEvent("previous",n);break;case o.DOWN:e=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(e)return e=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault());if(!i){var n=t.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(t){return s?(s=!1,void t.preventDefault()):void this._searchTimeout(t)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(t),void this._change(t))}}),this._initSource(),this.menu=t("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];t(e.target).closest(".ui-menu-item").length||this._delay(function(){var e=this;this.document.one("mousedown",function(s){s.target===e.element[0]||s.target===i||t.contains(i,s.target)||e.close()})})},menufocus:function(e,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),void this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)})):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:n})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,void(s&&t.trim(s).length&&(this.liveRegion.children().hide(),t("<div>").text(s).appendTo(this.liveRegion))))},menuselect:function(t,e){var i=e.item.data("ui-autocomplete-item"),s=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s,this.selectedItem=i})),!1!==this._trigger("select",t,{item:i})&&this._value(i.value),this.term=this._value(),this.close(t),this.selectedItem=i}}),this.liveRegion=t("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,s=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,s){s(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){s.xhr&&s.xhr.abort(),s.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),s=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;(!e||e&&!i&&!s)&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):void 0},_search:function(t){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var s=this;t.each(i,function(t,i){s._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").text(i.label).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[t](e):void this.search(null,e)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var s=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return s.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete;var u,m="ui-button ui-widget ui-state-default ui-corner-all",p="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",f=function(){var e=t(this);setTimeout(function(){e.find(":ui-button").button("refresh")},1)},g=function(e){var i=e.name,s=e.form,n=t([]);return i&&(i=i.replace(/'/g,"\\'"),n=s?t(s).find("[name='"+i+"'][type=radio]"):t("[name='"+i+"'][type=radio]",e.ownerDocument).filter(function(){return!this.form})),n};t.widget("ui.button",{version:"1.11.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,f),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var e=this,i=this.options,s="checkbox"===this.type||"radio"===this.type,n=s?"":"ui-state-active";null===i.label&&(i.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(m).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){i.disabled||this===u&&t(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){i.disabled||t(this).removeClass(n)}).bind("click"+this.eventNamespace,function(t){i.disabled&&(t.preventDefault(),t.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),s&&this.element.bind("change"+this.eventNamespace,function(){e.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return i.disabled?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1;t(this).addClass("ui-state-active"),e.buttonElement.attr("aria-pressed","true");var s=e.element[0];g(s).not(s).map(function(){return t(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return i.disabled?!1:(t(this).addClass("ui-state-active"),u=this,void e.document.one("mouseup",function(){u=null}))}).bind("mouseup"+this.eventNamespace,function(){return i.disabled?!1:void t(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(e){return i.disabled?!1:void((e.keyCode===t.ui.keyCode.SPACE||e.keyCode===t.ui.keyCode.ENTER)&&t(this).addClass("ui-state-active"))}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){t(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(e){e.keyCode===t.ui.keyCode.SPACE&&t(this).click()})),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var t,e,i;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(t=this.element.parents().last(),e="label[for='"+this.element.attr("id")+"']",this.buttonElement=t.find(e),this.buttonElement.length||(t=t.length?t.siblings():this.element.siblings(),this.buttonElement=t.filter(e),this.buttonElement.length||(this.buttonElement=t.find(e))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(m+" ui-state-active "+p).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(t,e){return this._super(t,e),"disabled"===t?(this.widget().toggleClass("ui-state-disabled",!!e),this.element.prop("disabled",!!e),void(e&&this.buttonElement.removeClass("checkbox"===this.type||"radio"===this.type?"ui-state-focus":"ui-state-focus ui-state-active"))):void this._resetButton()},refresh:function(){var e=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOption("disabled",e),"radio"===this.type?g(this.element[0]).each(function(){t(this).is(":checked")?t(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):t(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return void(this.options.label&&this.element.val(this.options.label));var e=this.buttonElement.removeClass(p),i=t("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(e.empty()).text(),s=this.options.icons,n=s.primary&&s.secondary,o=[];s.primary||s.secondary?(this.options.text&&o.push("ui-button-text-icon"+(n?"s":s.primary?"-primary":"-secondary")),s.primary&&e.prepend("<span class='ui-button-icon-primary ui-icon "+s.primary+"'></span>"),s.secondary&&e.append("<span class='ui-button-icon-secondary ui-icon "+s.secondary+"'></span>"),this.options.text||(o.push(n?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||e.attr("title",t.trim(i)))):o.push("ui-button-text-only"),e.addClass(o.join(" "))}}),t.widget("ui.buttonset",{version:"1.11.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(t,e){"disabled"===t&&this.buttons.button("option",t,e),this._super(t,e)},refresh:function(){var e="rtl"===this.element.css("direction"),i=this.element.find(this.options.items),s=i.filter(":ui-button");i.not(":ui-button").button(),s.button("refresh"),this.buttons=i.map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(e?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(e?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}}),t.ui.button,t.extend(t.ui,{datepicker:{version:"1.11.4"}});var _;t.extend(n.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return r(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var s,n,o;s=e.nodeName.toLowerCase(),n="div"===s||"span"===s,e.id||(this.uuid+=1,e.id="dp"+this.uuid),o=this._newInst(t(e),n),o.settings=t.extend({},i||{}),"input"===s?this._connectDatepicker(e,o):n&&this._inlineDatepicker(e,o)},_newInst:function(e,i){var s=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?o(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var s=t(e);i.append=t([]),i.trigger=t([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var s,n,o,a=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),a&&(i.append=t("<span class='"+this._appendClass+"'>"+a+"</span>"),e[r?"before":"after"](i.append)),e.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&e.focus(this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:n,title:n}):n)),e[r?"before":"after"](i.trigger),i.trigger.click(function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,s,n,o=new Date(2009,11,20),a=this._get(t,"dateFormat");a.match(/[DM]/)&&(e=function(t){for(i=0,s=0,n=0;t.length>n;n++)t[n].length>i&&(i=t[n].length,s=n);return s},o.setMonth(e(this._get(t,a.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,a.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length)}},_inlineDatepicker:function(e,i){var s=t(e);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,s,n,o){var a,l,d,h,c,u=this._dialogInst;return u||(this.uuid+=1,a="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+a+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),t("body").append(this._dialogInput),u=this._dialogInst=this._newInst(this._dialogInput,!1),u.settings={},t.data(this._dialogInput[0],"datepicker",u)),r(u.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(u,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(l=document.documentElement.clientWidth,d=document.documentElement.clientHeight,h=document.documentElement.scrollLeft||document.body.scrollLeft,c=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[l/2-100+h,d/2-150+c]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),u.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",u),this},_destroyDatepicker:function(e){var i,s=t(e),n=t.data(e,"datepicker");s.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty(),_===n&&(_=null))},_enableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(i){throw"Missing instance data for this datepicker"
}},_optionDatepicker:function(e,i,s){var n,o,a,l,d=this._getInst(e);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):d?"all"===i?t.extend({},d.settings):this._get(d,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),void(d&&(this._curInst===d&&this._hideDatepicker(),o=this._getDateDatepicker(e,!0),a=this._getMinMaxDate(d,"min"),l=this._getMinMaxDate(d,"max"),r(d.settings,n),null!==a&&void 0!==n.dateFormat&&void 0===n.minDate&&(d.settings.minDate=this._formatDate(d,a)),null!==l&&void 0!==n.dateFormat&&void 0===n.maxDate&&(d.settings.maxDate=this._formatDate(d,l)),"disabled"in n&&(n.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),d),this._autoSize(d),this._setDate(d,o),this._updateAlternate(d),this._updateDatepicker(d))))},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,s,n,o=t.datepicker._getInst(e.target),a=!0,r=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),a=!1;break;case 13:return n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv),n[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,n[0]),i=t.datepicker._get(o,"onSelect"),i?(s=t.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[s,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),a=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),a=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?1:-1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),a=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?-1:1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),a=e.ctrlKey||e.metaKey;break;default:a=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):a=!1;a&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,s,n=t.datepicker._getInst(e.target);return t.datepicker._get(n,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(e){var i,s=t.datepicker._getInst(e.target);if(s.input.val()!==s.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,t.datepicker._getFormatConfig(s)),i&&(t.datepicker._setDateFromField(s),t.datepicker._updateAlternate(s),t.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var i,n,o,a,l,d,h;i=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==i&&(t.datepicker._curInst.dpDiv.stop(!0,!0),i&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),n=t.datepicker._get(i,"beforeShow"),o=n?n.apply(e,[e,i]):{},o!==!1&&(r(i.settings,o),i.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(i),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),a=!1,t(e).parents().each(function(){return a|="fixed"===t(this).css("position"),!a}),l={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(i),l=t.datepicker._checkOffset(i,l,a),i.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":a?"fixed":"absolute",display:"none",left:l.left+"px",top:l.top+"px"}),i.inline||(d=t.datepicker._get(i,"showAnim"),h=t.datepicker._get(i,"duration"),i.dpDiv.css("z-index",s(t(e))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[d]?i.dpDiv.show(d,t.datepicker._get(i,"showOptions"),h):i.dpDiv[d||"show"](d?h:null),t.datepicker._shouldFocusInput(i)&&i.input.focus(),t.datepicker._curInst=i))}},_updateDatepicker:function(e){this.maxRows=4,_=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,s=this._getNumberOfMonths(e),n=s[1],o=17,r=e.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&a.apply(r.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",o*n+"em"),e.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.focus(),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,s){var n=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),a=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,l=document.documentElement.clientWidth+(s?0:t(document).scrollLeft()),d=document.documentElement.clientHeight+(s?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-a:0,i.left-=s&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=s&&i.top===e.input.offset().top+r?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>l&&l>n?Math.abs(i.left+n-l):0),i.top-=Math.min(i.top,i.top+o>d&&d>o?Math.abs(o+r):0),i},_findPos:function(e){for(var i,s=this._getInst(e),n=this._get(s,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,s,n,o,a=this._curInst;!a||e&&a!==t.data(e,"datepicker")||this._datepickerShowing&&(i=this._get(a,"showAnim"),s=this._get(a,"duration"),n=function(){t.datepicker._tidyDialog(a)},t.effects&&(t.effects.effect[i]||t.effects[i])?a.dpDiv.hide(i,t.datepicker._get(a,"showOptions"),s,n):a.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,o=this._get(a,"onClose"),o&&o.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),s=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==s)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,s){var n=t(e),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===s?this._get(o,"showCurrentAtPos"):0),s),this._updateDatepicker(o))},_gotoToday:function(e){var i,s=t(e),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(e,i,s){var n=t(e),o=this._getInst(n[0]);o["selected"+("M"===s?"Month":"Year")]=o["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(e,i,s,n){var o,a=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(a[0])||(o=this._getInst(a[0]),o.selectedDay=o.currentDay=t("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=s,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var s,n=t(e),o=this._getInst(n[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),s=this._get(o,"onSelect"),s?s.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var i,s,n,o=this._get(e,"altField");o&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),s=this._getDate(e),n=this.formatDate(i,s,this._getFormatConfig(e)),t(o).each(function(){t(this).val(n)}))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,s){if(null==e||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,o,a,r,l=0,d=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,h="string"!=typeof d?d:(new Date).getFullYear()%100+parseInt(d,10),c=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,u=(s?s.dayNames:null)||this._defaults.dayNames,m=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,p=(s?s.monthNames:null)||this._defaults.monthNames,f=-1,g=-1,_=-1,b=-1,v=!1,y=function(t){var i=e.length>n+1&&e.charAt(n+1)===t;return i&&n++,i},w=function(t){var e=y(t),s="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n="y"===t?s:1,o=RegExp("^\\d{"+n+","+s+"}"),a=i.substring(l).match(o);if(!a)throw"Missing number at position "+l;return l+=a[0].length,parseInt(a[0],10)},C=function(e,s,n){var o=-1,a=t.map(y(e)?n:s,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(a,function(t,e){var s=e[1];return i.substr(l,s.length).toLowerCase()===s.toLowerCase()?(o=e[0],l+=s.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+l},S=function(){if(i.charAt(l)!==e.charAt(n))throw"Unexpected literal at position "+l;l++};for(n=0;e.length>n;n++)if(v)"'"!==e.charAt(n)||y("'")?S():v=!1;else switch(e.charAt(n)){case"d":_=w("d");break;case"D":C("D",c,u);break;case"o":b=w("o");break;case"m":g=w("m");break;case"M":g=C("M",m,p);break;case"y":f=w("y");break;case"@":r=new Date(w("@")),f=r.getFullYear(),g=r.getMonth()+1,_=r.getDate();break;case"!":r=new Date((w("!")-this._ticksTo1970)/1e4),f=r.getFullYear(),g=r.getMonth()+1,_=r.getDate();break;case"'":y("'")?S():v=!0;break;default:S()}if(i.length>l&&(a=i.substr(l),!/^\s+/.test(a)))throw"Extra/unparsed characters found in date: "+a;if(-1===f?f=(new Date).getFullYear():100>f&&(f+=(new Date).getFullYear()-(new Date).getFullYear()%100+(h>=f?0:-100)),b>-1)for(g=1,_=b;o=this._getDaysInMonth(f,g-1),!(o>=_);)g++,_-=o;if(r=this._daylightSavingAdjust(new Date(f,g-1,_)),r.getFullYear()!==f||r.getMonth()+1!==g||r.getDate()!==_)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864e9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,a=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,l=function(e){var i=t.length>s+1&&t.charAt(s+1)===e;return i&&s++,i},d=function(t,e,i){var s=""+e;if(l(t))for(;i>s.length;)s="0"+s;return s},h=function(t,e,i,s){return l(t)?s[e]:i[e]},c="",u=!1;if(e)for(s=0;t.length>s;s++)if(u)"'"!==t.charAt(s)||l("'")?c+=t.charAt(s):u=!1;else switch(t.charAt(s)){case"d":c+=d("d",e.getDate(),2);break;case"D":c+=h("D",e.getDay(),n,o);break;case"o":c+=d("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":c+=d("m",e.getMonth()+1,2);break;case"M":c+=h("M",e.getMonth(),a,r);break;case"y":c+=l("y")?e.getFullYear():(10>e.getYear()%100?"0":"")+e.getYear()%100;break;case"@":c+=e.getTime();break;case"!":c+=1e4*e.getTime()+this._ticksTo1970;break;case"'":l("'")?c+="'":u=!0;break;default:c+=t.charAt(s)}return c},_possibleChars:function(t){var e,i="",s=!1,n=function(i){var s=t.length>e+1&&t.charAt(e+1)===i;return s&&e++,s};for(e=0;t.length>e;e++)if(s)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):s=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return void 0!==t.settings[e]?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),s=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),o=n,a=this._getFormatConfig(t);try{o=this.parseDate(i,s,a)||n}catch(r){s=e?"":s}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=s?o.getDate():0,t.currentMonth=s?o.getMonth():0,t.currentYear=s?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,s){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},o=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,o=n.getFullYear(),a=n.getMonth(),r=n.getDate(),l=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,d=l.exec(i);d;){switch(d[2]||"d"){case"d":case"D":r+=parseInt(d[1],10);break;case"w":case"W":r+=7*parseInt(d[1],10);break;case"m":case"M":a+=parseInt(d[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a));break;case"y":case"Y":o+=parseInt(d[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a))}d=l.exec(i)}return new Date(o,a,r)},a=null==i||""===i?s:"string"==typeof i?o(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return a=a&&"Invalid Date"==""+a?s:a,a&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var s=!e,n=t.selectedMonth,o=t.selectedYear,a=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=a.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=a.getMonth(),t.drawYear=t.selectedYear=t.currentYear=a.getFullYear(),n===t.selectedMonth&&o===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(s?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),s="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(s,-i,"M")},next:function(){t.datepicker._adjustDate(s,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(s)},selectDay:function(){return t.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(s,this,"Y"),!1}};t(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,s,n,o,a,r,l,d,h,c,u,m,p,f,g,_,b,v,y,w,C,S,k,M,T,D,I,x,P,F,$,A,L,O,E,W,B,z,N=new Date,R=this._daylightSavingAdjust(new Date(N.getFullYear(),N.getMonth(),N.getDate())),U=this._get(t,"isRTL"),j=this._get(t,"showButtonPanel"),H=this._get(t,"hideIfNoPrevNext"),q=this._get(t,"navigationAsDateFormat"),V=this._getNumberOfMonths(t),Q=this._get(t,"showCurrentAtPos"),G=this._get(t,"stepMonths"),Y=1!==V[0]||1!==V[1],K=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),X=this._getMinMaxDate(t,"min"),Z=this._getMinMaxDate(t,"max"),J=t.drawMonth-Q,te=t.drawYear;if(0>J&&(J+=12,te--),Z)for(e=this._daylightSavingAdjust(new Date(Z.getFullYear(),Z.getMonth()-V[0]*V[1]+1,Z.getDate())),e=X&&X>e?X:e;this._daylightSavingAdjust(new Date(te,J,1))>e;)J--,0>J&&(J=11,te--);for(t.drawMonth=J,t.drawYear=te,i=this._get(t,"prevText"),i=q?this.formatDate(i,this._daylightSavingAdjust(new Date(te,J-G,1)),this._getFormatConfig(t)):i,s=this._canAdjustMonth(t,-1,te,J)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+i+"</span></a>":H?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=q?this.formatDate(n,this._daylightSavingAdjust(new Date(te,J+G,1)),this._getFormatConfig(t)):n,o=this._canAdjustMonth(t,1,te,J)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+n+"</span></a>":H?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+n+"</span></a>",a=this._get(t,"currentText"),r=this._get(t,"gotoCurrent")&&t.currentDay?K:R,a=q?this.formatDate(a,r,this._getFormatConfig(t)):a,l=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",d=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(U?l:"")+(this._isInRange(t,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+a+"</button>":"")+(U?"":l)+"</div>":"",h=parseInt(this._get(t,"firstDay"),10),h=isNaN(h)?0:h,c=this._get(t,"showWeek"),u=this._get(t,"dayNames"),m=this._get(t,"dayNamesMin"),p=this._get(t,"monthNames"),f=this._get(t,"monthNamesShort"),g=this._get(t,"beforeShowDay"),_=this._get(t,"showOtherMonths"),b=this._get(t,"selectOtherMonths"),v=this._getDefaultDate(t),y="",C=0;V[0]>C;C++){for(S="",this.maxRows=4,k=0;V[1]>k;k++){if(M=this._daylightSavingAdjust(new Date(te,J,t.selectedDay)),T=" ui-corner-all",D="",Y){if(D+="<div class='ui-datepicker-group",V[1]>1)switch(k){case 0:D+=" ui-datepicker-group-first",T=" ui-corner-"+(U?"right":"left");break;case V[1]-1:D+=" ui-datepicker-group-last",T=" ui-corner-"+(U?"left":"right");break;default:D+=" ui-datepicker-group-middle",T=""}D+="'>"}for(D+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+T+"'>"+(/all|left/.test(T)&&0===C?U?o:s:"")+(/all|right/.test(T)&&0===C?U?s:o:"")+this._generateMonthYearHeader(t,J,te,X,Z,C>0||k>0,p,f)+"</div><table class='ui-datepicker-calendar'><thead><tr>",I=c?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;7>w;w++)x=(w+h)%7,I+="<th scope='col'"+((w+h+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+u[x]+"'>"+m[x]+"</span></th>";for(D+=I+"</tr></thead><tbody>",P=this._getDaysInMonth(te,J),te===t.selectedYear&&J===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,P)),F=(this._getFirstDayOfMonth(te,J)-h+7)%7,$=Math.ceil((F+P)/7),A=Y&&this.maxRows>$?this.maxRows:$,this.maxRows=A,L=this._daylightSavingAdjust(new Date(te,J,1-F)),O=0;A>O;O++){for(D+="<tr>",E=c?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(L)+"</td>":"",w=0;7>w;w++)W=g?g.apply(t.input?t.input[0]:null,[L]):[!0,""],B=L.getMonth()!==J,z=B&&!b||!W[0]||X&&X>L||Z&&L>Z,E+="<td class='"+((w+h+6)%7>=5?" ui-datepicker-week-end":"")+(B?" ui-datepicker-other-month":"")+(L.getTime()===M.getTime()&&J===t.selectedMonth&&t._keyEvent||v.getTime()===L.getTime()&&v.getTime()===M.getTime()?" "+this._dayOverClass:"")+(z?" "+this._unselectableClass+" ui-state-disabled":"")+(B&&!_?"":" "+W[1]+(L.getTime()===K.getTime()?" "+this._currentClass:"")+(L.getTime()===R.getTime()?" ui-datepicker-today":""))+"'"+(B&&!_||!W[2]?"":" title='"+W[2].replace(/'/g,"&#39;")+"'")+(z?"":" data-handler='selectDay' data-event='click' data-month='"+L.getMonth()+"' data-year='"+L.getFullYear()+"'")+">"+(B&&!_?"&#xa0;":z?"<span class='ui-state-default'>"+L.getDate()+"</span>":"<a class='ui-state-default"+(L.getTime()===R.getTime()?" ui-state-highlight":"")+(L.getTime()===K.getTime()?" ui-state-active":"")+(B?" ui-priority-secondary":"")+"' href='#'>"+L.getDate()+"</a>")+"</td>",L.setDate(L.getDate()+1),L=this._daylightSavingAdjust(L);D+=E+"</tr>"}J++,J>11&&(J=0,te++),D+="</tbody></table>"+(Y?"</div>"+(V[0]>0&&k===V[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),S+=D}y+=S}return y+=d,t._keyEvent=!1,y},_generateMonthYearHeader:function(t,e,i,s,n,o,a,r){var l,d,h,c,u,m,p,f,g=this._get(t,"changeMonth"),_=this._get(t,"changeYear"),b=this._get(t,"showMonthAfterYear"),v="<div class='ui-datepicker-title'>",y="";if(o||!g)y+="<span class='ui-datepicker-month'>"+a[e]+"</span>";else{for(l=s&&s.getFullYear()===i,d=n&&n.getFullYear()===i,y+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",h=0;12>h;h++)(!l||h>=s.getMonth())&&(!d||n.getMonth()>=h)&&(y+="<option value='"+h+"'"+(h===e?" selected='selected'":"")+">"+r[h]+"</option>");y+="</select>"}if(b||(v+=y+(!o&&g&&_?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!_)v+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(c=this._get(t,"yearRange").split(":"),u=(new Date).getFullYear(),m=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?u+parseInt(t,10):parseInt(t,10);return isNaN(e)?u:e},p=m(c[0]),f=Math.max(p,m(c[1]||"")),p=s?Math.max(p,s.getFullYear()):p,f=n?Math.min(f,n.getFullYear()):f,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";f>=p;p++)t.yearshtml+="<option value='"+p+"'"+(p===i?" selected='selected'":"")+">"+p+"</option>";t.yearshtml+="</select>",v+=t.yearshtml,t.yearshtml=null}return v+=this._get(t,"yearSuffix"),b&&(v+=(!o&&g&&_?"":"&#xa0;")+y),v+="</div>"},_adjustInstDate:function(t,e,i){var s=t.drawYear+("Y"===i?e:0),n=t.drawMonth+("M"===i?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(s,n))+("D"===i?e:0),a=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(s,n,o)));t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),s=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return s&&n>s?s:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,s){var n=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(i,s+(0>e?e:n[0]*n[1]),1));return 0>e&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var i,s,n=this._getMinMaxDate(t,"min"),o=this._getMinMaxDate(t,"max"),a=null,r=null,l=this._get(t,"yearRange");return l&&(i=l.split(":"),s=(new Date).getFullYear(),a=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(a+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||e.getTime()>=n.getTime())&&(!o||e.getTime()<=o.getTime())&&(!a||e.getFullYear()>=a)&&(!r||r>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,s){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(s,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).mousedown(t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new n,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.11.4",t.datepicker,t.widget("ui.dialog",{version:"1.11.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var i,s=this;if(this._isOpen&&this._trigger("beforeClose",e)!==!1){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{i=this.document[0].activeElement,i&&"body"!==i.nodeName.toLowerCase()&&t(i).blur()}catch(n){}this._hide(this.uiDialog,this.options.hide,function(){s._trigger("close",e)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),o=Math.max.apply(null,n);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),s=!0),s&&!i&&this._trigger("focus",e),s},open:function(){var e=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=t(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).focus()},_keepFocus:function(e){function i(){var e=this.document[0].activeElement,i=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);i||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==s[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){n.focus()}),e.preventDefault()):(this._delay(function(){s.focus()}),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(e),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title||t.html("&#160;"),t.text(this.options.title)
},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?void this.uiDialog.removeClass("ui-dialog-buttons"):(t.each(i,function(i,s){var n,o;s=t.isFunction(s)?{click:s,text:i}:s,s=t.extend({type:"button"},s),n=s.click,s.click=function(){n.apply(e.element[0],arguments)},o={icons:s.icons,text:s.showText},delete s.icons,delete s.showText,t("<button></button>",s).button(o).appendTo(e.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){t(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,e(n))},drag:function(t,s){i._trigger("drag",t,e(s))},stop:function(n,o){var a=o.offset.left-i.document.scrollLeft(),r=o.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" top"+(r>=0?"+":"")+r,of:i.window},t(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,s=this.options,n=s.resizable,o=this.uiDialog.css("position"),a="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:a,start:function(s,n){t(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,e(n))},resize:function(t,s){i._trigger("resize",t,e(s))},stop:function(n,o){var a=i.uiDialog.offset(),r=a.left-i.document.scrollLeft(),l=a.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" top"+(l>=0?"+":"")+l,of:i.window},t(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,s=!1,n={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(s=!0),t in i.resizableRelatedOptions&&(n[t]=e)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(t,e){var i,s,n=this.uiDialog;"dialogClass"===t&&n.removeClass(this.options.dialogClass).addClass(e),"disabled"!==t&&(this._super(t,e),"appendTo"===t&&this.uiDialog.appendTo(this._appendTo()),"buttons"===t&&this._createButtons(),"closeText"===t&&this.uiDialogTitlebarClose.button({label:""+e}),"draggable"===t&&(i=n.is(":data(ui-draggable)"),i&&!e&&n.draggable("destroy"),!i&&e&&this._makeDraggable()),"position"===t&&this._position(),"resizable"===t&&(s=n.is(":data(ui-resizable)"),s&&!e&&n.resizable("destroy"),s&&"string"==typeof e&&n.resizable("option","handles",e),s||e===!1||this._makeResizable()),"title"===t&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),t=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),e=Math.max(0,s.minHeight-t),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-t):"none","auto"===s.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return t(e.target).closest(".ui-dialog").length?!0:!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null}}}),t.widget("ui.progressbar",{version:"1.11.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=t("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(t){return void 0===t?this.options.value:(this.options.value=this._constrainedValue(t),void this._refreshValue())},_constrainedValue:function(t){return void 0===t&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!e).attr("aria-disabled",e),this._super(t,e)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.selectmenu",{version:"1.11.4",defaultElement:"<select>",options:{appendTo:null,disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var t=this.element.uniqueId().attr("id");this.ids={element:t,button:t+"-button",menu:t+"-menu"},this._drawButton(),this._drawMenu(),this.options.disabled&&this.disable()},_drawButton:function(){var e=this;this.label=t("label[for='"+this.ids.element+"']").attr("for",this.ids.button),this._on(this.label,{click:function(t){this.button.focus(),t.preventDefault()}}),this.element.hide(),this.button=t("<span>",{"class":"ui-selectmenu-button ui-widget ui-state-default ui-corner-all",tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true"}).insertAfter(this.element),t("<span>",{"class":"ui-icon "+this.options.icons.button}).prependTo(this.button),this.buttonText=t("<span>",{"class":"ui-selectmenu-text"}).appendTo(this.button),this._setText(this.buttonText,this.element.find("option:selected").text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){e.menuItems||e._refreshMenu()}),this._hoverable(this.button),this._focusable(this.button)},_drawMenu:function(){var e=this;this.menu=t("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=t("<div>",{"class":"ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:"listbox",select:function(t,i){t.preventDefault(),e._setSelection(),e._select(i.item.data("ui-selectmenu-item"),t)},focus:function(t,i){var s=i.item.data("ui-selectmenu-item");null!=e.focusIndex&&s.index!==e.focusIndex&&(e._trigger("focus",t,{item:s}),e.isOpen||e._select(s,t)),e.focusIndex=s.index,e.button.attr("aria-activedescendant",e.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton()},_refreshMenu:function(){this.menu.empty();var t,e=this.element.find("option");e.length&&(this._parseOptions(e),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup"),t=this._getSelectedItem(),this.menuInstance.focus(null,t),this._setAria(t.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(t){this.options.disabled||(this.menuItems?(this.menu.find(".ui-state-focus").removeClass("ui-state-focus"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",t))},_position:function(){this.menuWrap.position(t.extend({of:this.button},this.options.position))},close:function(t){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",t))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderMenu:function(e,i){var s=this,n="";t.each(i,function(i,o){o.optgroup!==n&&(t("<li>",{"class":"ui-selectmenu-optgroup ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""),text:o.optgroup}).appendTo(e),n=o.optgroup),s._renderItemData(e,o)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-selectmenu-item",e)},_renderItem:function(e,i){var s=t("<li>");return i.disabled&&s.addClass("ui-state-disabled"),this._setText(s,i.label),s.appendTo(e)},_setText:function(t,e){e?t.text(e):t.html("&#160;")},_move:function(t,e){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex):(i=this.menuItems.eq(this.element[0].selectedIndex),n+=":not(.ui-state-disabled)"),s="first"===t||"last"===t?i["first"===t?"prevAll":"nextAll"](n).eq(-1):i[t+"All"](n).eq(0),s.length&&this.menuInstance.focus(e,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex)},_toggle:function(t){this[this.isOpen?"close":"open"](t)},_setSelection:function(){var t;this.range&&(window.getSelection?(t=window.getSelection(),t.removeAllRanges(),t.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(e){this.isOpen&&(t(e.target).closest(".ui-selectmenu-menu, #"+this.ids.button).length||this.close(e))}},_buttonEvents:{mousedown:function(){var t;window.getSelection?(t=window.getSelection(),t.rangeCount&&(this.range=t.getRangeAt(0))):this.range=document.selection.createRange()},click:function(t){this._setSelection(),this._toggle(t)},keydown:function(e){var i=!0;switch(e.keyCode){case t.ui.keyCode.TAB:case t.ui.keyCode.ESCAPE:this.close(e),i=!1;break;case t.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case t.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case t.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case t.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case t.ui.keyCode.LEFT:this._move("prev",e);break;case t.ui.keyCode.RIGHT:this._move("next",e);break;case t.ui.keyCode.HOME:case t.ui.keyCode.PAGE_UP:this._move("first",e);break;case t.ui.keyCode.END:case t.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),i=!1}i&&e.preventDefault()}},_selectFocusedItem:function(t){var e=this.menuItems.eq(this.focusIndex);e.hasClass("ui-state-disabled")||this._select(e.data("ui-selectmenu-item"),t)},_select:function(t,e){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=t.index,this._setText(this.buttonText,t.label),this._setAria(t),this._trigger("select",e,{item:t}),t.index!==i&&this._trigger("change",e,{item:t}),this.close(e)},_setAria:function(t){var e=this.menuItems.eq(t.index).attr("id");this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(t,e){"icons"===t&&this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(e.button),this._super(t,e),"appendTo"===t&&this.menuWrap.appendTo(this._appendTo()),"disabled"===t&&(this.menuInstance.option("disabled",e),this.button.toggleClass("ui-state-disabled",e).attr("aria-disabled",e),this.element.prop("disabled",e),e?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)),"width"===t&&this._resizeButton()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front")),e.length||(e=this.document[0].body),e},_toggleAttr:function(){this.button.toggleClass("ui-corner-top",this.isOpen).toggleClass("ui-corner-all",!this.isOpen).attr("aria-expanded",this.isOpen),this.menuWrap.toggleClass("ui-selectmenu-open",this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var t=this.options.width;t||(t=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(t)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){return{disabled:this.element.prop("disabled")}},_parseOptions:function(e){var i=[];e.each(function(e,s){var n=t(s),o=n.parent("optgroup");i.push({element:n,index:e,value:n.val(),label:n.text(),optgroup:o.attr("label")||"",disabled:o.prop("disabled")||n.prop("disabled")})}),this.items=i},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr("for",this.ids.element)}}),t.widget("ui.slider",t.ui.mouse,{version:"1.11.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,s=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o="<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>",a=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)a.push(o);this.handles=n.add(t(a.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e)})},_createRange:function(){var e=this.options,i="";e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=t("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===e.range||"max"===e.range?" ui-slider-range-"+e.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(e){var i,s,n,o,a,r,l,d,h=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-h.values(e));(n>i||n===i&&(e===h._lastChangedValue||h.values(e)===c.min))&&(n=i,o=t(this),a=e)}),r=this._start(e,a),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=a,o.addClass("ui-state-active").focus(),l=o.offset(),d=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=d?{left:0,top:0}:{left:e.pageX-l.left-o.width()/2,top:e.pageY-l.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,s,n,o;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/e,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),o=this._valueMin()+s*n,this._trimAlignValue(o)},_start:function(t,e){var i={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("start",t,i)},_slide:function(t,e,i){var s,n,o;this.options.values&&this.options.values.length?(s=this.values(e?0:1),2===this.options.values.length&&this.options.range===!0&&(0===e&&i>s||1===e&&s>i)&&(i=s),i!==this.values(e)&&(n=this.values(),n[e]=i,o=this._trigger("slide",t,{handle:this.handles[e],value:i,values:n}),s=this.values(e?0:1),o!==!1&&this.values(e,i))):i!==this.value()&&(o=this._trigger("slide",t,{handle:this.handles[e],value:i}),o!==!1&&this.value(i))},_stop:function(t,e){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("stop",t,i)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._lastChangedValue=e,this._trigger("change",t,i)}},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,i){var s,n,o;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(s=this.options.values,n=arguments[0],o=0;s.length>o;o+=1)s[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!i),this._super(e,i),e){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;n>s;s+=1)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,s;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,s=t-i;return 2*Math.abs(i)>=e&&(s+=i>0?e:-e),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step,s=Math.floor(+(t-e).toFixed(this._precision())/i)*i;t=s+e,this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var e,i,s,n,o,a=this.options.range,r=this.options,l=this,d=this._animateOff?!1:r.animate,h={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=100*((l.values(s)-l._valueMin())/(l._valueMax()-l._valueMin())),h["horizontal"===l.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[d?"animate":"css"](h,r.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===s&&l.range.stop(1,1)[d?"animate":"css"]({left:i+"%"},r.animate),1===s&&l.range[d?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&l.range.stop(1,1)[d?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&l.range[d?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?100*((s-n)/(o-n)):0,h["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[d?"animate":"css"](h,r.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[d?"animate":"css"]({width:i+"%"},r.animate),"max"===a&&"horizontal"===this.orientation&&this.range[d?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:r.animate}),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[d?"animate":"css"]({height:i+"%"},r.animate),"max"===a&&"vertical"===this.orientation&&this.range[d?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(e){var i,s,n,o,a=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,t(e.target).addClass("ui-state-active"),i=this._start(e,a),i===!1))return}switch(o=this.options.step,s=n=this.options.values&&this.options.values.length?this.values(a):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-o)}this._slide(e,a,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),t(e.target).removeClass("ui-state-active"))}}}),t.widget("ui.spinner",{version:"1.11.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e={},i=this.element;return t.each(["min","max","step"],function(t,s){var n=i.attr(s);void 0!==n&&n.length&&(e[s]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",t)))},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){var t=this.element[0]===this.document[0].activeElement;t||(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)===!1?!1:void this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var t=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=t.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*t.height())&&t.height()>0&&t.height(t.height()),this.options.disabled&&this.disable()},_keydown:function(e){var i=this.options,s=t.ui.keyCode;switch(e.keyCode){case s.UP:return this._repeat(null,1,e),!0;case s.DOWN:return this._repeat(null,-1,e),!0;case s.PAGE_UP:return this._repeat(null,i.page,e),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(t){return this.spinning||this._trigger("start",t)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,s=this.options;return e=null!==s.min?s.min:0,i=t-e,i=Math.round(i/s.step)*s.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==s.max&&t>s.max?s.max:null!==s.min&&s.min>t?s.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){if("culture"===t||"numberFormat"===t){var i=this._parse(this.element.val());return this.options[t]=e,void this.element.val(this._format(i))}("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(e.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(e.down)),this._super(t,e),"disabled"===t&&(this.widget().toggleClass("ui-state-disabled",!!e),this.element.prop("disabled",!!e),this.buttons.button(e?"disable":"enable"))},_setOptions:l(function(t){this._super(t)}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null===t?!1:t===this._adjustValue(t)},_value:function(t,e){var i;""!==t&&(i=this._parse(t),null!==i&&(e||(i=this._adjustValue(i)),t=this._format(i))),this.element.val(t),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)
},stepUp:l(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:l(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:l(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:l(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?void l(this._value).call(this,t):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),t.widget("ui.tabs",{version:"1.11.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var t=/#.*$/;return function(e){var i,s;e=e.cloneNode(!1),i=e.href.replace(t,""),s=location.href.replace(t,"");try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return e.hash.length>1&&i===s}}(),_create:function(){var e=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===e&&(s&&this.tabs.each(function(i,n){return t(n).attr("aria-controls")===s?(e=i,!1):void 0}),null===e&&(e=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===e||-1===e)&&(e=this.tabs.length?0:!1)),e!==!1&&(e=this.tabs.index(this.tabs.eq(e)),-1===e&&(e=i?!1:0)),!i&&e===!1&&this.anchors.length&&(e=0),e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(this.document[0].activeElement).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:s++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:n=!1,s--;break;case t.ui.keyCode.END:s=this.anchors.length-1;break;case t.ui.keyCode.HOME:s=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),void this._activate(s);case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),void this._activate(s===this.options.active?!1:s);default:return}e.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),e.ctrlKey||e.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.focus())},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){function s(){return e>n&&(e=0),0>e&&(e=n),e}for(var n=this.tabs.length-1;-1!==t.inArray(s(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).focus(),t},_setOption:function(t,e){return"active"===t?void this._activate(e):"disabled"===t?void this._setupDisabled(e):(this._super(t,e),"collapsible"===t&&(this.element.toggleClass("ui-tabs-collapsible",e),e||this.options.active!==!1||this._activate(0)),"event"===t&&this._setupEvents(e),void("heightStyle"===t&&this._setupHeightStyle(e)))},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),e.active!==!1&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=t(),this.anchors.each(function(i,s){var n,o,a,r=t(s).uniqueId().attr("id"),l=t(s).closest("li"),d=l.attr("aria-controls");e._isLocal(s)?(n=s.hash,a=n.substring(1),o=e.element.find(e._sanitizeSelector(n))):(a=l.attr("aria-controls")||t({}).uniqueId()[0].id,n="#"+a,o=e.element.find(n),o.length||(o=e._createPanel(a),o.insertAfter(e.panels[i-1]||e.tablist)),o.attr("aria-live","polite")),o.length&&(e.panels=e.panels.add(o)),d&&l.data("ui-tabs-aria-controls",d),l.attr({"aria-controls":a,"aria-labelledby":r}),o.attr("aria-labelledby",r)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(e){t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1);for(var i,s=0;i=this.tabs[s];s++)e===!0||-1!==t.inArray(s,e)?t(i).addClass("ui-state-disabled").attr("aria-disabled","true"):t(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=e},_setupEvents:function(e){var i={};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(t){t.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,s=this.element.parent();"fill"===e?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),s=e.css("position");"absolute"!==s&&"fixed"!==s&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,s=this.active,n=t(e.currentTarget),o=n.closest("li"),a=o[0]===s[0],r=a&&i.collapsible,l=r?t():this._getPanelForTab(o),d=s.length?this._getPanelForTab(s):t(),h={oldTab:s,oldPanel:d,newTab:r?t():o,newPanel:l};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||a&&!i.collapsible||this._trigger("beforeActivate",e,h)===!1||(i.active=r?!1:this.tabs.index(o),this.active=a?t():o,this.xhr&&this.xhr.abort(),d.length||l.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(o),e),this._toggle(e,h))},_toggle:function(e,i){function s(){o.running=!1,o._trigger("activate",e,i)}function n(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),a.length&&o.options.show?o._show(a,o.options.show,s):(a.show(),s())}var o=this,a=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),n()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),a.length&&r.length?i.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),a.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(e){var i,s=this._findActive(e);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return e===!1?t():this.tabs.eq(e)},_getIndex:function(t){return"string"==typeof t&&(t=this.anchors.index(this.anchors.filter("[href$='"+t+"']"))),t},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(e){var i=this.options.disabled;i!==!1&&(void 0===e?i=!1:(e=this._getIndex(e),i=t.isArray(i)?t.map(i,function(t){return t!==e?t:null}):t.map(this.tabs,function(t,i){return i!==e?i:null})),this._setupDisabled(i))},disable:function(e){var i=this.options.disabled;if(i!==!0){if(void 0===e)i=!0;else{if(e=this._getIndex(e),-1!==t.inArray(e,i))return;i=t.isArray(i)?t.merge([e],i).sort():[e]}this._setupDisabled(i)}},load:function(e,i){e=this._getIndex(e);var s=this,n=this.tabs.eq(e),o=n.find(".ui-tabs-anchor"),a=this._getPanelForTab(n),r={tab:n,panel:a},l=function(t,e){"abort"===e&&s.panels.stop(!1,!0),n.removeClass("ui-tabs-loading"),a.removeAttr("aria-busy"),t===s.xhr&&delete s.xhr};this._isLocal(o[0])||(this.xhr=t.ajax(this._ajaxSettings(o,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(n.addClass("ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.done(function(t,e,n){setTimeout(function(){a.html(t),s._trigger("load",i,r),l(n,e)},1)}).fail(function(t,e){setTimeout(function(){l(t,e)},1)})))},_ajaxSettings:function(e,i,s){var n=this;return{url:e.attr("href"),beforeSend:function(e,o){return n._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:o},s))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),t.widget("ui.tooltip",{version:"1.11.4",options:{content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var s=(e.attr("aria-describedby")||"").split(/\s+/);s.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(s.join(" ")))},_removeDescribedBy:function(e){var i=e.data("ui-tooltip-id"),s=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,s);-1!==n&&s.splice(n,1),e.removeData("ui-tooltip-id"),s=t.trim(s.join(" ")),s?e.attr("aria-describedby",s):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(e,i){var s=this;return"disabled"===e?(this[i?"_disable":"_enable"](),void(this.options[e]=i)):(this._super(e,i),void("content"===e&&t.each(this.tooltips,function(t,e){s._updateContent(e.element)})))},_disable:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s.element[0],e.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.is("[title]")&&e.data("ui-tooltip-title",e.attr("title")).removeAttr("title")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))})},open:function(e){var i=this,s=t(e?e.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&s.parents().each(function(){var e,s=t(this);s.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(e,s),this._updateContent(s,e))},_updateContent:function(t,e){var i,s=this.options.content,n=this,o=e?e.type:null;return"string"==typeof s?this._open(e,t,s):(i=s.call(t[0],function(i){n._delay(function(){t.data("ui-tooltip-open")&&(e&&(e.type=o),this._open(e,t,i))})}),void(i&&this._open(e,t,i)))},_open:function(e,i,s){function n(t){d.of=t,a.is(":hidden")||a.position(d)}var o,a,r,l,d=t.extend({},this.options.position);if(s){if(o=this._find(i))return void o.tooltip.find(".ui-tooltip-content").html(s);i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),o=this._tooltip(i),a=o.tooltip,this._addDescribedBy(i,a.attr("id")),a.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),s.clone?(l=s.clone(),l.removeAttr("id").find("[id]").removeAttr("id")):l=s,t("<div>").html(l).appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:n}),n(e)):a.position(t.extend({of:i},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){a.is(":visible")&&(n(d.of),clearInterval(r))},t.fx.interval)),this._trigger("open",e,{tooltip:a})}},_registerCloseHandlers:function(e,i){var s={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var s=t.Event(e);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),e&&"mouseover"!==e.type||(s.mouseleave="close"),e&&"focusin"!==e.type||(s.focusout="close"),this._on(!0,i,s)},close:function(e){var i,s=this,n=t(e?e.currentTarget:this.element),o=this._find(n);return o?(i=o.tooltip,void(o.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete s.parents[e]}),o.closing=!0,this._trigger("close",e,{tooltip:i}),o.hiding||(o.closing=!1)))):void n.removeData("ui-tooltip-open")},_tooltip:function(e){var i=t("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),s=i.uniqueId().attr("id");return t("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[s]={element:e,tooltip:i}},_find:function(t){var e=t.data("ui-tooltip-id");return e?this.tooltips[e]:null},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_destroy:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur"),o=s.element;n.target=n.currentTarget=o[0],e.close(n,!0),t("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}});var b="ui-effects-",v=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var s=c[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:t>s.max?s.max:t)}function s(i){var s=d(),n=s._rgba=[];return i=i.toLowerCase(),p(l,function(t,o){var a,r=o.re.exec(i),l=r&&o.parse(r),d=o.space||"rgba";return l?(a=s[d](l),s[h[d].cache]=a[h[d].cache],n=s._rgba=a._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),s):o[i]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var o,a="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],d=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},h={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},c={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},u=d.support={},m=t("<p>")[0],p=t.each;m.style.cssText="background-color:rgba(1,1,1,.5)",u.rgba=m.style.backgroundColor.indexOf("rgba")>-1,p(h,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),d.fn=t.extend(d.prototype,{parse:function(n,a,r,l){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(a),a=e);var c=this,u=t.type(n),m=this._rgba=[];return a!==e&&(n=[n,a,r,l],u="array"),"string"===u?this.parse(s(n)||o._default):"array"===u?(p(h.rgba.props,function(t,e){m[e.idx]=i(n[e.idx],e)}),this):"object"===u?(n instanceof d?p(h,function(t,e){n[e.cache]&&(c[e.cache]=n[e.cache].slice())}):p(h,function(e,s){var o=s.cache;p(s.props,function(t,e){if(!c[o]&&s.to){if("alpha"===t||null==n[t])return;c[o]=s.to(c._rgba)}c[o][e.idx]=i(n[t],e,!0)}),c[o]&&0>t.inArray(null,c[o].slice(0,3))&&(c[o][3]=1,s.from&&(c._rgba=s.from(c[o])))}),this):e},is:function(t){var i=d(t),s=!0,n=this;return p(h,function(t,o){var a,r=i[o.cache];return r&&(a=n[o.cache]||o.to&&o.to(n._rgba)||[],p(o.props,function(t,i){return null!=r[i.idx]?s=r[i.idx]===a[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return p(h,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=d(t),n=s._space(),o=h[n],a=0===this.alpha()?d("transparent"):this,r=a[o.cache]||o.to(a._rgba),l=r.slice();return s=s[o.cache],p(o.props,function(t,n){var o=n.idx,a=r[o],d=s[o],h=c[n.type]||{};null!==d&&(null===a?l[o]=d:(h.mod&&(d-a>h.mod/2?a+=h.mod:a-d>h.mod/2&&(a-=h.mod)),l[o]=i((d-a)*e+a,n)))}),this[n](l)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=d(e)._rgba;return d(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),d.fn.parse.prototype=d.fn,h.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,s=t[0]/255,n=t[1]/255,o=t[2]/255,a=t[3],r=Math.max(s,n,o),l=Math.min(s,n,o),d=r-l,h=r+l,c=.5*h;return e=l===r?0:s===r?60*(n-o)/d+360:n===r?60*(o-s)/d+120:60*(s-n)/d+240,i=0===d?0:.5>=c?d/h:d/(2-h),[Math.round(e)%360,i,c,null==a?1:a]},h.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],o=t[3],a=.5>=s?s*(1+i):s+i-s*i,r=2*s-a;return[Math.round(255*n(r,a,e+1/3)),Math.round(255*n(r,a,e)),Math.round(255*n(r,a,e-1/3)),o]},p(h,function(s,n){var o=n.props,a=n.cache,l=n.to,h=n.from;d.fn[s]=function(s){if(l&&!this[a]&&(this[a]=l(this._rgba)),s===e)return this[a].slice();var n,r=t.type(s),c="array"===r||"object"===r?s:arguments,u=this[a].slice();return p(o,function(t,e){var s=c["object"===r?t:e.idx];null==s&&(s=u[e.idx]),u[e.idx]=i(s,e)}),h?(n=d(h(u)),n[a]=u,n):d(u)},p(o,function(e,i){d.fn[e]||(d.fn[e]=function(n){var o,a=t.type(n),l="alpha"===e?this._hsla?"hsla":"rgba":s,d=this[l](),h=d[i.idx];return"undefined"===a?h:("function"===a&&(n=n.call(this,h),a=t.type(n)),null==n&&i.empty?this:("string"===a&&(o=r.exec(n),o&&(n=h+parseFloat(o[2])*("+"===o[1]?1:-1))),d[i.idx]=n,this[l](d)))})})}),d.hook=function(e){var i=e.split(" ");p(i,function(e,i){t.cssHooks[i]={set:function(e,n){var o,a,r="";if("transparent"!==n&&("string"!==t.type(n)||(o=s(n)))){if(n=d(o||n),!u.rgba&&1!==n._rgba[3]){for(a="backgroundColor"===i?e.parentNode:e;(""===r||"transparent"===r)&&a&&a.style;)try{r=t.css(a,"backgroundColor"),a=a.parentNode}catch(l){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(l){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=d(e.elem,i),e.end=d(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},d.hook(a),t.cssHooks.borderColor={expand:function(t){var e={};return p(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(v),function(){function e(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(o[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function i(e,i){var s,o,a={};for(s in i)o=i[s],e[s]!==o&&(n[s]||(t.fx.step[s]||!isNaN(parseFloat(o)))&&(a[s]=o));return a}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(v.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(n,o,a,r){var l=t.speed(o,a,r);return this.queue(function(){var o,a=t(this),r=a.attr("class")||"",d=l.children?a.find("*").addBack():a;d=d.map(function(){var i=t(this);return{el:i,start:e(this)}}),o=function(){t.each(s,function(t,e){n[e]&&a[e+"Class"](n[e])})},o(),d=d.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),a.attr("class",r),d=d.map(function(){var e=this,i=t.Deferred(),s=t.extend({},l,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,d.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),l.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,o){return s?t.effects.animateClass.call(this,{add:i},s,n,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,n,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,s,n,o,a){return"boolean"==typeof s||void 0===s?n?t.effects.animateClass.call(this,s?{add:i}:{remove:i},n,o,a):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},s,n,o)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,o){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,o)}})}(),function(){function e(e,i,s,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function i(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}t.extend(t.effects,{version:"1.11.4",save:function(t,e){for(var i=0;e.length>i;i++)null!==e[i]&&t.data(b+e[i],t[0].style[e[i]])},restore:function(t,e){var i,s;for(s=0;e.length>s;s++)null!==e[s]&&(i=t.data(b+e[s]),void 0===i&&(i=""),t.css(e[s],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(a){o=document.body}return e.wrap(s),(e[0]===o||t.contains(e[0],o))&&t(o).focus(),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).focus()),e},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var o=e.cssUnit(i);o[0]>0&&(n[i]=o[0]*s+o[1])}),n}}),t.fn.extend({effect:function(){function i(e){function i(){t.isFunction(o)&&o.call(n[0]),t.isFunction(e)&&e()}var n=t(this),o=s.complete,r=s.mode;(n.is(":hidden")?"hide"===r:"show"===r)?(n[r](),i()):a.call(n[0],s,i)}var s=e.apply(this,arguments),n=s.mode,o=s.queue,a=t.effects.effect[s.effect];return t.fx.off||!a?n?this[n](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this)}):o===!1?this.each(i):this.queue(o||"fx",i)},show:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(t.fn.show),hide:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(s){if(i(s)||"boolean"==typeof s)return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s}})}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}(),t.effects,t.effects.effect.blind=function(e,i){var s,n,o,a=t(this),r=/up|down|vertical/,l=/up|left|vertical|horizontal/,d=["position","top","bottom","left","right","height","width"],h=t.effects.setMode(a,e.mode||"hide"),c=e.direction||"up",u=r.test(c),m=u?"height":"width",p=u?"top":"left",f=l.test(c),g={},_="show"===h;a.parent().is(".ui-effects-wrapper")?t.effects.save(a.parent(),d):t.effects.save(a,d),a.show(),s=t.effects.createWrapper(a).css({overflow:"hidden"}),n=s[m](),o=parseFloat(s.css(p))||0,g[m]=_?n:0,f||(a.css(u?"bottom":"right",0).css(u?"top":"left","auto").css({position:"absolute"}),g[p]=_?o:n+o),_&&(s.css(m,0),f||s.css(p,o+n)),s.animate(g,{duration:e.duration,easing:e.easing,queue:!1,complete:function(){"hide"===h&&a.hide(),t.effects.restore(a,d),t.effects.removeWrapper(a),i()}})},t.effects.effect.bounce=function(e,i){var s,n,o,a=t(this),r=["position","top","bottom","left","right","height","width"],l=t.effects.setMode(a,e.mode||"effect"),d="hide"===l,h="show"===l,c=e.direction||"up",u=e.distance,m=e.times||5,p=2*m+(h||d?1:0),f=e.duration/p,g=e.easing,_="up"===c||"down"===c?"top":"left",b="up"===c||"left"===c,v=a.queue(),y=v.length;for((h||d)&&r.push("opacity"),t.effects.save(a,r),a.show(),t.effects.createWrapper(a),u||(u=a["top"===_?"outerHeight":"outerWidth"]()/3),h&&(o={opacity:1},o[_]=0,a.css("opacity",0).css(_,b?2*-u:2*u).animate(o,f,g)),d&&(u/=Math.pow(2,m-1)),o={},o[_]=0,s=0;m>s;s++)n={},n[_]=(b?"-=":"+=")+u,a.animate(n,f,g).animate(o,f,g),u=d?2*u:u/2;d&&(n={opacity:0},n[_]=(b?"-=":"+=")+u,a.animate(n,f,g)),a.queue(function(){d&&a.hide(),t.effects.restore(a,r),t.effects.removeWrapper(a),i()}),y>1&&v.splice.apply(v,[1,0].concat(v.splice(y,p+1))),a.dequeue()},t.effects.effect.clip=function(e,i){var s,n,o,a=t(this),r=["position","top","bottom","left","right","height","width"],l=t.effects.setMode(a,e.mode||"hide"),d="show"===l,h=e.direction||"vertical",c="vertical"===h,u=c?"height":"width",m=c?"top":"left",p={};t.effects.save(a,r),a.show(),s=t.effects.createWrapper(a).css({overflow:"hidden"}),n="IMG"===a[0].tagName?s:a,o=n[u](),d&&(n.css(u,0),n.css(m,o/2)),p[u]=d?o:0,p[m]=d?0:o/2,n.animate(p,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){d||a.hide(),t.effects.restore(a,r),t.effects.removeWrapper(a),i()}})},t.effects.effect.drop=function(e,i){var s,n=t(this),o=["position","top","bottom","left","right","opacity","height","width"],a=t.effects.setMode(n,e.mode||"hide"),r="show"===a,l=e.direction||"left",d="up"===l||"down"===l?"top":"left",h="up"===l||"left"===l?"pos":"neg",c={opacity:r?1:0};
t.effects.save(n,o),n.show(),t.effects.createWrapper(n),s=e.distance||n["top"===d?"outerHeight":"outerWidth"](!0)/2,r&&n.css("opacity",0).css(d,"pos"===h?-s:s),c[d]=(r?"pos"===h?"+=":"-=":"pos"===h?"-=":"+=")+s,n.animate(c,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===a&&n.hide(),t.effects.restore(n,o),t.effects.removeWrapper(n),i()}})},t.effects.effect.explode=function(e,i){function s(){v.push(this),v.length===c*u&&n()}function n(){m.css({visibility:"visible"}),t(v).remove(),f||m.hide(),i()}var o,a,r,l,d,h,c=e.pieces?Math.round(Math.sqrt(e.pieces)):3,u=c,m=t(this),p=t.effects.setMode(m,e.mode||"hide"),f="show"===p,g=m.show().css("visibility","hidden").offset(),_=Math.ceil(m.outerWidth()/u),b=Math.ceil(m.outerHeight()/c),v=[];for(o=0;c>o;o++)for(l=g.top+o*b,h=o-(c-1)/2,a=0;u>a;a++)r=g.left+a*_,d=a-(u-1)/2,m.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-a*_,top:-o*b}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:_,height:b,left:r+(f?d*_:0),top:l+(f?h*b:0),opacity:f?0:1}).animate({left:r+(f?0:d*_),top:l+(f?0:h*b),opacity:f?1:0},e.duration||500,e.easing,s)},t.effects.effect.fade=function(e,i){var s=t(this),n=t.effects.setMode(s,e.mode||"toggle");s.animate({opacity:n},{queue:!1,duration:e.duration,easing:e.easing,complete:i})},t.effects.effect.fold=function(e,i){var s,n,o=t(this),a=["position","top","bottom","left","right","height","width"],r=t.effects.setMode(o,e.mode||"hide"),l="show"===r,d="hide"===r,h=e.size||15,c=/([0-9]+)%/.exec(h),u=!!e.horizFirst,m=l!==u,p=m?["width","height"]:["height","width"],f=e.duration/2,g={},_={};t.effects.save(o,a),o.show(),s=t.effects.createWrapper(o).css({overflow:"hidden"}),n=m?[s.width(),s.height()]:[s.height(),s.width()],c&&(h=parseInt(c[1],10)/100*n[d?0:1]),l&&s.css(u?{height:0,width:h}:{height:h,width:0}),g[p[0]]=l?n[0]:h,_[p[1]]=l?n[1]:0,s.animate(g,f,e.easing).animate(_,f,e.easing,function(){d&&o.hide(),t.effects.restore(o,a),t.effects.removeWrapper(o),i()})},t.effects.effect.highlight=function(e,i){var s=t(this),n=["backgroundImage","backgroundColor","opacity"],o=t.effects.setMode(s,e.mode||"show"),a={backgroundColor:s.css("backgroundColor")};"hide"===o&&(a.opacity=0),t.effects.save(s,n),s.show().css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(a,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===o&&s.hide(),t.effects.restore(s,n),i()}})},t.effects.effect.size=function(e,i){var s,n,o,a=t(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["position","top","bottom","left","right","overflow","opacity"],d=["width","height","overflow"],h=["fontSize"],c=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],u=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],m=t.effects.setMode(a,e.mode||"effect"),p=e.restore||"effect"!==m,f=e.scale||"both",g=e.origin||["middle","center"],_=a.css("position"),b=p?r:l,v={height:0,width:0,outerHeight:0,outerWidth:0};"show"===m&&a.show(),s={height:a.height(),width:a.width(),outerHeight:a.outerHeight(),outerWidth:a.outerWidth()},"toggle"===e.mode&&"show"===m?(a.from=e.to||v,a.to=e.from||s):(a.from=e.from||("show"===m?v:s),a.to=e.to||("hide"===m?v:s)),o={from:{y:a.from.height/s.height,x:a.from.width/s.width},to:{y:a.to.height/s.height,x:a.to.width/s.width}},("box"===f||"both"===f)&&(o.from.y!==o.to.y&&(b=b.concat(c),a.from=t.effects.setTransition(a,c,o.from.y,a.from),a.to=t.effects.setTransition(a,c,o.to.y,a.to)),o.from.x!==o.to.x&&(b=b.concat(u),a.from=t.effects.setTransition(a,u,o.from.x,a.from),a.to=t.effects.setTransition(a,u,o.to.x,a.to))),("content"===f||"both"===f)&&o.from.y!==o.to.y&&(b=b.concat(h).concat(d),a.from=t.effects.setTransition(a,h,o.from.y,a.from),a.to=t.effects.setTransition(a,h,o.to.y,a.to)),t.effects.save(a,b),a.show(),t.effects.createWrapper(a),a.css("overflow","hidden").css(a.from),g&&(n=t.effects.getBaseline(g,s),a.from.top=(s.outerHeight-a.outerHeight())*n.y,a.from.left=(s.outerWidth-a.outerWidth())*n.x,a.to.top=(s.outerHeight-a.to.outerHeight)*n.y,a.to.left=(s.outerWidth-a.to.outerWidth)*n.x),a.css(a.from),("content"===f||"both"===f)&&(c=c.concat(["marginTop","marginBottom"]).concat(h),u=u.concat(["marginLeft","marginRight"]),d=r.concat(c).concat(u),a.find("*[width]").each(function(){var i=t(this),s={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};p&&t.effects.save(i,d),i.from={height:s.height*o.from.y,width:s.width*o.from.x,outerHeight:s.outerHeight*o.from.y,outerWidth:s.outerWidth*o.from.x},i.to={height:s.height*o.to.y,width:s.width*o.to.x,outerHeight:s.height*o.to.y,outerWidth:s.width*o.to.x},o.from.y!==o.to.y&&(i.from=t.effects.setTransition(i,c,o.from.y,i.from),i.to=t.effects.setTransition(i,c,o.to.y,i.to)),o.from.x!==o.to.x&&(i.from=t.effects.setTransition(i,u,o.from.x,i.from),i.to=t.effects.setTransition(i,u,o.to.x,i.to)),i.css(i.from),i.animate(i.to,e.duration,e.easing,function(){p&&t.effects.restore(i,d)})})),a.animate(a.to,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){0===a.to.opacity&&a.css("opacity",a.from.opacity),"hide"===m&&a.hide(),t.effects.restore(a,b),p||("static"===_?a.css({position:"relative",top:a.to.top,left:a.to.left}):t.each(["top","left"],function(t,e){a.css(e,function(e,i){var s=parseInt(i,10),n=t?a.to.left:a.to.top;return"auto"===i?n+"px":s+n+"px"})})),t.effects.removeWrapper(a),i()}})},t.effects.effect.scale=function(e,i){var s=t(this),n=t.extend(!0,{},e),o=t.effects.setMode(s,e.mode||"effect"),a=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"hide"===o?0:100),r=e.direction||"both",l=e.origin,d={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},h={y:"horizontal"!==r?a/100:1,x:"vertical"!==r?a/100:1};n.effect="size",n.queue=!1,n.complete=i,"effect"!==o&&(n.origin=l||["middle","center"],n.restore=!0),n.from=e.from||("show"===o?{height:0,width:0,outerHeight:0,outerWidth:0}:d),n.to={height:d.height*h.y,width:d.width*h.x,outerHeight:d.outerHeight*h.y,outerWidth:d.outerWidth*h.x},n.fade&&("show"===o&&(n.from.opacity=0,n.to.opacity=1),"hide"===o&&(n.from.opacity=1,n.to.opacity=0)),s.effect(n)},t.effects.effect.puff=function(e,i){var s=t(this),n=t.effects.setMode(s,e.mode||"hide"),o="hide"===n,a=parseInt(e.percent,10)||150,r=a/100,l={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()};t.extend(e,{effect:"scale",queue:!1,fade:!0,mode:n,complete:i,percent:o?a:100,from:o?l:{height:l.height*r,width:l.width*r,outerHeight:l.outerHeight*r,outerWidth:l.outerWidth*r}}),s.effect(e)},t.effects.effect.pulsate=function(e,i){var s,n=t(this),o=t.effects.setMode(n,e.mode||"show"),a="show"===o,r="hide"===o,l=a||"hide"===o,d=2*(e.times||5)+(l?1:0),h=e.duration/d,c=0,u=n.queue(),m=u.length;for((a||!n.is(":visible"))&&(n.css("opacity",0).show(),c=1),s=1;d>s;s++)n.animate({opacity:c},h,e.easing),c=1-c;n.animate({opacity:c},h,e.easing),n.queue(function(){r&&n.hide(),i()}),m>1&&u.splice.apply(u,[1,0].concat(u.splice(m,d+1))),n.dequeue()},t.effects.effect.shake=function(e,i){var s,n=t(this),o=["position","top","bottom","left","right","height","width"],a=t.effects.setMode(n,e.mode||"effect"),r=e.direction||"left",l=e.distance||20,d=e.times||3,h=2*d+1,c=Math.round(e.duration/h),u="up"===r||"down"===r?"top":"left",m="up"===r||"left"===r,p={},f={},g={},_=n.queue(),b=_.length;for(t.effects.save(n,o),n.show(),t.effects.createWrapper(n),p[u]=(m?"-=":"+=")+l,f[u]=(m?"+=":"-=")+2*l,g[u]=(m?"-=":"+=")+2*l,n.animate(p,c,e.easing),s=1;d>s;s++)n.animate(f,c,e.easing).animate(g,c,e.easing);n.animate(f,c,e.easing).animate(p,c/2,e.easing).queue(function(){"hide"===a&&n.hide(),t.effects.restore(n,o),t.effects.removeWrapper(n),i()}),b>1&&_.splice.apply(_,[1,0].concat(_.splice(b,h+1))),n.dequeue()},t.effects.effect.slide=function(e,i){var s,n=t(this),o=["position","top","bottom","left","right","width","height"],a=t.effects.setMode(n,e.mode||"show"),r="show"===a,l=e.direction||"left",d="up"===l||"down"===l?"top":"left",h="up"===l||"left"===l,c={};t.effects.save(n,o),n.show(),s=e.distance||n["top"===d?"outerHeight":"outerWidth"](!0),t.effects.createWrapper(n).css({overflow:"hidden"}),r&&n.css(d,h?isNaN(s)?"-"+s:-s:s),c[d]=(r?h?"+=":"-=":h?"-=":"+=")+s,n.animate(c,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===a&&n.hide(),t.effects.restore(n,o),t.effects.removeWrapper(n),i()}})},t.effects.effect.transfer=function(e,i){var s=t(this),n=t(e.to),o="fixed"===n.css("position"),a=t("body"),r=o?a.scrollTop():0,l=o?a.scrollLeft():0,d=n.offset(),h={top:d.top-r,left:d.left-l,height:n.innerHeight(),width:n.innerWidth()},c=s.offset(),u=t("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(e.className).css({top:c.top-r,left:c.left-l,height:s.innerHeight(),width:s.innerWidth(),position:o?"fixed":"absolute"}).animate(h,e.duration,e.easing,function(){u.remove(),i()})}}),/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 2011–2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
!function(t){function e(t,e){if(!(t.originalEvent.touches.length>1)){t.preventDefault();var i=t.originalEvent.changedTouches[0],s=document.createEvent("MouseEvents");s.initMouseEvent(e,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(s)}}if(t.support.touch="ontouchend"in document,t.support.touch){var i,s=t.ui.mouse.prototype,n=s._mouseInit,o=s._mouseDestroy;s._touchStart=function(t){var s=this;!i&&s._mouseCapture(t.originalEvent.changedTouches[0])&&(i=!0,s._touchMoved=!1,e(t,"mouseover"),e(t,"mousemove"),e(t,"mousedown"))},s._touchMove=function(t){i&&(this._touchMoved=!0,e(t,"mousemove"))},s._touchEnd=function(t){i&&(e(t,"mouseup"),e(t,"mouseout"),this._touchMoved||e(t,"click"),i=!1)},s._mouseInit=function(){var e=this;e.element.bind({touchstart:t.proxy(e,"_touchStart"),touchmove:t.proxy(e,"_touchMove"),touchend:t.proxy(e,"_touchEnd")}),n.call(e)},s._mouseDestroy=function(){var e=this;e.element.unbind({touchstart:t.proxy(e,"_touchStart"),touchmove:t.proxy(e,"_touchMove"),touchend:t.proxy(e,"_touchEnd")}),o.call(e)}}}(jQuery),function(t){function e(){return!1}t.fn.smoothScrollTo=function(e){t("html, body").animate({scrollTop:t(this).offset().top-(e||0)})},t.fn.smoothScrollToCenter=function(){t(this).smoothScrollTo(t(window).height()/2)},t.fn.cssShow=function(){var e=this;return setTimeout(function(){Widget.ModalOverlay.get().$element.addClass("animation-base"),Widget.ModalOverlay.get().$element.prepend(e)},30),setTimeout(function(){t(e).removeClass("hide-element").addClass("show-element")},50),this},t.fn.cssShowSlow=function(){var e=this;return setTimeout(function(){Widget.ModalOverlay.get().$element.addClass("animation-base")},30),setTimeout(function(){t(e).removeClass("hide-element").addClass("show-element")},130),this},t.fn.cssHide=function(){t(this).removeClass("show-element").addClass("hide-element"),Widget.ModalOverlay.get().$element.removeClass("animation-base")},t.fn.cssHideSlow=function(){var e=this;t(this).addClass("scaleOut-element"),setTimeout(function(){t(e).removeClass("show-element").addClass("hide-element"),Widget.ModalOverlay.get().$element.removeClass("animation-base")},160)},t.fn.cssHideCross=function(){var e=this;t(this).addClass("scaleOut-element"),setTimeout(function(){t(e).removeClass("show-element").addClass("hide-element")},160)};var i=1;t.fn.identify=function(){if(0===this.length)return!1;var e=this.first(),s=e.attr("id");if(!s){do s="jq_anonymous_element_"+i++;while(t("#"+s)[0]);e.attr("id",s)}return s},t.fn.getChildren=function(t){var e={};return _.each(t,function(t,i){_.isString(t)?e["$"+i]=this.find(t).eq(0):_.isArray(t)?e["$"+i]=this.find(_.first(t)):e[i]=this.getChildren(t)},this),e},t.fn.disable=function(){return this.prop("disabled",!0).addClass("disabled")},t.fn.enable=function(){return this.prop("disabled",!1).removeClass("disabled")},t.fn.detectClass=function(){return _.detect(arguments,function(t){return this.hasClass(t)},this)},t.fn.removeClassNames=function(t){return _.each(t,function(t){this.removeClass(t)},this),this};var s="placeholder"in document.createElement("input");t.fn.valPlaceholderSafe=function(){return s?this.val():this.val()==this.attr("placeholder")?"":this.val()},t.fn.errorFlash=function(){return this.css({backgroundColor:"#f55"}).animate({backgroundColor:"#fff"},500),this[this.is("input")?"select":"focus"](),this},t.fn.reset=function(){return this.each(function(t){t.reset&&t.reset()})},t.fn.findElement=function(e){var i;return t.each(this.parents().add(this),function(s,n){return t(n).is(e)?void(i=n):void 0}),t(i)},t.fn.toggleBrightness=function(t,e,i){if(0===this.length)return this;null==t&&(t=this.css("background-color"));var s=Color.htmlColorToRgb(t),n=Color.rgbBrightness(s);return this[(150>n?"add":"remove")+"Class"](e)[(150>n?"remove":"add")+"Class"](i),this},t.fn.fadeSlide=function(t){t||(t={});var e=t.duration||200;this.data("originalHeight",this.height()),this.animate({height:0,opacity:0},e,function(){t.after&&t.after()})},t.fn.appearSlide=function(t){t||(t={});var e=t.duration||200,i=this.data("originalHeight"),s=i?i+"px":"toggle";this.animate({height:s,opacity:1},e,function(){t.after&&t.after()})},t.fn.scrollToCenter=function(){return jQuery.scrollTo(this[0],400,{offset:-(t(window).height()/2)})},t.fn.observe=function(e,i){this.each(function(){var s=this,n=!1;t(s.elements).change(function(){n=!0});var o=setInterval(function(){return t(s).data("stop-observing")?void clearInterval(o):(n&&i.call(s),void(n=!1))},1e3*e)})};var n=document.documentElement.style,o="userSelect"in n?"userSelect":"MozUserSelect"in n?"MozUserSelect":"WebkitUserSelect"in n?"WebkitUserSelect":"KhtmlUserSelect"in n?"KhtmlUserSelect":"";t.fn.makeUnselectable=function(){return this.each(function(){"undefined"!=typeof this.onselectstart&&(this.onselectstart=e),o?this.style[o]="none":"string"==typeof this.unselectable&&(this.unselectable="on")})},t.fn.makeSelectable=function(){return this.each(function(){"undefined"!=typeof this.onselectstart&&(this.onselectstart=null),o?this.style[o]="":"string"==typeof this.unselectable&&(this.unselectable="off")})},t.isNodeName=function(t,e){if(arguments.length>2){for(var i=1;i<arguments.length;i++)if(t.nodeName.toUpperCase()===arguments[i].toUpperCase())return!0;return!1}return t.nodeName.toUpperCase()===e.toUpperCase()},t.fn.highlight=function(t){var e=t.duration||200,i=this.css("backgroundColor");this.css({backgroundColor:"#ffff99"}).animate({backgroundColor:i},e)},t.fn.addRemoveClassNames=function(t,e){return _.each(t,function(t){this[(t==e?"add":"remove")+"Class"](t)},this),this},t.fn.parseIntStyle=function(t){var e=1;return t.startsWith("-")&&(e=-1,t=t.substr(1)),e*parseInt(this.css(t),10)},t.fn.viewportOffset=function(){var e=this.offset(),i=t(window).scrollTop(),s=t(window).scrollLeft();return{left:e.left-s,top:e.top-i}},t.fn.insertAtCursor=function(t){var e=this[0];if(document.selection){var i;e.focus();var s=document.selection.createRange();i=s.text.length,s.text=t,0===t.length?(s.moveStart("character",t.length),s.moveEnd("character",t.length)):s.moveStart("character",-t.length+i),s.select()}else if(e.selectionStart||0===e.selectionStart){var n=e.selectionStart,o=e.selectionEnd;e.value=e.value.substring(0,n)+t+e.value.substring(o,e.value.length),e.selectionStart=n+t.length,e.selectionEnd=n+t.length}else e.value+=t},t.fn.display=function(t){return this.css({display:t||"block"})},t.fn.clonePosition=function(e){var i=_.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},arguments[1]||{}),s=t(e).offset()||{left:0,top:0},n={left:0,top:0};return i.setLeft&&this.css("left",s.left-n.left+i.offsetLeft+"px"),i.setTop&&this.css("top",s.top-n.top+i.offsetTop+"px"),i.setWidth&&this.css("width",e.offsetWidth+"px"),i.setHeight&&this.css("height",e.offsetHeight+"px"),this},t.ajaxSetup({headers:{"X-CSRF-Token":t('meta[name="csrf-token"]').attr("content")}}),function(t){function e(t){return"object"==typeof t?t:{top:t,left:t}}var i=t.scrollTo=function(e,i,s){t(window).scrollTo(e,i,s)};i.defaults={axis:"xy",duration:parseFloat(t.fn.jquery)>=1.3?0:1,limit:!0},i.window=function(){return t(window)._scrollable()},t.fn._scrollable=function(){return this.map(function(){var e=this,i=!e.nodeName||-1!=t.inArray(e.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!i)return e;var s=(e.contentWindow||e).document||e.ownerDocument||e;return/webkit/i.test(navigator.userAgent)||"BackCompat"==s.compatMode?s.body:s.documentElement})},t.fn.scrollTo=function(s,n,o){return"object"==typeof n&&(o=n,n=0),"function"==typeof o&&(o={onAfter:o}),"max"==s&&(s=9e9),o=t.extend({},i.defaults,o),n=n||o.duration,o.queue=o.queue&&o.axis.length>1,o.queue&&(n/=2),o.offset=e(o.offset),o.over=e(o.over),this._scrollable().each(function(){function a(t){d.animate(c,n,o.easing,t&&function(){t.call(this,s,o)})}if(null!=s){var r,l=this,d=t(l),h=s,c={},u=d.is("html,body");switch(typeof h){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(h)){h=e(h);break}if(h=t(h,this),!h.length)return;case"object":(h.is||h.style)&&(r=(h=t(h)).offset())}t.each(o.axis.split(""),function(t,e){var s="x"==e?"Left":"Top",n=s.toLowerCase(),m="scroll"+s,p=l[m],f=i.max(l,e);if(r)c[m]=r[n]+(u?0:p-d.offset()[n]),o.margin&&(c[m]-=parseInt(h.css("margin"+s))||0,c[m]-=parseInt(h.css("border"+s+"Width"))||0),c[m]+=o.offset[n]||0,o.over[n]&&(c[m]+=h["x"==e?"width":"height"]()*o.over[n]);else{var g=h[n];c[m]=g.slice&&"%"==g.slice(-1)?parseFloat(g)/100*f:g}o.limit&&/^\d+$/.test(c[m])&&(c[m]=c[m]<=0?0:Math.min(c[m],f)),!t&&o.queue&&(p!=c[m]&&a(o.onAfterFirst),delete c[m])}),a(o.onAfter)}}).end()},i.max=function(e,i){var s="x"==i?"Width":"Height",n="scroll"+s;if(!t(e).is("html,body"))return e[n]-t(e)[s.toLowerCase()]();var o="client"+s,a=e.ownerDocument.documentElement,r=e.ownerDocument.body;return Math.max(a[n],r[n])-Math.min(a[o],r[o])}}(jQuery),function(t){var e=t({});t.ajaxQueue=function(i){function s(e){n=t.ajax(i).done(o.resolve).fail(o.reject).then(e,e)}var n,o=t.Deferred(),a=o.promise();return e.queue(s),a.abort=function(r){if(n)return n.abort(r);var l=e.queue(),d=t.inArray(s,l);return d>-1&&l.splice(d,1),o.rejectWith(i.context||i,[a,r,""]),a},a}}(jQuery),t.fn.scrollStopped=function(e){var i=t(this),s=this;i.scroll(function(){i.data("scrollTimeout")&&clearTimeout(i.data("scrollTimeout")),i.data("scrollTimeout",setTimeout(e,150,s))})},t.fn.removeClasses=function(){for(var e in arguments){var i=arguments[e];t(this).removeClass(i)}return t(this)},t.fn.clearFile=function(){t(this).filter("input:file").each(function(){t(this).wrap("<form>").closest("form").get(0).reset(),t(this).unwrap()})},t.serializeFormData=function(e,i,s,n){i=i||new FormData,s=s||"",n=n||0;for(var o in e){var a=e[o],r=s+(0==n?o:"["+o+"]"),l=File.prototype.isPrototypeOf(a);l||"object"!=typeof a?i.append(r,a):t.serializeFormData(a,i,r,n+1)}return i},t.iframeAjax=function(e){var e=_.extend({method:"POST"},e||{}),i=t("<iframe>").attr("id","pseudo_ajax").attr("name","pseudo_ajax").hide().appendTo(t("body"));setTimeout(function(){i.on("load",function(){var t=i.contents().find("body").html();e.complete&&e.complete(t),n.remove(),i.remove()});var s=_.include(["GET","POST"],e.method.toUpperCase()),n=t("<form>").appendTo(t("body")).attr("target","pseudo_ajax").attr("enctype","multipart/form-data").attr("action",e.url).attr("method",s?e.method:"POST").hide();s||_.extend(e.data,{_method:e.method}),t.appendInputsFromData(n,e.data),n.submit()},100)},t.appendInputsFromData=function(e,i,s,n){s=s||"",n=n||0;for(var o in i){var a=i[o],r=s+(0==n?o:"["+o+"]");if(a instanceof jQuery)a.appendToAndReplaceWithClone(e).attr("name",r);else if("object"==typeof a)t.appendInputsFromData(e,a,r,n+1);else{var l=t("<input>").attr("name",r).val(a);t(e).append(l)}}},t.fn.appendToAndReplaceWithClone=function(e){var i=t(this).clone(!0),s=t(this).replaceWith(i);return t(s).appendTo(e)}}(jQuery),function(){function t(e,i,s){if(e===i)return 0!==e||1/e==1/i;if(null==e||null==i)return e===i;if(e._chain&&(e=e._wrapped),i._chain&&(i=i._wrapped),e.isEqual&&S.isFunction(e.isEqual))return e.isEqual(i);if(i.isEqual&&S.isFunction(i.isEqual))return i.isEqual(e);var n=d.call(e);if(n!=d.call(i))return!1;switch(n){case"[object String]":return e==String(i);case"[object Number]":return e!=+e?i!=+i:0==e?1/e==1/i:e==+i;case"[object Date]":case"[object Boolean]":return+e==+i;case"[object RegExp]":return e.source==i.source&&e.global==i.global&&e.multiline==i.multiline&&e.ignoreCase==i.ignoreCase}if("object"!=typeof e||"object"!=typeof i)return!1;for(var o=s.length;o--;)if(s[o]==e)return!0;s.push(e);var a=0,r=!0;if("[object Array]"==n){if(a=e.length,r=a==i.length)for(;a--&&(r=a in e==a in i&&t(e[a],i[a],s)););}else{if("constructor"in e!="constructor"in i||e.constructor!=i.constructor)return!1;for(var l in e)if(S.has(e,l)&&(a++,!(r=S.has(i,l)&&t(e[l],i[l],s))))break;if(r){for(l in i)if(S.has(i,l)&&!a--)break;r=!a}}return s.pop(),r}var e=this,i=e._,s={},n=Array.prototype,o=Object.prototype,a=Function.prototype,r=n.slice,l=n.unshift,d=o.toString,h=o.hasOwnProperty,c=n.forEach,u=n.map,m=n.reduce,p=n.reduceRight,f=n.filter,g=n.every,_=n.some,b=n.indexOf,v=n.lastIndexOf,y=Array.isArray,w=Object.keys,C=a.bind,S=function(t){return new P(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=S),exports._=S):e._=S,S.VERSION="1.3.1";var k=S.each=S.forEach=function(t,e,i){if(null!=t)if(c&&t.forEach===c)t.forEach(e,i);else if(t.length===+t.length){for(var n=0,o=t.length;o>n;n++)if(n in t&&e.call(i,t[n],n,t)===s)return}else for(var a in t)if(S.has(t,a)&&e.call(i,t[a],a,t)===s)return};S.map=S.collect=function(t,e,i){var s=[];return null==t?s:u&&t.map===u?t.map(e,i):(k(t,function(t,n,o){s[s.length]=e.call(i,t,n,o)}),t.length===+t.length&&(s.length=t.length),s)},S.reduce=S.foldl=S.inject=function(t,e,i,s){var n=arguments.length>2;if(null==t&&(t=[]),m&&t.reduce===m)return s&&(e=S.bind(e,s)),n?t.reduce(e,i):t.reduce(e);if(k(t,function(t,o,a){n?i=e.call(s,i,t,o,a):(i=t,n=!0)}),!n)throw new TypeError("Reduce of empty array with no initial value");return i},S.reduceRight=S.foldr=function(t,e,i,s){var n=arguments.length>2;if(null==t&&(t=[]),p&&t.reduceRight===p)return s&&(e=S.bind(e,s)),n?t.reduceRight(e,i):t.reduceRight(e);var o=S.toArray(t).reverse();return s&&!n&&(e=S.bind(e,s)),n?S.reduce(o,e,i,s):S.reduce(o,e)},S.find=S.detect=function(t,e,i){var s;return M(t,function(t,n,o){return e.call(i,t,n,o)?(s=t,!0):void 0}),s},S.filter=S.select=function(t,e,i){var s=[];return null==t?s:f&&t.filter===f?t.filter(e,i):(k(t,function(t,n,o){e.call(i,t,n,o)&&(s[s.length]=t)}),s)},S.reject=function(t,e,i){var s=[];return null==t?s:(k(t,function(t,n,o){e.call(i,t,n,o)||(s[s.length]=t)}),s)},S.every=S.all=function(t,e,i){var n=!0;return null==t?n:g&&t.every===g?t.every(e,i):(k(t,function(t,o,a){return(n=n&&e.call(i,t,o,a))?void 0:s}),n)};var M=S.some=S.any=function(t,e,i){e||(e=S.identity);var n=!1;return null==t?n:_&&t.some===_?t.some(e,i):(k(t,function(t,o,a){return n||(n=e.call(i,t,o,a))?s:void 0}),!!n)};S.include=S.contains=function(t,e){var i=!1;return null==t?i:b&&t.indexOf===b?-1!=t.indexOf(e):i=M(t,function(t){return t===e})},S.invoke=function(t,e){var i=r.call(arguments,2);return S.map(t,function(t){return(S.isFunction(e)?e||t:t[e]).apply(t,i)})},S.pluck=function(t,e){return S.map(t,function(t){return t[e]})},S.max=function(t,e,i){if(!e&&S.isArray(t))return Math.max.apply(Math,t);if(!e&&S.isEmpty(t))return-1/0;var s={computed:-1/0};return k(t,function(t,n,o){var a=e?e.call(i,t,n,o):t;a>=s.computed&&(s={value:t,computed:a})}),s.value},S.min=function(t,e,i){if(!e&&S.isArray(t))return Math.min.apply(Math,t);if(!e&&S.isEmpty(t))return 1/0;var s={computed:1/0};return k(t,function(t,n,o){var a=e?e.call(i,t,n,o):t;a<s.computed&&(s={value:t,computed:a})}),s.value},S.shuffle=function(t){var e,i=[];return k(t,function(t,s){0==s?i[0]=t:(e=Math.floor(Math.random()*(s+1)),i[s]=i[e],i[e]=t)}),i},S.sortBy=function(t,e,i){return S.pluck(S.map(t,function(t,s,n){return{value:t,criteria:e.call(i,t,s,n)}}).sort(function(t,e){var i=t.criteria,s=e.criteria;return s>i?-1:i>s?1:0}),"value")},S.groupBy=function(t,e){var i={},s=S.isFunction(e)?e:function(t){return t[e]};return k(t,function(t,e){var n=s(t,e);(i[n]||(i[n]=[])).push(t)}),i},S.sortedIndex=function(t,e,i){i||(i=S.identity);for(var s=0,n=t.length;n>s;){var o=s+n>>1;i(t[o])<i(e)?s=o+1:n=o}return s},S.toArray=function(t){return t?t.toArray?t.toArray():S.isArray(t)?r.call(t):S.isArguments(t)?r.call(t):S.values(t):[]},S.size=function(t){return S.toArray(t).length},S.first=S.head=function(t,e,i){return null==e||i?t[0]:r.call(t,0,e)},S.initial=function(t,e,i){return r.call(t,0,t.length-(null==e||i?1:e))},S.last=function(t,e,i){return null==e||i?t[t.length-1]:r.call(t,Math.max(t.length-e,0))},S.rest=S.tail=function(t,e,i){return r.call(t,null==e||i?1:e)},S.compact=function(t){return S.filter(t,function(t){return!!t})},S.flatten=function(t,e){return S.reduce(t,function(t,i){return S.isArray(i)?t.concat(e?i:S.flatten(i)):(t[t.length]=i,t)},[])},S.without=function(t){return S.difference(t,r.call(arguments,1))},S.uniq=S.unique=function(t,e,i){var s=i?S.map(t,i):t,n=[];return S.reduce(s,function(i,s,o){return 0!=o&&(e===!0?S.last(i)==s:S.include(i,s))||(i[i.length]=s,n[n.length]=t[o]),i},[]),n},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=S.intersect=function(t){var e=r.call(arguments,1);return S.filter(S.uniq(t),function(t){return S.every(e,function(e){return S.indexOf(e,t)>=0})})},S.difference=function(t){var e=S.flatten(r.call(arguments,1));return S.filter(t,function(t){return!S.include(e,t)})},S.zip=function(){for(var t=r.call(arguments),e=S.max(S.pluck(t,"length")),i=new Array(e),s=0;e>s;s++)i[s]=S.pluck(t,""+s);return i},S.indexOf=function(t,e,i){if(null==t)return-1;var s,n;if(i)return s=S.sortedIndex(t,e),t[s]===e?s:-1;if(b&&t.indexOf===b)return t.indexOf(e);for(s=0,n=t.length;n>s;s++)if(s in t&&t[s]===e)return s;return-1},S.lastIndexOf=function(t,e){if(null==t)return-1;if(v&&t.lastIndexOf===v)return t.lastIndexOf(e);for(var i=t.length;i--;)if(i in t&&t[i]===e)return i;return-1},S.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var s=Math.max(Math.ceil((e-t)/i),0),n=0,o=new Array(s);s>n;)o[n++]=t,t+=i;return o};var T=function(){};S.bind=function(t,e){var i,s;if(t.bind===C&&C)return C.apply(t,r.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return s=r.call(arguments,2),i=function(){if(!(this instanceof i))return t.apply(e,s.concat(r.call(arguments)));T.prototype=t.prototype;var n=new T,o=t.apply(n,s.concat(r.call(arguments)));return Object(o)===o?o:n}},S.bindAll=function(t){var e=r.call(arguments,1);return 0==e.length&&(e=S.functions(t)),k(e,function(e){t[e]=S.bind(t[e],t)}),t},S.memoize=function(t,e){var i={};return e||(e=S.identity),function(){var s=e.apply(this,arguments);return S.has(i,s)?i[s]:i[s]=t.apply(this,arguments)}},S.delay=function(t,e){var i=r.call(arguments,2);return setTimeout(function(){return t.apply(t,i)},e)},S.defer=function(t){return S.delay.apply(S,[t,1].concat(r.call(arguments,1)))},S.throttle=function(t,e){var i,s,n,o,a,r=S.debounce(function(){a=o=!1},e);return function(){i=this,s=arguments;var l=function(){n=null,a&&t.apply(i,s),r()};n||(n=setTimeout(l,e)),o?a=!0:t.apply(i,s),r(),o=!0}},S.debounce=function(t,e){var i;return function(){var s=this,n=arguments,o=function(){i=null,t.apply(s,n)};clearTimeout(i),i=setTimeout(o,e)}},S.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments))}},S.wrap=function(t,e){return function(){var i=[t].concat(r.call(arguments,0));return e.apply(this,i)}},S.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},S.after=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},S.keys=w||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)S.has(t,i)&&(e[e.length]=i);return e},S.values=function(t){return S.map(t,S.identity)},S.functions=S.methods=function(t){var e=[];for(var i in t)S.isFunction(t[i])&&e.push(i);return e.sort()},S.extend=function(t){return k(r.call(arguments,1),function(e){for(var i in e)t[i]=e[i]}),t},S.defaults=function(t){return k(r.call(arguments,1),function(e){for(var i in e)null==t[i]&&(t[i]=e[i])}),t},S.clone=function(t){return S.isObject(t)?S.isArray(t)?t.slice():S.extend({},t):t},S.tap=function(t,e){return e(t),t},S.isEqual=function(e,i){return t(e,i,[])},S.isEmpty=function(t){if(S.isArray(t)||S.isString(t))return 0===t.length;for(var e in t)if(S.has(t,e))return!1;return!0},S.isElement=function(t){return!(!t||1!=t.nodeType)},S.isArray=y||function(t){return"[object Array]"==d.call(t)},S.isObject=function(t){return t===Object(t)},S.isArguments=function(t){return"[object Arguments]"==d.call(t)},S.isArguments(arguments)||(S.isArguments=function(t){return!(!t||!S.has(t,"callee"))}),S.isFunction=function(t){return"[object Function]"==d.call(t)},S.isString=function(t){return"[object String]"==d.call(t)},S.isNumber=function(t){return"[object Number]"==d.call(t)},S.isNaN=function(t){return t!==t},S.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==d.call(t)},S.isDate=function(t){return"[object Date]"==d.call(t)},S.isRegExp=function(t){return"[object RegExp]"==d.call(t)},S.isNull=function(t){return null===t},S.isUndefined=function(t){return void 0===t},S.has=function(t,e){return h.call(t,e)},S.noConflict=function(){return e._=i,this},S.identity=function(t){return t},S.times=function(t,e,i){for(var s=0;t>s;s++)e.call(i,s)},S.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},S.mixin=function(t){k(S.functions(t),function(e){$(e,S[e]=t[e])})};var D=0;S.uniqueId=function(t){var e=D++;return t?t+e:e},S.templateSettings={evaluate:/<\%([\s\S]+?)%>/g,interpolate:/<\%=([\s\S]+?)%>/g,escape:/<\%-([\s\S]+?)%>/g};var I=/.^/,x=function(t){return t.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};S.template=function(t,e){var i=S.templateSettings,s="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(i.escape||I,function(t,e){return"',_.escape("+x(e)+"),'"}).replace(i.interpolate||I,function(t,e){return"',"+x(e)+",'"}).replace(i.evaluate||I,function(t,e){return"');"+x(e).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",n=new Function("obj","_",s);return e?n(e,S):function(t){return n.call(this,t,S)}},S.chain=function(t){return S(t).chain()};var P=function(t){this._wrapped=t};S.prototype=P.prototype;var F=function(t,e){return e?S(t).chain():t},$=function(t,e){P.prototype[t]=function(){var t=r.call(arguments);return l.call(t,this._wrapped),F(e.apply(S,t),this._chain)}};S.mixin(S),k(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];P.prototype[t]=function(){var i=this._wrapped;e.apply(i,arguments);var s=i.length;return"shift"!=t&&"splice"!=t||0!==s||delete i[0],F(i,this._chain)}}),k(["concat","join","slice"],function(t){var e=n[t];P.prototype[t]=function(){return F(e.apply(this._wrapped,arguments),this._chain)}}),P.prototype.chain=function(){return this._chain=!0,this},P.prototype.value=function(){return this._wrapped}}.call(this),_.stripTags=function(t){return t.replace(/<\/?[^>]+>/gi,"")},_.startsWith=function(t,e){return 0===t.indexOf(e)},_.capitalize=function(t){return t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()},_.decapitalize=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},_.blank=function(t){return/^\s*$/.test(t)},_.templateSettings={evaluate:/#\{(.+?)\}/g,interpolate:/#\{(.+?)\}/g},function(){var t,e=this,i=e.Backbone,s=Array.prototype.slice,n=Array.prototype.splice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="0.9.1";var o=e._;o||"undefined"==typeof require||(o=require("underscore"));var a=e.jQuery||e.Zepto||e.ender;t.setDomLibrary=function(t){a=t},t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1,t.Events={on:function(t,e,i){var s;t=t.split(/\s+/);for(var n=this._callbacks||(this._callbacks={});s=t.shift();){var o=n[s]||(n[s]={}),a=o.tail||(o.tail=o.next={});a.callback=e,a.context=i,o.tail=a.next={}}return this},off:function(t,e,i){var s,n,o;if(t){if(n=this._callbacks)for(t=t.split(/\s+/);s=t.shift();)if(o=n[s],delete n[s],e&&o)for(;(o=o.next)&&o.next;)(o.callback!==e||i&&o.context!==i)&&this.on(s,o.callback,o.context)}else delete this._callbacks;return this},trigger:function(t){var e,i,n,o,a,r,l;if(!(n=this._callbacks))return this;for(r=n.all,(t=t.split(/\s+/)).push(null);e=t.shift();)r&&t.push({next:r.next,tail:r.tail,event:e}),(i=n[e])&&t.push({next:i.next,tail:i.tail});for(l=s.call(arguments,1);i=t.pop();)for(o=i.tail,a=i.event?[i.event].concat(l):l;(i=i.next)!==o;)i.callback.apply(i.context||this,a);return this}},t.Events.bind=t.Events.on,t.Events.unbind=t.Events.off,t.Model=function(t,e){var i;if(t||(t={}),e&&e.parse&&(t=this.parse(t)),(i=y(this,"defaults"))&&(t=o.extend({},i,t)),e&&e.collection&&(this.collection=e.collection),this.attributes={},this._escapedAttributes={},this.cid=o.uniqueId("c"),!this.set(t,{silent:!0}))throw new Error("Can't create an invalid model");delete this._changed,this._previousAttributes=o.clone(this.attributes),this.initialize.apply(this,arguments)},o.extend(t.Model.prototype,t.Events,{idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},get:function(t){return this.attributes[t]},escape:function(t){var e;if(e=this._escapedAttributes[t])return e;var i=this.attributes[t];return this._escapedAttributes[t]=o.escape(null==i?"":""+i)},has:function(t){return null!=this.attributes[t]},set:function(e,i,s){var n,a,r;if(o.isObject(e)||null==e?(n=e,s=i):(n={},n[e]=i),s||(s={}),!n)return this;if(n instanceof t.Model&&(n=n.attributes),s.unset)for(a in n)n[a]=void 0;if(!this._validate(n,s))return!1;this.idAttribute in n&&(this.id=n[this.idAttribute]);var l=this.attributes,d=this._escapedAttributes,h=this._previousAttributes||{},c=this._setting;this._changed||(this._changed={}),this._setting=!0;for(a in n)r=n[a],o.isEqual(l[a],r)||delete d[a],s.unset?delete l[a]:l[a]=r,this._changing&&!o.isEqual(this._changed[a],r)&&(this.trigger("change:"+a,this,r,s),this._moreChanges=!0),delete this._changed[a],o.isEqual(h[a],r)&&o.has(l,a)==o.has(h,a)||(this._changed[a]=r);return c||(!s.silent&&this.hasChanged()&&this.change(s),this._setting=!1),this},unset:function(t,e){return(e||(e={})).unset=!0,this.set(t,null,e)},clear:function(t){return(t||(t={})).unset=!0,this.set(o.clone(this.attributes),t)},fetch:function(e){e=e?o.clone(e):{};var i=this,s=e.success;return e.success=function(t,n,o){return i.set(i.parse(t,o),e)?void(s&&s(i,t)):!1},e.error=t.wrapError(e.error,i,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,i,s){var n,a;o.isObject(e)||null==e?(n=e,s=i):(n={},n[e]=i),s=s?o.clone(s):{},s.wait&&(a=o.clone(this.attributes));var r=o.extend({},s,{silent:!0});if(n&&!this.set(n,s.wait?r:s))return!1;var l=this,d=s.success;s.success=function(t,e,i){var a=l.parse(t,i);return s.wait&&(a=o.extend(n||{},a)),l.set(a,s)?void(d?d(l,t):l.trigger("sync",l,t,s)):!1},s.error=t.wrapError(s.error,l,s);var h=this.isNew()?"create":"update",c=(this.sync||t.sync).call(this,h,this,s);return s.wait&&this.set(a,r),c},destroy:function(e){e=e?o.clone(e):{};var i=this,s=e.success,n=function(){i.trigger("destroy",i,i.collection,e)};if(this.isNew())return n();e.success=function(t){e.wait&&n(),s?s(i,t):i.trigger("sync",i,t,e)},e.error=t.wrapError(e.error,i,e);var a=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||n(),a},url:function(){var t=y(this.collection,"url")||y(this,"urlRoot")||w();return this.isNew()?t:t+("/"==t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(t){if(this._changing||!this.hasChanged())return this;this._changing=!0,this._moreChanges=!0;for(var e in this._changed)this.trigger("change:"+e,this,this._changed[e],t);for(;this._moreChanges;)this._moreChanges=!1,this.trigger("change",this,t);return this._previousAttributes=o.clone(this.attributes),delete this._changed,this._changing=!1,this},hasChanged:function(t){return arguments.length?this._changed&&o.has(this._changed,t):!o.isEmpty(this._changed)},changedAttributes:function(t){if(!t)return this.hasChanged()?o.clone(this._changed):!1;var e,i=!1,s=this._previousAttributes;for(var n in t)o.isEqual(s[n],e=t[n])||((i||(i={}))[n]=e);return i},previous:function(t){return arguments.length&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(t,e){if(e.silent||!this.validate)return!0;t=o.extend({},this.attributes,t);var i=this.validate(t,e);return i?(e&&e.error?e.error(this,i,e):this.trigger("error",this,i,e),!1):!0}}),t.Collection=function(t,e){e||(e={}),e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,{silent:!0,parse:e.parse})},o.extend(t.Collection.prototype,t.Events,{model:t.Model,initialize:function(){},toJSON:function(){return this.map(function(t){return t.toJSON()})},add:function(t,e){var i,s,a,r,l,d,h={},c={};for(e||(e={}),t=o.isArray(t)?t.slice():[t],i=0,a=t.length;a>i;i++){if(!(r=t[i]=this._prepareModel(t[i],e)))throw new Error("Can't add an invalid model to a collection");if(h[l=r.cid]||this._byCid[l]||null!=(d=r.id)&&(c[d]||this._byId[d]))throw new Error("Can't add the same model to a collection twice");h[l]=c[d]=r}for(i=0;a>i;i++)(r=t[i]).on("all",this._onModelEvent,this),this._byCid[r.cid]=r,null!=r.id&&(this._byId[r.id]=r);if(this.length+=a,s=null!=e.at?e.at:this.models.length,n.apply(this.models,[s,0].concat(t)),this.comparator&&this.sort({silent:!0}),e.silent)return this;for(i=0,a=this.models.length;a>i;i++)h[(r=this.models[i]).cid]&&(e.index=i,r.trigger("add",r,this,e));return this},remove:function(t,e){var i,s,n,a;for(e||(e={}),t=o.isArray(t)?t.slice():[t],i=0,s=t.length;s>i;i++)a=this.getByCid(t[i])||this.get(t[i]),a&&(delete this._byId[a.id],delete this._byCid[a.cid],n=this.indexOf(a),this.models.splice(n,1),this.length--,e.silent||(e.index=n,a.trigger("remove",a,this,e)),this._removeReference(a));return this},get:function(t){return null==t?null:this._byId[null!=t.id?t.id:t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},sort:function(t){if(t||(t={}),!this.comparator)throw new Error("Cannot sort a set without a comparator");var e=o.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("reset",this,t),this},pluck:function(t){return o.map(this.models,function(e){return e.get(t)})},reset:function(t,e){t||(t=[]),e||(e={});for(var i=0,s=this.models.length;s>i;i++)this._removeReference(this.models[i]);return this._reset(),this.add(t,{silent:!0,parse:e.parse}),e.silent||this.trigger("reset",this,e),this},fetch:function(e){e=e?o.clone(e):{},void 0===e.parse&&(e.parse=!0);var i=this,s=e.success;return e.success=function(t,n,o){i[e.add?"add":"reset"](i.parse(t,o),e),s&&s(i,t)},e.error=t.wrapError(e.error,i,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(t,e){var i=this;if(e=e?o.clone(e):{},t=this._prepareModel(t,e),!t)return!1;e.wait||i.add(t,e);var s=e.success;return e.success=function(n,o){e.wait&&i.add(n,e),s?s(n,o):n.trigger("sync",t,o,e)},t.save(null,e),t},parse:function(t){return t},chain:function(){return o(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,i){if(e instanceof t.Model)e.collection||(e.collection=this);else{var s=e;i.collection=this,e=new this.model(s,i),e._validate(e.attributes,i)||(e=!1)}return e},_removeReference:function(t){this==t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,s){("add"!=t&&"remove"!=t||i==this)&&("destroy"==t&&this.remove(e,s),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],this._byId[e.id]=e),this.trigger.apply(this,arguments))}});var r=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];o.each(r,function(e){t.Collection.prototype[e]=function(){return o[e].apply(o,[this.models].concat(o.toArray(arguments)))}}),t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var l=/:\w+/g,d=/\*\w+/g,h=/[-[\]{}()+?.,\\^$|#\s]/g;o.extend(t.Router.prototype,t.Events,{initialize:function(){},route:function(e,i,s){return t.history||(t.history=new t.History),o.isRegExp(e)||(e=this._routeToRegExp(e)),s||(s=this[i]),t.history.route(e,o.bind(function(n){var o=this._extractParameters(e,n);s&&s.apply(this,o),this.trigger.apply(this,["route:"+i].concat(o)),t.history.trigger("route",this,i,o)},this)),this},navigate:function(e,i){t.history.navigate(e,i)},_bindRoutes:function(){if(this.routes){var t=[];for(var e in this.routes)t.unshift([e,this.routes[e]]);for(var i=0,s=t.length;s>i;i++)this.route(t[i][0],t[i][1],this[t[i][1]])
}},_routeToRegExp:function(t){return t=t.replace(h,"\\$&").replace(l,"([^/]+)").replace(d,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}}),t.History=function(){this.handlers=[],o.bindAll(this,"checkUrl")};var c=/^[#\/]/,u=/msie [\w.]+/,m=!1;o.extend(t.History.prototype,t.Events,{interval:50,getFragment:function(t,e){if(null==t)if(this._hasPushState||e){t=window.location.pathname;var i=window.location.search;i&&(t+=i)}else t=window.location.hash;return t=decodeURIComponent(t),t.indexOf(this.options.root)||(t=t.substr(this.options.root.length)),t.replace(c,"")},start:function(t){if(m)throw new Error("Backbone.history has already been started");this.options=o.extend({},{root:"/"},this.options,t),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var e=this.getFragment(),i=document.documentMode,s=u.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);s&&(this.iframe=a('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?a(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?a(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e,m=!0;var n=window.location,r=n.pathname==this.options.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!r?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&r&&n.hash&&(this.fragment=n.hash.replace(c,""),window.history.replaceState({},document.title,n.protocol+"//"+n.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){a(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),m=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t==this.fragment&&this.iframe&&(t=this.getFragment(this.iframe.location.hash)),t==this.fragment||t==decodeURIComponent(this.fragment)?!1:(this.iframe&&this.navigate(t),void(this.loadUrl()||this.loadUrl(window.location.hash)))},loadUrl:function(t){var e=this.fragment=this.getFragment(t),i=o.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return i},navigate:function(t,e){if(!m)return!1;e&&e!==!0||(e={trigger:e});var i=(t||"").replace(c,"");this.fragment!=i&&this.fragment!=decodeURIComponent(i)&&(this._hasPushState?(0!=i.indexOf(this.options.root)&&(i=this.options.root+i),this.fragment=i,window.history[e.replace?"replaceState":"pushState"]({},document.title,i)):this._wantsHashChange?(this.fragment=i,this._updateHash(window.location,i,e.replace),this.iframe&&i!=this.getFragment(this.iframe.location.hash)&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,i,e.replace))):window.location.assign(this.options.root+t),e.trigger&&this.loadUrl(t))},_updateHash:function(t,e,i){i?t.replace(t.toString().replace(/(javascript:|#).*$/,"")+"#"+e):t.hash=e}}),t.View=function(t){this.cid=o.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()};var p=/^(\S+)\s*(.*)$/,f=["model","collection","el","id","attributes","className","tagName"];o.extend(t.View.prototype,t.Events,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(t,e,i){var s=document.createElement(t);return e&&a(s).attr(e),i&&a(s).html(i),s},setElement:function(t,e){return this.$el=a(t),this.el=this.$el[0],e!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(t||(t=y(this,"events"))){this.undelegateEvents();for(var e in t){var i=t[e];if(o.isFunction(i)||(i=this[t[e]]),!i)throw new Error('Event "'+t[e]+'" does not exist');var s=e.match(p),n=s[1],a=s[2];i=o.bind(i,this),n+=".delegateEvents"+this.cid,""===a?this.$el.bind(n,i):this.$el.delegate(a,n,i)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(t){this.options&&(t=o.extend({},this.options,t));for(var e=0,i=f.length;i>e;e++){var s=f[e];t[s]&&(this[s]=t[s])}this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var t=y(this,"attributes")||{};this.id&&(t.id=this.id),this.className&&(t["class"]=this.className),this.setElement(this.make(this.tagName,t),!1)}}});var g=function(t,e){var i=v(this,t,e);return i.extend=this.extend,i};t.Model.extend=t.Collection.extend=t.Router.extend=t.View.extend=g;var _={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,i,s){var n=_[e],r={type:n,dataType:"json"};return s.url||(r.url=y(i,"url")||w()),s.data||!i||"create"!=e&&"update"!=e||(r.contentType="application/json",r.data=JSON.stringify(i.toJSON())),t.emulateJSON&&(r.contentType="application/x-www-form-urlencoded",r.data=r.data?{model:r.data}:{}),t.emulateHTTP&&("PUT"===n||"DELETE"===n)&&(t.emulateJSON&&(r.data._method=n),r.type="POST",r.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",n)}),"GET"===r.type||t.emulateJSON||(r.processData=!1),a.ajax(o.extend(r,s))},t.wrapError=function(t,e,i){return function(s,n){n=s===e?n:s,t?t(e,n,i):e.trigger("error",e,n,i)}};var b=function(){},v=function(t,e,i){var s;return s=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},o.extend(s,t),b.prototype=t.prototype,s.prototype=new b,e&&o.extend(s.prototype,e),i&&o.extend(s,i),s.prototype.constructor=s,s.__super__=t.prototype,s},y=function(t,e){return t&&t[e]?o.isFunction(t[e])?t[e]():t[e]:null},w=function(){throw new Error('A "url" property or function must be specified')}}.call(this),_.extend(Backbone.View.prototype,{appendTo:function(t){return this.render(),t.appendChild(this.el),this}}),function(){var t={destroyViews:function(){this.__views&&(_.each(this.__views,function(t){t.remove(),t.off(),t.destroy&&t.destroy()}),this.__views.length=0)},registerView:function(t){this.__views||(this.__views=[]),this.__views.push(t)}};_.extend(Backbone.Model.prototype,t),_.extend(Backbone.Collection.prototype,t)}(),function(){function t(t,e){return"!"!==t[0][0]?'<a href="'+o(e.href)+'"'+(e.title?' title="'+o(e.title)+'"':"")+">"+m.lexer(t[1])+"</a>":'<img src="'+o(e.href)+'" alt="'+o(t[1])+'"'+(e.title?' title="'+o(e.title)+'"':"")+">"}function e(){return f=p.pop()}function i(){switch(f.type){case"space":return"";case"hr":return"<hr>\n";case"heading":return"<h"+f.depth+">"+m.lexer(f.text)+"</h"+f.depth+">\n";case"code":return g.highlight&&(f.code=g.highlight(f.text,f.lang),null!=f.code&&f.code!==f.text&&(f.escaped=!0,f.text=f.code)),f.escaped||(f.text=o(f.text,!0)),"<pre><code"+(f.lang?' class="lang-'+f.lang+'"':"")+">"+f.text+"</code></pre>\n";case"blockquote_start":for(var t="";"blockquote_end"!==e().type;)t+=i();return"<blockquote>\n"+t+"</blockquote>\n";case"list_start":for(var n=f.ordered?"ol":"ul",t="";"list_end"!==e().type;)t+=i();return"<"+n+">\n"+t+"</"+n+">\n";case"list_item_start":for(var t="";"list_item_end"!==e().type;)t+="text"===f.type?s():i();return"<li>"+t+"</li>\n";case"loose_item_start":for(var t="";"list_item_end"!==e().type;)t+=i();return"<li>"+t+"</li>\n";case"html":return g.sanitize?m.lexer(f.text):f.pre||g.pedantic?f.text:m.lexer(f.text);case"paragraph":return"<p>"+m.lexer(f.text)+"</p>\n";case"text":return"<p>"+s()+"</p>\n"}}function s(){for(var t,i=f.text;(t=p[p.length-1])&&"text"===t.type;)i+="\n"+e().text;return m.lexer(i)}function n(t){p=t.reverse();for(var s="";e();)s+=i();return p=null,f=null,s}function o(t,e){return t.replace(e?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function a(t){for(var e,i="",s=t.length,n=0;s>n;n++)e=t.charCodeAt(n),Math.random()>.5&&(e="x"+e.toString(16)),i+="&#"+e+";";return i}function r(){var t="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b";return t}function l(t,e){return t=t.source,e=e||"",function i(s,n){return s?(t=t.replace(s,n.source||n),i):new RegExp(t,e)}}function d(){}function h(t,e){return c(e),n(u.lexer(t))}function c(t){t||(t=_),g!==t&&(g=t,g.gfm?(u.fences=u.gfm.fences,u.paragraph=u.gfm.paragraph,m.text=m.gfm.text,m.url=m.gfm.url):(u.fences=u.normal.fences,u.paragraph=u.normal.paragraph,m.text=m.normal.text,m.url=m.normal.url),g.pedantic?(m.em=m.pedantic.em,m.strong=m.pedantic.strong):(m.em=m.normal.em,m.strong=m.normal.strong))}var u={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:d,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,lheading:/^([^\n]+)\n[ \u1234]*(=\u1234?|-\u1234?){3,}[ \u1234]*\n*/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [^\0]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *([^\s]+)(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,paragraph:/^([^\n]+\n?(?!body))+\n*/,text:/^[^\n]+/};u.bullet=/(?:[*+-]|\d+\.)/,u.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,u.item=l(u.item,"gm")(/bull/g,u.bullet)(),u.list=l(u.list)(/bull/g,u.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)(),u.html=l(u.html)("comment",/<!--[^\0]*?-->/)("closed",/<(tag)[^\0]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,r())(),u.paragraph=function(){var t=u.paragraph.source,e=[];return function i(t){return t=u[t]?u[t].source:t,e.push(t.replace(/(^|[^\[])\^/g,"$1")),i}("hr")("heading")("lheading")("blockquote")("<"+r())("def"),new RegExp(t.replace("body",e.join("|")))}(),u.normal={fences:u.fences,paragraph:u.paragraph},u.gfm={fences:/^ *``` *(\w+)? *\n([^\0]+?)\s*``` *(?:\n+|$)/,paragraph:/^/},u.gfm.paragraph=l(u.paragraph)("(?!","(?!"+u.gfm.fences.source.replace(/(^|[^\[])\^/g,"$1")+"|")(),u.lexer=function(t){var e=[];return e.links={},t=t.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    "),u.token(t,e,!0)},u.token=function(t,e,i){for(var s,n,o,a,r,l,d,t=t.replace(/^ +$/gm,"");t;)if(o=g.cursor.exec(t)){var h=t.indexOf("\u1234");e.push({type:"cursor",offset:h,srcLine:t.replace("\u1234","").match(/^.*/)[0]}),t=t.replace(o[1],"")}else if((o=u.newline.exec(t))&&(t=t.substring(o[0].length),o[0].length>1&&e.push({type:"space"})),o=u.code.exec(t))t=t.substring(o[0].length),o=o[0].replace(/^ {4}/gm,""),e.push({type:"code",text:g.pedantic?o:o.replace(/\n+$/,"")});else if(o=u.fences.exec(t))t=t.substring(o[0].length),e.push({type:"code",lang:o[1],text:o[2]});else if(o=u.heading.exec(t))t=t.substring(o[0].length),e.push({type:"heading",depth:o[1].length,text:o[2]});else if(o=u.lheading.exec(t))t=t.substring(o[0].length),o[0].indexOf("\u1234")>-1&&e.push({type:"cursor",offset:o[0].indexOf("\u1234")}),e.push({type:"heading",depth:o[2].indexOf("=")>-1?1:2,text:o[1]});else if(o=u.hr.exec(t))t=t.substring(o[0].length),e.push({type:"hr"});else if(o=u.blockquote.exec(t))t=t.substring(o[0].length),e.push({type:"blockquote_start"}),o=o[0].replace(/^ *> ?/gm,""),u.token(o,e,i),e.push({type:"blockquote_end"});else if(o=u.list.exec(t)){for(t=t.substring(o[0].length),e.push({type:"list_start",ordered:isFinite(o[2])}),o=o[0].match(u.item),s=!1,d=o.length,l=0;d>l;l++)a=o[l],r=a.length,a=a.replace(/^ *([*+-]|\d+\.) +/,""),~a.indexOf("\n ")&&(r-=a.length,a=g.pedantic?a.replace(/^ {1,4}/gm,""):a.replace(new RegExp("^ {1,"+r+"}","gm"),"")),n=s||/\n\n(?!\s*$)/.test(a),l!==d-1&&(s="\n"===a[a.length-1],n||(n=s)),e.push({type:n?"loose_item_start":"list_item_start"}),u.token(a,e),e.push({type:"list_item_end"});e.push({type:"list_end"})}else(o=u.html.exec(t))?(t=t.substring(o[0].length),e.push({type:"html",pre:"pre"===o[1],text:o[0]})):i&&(o=u.def.exec(t))?(t=t.substring(o[0].length),e.links[o[1].toLowerCase()]={href:o[2],title:o[3]}):i&&(o=u.paragraph.exec(t))?(t=t.substring(o[0].length),e.push({type:"paragraph",text:o[0]})):(o=u.text.exec(t))&&(t=t.substring(o[0].length),e.push({type:"text",text:o[0]}));return e};var m={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:d,tag:/^<!--[^\0]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\u1234?\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([^\0]+?)__(?!_)|^\*\*([^\0]+?)\*\*(?!\*)/,em:/^\b_((?:__|[^\0])+?)_\b|^\*((?:\*\*|[^\0])+?)\*(?!\*)/,code:/^(`+)([^\0]*?[^`])\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,text:/^[^\0]+?(?=[\\<!\[_*`-]| {2,}\n|$)/,center:/^->([\s\S]*?)<-/};m._linkInside=/(?:\[[^\]]*\]|[^\]]|\](?=[^\[]*\]))*/,m._linkHref=/\s*<?([^\s]*?)>?(?:\s+['"]([^\0]*?)['"])?\s*/,m.link=l(m.link)("inside",m._linkInside)("href",m._linkHref)(),m.reflink=l(m.reflink)("inside",m._linkInside)(),m.normal={url:m.url,strong:m.strong,em:m.em,text:m.text},m.pedantic={strong:/^__(?=\S)([^\0]*?\S)__(?!_)|^\*\*(?=\S)([^\0]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([^\0]*?\S)_(?!_)|^\*(?=\S)([^\0]*?\S)\*(?!\*)/},m.gfm={url:/^(https?:\/\/[^\s]+[^.,:;"')\]\s])/,text:/^[^\0]+?(?=[\\<!\[_*`]|https?:\/\/| {2,}\n|$)/},m.lexer=function(e){for(var i,s,n,r,l="",d=p?p.links:{};e;)if(r=m.escape.exec(e))e=e.substring(r[0].length),l+=r[1];else if(r=m.autolink.exec(e))e=e.substring(r[0].length),"@"===r[2]?(s=a(":"===r[1][6]?r[1].substring(7):r[1]),n=a("mailto:")+s):(s=o(r[1]),n=s),l+='<a href="'+n+'">'+s+"</a>";else if(r=m.url.exec(e))e=e.substring(r[0].length),s=o(r[1]),n=s,l+='<a href="'+n+'">'+s+"</a>";else if(r=m.tag.exec(e))e=e.substring(r[0].length),l+=g.sanitize?o(r[0]):r[0];else if(r=m.link.exec(e))e=e.substring(r[0].length),l+=t(r,{href:r[2]+(r[0].indexOf("\u1234")>-1?"\u1234":""),title:r[3]});else if((r=m.reflink.exec(e))||(r=m.nolink.exec(e))){if(e=e.substring(r[0].length),i=(r[2]||r[1]).replace(/\s+/g," "),i=d[i.toLowerCase()],!i||!i.href){l+=r[0][0],e=r[0].substring(1)+e;continue}l+=t(r,i)}else(r=m.strong.exec(e))?(e=e.substring(r[0].length),l+="<strong>"+m.lexer(r[2]||r[1])+"</strong>"):(r=m.em.exec(e))?(e=e.substring(r[0].length),l+="<em>"+m.lexer(r[2]||r[1])+"</em>"):(r=m.code.exec(e))?(e=e.substring(r[0].length),l+="<code>"+o(r[2],!0)+"</code>"):(r=m.br.exec(e))?(e=e.substring(r[0].length),l+="<br>"):(r=m.center.exec(e))?(e=e.substring(r[0].length),l+="<center>"+m.lexer(r[1])+"</center>"):(r=m.text.exec(e))&&(e=e.substring(r[0].length),l+=o(r[0]));return l};var p,f;d.exec=d;var g,_;h.options=h.setOptions=function(t){return _=t,c(t),h},h.setOptions({gfm:!0,pedantic:!1,sanitize:!1,highlight:null}),h.parser=function(t,e){return c(e),n(t)},h.lexer=function(t,e){return c(e),u.lexer(t)},h.inlineLexer=function(t,e){return c(e),m.lexer(t)},h.parse=h,"undefined"!=typeof module?module.exports=h:this.marked=h}.call(function(){return this||("undefined"!=typeof window?window:global)}()),function(){function t(t){return t.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function e(t){var e={_lexedTree:t};return r=null,i(t,e),s(e),e}function i(t,e){for(var i=0,s=t.length;s>i;i++)"cursor"===t[i].type&&(o(t,i,e),a=t[i].offset,r=t[i].srcLine,e._cursor=t[i],t[i+1]&&t[i+1].text&&0===t[i+1].text.indexOf(r)&&(r=t[i+1].text))}function s(e){if(!r||r&&-1===r.indexOf("\u1234"))for(var i=0,s=e._lexedTree.length;s>i;i++)if("paragraph"===e._lexedTree[i].type&&e._lexedTree[i].text.indexOf("\u1234")>-1){r=e._lexedTree[i].text;break}if(r){var o=r.split("");o.splice(a,0,"\u1234");var l=o.join("")}var d=n(/<strong>([\s\S]*?)<\/strong>/g,l),h=n(/<em>([\s\S]*?)<\/em>/g,l),c=n(/<a href="[^"]*">([\s\S]*?)<\/a>/g,l,!0),u=n(/<center>([\s\S]*?)<\/center>/g,l);d&&(e.bold=t(d)),h&&(e.italic=t(h)),c&&(e.link=t(c)),u&&(e.center=t(u))}function n(t,e,i){for(var s=marked.inlineLexer(e),n=t.exec(s),o=!1;null!=n;){var a=n[1];if(a.indexOf("\u1234")>-1||i&&n[0].indexOf("\u1234")>-1){var o=!0;break}n=t.exec(s)}return o?a.replace("\u1234",""):void 0}function o(t,e,i){function s(e,i){return t[e]&&t[e].type===i}if(!s(e+1,"space")){if(s(e+1,"paragraph")&&(i.paragraph=!0),s(e+1,"heading")&&(i.heading=t[e+1].depth),s(e+1,"list_start")&&(i.list=t[e+1].ordered?"ordered":"unordered"),s(e+1,"blockquote_start")&&(i.blockquote=!0),s(e+1,"list_start")&&s(e+3,"heading")&&(i.heading=t[e+3].depth),s(e+1,"list_start")&&s(e+3,"blockquote_start")&&(i.blockquote=!0),s(e+1,"blockquote_start"))for(var n=e+1;t[n]&&"blockquote_start"===t[n].type;){if(t[n+1]&&"heading"===t[n+1].type){i.heading=t[n+1].depth;break}n++}if(s(e+1,"blockquote_start"))for(var n=e+1;t[n]&&"blockquote_start"===t[n].type;){if(s(n+1,"list_start")){i.list=t[n+1].ordered?"ordered":"unordered";break}n++}if(s(e+1,"blockquote_start"))for(var n=e+1;t[n]&&"blockquote_start"===t[n].type;){if(s(n+1,"list_start")&&s(n+3,"heading")){i.heading=t[n+3].depth;break}n++}if(s(e+1,"list_start")&&s(e+3,"blockquote_start"))for(var n=e+3;t[n]&&"blockquote_start"===t[n].type;){if(s(n+1,"heading")){i.heading=t[n+1].depth;break}n++}if(!i.list)for(var n=e-1;t[n];){if("list_start"===t[n].type||"list_end"===t[n].type){"list_start"===t[n].type&&(i.list=t[n].ordered?"ordered":"unordered");break}n--}if(!i.blockquote)for(var n=e-1;t[n];){if("blockquote_start"===t[n].type||"blockquote_end"===t[n].type){"blockquote_start"===t[n].type&&(i.blockquote=!0);break}n--}for(var n=e+1;t[n];){if("text"===t[n].type||"paragraph"===t[n].type||"heading"===t[n].type){i.text=t[n].text;break}n++}}}var a,r;"undefined"!=typeof global&&global.marked?global.marked.getContext=e:marked.getContext=e}(),function(){function t(t){this.setTextarea(t)}t.prototype={constructor:t,getLexedTree:function(t,e){var i=t.slice(0,e)+"\u1234"+t.slice(e);return marked.lexer(i)},getContext:function(t,e){var i=this.getLexedTree(t,e),s=marked.getContext(i);return s},setTextarea:function(t){this.textarea=t},updateContext:function(){return this.context=this.getContext(this.textarea.value,this.textarea.selectionStart),this},isInContext:function(t){return t in this.context},replaceTextareaChar:function(t,e){var i=this.textarea.value.split("");i[t]=e,this.textarea.value=i.join("")},selectText:function(t){if(t||(t={}),"undefined"==typeof t.afterControlCharacter&&(t.afterControlCharacter=t.beforeControlCharacter),t.beforeControlCharacter)e=t.beforeChars.substring(t.beforeChars.lastIndexOf(t.beforeControlCharacter)+t.beforeControlCharacter.length);else var e=t.beforeChars;if(t.afterControlCharacter)var i=t.afterChars.indexOf(t.afterControlCharacter),s=i>-1?t.afterChars.substring(0,i):t.afterChars;else var s=t.afterChars;t.ignoreSelectionRestore||this.restoreSelection(),this.textarea.selectionStart-=e.length+(t.offset||0),this.textarea.selectionEnd=this.textarea.selectionStart+e.length+s.length-(t.offset||0),this.textarea.focus()},addBold:function(){},removeBold:function(){if(this.updateContext(),this.isInContext("bold")){var t=this.removeBefore(/(\*\*|__)([^\1]*)$/,"$2"),e=(t.match(/(\*\*|__)([^\1]*)$/)||{})[1];if(e){var i=new RegExp("^([^\\"+e.charAt(0)+"]*)"+e.replace(/(.)/g,"\\$1")),s=this.removeAfter(i);this.selectText({beforeChars:t,afterChars:s,beforeControlCharacter:e})}}},removeCenterInSelection:function(){this.replaceInside(/(->|<-)/g,"")},removeBoldInSelection:function(){this.replaceInside(/(\*\*|__)([^\1]+?)\1/g,"$2")},removeItalicInSelection:function(){this.saveSelection(),this.textarea.value=this.textarea.value.replace(/\*\*/g,"\u1234\u1234").replace(/__/g,"\u2345\u2345"),this.restoreSelection(),this.replaceInside(/(\*|_)([^\1]+?)\1/g,"$2"),this.saveSelection(),this.textarea.value=this.textarea.value.replace(/\u1234\u1234/g,"**").replace(/\u2345\u2345/g,"__"),this.restoreSelection()},addItalic:function(){},removeItalic:function(){if(this.updateContext(),this.isInContext("italic")){var t,e,i,s=this.isInContext("bold");if(s)e=/(?:_(\*\*)|(__)\*|\*(__)|(\*\*)_)(.*?)$/,i=function(e,i,s,n,o,a){var r=i||s||n||o;return t="_"===r.charAt(0)?"*":"_",r+a};else{var e=/(_)(?!_)([^_]*)$|(?:[^*]|^)(\*)(?!_[^_])([^\*]*?)$/;i=function(e,i,s,n,o){return t="*"===(i||n).charAt(0)?"*":"_",s||o||""}}var n=this.removeBefore(e,i),o=new RegExp("^([^\\"+t+"]*)\\"+t),a=this.removeAfter(o);this.selectText({beforeChars:n,afterChars:a,beforeControlCharacter:t})}},addBlockquote:function(){},removeBlockquote:function(){if(this.updateContext(),this.isInContext("blockquote")){var t=this.getLineWithCursor(),e=t.split("\u1234"),i=e[0],s=e[1];/>+/.test(i)&&this.removeBefore(/>+\s*/,""),/>+/.exec(s)&&this.removeAfter(/>+\s*/,"")}},selectCenter:function(){var t=this.getLineWithCursor(),e=t.indexOf("\u1234"),i=t.substring(t.indexOf("\u1234")+1).length;this.textarea.selectionStart-=e,this.textarea.selectionEnd+=i},selectHeading:function(){var t=this.getLineWithCursor();if(/^\u1234?(=\u1234?|-\u1234?){3,}/.test(t)){var e=t.indexOf("\u1234"),i=this.getLinePreviousToCursor().length,s=e+1+i;this.textarea.selectionStart-=s,this.textarea.selectionEnd-=e+1}else{var n=t.indexOf("\u1234"),o=t.substring(t.indexOf("\u1234")+1).length;this.textarea.selectionStart-=n,this.textarea.selectionEnd+=o}},addHeading:function(){},removeHeading:function(){if(this.updateContext(),this.isInContext("heading")){var t,e,i,s=this.getLineWithCursor(),n=s.replace("\u1234",""),o="",a="",r="";if(s.indexOf("#")>-1){var l=s.split("\u1234"),d=l[0].indexOf("#")>-1,h=l[1].indexOf("#")>-1,t=/#+/;d&&(o=this.removeBefore(t,""),r=/#+/.exec(o)[0],a=l[1]),h&&(a=this.removeAfter(t,""),r=/#+/.exec(a)[0],e="",i=r.length)}else{if(/(---|===)/.test(n)){this.replaceLinesAround(/^(-|=){3,}/,"");{this.getLinePreviousToCursor()}this.textarea.selectionStart--,this.textarea.selectionEnd=this.textarea.selectionStart,this.replaceTextareaChar(this.textarea.selectionEnd,"");var c=this.getLineWithCursor().replace("\u1234","").length;return void(this.textarea.selectionStart-=c)}var l=s.split("\u1234");o=l[0],a=l[1],r="",this.removeAfterOnAllLines(/\n[-=]*/)}this.selectText({beforeChars:o,afterChars:a,beforeControlCharacter:r,afterControlCharacter:e,ignoreSelectionRestore:!0,offset:i})}},addList:function(){},removeList:function(t){this.updateContext(),this.isInContext("list")&&(t?this.replaceLinesAround(/^\s*\d+\.\s*/,""):this.replaceLinesAround(/^\s*\*\s*/,""))},addLink:function(){},removeLink:function(){if(this.updateContext(),this.isInContext("link")){var t,e,i=this.getLineWithCursor(),s=i.split("\u1234"),n=s[0],o=s[1];if(e=/\[([^\]]*)/.exec(n)){t=!0;{var a=e[1];this.removeBefore(new RegExp("\\[("+RegExp.escape(a)+")$"))}}if(e=/^([^\[\]]*)\]\([^\)]*\)/.exec(o))var r=e[1],l=new RegExp("^("+RegExp.escape(r)+")\\]\\([^\\)]*\\)"),d=this.removeAfter(l),h=d.replace(/[^\]]*\]\(([^\)]*).*/,"$1"),c=n.replace(/^.*\[/,"")+r;else var u=this.removeBefore(/\[([^\]]*)\]?\(?[^\(]*$/),c=u.replace(/.*\[(.*)\].*/,"$1"),m=this.removeAfter(/\(?[^\)]*\)/,""),p=u.replace(/.*\((.*)/,"$1"),f=m.replace(/\(?([^\)]*)\).*/,"$1"),h=p+f;this.restoreSelection();var g="undefined"!=typeof a?a.length:"undefined"!=typeof c?c.length:0;return this.textarea.selectionStart-=g,this.textarea.selectionEnd=this.textarea.selectionStart+c.length,h}},addCenter:function(){},removeCenter:function(){if(this.updateContext(),this.isInContext("center")){var t=this.removeBefore(/->(.*?)$/),e=this.removeAfter(/^(.*?)<-/);this.selectText({beforeChars:t,afterChars:e,beforeControlCharacter:"->",afterControlCharacter:"<-"})}},replaceInside:function(t,e){this.saveSelection();var i=this.textarea.value.slice(0,this.selectionStart),s=this.textarea.value.slice(this.selectionStart,this.selectionEnd),n=this.textarea.value.slice(this.selectionEnd),o=s.length;s=s.replace(t,e);var a=o-s.length;this.textarea.value=i+s+n,this.textarea.selectionStart=this.selectionStart,this.textarea.selectionEnd=this.selectionEnd-a},removeBefore:function(t,e){this.saveSelection();var i=this.textarea.value.slice(0,this.selectionStart),s=this.textarea.value.slice(this.selectionStart),n=i.split("\n"),o=n[n.length-1],a=o.length,r=o;o=o.replace(t,"undefined"!=typeof e?e:"$1");var l=a-o.length;return n[n.length-1]=o,this.textarea.value=n.join("\n")+s,this.restoreSelection(-l),r},removeAfter:function(t,e){this.saveSelection();var i=this.textarea.value.slice(0,this.selectionStart),s=this.textarea.value.slice(this.selectionStart),n=s.split("\n"),o=n[0],a=o.length,r=o;o=o.replace(t,"undefined"!=typeof e?e:"$1");var l=a-o.length;return n[0]=o,this.textarea.value=i+n.join("\n"),this.restoreSelection(l),r},removeAfterOnAllLines:function(t){this.saveSelection();{var e=this.textarea.value.slice(0,this.selectionStart),i=this.textarea.value.slice(this.selectionStart);i.length}return i=i.replace(t,""),this.textarea.value=e+i,this.restoreSelection(),i},replaceLinesAround:function(t,e){for(var i,s=this.textarea.value.slice(0,this.textarea.selectionStart)+"\u1234"+this.textarea.value.slice(this.textarea.selectionStart),n=s.split("\n"),o=[],a=[],r=0,l=n.length;l>r;r++){if(n[r].indexOf("\u1234")>-1){i=n[r].replace("\u1234","");break}o.push(n[r])}for(r++;l>r;r++)a.push(n[r]);for(var r=o.length;r--&&t.exec(o[r]);)o[r]=o[r].replace(t,e);i=i.replace(t,e),"undefined"!=typeof o[r+1]?o[r+1]="\u1234"+o[r+1]:i="\u1234"+i;for(var r=0,l=a.length;l>r&&t.exec(a[r]);r++)a[r]=a[r].replace(t,e);"undefined"!=typeof a[r-1]?a[r-1]=a[r-1]+"\u1234":i+="\u1234",o.push(i),o.push.apply(o,a);var d=o.join("\n"),h=d.indexOf("\u1234"),c=d.lastIndexOf("\u1234")-1;d=d.replace(/\u1234/g,""),this.textarea.value=d,this.textarea.selectionStart=h,this.textarea.selectionEnd=c,this.textarea.focus()},_getLines:function(){var t=this.textarea.value.slice(0,this.textarea.selectionStart)+"\u1234"+this.textarea.value.slice(this.textarea.selectionStart);return t.split("\n")},getLineWithCursor:function(){this.updateContext();for(var t,e=this._getLines(),i=0,s=e.length;s>i;i++)if(e[i].indexOf("\u1234")>-1){t=e[i];break}return t},getLinePreviousToCursor:function(){for(var t,e=this._getLines(),i=0,s=e.length;s>i;i++)if(e[i].indexOf("\u1234")>-1){t=e[i-1];break}return t},saveSelection:function(){this.selectionStart=this.textarea.selectionStart,this.selectionEnd=this.textarea.selectionEnd},restoreSelection:function(t){this.textarea.selectionStart=this.selectionStart+(t||0),this.textarea.selectionEnd=this.selectionEnd+(t||0)},offsetSelection:function(t){this.textarea.selectionEnd+=t,this.textarea.selectionStart+=t}},marked.Transformer=t}();// Copyright (c) 2007 John Fraser.
// Original Markdown Copyright (c) 2004-2005 John Gruber
var Showdown={extensions:{}},forEach=Showdown.forEach=function(t,e){if("function"==typeof t.forEach)t.forEach(e);else{var i,s=t.length;for(i=0;s>i;i++)e(t[i],i,t)}},stdExtName=function(t){return t.replace(/[_-]||\s/g,"").toLowerCase()};Showdown.converter=function(t){var e,i,s,n=0,o=[],a=[];if("undefind"!=typeof module&&"undefined"!=typeof exports&&"undefind"!=typeof require){var r=require("fs");if(r){var l=r.readdirSync((__dirname||".")+"/extensions").filter(function(t){return~t.indexOf(".js")}).map(function(t){return t.replace(/\.js$/,"")});Showdown.forEach(l,function(t){var e=stdExtName(t);Showdown.extensions[e]=require("./extensions/"+t)})}}if(this.makeHtml=function(t){return e={},i={},s=[],t=t.replace(/~/g,"~T"),t=t.replace(/\$/g,"~D"),t=t.replace(/\r\n/g,"\n"),t=t.replace(/\r/g,"\n"),t="\n\n"+t+"\n\n",t=B(t),t=t.replace(/^[ \t]+$/gm,""),Showdown.forEach(o,function(e){t=c(e,t)}),t=M(t),t=m(t),t=u(t),t=f(t),t=E(t),t=t.replace(/~D/g,"$$"),t=t.replace(/~T/g,"~"),Showdown.forEach(a,function(e){t=c(e,t)}),t},t&&t.extensions){var d=this;Showdown.forEach(t.extensions,function(t){if("string"==typeof t&&(t=Showdown.extensions[stdExtName(t)]),"function"!=typeof t)throw"Extension '"+t+"' could not be loaded.  It was either not found or is not a valid extension.";Showdown.forEach(t(d),function(t){t.type?"language"===t.type||"lang"===t.type?o.push(t):("output"===t.type||"html"===t.type)&&a.push(t):a.push(t)})})}var h,c=function(t,e){if(t.regex){var i=new RegExp(t.regex,"g");return e.replace(i,t.replace)}return t.filter?t.filter(e):void 0},u=function(t){return t+="~0",t=t.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|(?=~0))/gm,function(t,s,n,o,a){return s=s.toLowerCase(),e[s]=$(n),o?o+a:(a&&(i[s]=a.replace(/"/g,"&quot;")),"")}),t=t.replace(/~0/,"")},m=function(t){t=t.replace(/\n/g,"\n\n");return t=t.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,p),t=t.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|style|section|header|footer|nav|article|aside)\b[^\r]*?<\/\2>[ \t]*(?=\n+)\n)/gm,p),t=t.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,p),t=t.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,p),t=t.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,p),t=t.replace(/\n\n/g,"\n")},p=function(t,e){var i=e;return i=i.replace(/\n\n/g,"\n"),i=i.replace(/^\n/,""),i=i.replace(/\n+$/g,""),i="\n\n~K"+(s.push(i)-1)+"K\n\n"},f=function(t){t=C(t);var e=T("<hr />");return t=t.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,e),t=t.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,e),t=t.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,e),t=S(t),t=k(t),t=P(t),t=m(t),t=F(t)},g=function(t){return t=D(t),t=_(t),t=A(t),t=y(t),t=b(t),t=L(t),t=$(t),t=x(t),t=t.replace(/  +\n/g," <br />\n")},_=function(t){var e=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return t=t.replace(e,function(t){var e=t.replace(/(.)<\/?code>(?=.)/g,"$1`");return e=z(e,"\\`*_")})},b=function(t){return t=t.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,v),t=t.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?(?:\(.*?\).*?)?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,v),t=t.replace(/(\[([^\[\]]+)\])()()()()()/g,v)},v=function(t,s,n,o,a,r,l,d){void 0==d&&(d="");var h=s,c=n,u=o.toLowerCase(),m=a,p=d;if(""==m)if(""==u&&(u=c.toLowerCase().replace(/ ?\n/g," ")),m="#"+u,void 0!=e[u])m=e[u],void 0!=i[u]&&(p=i[u]);else{if(!(h.search(/\(\s*\)$/m)>-1))return h;m=""}m=z(m,"*_");var f='<a href="'+m+'"';return""!=p&&(p=p.replace(/"/g,"&quot;"),p=z(p,"*_"),f+=' title="'+p+'"'),f+=">"+c+"</a>"},y=function(t){return t=t.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,w),t=t.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,w)},w=function(t,s,n,o,a,r,l,d){var h=s,c=n,u=o.toLowerCase(),m=a,p=d;if(p||(p=""),""==m){if(""==u&&(u=c.toLowerCase().replace(/ ?\n/g," ")),m="#"+u,void 0==e[u])return h;m=e[u],void 0!=i[u]&&(p=i[u])}c=c.replace(/"/g,"&quot;"),m=z(m,"*_");var f='<img src="'+m+'" alt="'+c+'"';return p=p.replace(/"/g,"&quot;"),p=z(p,"*_"),f+=' title="'+p+'"',f+=" />"},C=function(t){function e(t){return t.replace(/[^\w]/g,"").toLowerCase()}return t=t.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(t,i){return T('<h1 id="'+e(i)+'">'+g(i)+"</h1>")}),t=t.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(t,i){return T('<h2 id="'+e(i)+'">'+g(i)+"</h2>")}),t=t.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(t,i,s){var n=i.length;return T("<h"+n+' id="'+e(s)+'">'+g(s)+"</h"+n+">")})},S=function(t){t+="~0";var e=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return n?t=t.replace(e,function(t,e,i){var s=e,n=i.search(/[*+-]/g)>-1?"ul":"ol";s=s.replace(/\n{2,}/g,"\n\n\n");var o=h(s);return o=o.replace(/\s+$/,""),o="<"+n+">"+o+"</"+n+">\n"}):(e=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,t=t.replace(e,function(t,e,i,s){var n=e,o=i,a=s.search(/[*+-]/g)>-1?"ul":"ol",o=o.replace(/\n{2,}/g,"\n\n\n"),r=h(o);return r=n+"<"+a+">\n"+r+"</"+a+">\n"})),t=t.replace(/~0/,"")};h=function(t){return n++,t=t.replace(/\n{2,}$/,"\n"),t+="~0",t=t.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(t,e,i,s,n){var o=n,a=e;return a||o.search(/\n{2,}/)>-1?o=f(W(o)):(o=S(W(o)),o=o.replace(/\n$/,""),o=g(o)),"<li>"+o+"</li>\n"}),t=t.replace(/~0/g,""),n--,t};var k=function(t){return t+="~0",t=t.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(t,e,i){var s=e,n=i;return s=I(W(s)),s=B(s),s=s.replace(/^\n+/g,""),s=s.replace(/\n+$/g,""),s="<pre><code>"+s+"\n</code></pre>",T(s)+n}),t=t.replace(/~0/,"")},M=function(t){return t+="~0",t=t.replace(/(?:^|\n)```(.*)\n([\s\S]*?)\n```/g,function(t,e,i){var s=e,n=i;return n=I(n),n=B(n),n=n.replace(/^\n+/g,""),n=n.replace(/\n+$/g,""),n="<pre><code"+(s?' class="'+s+'"':"")+">"+n+"\n</code></pre>",T(n)}),t=t.replace(/~0/,"")},T=function(t){return t=t.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(s.push(t)-1)+"K\n\n"},D=function(t){return t=t.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(t,e,i,s){var n=s;return n=n.replace(/^([ \t]*)/g,""),n=n.replace(/[ \t]*$/g,""),n=I(n),e+"<code>"+n+"</code>"})},I=function(t){return t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=z(t,"*_{}[]\\",!1)},x=function(t){return t=t.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),t=t.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")},P=function(t){return t=t.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(t,e){var i=e;return i=i.replace(/^[ \t]*>[ \t]?/gm,"~0"),i=i.replace(/~0/g,""),i=i.replace(/^[ \t]+$/gm,""),i=f(i),i=i.replace(/(^|\n)/g,"$1  "),i=i.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(t,e){var i=e;return i=i.replace(/^  /gm,"~0"),i=i.replace(/~0/g,"")}),T("<blockquote>\n"+i+"\n</blockquote>")})},F=function(t){t=t.replace(/^\n+/g,""),t=t.replace(/\n+$/g,"");for(var e=t.split(/\n{2,}/g),i=[],n=e.length,o=0;n>o;o++){var a=e[o];a.search(/~K(\d+)K/g)>=0?i.push(a):a.search(/\S/)>=0&&(a=g(a),a=a.replace(/^([ \t]*)/g,"<p>"),a+="</p>",i.push(a))}n=i.length;for(var o=0;n>o;o++)for(;i[o].search(/~K(\d+)K/)>=0;){var r=s[RegExp.$1];r=r.replace(/\$/g,"$$$$"),i[o]=i[o].replace(/~K\d+K/,r)}return i.join("\n\n")},$=function(t){return t=t.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),t=t.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},A=function(t){return t=t.replace(/\\(\\)/g,N),t=t.replace(/\\([`*_{}\[\]()>#+-.!])/g,N)},L=function(t){return t=t.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),t=t.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(t,e){return O(E(e))})},O=function(t){var e=[function(t){return"&#"+t.charCodeAt(0)+";"},function(t){return"&#x"+t.charCodeAt(0).toString(16)+";"},function(t){return t}];return t="mailto:"+t,t=t.replace(/./g,function(t){if("@"==t)t=e[Math.floor(2*Math.random())](t);else if(":"!=t){var i=Math.random();t=i>.9?e[2](t):i>.45?e[1](t):e[0](t)}return t}),t='<a href="'+t+'">'+t+"</a>",t=t.replace(/">.+:/g,'">')},E=function(t){return t=t.replace(/~E(\d+)E/g,function(t,e){var i=parseInt(e);return String.fromCharCode(i)})},W=function(t){return t=t.replace(/^(\t|[ ]{1,4})/gm,"~0"),t=t.replace(/~0/g,"")},B=function(t){return t=t.replace(/\t(?=\t)/g,"    "),t=t.replace(/\t/g,"~A~B"),t=t.replace(/~B(.+?)~A/g,function(t,e){for(var i=e,s=4-i.length%4,n=0;s>n;n++)i+=" ";return i}),t=t.replace(/~A/g,"    "),t=t.replace(/~B/g,"")},z=function(t,e,i){var s="(["+e.replace(/([\[\]\\])/g,"\\$1")+"])";i&&(s="\\\\"+s);var n=new RegExp(s,"g");return t=t.replace(n,N)},N=function(t,e){var i=e.charCodeAt(0);return"~E"+i+"E"}},"undefined"!=typeof module&&(module.exports=Showdown),"function"==typeof define&&define.amd&&define("showdown",function(){return Showdown}),/*!
 * Pusher JavaScript Library v2.1.2
 * http://pusherapp.com/
 *
 * Copyright 2013, Pusher
 * Released under the MIT licence.
 */
function(){function t(e,i){(null===e||void 0===e)&&t.warn("Warning","You must pass your app key when you instantiate Pusher.");var i=i||{},s=this;this.key=e,this.config=t.Util.extend(t.getGlobalConfig(),i.cluster?t.getClusterConfig(i.cluster):{},i),this.channels=new t.Channels,this.global_emitter=new t.EventsDispatcher,this.sessionID=Math.floor(1e9*Math.random()),this.timeline=new t.Timeline(this.key,this.sessionID,{features:t.Util.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:t.Timeline.INFO,version:t.VERSION}),this.config.disableStats||(this.timelineSender=new t.TimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline"})),this.connection=new t.ConnectionManager(this.key,t.Util.extend({getStrategy:function(e){return t.StrategyBuilder.build(t.getDefaultStrategy(s.config),t.Util.extend({},s.config,e))},timeline:this.timeline,activityTimeout:this.config.activity_timeout,pongTimeout:this.config.pong_timeout,unavailableTimeout:this.config.unavailable_timeout},this.config,{encrypted:this.isEncrypted()})),this.connection.bind("connected",function(){s.subscribeAll(),s.timelineSender&&s.timelineSender.send(s.connection.isEncrypted())}),this.connection.bind("message",function(t){var e=0===t.event.indexOf("pusher_internal:");if(t.channel){var i=s.channel(t.channel);i&&i.handleEvent(t.event,t.data)}e||s.global_emitter.emit(t.event,t.data)}),this.connection.bind("disconnected",function(){s.channels.disconnect()}),this.connection.bind("error",function(e){t.warn("Error",e)}),t.instances.push(this),t.isReady&&s.connect()}var e=t.prototype;t.instances=[],t.isReady=!1,t.debug=function(){t.log&&t.log(t.Util.stringify.apply(this,arguments))},t.warn=function(){var e=t.Util.stringify.apply(this,arguments);window.console&&(window.console.warn?window.console.warn(e):window.console.log&&window.console.log(e)),t.log&&t.log(e)},t.ready=function(){t.isReady=!0;for(var e=0,i=t.instances.length;i>e;e++)t.instances[e].connect()},e.channel=function(t){return this.channels.find(t)},e.connect=function(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var e=this.connection.isEncrypted(),i=this.timelineSender;this.timelineSenderTimer=new t.PeriodicTimer(6e4,function(){i.send(e)})}},e.disconnect=function(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)},e.bind=function(t,e){return this.global_emitter.bind(t,e),this},e.bind_all=function(t){return this.global_emitter.bind_all(t),this},e.subscribeAll=function(){for(var t in this.channels.channels)this.channels.channels.hasOwnProperty(t)&&this.subscribe(t)},e.subscribe=function(t){return t=this.channels.add(t,this),"connected"===this.connection.state&&t.subscribe(),t},e.unsubscribe=function(t){t=this.channels.remove(t),"connected"===this.connection.state&&t.unsubscribe()},e.send_event=function(t,e,i){return this.connection.send_event(t,e,i)},e.isEncrypted=function(){return"https:"===t.Util.getDocumentLocation().protocol?!0:Boolean(this.config.encrypted)},this.Pusher=t}.call(this),function(){Pusher.Util={now:function(){return Date.now?Date.now():(new Date).valueOf()},extend:function(t){for(var e=1;e<arguments.length;e++){var i,s=arguments[e];for(i in s)t[i]=s[i]&&s[i].constructor&&s[i].constructor===Object?Pusher.Util.extend(t[i]||{},s[i]):s[i]}return t},stringify:function(){for(var t=["Pusher"],e=0;e<arguments.length;e++)t.push("string"==typeof arguments[e]?arguments[e]:void 0===window.JSON?arguments[e].toString():JSON.stringify(arguments[e]));return t.join(" : ")},arrayIndexOf:function(t,e){var i=Array.prototype.indexOf;if(null===t)return-1;if(i&&t.indexOf===i)return t.indexOf(e);for(var i=0,s=t.length;s>i;i++)if(t[i]===e)return i;return-1},keys:function(t){var e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(e);return i},apply:function(t,e){for(var i=0;i<t.length;i++)e(t[i],i,t)},objectApply:function(t,e){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e(t[i],i,t)},map:function(t,e){for(var i=[],s=0;s<t.length;s++)i.push(e(t[s],s,t,i));return i},mapObject:function(t,e){var i,s={};for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=e(t[i]));return s},filter:function(t,e){for(var e=e||function(t){return!!t},i=[],s=0;s<t.length;s++)e(t[s],s,t,i)&&i.push(t[s]);return i},filterObject:function(t,e){var i,e=e||function(t){return!!t},s={};for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&e(t[i],i,t,s)&&(s[i]=t[i]);return s},flatten:function(t){var e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push([e,t[e]]);return i},any:function(t,e){for(var i=0;i<t.length;i++)if(e(t[i],i,t))return!0;return!1},all:function(t,e){for(var i=0;i<t.length;i++)if(!e(t[i],i,t))return!1;return!0},method:function(t){var e=Array.prototype.slice.call(arguments,1);return function(i){return i[t].apply(i,e.concat(arguments))}},getDocument:function(){return document},getDocumentLocation:function(){return Pusher.Util.getDocument().location},getLocalStorage:function(){try{return window.localStorage}catch(t){}},getClientFeatures:function(){return Pusher.Util.keys(Pusher.Util.filterObject({ws:Pusher.WSTransport,flash:Pusher.FlashTransport},function(t){return t.isSupported()}))}}}.call(this),function(){Pusher.VERSION="2.1.2",Pusher.PROTOCOL=6,Pusher.host="ws.pusherapp.com",Pusher.ws_port=80,Pusher.wss_port=443,Pusher.sockjs_host="sockjs.pusher.com",Pusher.sockjs_http_port=80,Pusher.sockjs_https_port=443,Pusher.sockjs_path="/pusher",Pusher.stats_host="stats.pusher.com",Pusher.channel_auth_endpoint="/pusher/auth",Pusher.channel_auth_transport="ajax",Pusher.activity_timeout=12e4,Pusher.pong_timeout=3e4,Pusher.unavailable_timeout=1e4,Pusher.cdn_http="http://localhost:5555/",Pusher.cdn_https="http://localhost:5555/",Pusher.dependency_suffix=".min",Pusher.getDefaultStrategy=function(t){return[[":def","ws_options",{hostUnencrypted:t.wsHost+":"+t.wsPort,hostEncrypted:t.wsHost+":"+t.wssPort}],[":def","sockjs_options",{hostUnencrypted:t.httpHost+":"+t.httpPort,hostEncrypted:t.httpHost+":"+t.httpsPort}],[":def","timeouts",{loop:!0,timeout:15e3,timeoutLimit:6e4}],[":def","ws_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:t.activity_timeout}]],[":def_transport","ws","ws",3,":ws_options",":ws_manager"],[":def_transport","flash","flash",2,":ws_options",":ws_manager"],[":def_transport","sockjs","sockjs",1,":sockjs_options"],[":def","ws_loop",[":sequential",":timeouts",":ws"]],[":def","flash_loop",[":sequential",":timeouts",":flash"]],[":def","sockjs_loop",[":sequential",":timeouts",":sockjs"]],[":def","strategy",[":cached",18e5,[":first_connected",[":if",[":is_supported",":ws"],[":best_connected_ever",":ws_loop",[":delayed",2e3,[":sockjs_loop"]]],[":if",[":is_supported",":flash"],[":best_connected_ever",":flash_loop",[":delayed",2e3,[":sockjs_loop"]]],[":sockjs_loop"]]]]]]]}}.call(this),function(){Pusher.getGlobalConfig=function(){return{wsHost:Pusher.host,wsPort:Pusher.ws_port,wssPort:Pusher.wss_port,httpHost:Pusher.sockjs_host,httpPort:Pusher.sockjs_http_port,httpsPort:Pusher.sockjs_https_port,httpPath:Pusher.sockjs_path,statsHost:Pusher.stats_host,authEndpoint:Pusher.channel_auth_endpoint,authTransport:Pusher.channel_auth_transport,activity_timeout:Pusher.activity_timeout,pong_timeout:Pusher.pong_timeout,unavailable_timeout:Pusher.unavailable_timeout}},Pusher.getClusterConfig=function(t){return{wsHost:"ws-"+t+".pusher.com",httpHost:"sockjs-"+t+".pusher.com"}}}.call(this),function(){function t(t){var e=function(e){Error.call(this,e),this.name=t};return Pusher.Util.extend(e.prototype,Error.prototype),e}Pusher.Errors={UnsupportedTransport:t("UnsupportedTransport"),UnsupportedStrategy:t("UnsupportedStrategy"),TransportPriorityTooLow:t("TransportPriorityTooLow"),TransportClosed:t("TransportClosed")}}.call(this),function(){function t(t){this.callbacks=new e,this.global_callbacks=[],this.failThrough=t}function e(){this._callbacks={}}var i=t.prototype;i.bind=function(t,e){return this.callbacks.add(t,e),this},i.bind_all=function(t){return this.global_callbacks.push(t),this},i.unbind=function(t,e){return this.callbacks.remove(t,e),this},i.emit=function(t,e){var i;for(i=0;i<this.global_callbacks.length;i++)this.global_callbacks[i](t,e);var s=this.callbacks.get(t);if(s&&s.length>0)for(i=0;i<s.length;i++)s[i](e);else this.failThrough&&this.failThrough(t,e);return this},e.prototype.get=function(t){return this._callbacks[this._prefix(t)]},e.prototype.add=function(t,e){var i=this._prefix(t);this._callbacks[i]=this._callbacks[i]||[],this._callbacks[i].push(e)},e.prototype.remove=function(t,e){if(this.get(t)){var i=Pusher.Util.arrayIndexOf(this.get(t),e);if(-1!==i){var s=this._callbacks[this._prefix(t)].slice(0);s.splice(i,1),this._callbacks[this._prefix(t)]=s}}},e.prototype._prefix=function(t){return"_"+t},Pusher.EventsDispatcher=t}.call(this),function(){function t(t){this.options=t,this.loading={},this.loaded={}}function e(t,e){Pusher.Util.getDocument().addEventListener?t.addEventListener("load",e,!1):t.attachEvent("onreadystatechange",function(){("loaded"===t.readyState||"complete"===t.readyState)&&e()})}function i(t,i){var s=Pusher.Util.getDocument(),n=s.getElementsByTagName("head")[0],s=s.createElement("script");s.setAttribute("src",t),s.setAttribute("type","text/javascript"),s.setAttribute("async",!0),e(s,function(){setTimeout(i,0)}),n.appendChild(s)}var s=t.prototype;s.load=function(t,e){var s=this;this.loaded[t]?e():this.loading[t]&&this.loading[t].length>0?this.loading[t].push(e):(this.loading[t]=[e],i(this.getPath(t),function(){if(s.loaded[t]=!0,s.loading[t]){for(var e=0;e<s.loading[t].length;e++)s.loading[t][e]();delete s.loading[t]}}))},s.getRoot=function(t){var e=Pusher.Util.getDocumentLocation().protocol;return(t&&t.encrypted||"https:"===e?this.options.cdn_https:this.options.cdn_http).replace(/\/*$/,"")+"/"+this.options.version},s.getPath=function(t,e){return this.getRoot(e)+"/"+t+this.options.suffix+".js"},Pusher.DependencyLoader=t}.call(this),function(){function t(){Pusher.ready()}function e(t){document.body?t():setTimeout(function(){e(t)},0)}function i(){e(t)}Pusher.Dependencies=new Pusher.DependencyLoader({cdn_http:Pusher.cdn_http,cdn_https:Pusher.cdn_https,version:Pusher.VERSION,suffix:Pusher.dependency_suffix}),!window.WebSocket&&window.MozWebSocket&&(window.WebSocket=window.MozWebSocket),window.JSON?i():Pusher.Dependencies.load("json2",i)}(),function(){function t(t,e){var i=this;this.timeout=setTimeout(function(){null!==i.timeout&&(e(),i.timeout=null)},t)}var e=t.prototype;e.isRunning=function(){return null!==this.timeout},e.ensureAborted=function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},Pusher.Timer=t}.call(this),function(){function t(t,e){var i=this;this.interval=setInterval(function(){null!==i.interval&&e()},t)}var e=t.prototype;e.isRunning=function(){return null!==this.interval},e.ensureAborted=function(){this.interval&&(clearInterval(this.interval),this.interval=null)},Pusher.PeriodicTimer=t}.call(this),function(){for(var t=String.fromCharCode,e=0;64>e;e++)"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e);var i=function(e){var i=e.charCodeAt(0);return 128>i?e:2048>i?t(192|i>>>6)+t(128|63&i):t(224|i>>>12&15)+t(128|i>>>6&63)+t(128|63&i)},s=function(t){var e=[0,2,1][t.length%3],t=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>>12&63),e>=2?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>>6&63),e>=1?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&t)].join("")},n=window.btoa||function(t){return t.replace(/[\s\S]{1,3}/g,s)};Pusher.Base64={encode:function(t){return n(t.replace(/[^\x00-\x7F]/g,i))}}}.call(this),function(){function t(t){this.options=t}function e(t){return Pusher.Util.mapObject(t,function(t){return"object"==typeof t&&(t=JSON.stringify(t)),encodeURIComponent(Pusher.Base64.encode(t.toString()))})}t.send=function(t,e){var i=new Pusher.JSONPRequest({url:t.url,receiver:t.receiverName,tagPrefix:t.tagPrefix}),s=t.receiver.register(function(t,s){i.cleanup(),e(t,s)});return i.send(s,t.data,function(e){var i=t.receiver.unregister(s);i&&i(e)})};var i=t.prototype;i.send=function(t,i,s){if(this.script)return!1;var n=this.options.tagPrefix||"_pusher_jsonp_",i=Pusher.Util.extend({},i,{receiver:this.options.receiver}),i=Pusher.Util.map(Pusher.Util.flatten(e(Pusher.Util.filterObject(i,function(t){return void 0!==t}))),Pusher.Util.method("join","=")).join("&");this.script=document.createElement("script"),this.script.id=n+t,this.script.src=this.options.url+"/"+t+"?"+i,this.script.type="text/javascript",this.script.charset="UTF-8",this.script.onerror=this.script.onload=s,void 0===this.script.async&&document.attachEvent&&/opera/i.test(navigator.userAgent)&&(n=this.options.receiver||"Pusher.JSONP.receive",this.errorScript=document.createElement("script"),this.errorScript.text=n+"("+t+", true);",this.script.async=this.errorScript.async=!1);var o=this;return this.script.onreadystatechange=function(){o.script&&/loaded|complete/.test(o.script.readyState)&&s(!0)},t=document.getElementsByTagName("head")[0],t.insertBefore(this.script,t.firstChild),this.errorScript&&t.insertBefore(this.errorScript,this.script.nextSibling),!0},i.cleanup=function(){this.script&&this.script.parentNode&&(this.script.parentNode.removeChild(this.script),this.script=null),this.errorScript&&this.errorScript.parentNode&&(this.errorScript.parentNode.removeChild(this.errorScript),this.errorScript=null)},Pusher.JSONPRequest=t}.call(this),function(){function t(){this.lastId=0,this.callbacks={}}var e=t.prototype;e.register=function(t){this.lastId++;var e=this.lastId;return this.callbacks[e]=t,e},e.unregister=function(t){if(this.callbacks[t]){var e=this.callbacks[t];return delete this.callbacks[t],e}return null},e.receive=function(t,e,i){(t=this.unregister(t))&&t(e,i)},Pusher.JSONPReceiver=t,Pusher.JSONP=new t}.call(this),function(){function t(t,e,i){this.key=t,this.session=e,this.events=[],this.options=i||{},this.uniqueID=this.sent=0}var e=t.prototype;t.ERROR=3,t.INFO=6,t.DEBUG=7,e.log=function(t,e){(void 0===this.options.level||t<=this.options.level)&&(this.events.push(Pusher.Util.extend({},e,{timestamp:Pusher.Util.now(),level:t})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())},e.error=function(e){this.log(t.ERROR,e)},e.info=function(e){this.log(t.INFO,e)},e.debug=function(e){this.log(t.DEBUG,e)},e.isEmpty=function(){return 0===this.events.length},e.send=function(t,e){var i=this,s={};return 0===this.sent&&(s=Pusher.Util.extend({key:this.key,features:this.options.features,version:this.options.version},this.options.params||{})),s.session=this.session,s.timeline=this.events,s=Pusher.Util.filterObject(s,function(t){return void 0!==t}),this.events=[],t(s,function(t,s){t||i.sent++,e&&e(t,s)}),!0},e.generateUniqueID=function(){return this.uniqueID++,this.uniqueID},Pusher.Timeline=t}.call(this),function(){function t(t,e){this.timeline=t,this.options=e||{}}t.prototype.send=function(t,e){if(!this.timeline.isEmpty()){var i=this,s="http"+(t?"s":"")+"://";i.timeline.send(function(t,e){return Pusher.JSONPRequest.send({data:t,url:s+(i.host||i.options.host)+i.options.path,receiver:Pusher.JSONP},function(t,s){s.host&&(i.host=s.host),e&&e(t,s)})},e)}},Pusher.TimelineSender=t}.call(this),function(){function t(t){this.strategies=t}function e(t,e,i){var n=Pusher.Util.map(t,function(t,s,n,o){return t.connect(e,i(s,o))});return{abort:function(){Pusher.Util.apply(n,s)},forceMinPriority:function(t){Pusher.Util.apply(n,function(e){e.forceMinPriority(t)})}}}function i(t){return Pusher.Util.all(t,function(t){return Boolean(t.error)})}function s(t){t.error||t.aborted||(t.abort(),t.aborted=!0)}var n=t.prototype;n.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))},n.connect=function(t,s){return e(this.strategies,t,function(t,e){return function(n,o){(e[t].error=n)?i(e)&&s(!0):(Pusher.Util.apply(e,function(t){t.forceMinPriority(o.transport.priority)}),s(null,o))}})},Pusher.BestConnectedEverStrategy=t}.call(this),function(){function t(t,e,i){this.strategy=t,this.transports=e,this.ttl=i.ttl||18e5,this.timeline=i.timeline}function e(){var t=Pusher.Util.getLocalStorage();return t&&t.pusherTransport?JSON.parse(t.pusherTransport):null}var i=t.prototype;i.isSupported=function(){return this.strategy.isSupported()},i.connect=function(t,i){var s=e(),n=[this.strategy];if(s&&s.timestamp+this.ttl>=Pusher.Util.now()){var o=this.transports[s.transport];o&&(this.timeline.info({cached:!0,transport:s.transport}),n.push(new Pusher.SequentialStrategy([o],{timeout:2*s.latency,failFast:!0})))}var a=Pusher.Util.now(),r=n.pop().connect(t,function l(e,s){if(e){var o=Pusher.Util.getLocalStorage();if(o&&o.pusherTransport)try{delete o.pusherTransport}catch(d){o.pusherTransport=void 0}n.length>0?(a=Pusher.Util.now(),r=n.pop().connect(t,l)):i(e)}else{var o=Pusher.Util.now()-a,h=s.transport.name,c=Pusher.Util.getLocalStorage();if(c)try{c.pusherTransport=JSON.stringify({timestamp:Pusher.Util.now(),transport:h,latency:o})}catch(u){}i(null,s)}});return{abort:function(){r.abort()},forceMinPriority:function(e){t=e,r&&r.forceMinPriority(e)}}},Pusher.CachedStrategy=t}.call(this),function(){function t(t,e){this.strategy=t,this.options={delay:e.delay}}var e=t.prototype;e.isSupported=function(){return this.strategy.isSupported()},e.connect=function(t,e){var i,s=this.strategy,n=new Pusher.Timer(this.options.delay,function(){i=s.connect(t,e)});return{abort:function(){n.ensureAborted(),i&&i.abort()},forceMinPriority:function(e){t=e,i&&i.forceMinPriority(e)}}},Pusher.DelayedStrategy=t}.call(this),function(){function t(t){this.strategy=t}var e=t.prototype;e.isSupported=function(){return this.strategy.isSupported()},e.connect=function(t,e){var i=this.strategy.connect(t,function(t,s){s&&i.abort(),e(t,s)});return i},Pusher.FirstConnectedStrategy=t}.call(this),function(){function t(t,e,i){this.test=t,this.trueBranch=e,this.falseBranch=i}var e=t.prototype;e.isSupported=function(){return(this.test()?this.trueBranch:this.falseBranch).isSupported()},e.connect=function(t,e){return(this.test()?this.trueBranch:this.falseBranch).connect(t,e)},Pusher.IfStrategy=t}.call(this),function(){function t(t,e){this.strategies=t,this.loop=Boolean(e.loop),this.failFast=Boolean(e.failFast),this.timeout=e.timeout,this.timeoutLimit=e.timeoutLimit}var e=t.prototype;e.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))},e.connect=function(t,e){var i=this,s=this.strategies,n=0,o=this.timeout,a=null,r=function(l,d){d?e(null,d):(n+=1,i.loop&&(n%=s.length),n<s.length?(o&&(o*=2,i.timeoutLimit&&(o=Math.min(o,i.timeoutLimit))),a=i.tryStrategy(s[n],t,{timeout:o,failFast:i.failFast},r)):e(!0))},a=this.tryStrategy(s[n],t,{timeout:o,failFast:this.failFast},r);return{abort:function(){a.abort()},forceMinPriority:function(e){t=e,a&&a.forceMinPriority(e)}}},e.tryStrategy=function(t,e,i,s){var n=null,o=null,o=t.connect(e,function(t,e){t&&n&&n.isRunning()&&!i.failFast||(n&&n.ensureAborted(),s(t,e))});return i.timeout>0&&(n=new Pusher.Timer(i.timeout,function(){o.abort(),s(!0)})),{abort:function(){n&&n.ensureAborted(),o.abort()},forceMinPriority:function(t){o.forceMinPriority(t)}}},Pusher.SequentialStrategy=t}.call(this),function(){function t(t,e,i,s){this.name=t,this.priority=e,this.transport=i,this.options=s||{}}function e(t,e){return new Pusher.Timer(0,function(){e(t)}),{abort:function(){},forceMinPriority:function(){}}}var i=t.prototype;i.isSupported=function(){return this.transport.isSupported({disableFlash:!!this.options.disableFlash})},i.connect=function(t,i){if(!this.transport.isSupported())return e(new Pusher.Errors.UnsupportedStrategy,i);if(this.priority<t)return e(new Pusher.Errors.TransportPriorityTooLow,i);var s=this,n=!1,o=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),a=null,r=function(){o.unbind("initialized",r),o.connect()},l=function(){a=new Pusher.Handshake(o,function(t){n=!0,c(),i(null,t)})},d=function(t){c(),i(t)},h=function(){c(),i(new Pusher.Errors.TransportClosed(o))},c=function(){o.unbind("initialized",r),o.unbind("open",l),o.unbind("error",d),o.unbind("closed",h)};return o.bind("initialized",r),o.bind("open",l),o.bind("error",d),o.bind("closed",h),o.initialize(),{abort:function(){n||(c(),a?a.close():o.close())},forceMinPriority:function(t){n||s.priority<t&&(a?a.close():o.close())}}},Pusher.TransportStrategy=t}.call(this),function(){function t(t,e,i,s){Pusher.EventsDispatcher.call(this),this.name=t,this.priority=e,this.key=i,this.state="new",this.timeline=s.timeline,this.id=this.timeline.generateUniqueID(),this.options={encrypted:Boolean(s.encrypted),hostUnencrypted:s.hostUnencrypted,hostEncrypted:s.hostEncrypted}}var e=t.prototype;Pusher.Util.extend(e,Pusher.EventsDispatcher.prototype),t.isSupported=function(){return!1},e.supportsPing=function(){return!1},e.initialize=function(){this.timeline.info(this.buildTimelineMessage({transport:this.name+(this.options.encrypted?"s":"")})),this.timeline.debug(this.buildTimelineMessage({method:"initialize"})),this.changeState("initialized")},e.connect=function(){var t=this.getURL(this.key,this.options);if(this.timeline.debug(this.buildTimelineMessage({method:"connect",url:t})),this.socket||"initialized"!==this.state)return!1;try{this.socket=this.createSocket(t)}catch(e){var i=this;return new Pusher.Timer(0,function(){i.onError(e),i.changeState("closed")}),!1}return this.bindListeners(),Pusher.debug("Connecting",{transport:this.name,url:t}),this.changeState("connecting"),!0},e.close=function(){return this.timeline.debug(this.buildTimelineMessage({method:"close"})),this.socket?(this.socket.close(),!0):!1},e.send=function(t){if(this.timeline.debug(this.buildTimelineMessage({method:"send",data:t})),"open"===this.state){var e=this;return setTimeout(function(){e.socket&&e.socket.send(t)},0),!0}return!1},e.requestPing=function(){this.emit("ping_request")},e.onOpen=function(){this.changeState("open"),this.socket.onopen=void 0},e.onError=function(t){this.emit("error",{type:"WebSocketError",error:t}),this.timeline.error(this.buildTimelineMessage({}))},e.onClose=function(t){t?this.changeState("closed",{code:t.code,reason:t.reason,wasClean:t.wasClean}):this.changeState("closed"),this.socket=void 0},e.onMessage=function(t){this.timeline.debug(this.buildTimelineMessage({message:t.data})),this.emit("message",t)},e.bindListeners=function(){var t=this;this.socket.onopen=function(){t.onOpen()},this.socket.onerror=function(e){t.onError(e)},this.socket.onclose=function(e){t.onClose(e)},this.socket.onmessage=function(e){t.onMessage(e)}},e.createSocket=function(){return null},e.getScheme=function(){return this.options.encrypted?"wss":"ws"},e.getBaseURL=function(){var t;return t=this.options.encrypted?this.options.hostEncrypted:this.options.hostUnencrypted,this.getScheme()+"://"+t},e.getPath=function(){return"/app/"+this.key},e.getQueryString=function(){return"?protocol="+Pusher.PROTOCOL+"&client=js&version="+Pusher.VERSION},e.getURL=function(){return this.getBaseURL()+this.getPath()+this.getQueryString()},e.changeState=function(t,e){this.state=t,this.timeline.info(this.buildTimelineMessage({state:t,params:e})),this.emit(t,e)},e.buildTimelineMessage=function(t){return Pusher.Util.extend({cid:this.id},t)},Pusher.AbstractTransport=t}.call(this),function(){function t(t,e,i,s){Pusher.AbstractTransport.call(this,t,e,i,s)}var e=t.prototype;Pusher.Util.extend(e,Pusher.AbstractTransport.prototype),t.createConnection=function(e,i,s,n){return new t(e,i,s,n)},t.isSupported=function(t){if(t&&t.disableFlash)return!1;try{return Boolean(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(e){return Boolean(navigator&&navigator.mimeTypes&&void 0!==navigator.mimeTypes["application/x-shockwave-flash"])}},e.initialize=function(){var t=this;this.timeline.info(this.buildTimelineMessage({transport:this.name+(this.options.encrypted?"s":"")})),this.timeline.debug(this.buildTimelineMessage({method:"initialize"})),this.changeState("initializing"),void 0===window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&(window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0),window.WEB_SOCKET_SWF_LOCATION=Pusher.Dependencies.getRoot()+"/WebSocketMain.swf",Pusher.Dependencies.load("flashfallback",function(){t.changeState("initialized")})},e.createSocket=function(t){return new FlashWebSocket(t)},e.getQueryString=function(){return Pusher.AbstractTransport.prototype.getQueryString.call(this)+"&flash=true"},Pusher.FlashTransport=t}.call(this),function(){function t(t,e,i,s){Pusher.AbstractTransport.call(this,t,e,i,s),this.options.ignoreNullOrigin=s.ignoreNullOrigin}var e=t.prototype;Pusher.Util.extend(e,Pusher.AbstractTransport.prototype),t.createConnection=function(e,i,s,n){return new t(e,i,s,n)},t.isSupported=function(){return!0},e.initialize=function(){var t=this;this.timeline.info(this.buildTimelineMessage({transport:this.name+(this.options.encrypted?"s":"")})),this.timeline.debug(this.buildTimelineMessage({method:"initialize"})),this.changeState("initializing"),Pusher.Dependencies.load("sockjs",function(){t.changeState("initialized")})},e.supportsPing=function(){return!0},e.createSocket=function(t){return new SockJS(t,null,{js_path:Pusher.Dependencies.getPath("sockjs",{encrypted:this.options.encrypted}),ignore_null_origin:this.options.ignoreNullOrigin})},e.getScheme=function(){return this.options.encrypted?"https":"http"},e.getPath=function(){return this.options.httpPath||"/pusher"},e.getQueryString=function(){return""},e.onOpen=function(){this.socket.send(JSON.stringify({path:Pusher.AbstractTransport.prototype.getPath.call(this)+Pusher.AbstractTransport.prototype.getQueryString.call(this)})),this.changeState("open"),this.socket.onopen=void 0},Pusher.SockJSTransport=t}.call(this),function(){function t(t,e,i,s){Pusher.AbstractTransport.call(this,t,e,i,s)}var e=t.prototype;Pusher.Util.extend(e,Pusher.AbstractTransport.prototype),t.createConnection=function(e,i,s,n){return new t(e,i,s,n)},t.isSupported=function(){return void 0!==window.WebSocket||void 0!==window.MozWebSocket},e.createSocket=function(t){return new(window.WebSocket||window.MozWebSocket)(t)},e.getQueryString=function(){return Pusher.AbstractTransport.prototype.getQueryString.call(this)+"&flash=false"},Pusher.WSTransport=t}.call(this),function(){function t(t,e,i){this.manager=t,this.transport=e,this.minPingDelay=i.minPingDelay,this.maxPingDelay=i.maxPingDelay,this.pingDelay=null}var e=t.prototype;e.createConnection=function(t,e,i,s){var n=this.transport.createConnection(t,e,i,s),o=this,a=null,r=null,l=function(){n.unbind("open",l),a=Pusher.Util.now(),o.pingDelay&&(r=setInterval(function(){r&&n.requestPing()},o.pingDelay)),n.bind("closed",d)},d=function(t){n.unbind("closed",d),r&&(clearInterval(r),r=null),1002===t.code||1003===t.code?o.manager.reportDeath():!t.wasClean&&a&&(t=Pusher.Util.now()-a,t<2*o.maxPingDelay)&&(o.manager.reportDeath(),o.pingDelay=Math.max(t/2,o.minPingDelay))};return n.bind("open",l),n},e.isSupported=function(t){return this.manager.isAlive()&&this.transport.isSupported(t)},Pusher.AssistantToTheTransportManager=t}.call(this),function(){function t(t){this.options=t||{},this.livesLeft=this.options.lives||1/0}var e=t.prototype;e.getAssistant=function(t){return new Pusher.AssistantToTheTransportManager(this,t,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})},e.isAlive=function(){return this.livesLeft>0},e.reportDeath=function(){this.livesLeft-=1},Pusher.TransportManager=t}.call(this),function(){function t(t){return function(e){return[t.apply(this,arguments),e]}}function e(t,i){if(0===t.length)return[[],i];var n=s(t[0],i),o=e(t.slice(1),n[1]);return[[n[0]].concat(o[0]),o[1]]}function i(t,i){if("string"==typeof t[0]&&":"===t[0].charAt(0)){var n=i[t[0].slice(1)];if(t.length>1){if("function"!=typeof n)throw"Calling non-function "+t[0];var o=[Pusher.Util.extend({},i)].concat(Pusher.Util.map(t.slice(1),function(t){return s(t,Pusher.Util.extend({},i))[0]}));return n.apply(this,o)}return[n,i]}return e(t,i)}function s(t,e){if("string"==typeof t){var s;if("string"==typeof t&&":"===t.charAt(0)){if(s=e[t.slice(1)],void 0===s)throw"Undefined symbol "+t;s=[s,e]}else s=[t,e];return s}return"object"==typeof t&&t instanceof Array&&t.length>0?i(t,e):[t,e]}var n={ws:Pusher.WSTransport,flash:Pusher.FlashTransport,sockjs:Pusher.SockJSTransport},o={def:function(t,e,i){if(void 0!==t[e])throw"Redefining symbol "+e;return t[e]=i,[void 0,t]},def_transport:function(t,e,i,s,o,a){var r=n[i];if(!r)throw new Pusher.Errors.UnsupportedTransport(i);return i=Pusher.Util.extend({},{key:t.key,encrypted:t.encrypted,timeline:t.timeline,disableFlash:t.disableFlash,ignoreNullOrigin:t.ignoreNullOrigin},o),a&&(r=a.getAssistant(r)),s=new Pusher.TransportStrategy(e,s,r,i),a=t.def(t,e,s)[1],a.transports=t.transports||{},a.transports[e]=s,[void 0,a]},transport_manager:t(function(t,e){return new Pusher.TransportManager(e)}),sequential:t(function(t,e){var i=Array.prototype.slice.call(arguments,2);return new Pusher.SequentialStrategy(i,e)}),cached:t(function(t,e,i){return new Pusher.CachedStrategy(i,t.transports,{ttl:e,timeline:t.timeline})}),first_connected:t(function(t,e){return new Pusher.FirstConnectedStrategy(e)}),best_connected_ever:t(function(){var t=Array.prototype.slice.call(arguments,1);return new Pusher.BestConnectedEverStrategy(t)}),delayed:t(function(t,e,i){return new Pusher.DelayedStrategy(i,{delay:e})}),"if":t(function(t,e,i,s){return new Pusher.IfStrategy(e,i,s)}),is_supported:t(function(t,e){return function(){return e.isSupported()}})};Pusher.StrategyBuilder={build:function(t,e){var i=Pusher.Util.extend({},o,e);return s(t,i)[1].strategy}}}.call(this),function(){Protocol={decodeMessage:function(t){try{var e=JSON.parse(t.data);if("string"==typeof e.data)try{e.data=JSON.parse(e.data)}catch(i){if(!(i instanceof SyntaxError))throw i}return e}catch(s){throw{type:"MessageParseError",error:s,data:t.data}}},encodeMessage:function(t){return JSON.stringify(t)},processHandshake:function(t){if(t=this.decodeMessage(t),"pusher:connection_established"===t.event)return{action:"connected",id:t.data.socket_id};if("pusher:error"===t.event)return{action:this.getCloseAction(t.data),error:this.getCloseError(t.data)};throw"Invalid handshake"},getCloseAction:function(t){return t.code<4e3?t.code>=1002&&t.code<=1004?"backoff":null:4e3===t.code?"ssl_only":t.code<4100?"refused":t.code<4200?"backoff":t.code<4300?"retry":"refused"},getCloseError:function(t){return 1e3!==t.code&&1001!==t.code?{type:"PusherError",data:{code:t.code,message:t.reason||t.message}}:null}},Pusher.Protocol=Protocol}.call(this),function(){function t(t,e){Pusher.EventsDispatcher.call(this),this.id=t,this.transport=e,this.bindListeners()}var e=t.prototype;Pusher.Util.extend(e,Pusher.EventsDispatcher.prototype),e.supportsPing=function(){return this.transport.supportsPing()},e.send=function(t){return this.transport.send(t)},e.send_event=function(t,e,i){return t={event:t,data:e},i&&(t.channel=i),Pusher.debug("Event sent",t),this.send(Pusher.Protocol.encodeMessage(t))},e.close=function(){this.transport.close()},e.bindListeners=function(){var t=this,e=function(e){var i;try{i=Pusher.Protocol.decodeMessage(e)}catch(s){t.emit("error",{type:"MessageParseError",error:s,data:e.data})}if(void 0!==i){switch(Pusher.debug("Event recd",i),i.event){case"pusher:error":t.emit("error",{type:"PusherError",data:i.data});break;case"pusher:ping":t.emit("ping");break;case"pusher:pong":t.emit("pong")}t.emit("message",i)}},i=function(){t.emit("ping_request")},s=function(e){t.emit("error",{type:"WebSocketError",error:e})},n=function(o){t.transport.unbind("closed",n),t.transport.unbind("error",s),t.transport.unbind("ping_request",i),t.transport.unbind("message",e),o&&o.code&&t.handleCloseEvent(o),t.transport=null,t.emit("closed")};t.transport.bind("message",e),t.transport.bind("ping_request",i),t.transport.bind("error",s),t.transport.bind("closed",n)},e.handleCloseEvent=function(t){var e=Pusher.Protocol.getCloseAction(t);(t=Pusher.Protocol.getCloseError(t))&&this.emit("error",t),e&&this.emit(e)},Pusher.Connection=t}.call(this),function(){function t(t,e){this.transport=t,this.callback=e,this.bindListeners()}var e=t.prototype;e.close=function(){this.unbindListeners(),this.transport.close()},e.bindListeners=function(){var t=this;t.onMessage=function(e){t.unbindListeners();try{var i=Pusher.Protocol.processHandshake(e);"connected"===i.action?t.finish("connected",{connection:new Pusher.Connection(i.id,t.transport)}):(t.finish(i.action,{error:i.error}),t.transport.close())
}catch(s){t.finish("error",{error:s}),t.transport.close()}},t.onClosed=function(e){t.unbindListeners();var i=Pusher.Protocol.getCloseAction(e)||"backoff",e=Pusher.Protocol.getCloseError(e);t.finish(i,{error:e})},t.transport.bind("message",t.onMessage),t.transport.bind("closed",t.onClosed)},e.unbindListeners=function(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)},e.finish=function(t,e){this.callback(Pusher.Util.extend({transport:this.transport,action:t},e))},Pusher.Handshake=t}.call(this),function(){function t(t,e){Pusher.EventsDispatcher.call(this),this.key=t,this.options=e||{},this.state="initialized",this.connection=null,this.encrypted=!!e.encrypted,this.timeline=this.options.timeline,this.connectionCallbacks=this.buildConnectionCallbacks(),this.errorCallbacks=this.buildErrorCallbacks(),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var i=this;Pusher.Network.bind("online",function(){i.timeline.info({netinfo:"online"}),"unavailable"===i.state&&i.connect()}),Pusher.Network.bind("offline",function(){i.timeline.info({netinfo:"offline"}),i.shouldRetry()&&(i.disconnect(),i.updateState("unavailable"))}),this.updateStrategy()}var e=t.prototype;Pusher.Util.extend(e,Pusher.EventsDispatcher.prototype),e.connect=function(){var t=this;if(!t.connection&&"connecting"!==t.state)if(t.strategy.isSupported())if(Pusher.Network.isOnline()===!1)t.updateState("unavailable");else{t.updateState("connecting");var e=function(i,s){i?t.runner=t.strategy.connect(0,e):"error"===s.action?t.timeline.error({handshakeError:s.error}):(t.runner.abort(),t.handshakeCallbacks[s.action](s))};t.runner=t.strategy.connect(0,e),t.setUnavailableTimer()}else t.updateState("failed")},e.send=function(t){return this.connection?this.connection.send(t):!1},e.send_event=function(t,e,i){return this.connection?this.connection.send_event(t,e,i):!1},e.disconnect=function(){this.runner&&this.runner.abort(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.stopActivityCheck(),this.updateState("disconnected"),this.connection&&(this.connection.close(),this.abandonConnection())},e.isEncrypted=function(){return this.encrypted},e.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,encrypted:this.encrypted})},e.retryIn=function(t){var e=this;e.timeline.info({action:"retry",delay:t}),t>0&&e.emit("connecting_in",Math.round(t/1e3)),e.retryTimer=new Pusher.Timer(t||0,function(){e.disconnect(),e.connect()})},e.clearRetryTimer=function(){this.retryTimer&&this.retryTimer.ensureAborted()},e.setUnavailableTimer=function(){var t=this;t.unavailableTimer=new Pusher.Timer(t.options.unavailableTimeout,function(){t.updateState("unavailable")})},e.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()},e.resetActivityCheck=function(){if(this.stopActivityCheck(),!this.connection.supportsPing()){var t=this;t.activityTimer=new Pusher.Timer(t.options.activityTimeout,function(){t.send_event("pusher:ping",{}),t.activityTimer=new Pusher.Timer(t.options.pongTimeout,function(){t.timeline.error({pong_timed_out:t.options.pongTimeout}),t.connection.close()})})}},e.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()},e.buildConnectionCallbacks=function(){var t=this;return{message:function(e){t.resetActivityCheck(),t.emit("message",e)},ping:function(){t.send_event("pusher:pong",{})},ping_request:function(){t.send_event("pusher:ping",{})},error:function(e){t.emit("error",{type:"WebSocketError",error:e})},closed:function(){t.abandonConnection(),t.shouldRetry()&&t.retryIn(1e3)}}},e.buildHandshakeCallbacks=function(t){var e=this;return Pusher.Util.extend({},t,{connected:function(t){e.clearUnavailableTimer(),e.setConnection(t.connection),e.socket_id=e.connection.id,e.timeline.info({socket_id:e.socket_id}),e.updateState("connected")}})},e.buildErrorCallbacks=function(){function t(t){return function(i){i.error&&e.emit("error",{type:"WebSocketError",error:i.error}),t(i)}}var e=this;return{ssl_only:t(function(){e.encrypted=!0,e.updateStrategy(),e.retryIn(0)}),refused:t(function(){e.disconnect()}),backoff:t(function(){e.retryIn(1e3)}),retry:t(function(){e.retryIn(0)})}},e.setConnection=function(t){this.connection=t;for(var e in this.connectionCallbacks)this.connection.bind(e,this.connectionCallbacks[e]);this.resetActivityCheck()},e.abandonConnection=function(){if(this.connection){for(var t in this.connectionCallbacks)this.connection.unbind(t,this.connectionCallbacks[t]);this.connection=null}},e.updateState=function(t,e){var i=this.state;this.state=t,i!==t&&(Pusher.debug("State changed",i+" -> "+t),this.timeline.info({state:t}),this.emit("state_change",{previous:i,current:t}),this.emit(t,e))},e.shouldRetry=function(){return"connecting"===this.state||"connected"===this.state},Pusher.ConnectionManager=t}.call(this),function(){function t(){Pusher.EventsDispatcher.call(this);var t=this;void 0!==window.addEventListener&&(window.addEventListener("online",function(){t.emit("online")},!1),window.addEventListener("offline",function(){t.emit("offline")},!1))}Pusher.Util.extend(t.prototype,Pusher.EventsDispatcher.prototype),t.prototype.isOnline=function(){return void 0===window.navigator.onLine?!0:window.navigator.onLine},Pusher.NetInfo=t,Pusher.Network=new t}.call(this),function(){function t(){this.reset()}var e=t.prototype;e.get=function(t){return Object.prototype.hasOwnProperty.call(this.members,t)?{id:t,info:this.members[t]}:null},e.each=function(t){var e=this;Pusher.Util.objectApply(e.members,function(i,s){t(e.get(s))})},e.setMyID=function(t){this.myID=t},e.onSubscription=function(t){this.members=t.presence.hash,this.count=t.presence.count,this.me=this.get(this.myID)},e.addMember=function(t){return null===this.get(t.user_id)&&this.count++,this.members[t.user_id]=t.user_info,this.get(t.user_id)},e.removeMember=function(t){var e=this.get(t.user_id);return e&&(delete this.members[t.user_id],this.count--),e},e.reset=function(){this.members={},this.count=0,this.me=this.myID=null},Pusher.Members=t}.call(this),function(){function t(t,e){Pusher.EventsDispatcher.call(this,function(e){Pusher.debug("No callbacks on "+t+" for "+e)}),this.name=t,this.pusher=e,this.subscribed=!1}var e=t.prototype;Pusher.Util.extend(e,Pusher.EventsDispatcher.prototype),e.authorize=function(t,e){return e(!1,{})},e.trigger=function(t,e){return this.pusher.send_event(t,e,this.name)},e.disconnect=function(){this.subscribed=!1},e.handleEvent=function(t,e){0===t.indexOf("pusher_internal:")?"pusher_internal:subscription_succeeded"===t&&(this.subscribed=!0,this.emit("pusher:subscription_succeeded",e)):this.emit(t,e)},e.subscribe=function(){var t=this;t.authorize(t.pusher.connection.socket_id,function(e,i){e?t.handleEvent("pusher:subscription_error",i):t.pusher.send_event("pusher:subscribe",{auth:i.auth,channel_data:i.channel_data,channel:t.name})})},e.unsubscribe=function(){this.pusher.send_event("pusher:unsubscribe",{channel:this.name})},Pusher.Channel=t}.call(this),function(){function t(t,e){Pusher.Channel.call(this,t,e)}var e=t.prototype;Pusher.Util.extend(e,Pusher.Channel.prototype),e.authorize=function(t,e){return new Pusher.Channel.Authorizer(this,this.pusher.config).authorize(t,e)},Pusher.PrivateChannel=t}.call(this),function(){function t(t,e){Pusher.PrivateChannel.call(this,t,e),this.members=new Pusher.Members}var e=t.prototype;Pusher.Util.extend(e,Pusher.PrivateChannel.prototype),e.authorize=function(t,e){var i=this;Pusher.PrivateChannel.prototype.authorize.call(i,t,function(t,s){if(!t){if(void 0===s.channel_data)return Pusher.warn("Invalid auth response for channel '"+i.name+"', expected 'channel_data' field"),void e("Invalid auth response");var n=JSON.parse(s.channel_data);i.members.setMyID(n.user_id)}e(t,s)})},e.handleEvent=function(t,e){switch(t){case"pusher_internal:subscription_succeeded":this.members.onSubscription(e),this.subscribed=!0,this.emit("pusher:subscription_succeeded",this.members);break;case"pusher_internal:member_added":this.emit("pusher:member_added",this.members.addMember(e));break;case"pusher_internal:member_removed":var i=this.members.removeMember(e);i&&this.emit("pusher:member_removed",i);break;default:Pusher.PrivateChannel.prototype.handleEvent.call(this,t,e)}},e.disconnect=function(){this.members.reset(),Pusher.PrivateChannel.prototype.disconnect.call(this)},Pusher.PresenceChannel=t}.call(this),function(){function t(){this.channels={}}var e=t.prototype;e.add=function(t,e){return this.channels[t]||(this.channels[t]=0===t.indexOf("private-")?new Pusher.PrivateChannel(t,e):0===t.indexOf("presence-")?new Pusher.PresenceChannel(t,e):new Pusher.Channel(t,e)),this.channels[t]},e.find=function(t){return this.channels[t]},e.remove=function(t){var e=this.channels[t];return delete this.channels[t],e},e.disconnect=function(){Pusher.Util.objectApply(this.channels,function(t){t.disconnect()})},Pusher.Channels=t}.call(this),function(){Pusher.Channel.Authorizer=function(t,e){this.channel=t,this.type=e.authTransport,this.options=e,this.authOptions=(e||{}).auth||{}},Pusher.Channel.Authorizer.prototype={composeQuery:function(t){var e,t="&socket_id="+encodeURIComponent(t)+"&channel_name="+encodeURIComponent(this.channel.name);for(e in this.authOptions.params)t+="&"+encodeURIComponent(e)+"="+encodeURIComponent(this.authOptions.params[e]);return t},authorize:function(t,e){return Pusher.authorizers[this.type].call(this,t,e)}};var t=1;Pusher.auth_callbacks={},Pusher.authorizers={ajax:function(t,e){var i;i=Pusher.XHR?new Pusher.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i.open("POST",this.options.authEndpoint,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var s in this.authOptions.headers)i.setRequestHeader(s,this.authOptions.headers[s]);return i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status){var t,s=!1;try{t=JSON.parse(i.responseText),s=!0}catch(n){e(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+i.responseText)}s&&e(!1,t)}else Pusher.warn("Couldn't get auth info from your webapp",i.status),e(!0,i.status)},i.send(this.composeQuery(t)),i},jsonp:function(e,i){void 0!==this.authOptions.headers&&Pusher.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var s=t.toString();t++;var n=Pusher.Util.getDocument(),o=n.createElement("script");Pusher.auth_callbacks[s]=function(t){i(!1,t)},o.src=this.options.authEndpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+s+"']")+this.composeQuery(e),s=n.getElementsByTagName("head")[0]||n.documentElement,s.insertBefore(o,s.firstChild)}}}.call(this),function(t,e){t.rails!==e&&t.error("jquery-ujs has already been loaded!");var i,s=t(document);t.rails=i={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",buttonClickSelector:"button[data-remote]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(e){var i=t('meta[name="csrf-token"]').attr("content");i&&e.setRequestHeader("X-CSRF-Token",i)},refreshCSRFTokens:function(){var e=t("meta[name=csrf-token]").attr("content"),i=t("meta[name=csrf-param]").attr("content");t('form input[name="'+i+'"]').val(e)},fire:function(e,i,s){var n=t.Event(i);return e.trigger(n,s),n.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t.attr("href")},handleRemote:function(s){var n,o,a,r,l,d,h,c;if(i.fire(s,"ajax:before")){if(r=s.data("cross-domain"),l=r===e?null:r,d=s.data("with-credentials")||null,h=s.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,s.is("form")){n=s.attr("method"),o=s.attr("action"),a=s.serializeArray();var u=s.data("ujs:submit-button");u&&(a.push(u),s.data("ujs:submit-button",null))}else s.is(i.inputChangeSelector)?(n=s.data("method"),o=s.data("url"),a=s.serialize(),s.data("params")&&(a=a+"&"+s.data("params"))):s.is(i.buttonClickSelector)?(n=s.data("method")||"get",o=s.data("url"),a=s.serialize(),s.data("params")&&(a=a+"&"+s.data("params"))):(n=s.data("method"),o=i.href(s),a=s.data("params")||null);c={type:n||"GET",data:a,dataType:h,beforeSend:function(t,n){return n.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+n.accepts.script),i.fire(s,"ajax:beforeSend",[t,n])},success:function(t,e,i){s.trigger("ajax:success",[t,e,i])},complete:function(t,e){s.trigger("ajax:complete",[t,e])},error:function(t,e,i){s.trigger("ajax:error",[t,e,i])},crossDomain:l},d&&(c.xhrFields={withCredentials:d}),o&&(c.url=o);var m=i.ajax(c);return s.trigger("ajax:send",m),m}return!1},handleMethod:function(s){var n=i.href(s),o=s.data("method"),a=s.attr("target"),r=t("meta[name=csrf-token]").attr("content"),l=t("meta[name=csrf-param]").attr("content"),d=t('<form method="post" action="'+n+'"></form>'),h='<input name="_method" value="'+o+'" type="hidden" />';l!==e&&r!==e&&(h+='<input name="'+l+'" value="'+r+'" type="hidden" />'),a&&d.attr("target",a),d.hide().append(h).appendTo("body"),d.submit()},disableFormElements:function(e){e.find(i.disableSelector).each(function(){var e=t(this),i=e.is("button")?"html":"val";e.data("ujs:enable-with",e[i]()),e[i](e.data("disable-with")),e.prop("disabled",!0)})},enableFormElements:function(e){e.find(i.enableSelector).each(function(){var e=t(this),i=e.is("button")?"html":"val";e.data("ujs:enable-with")&&e[i](e.data("ujs:enable-with")),e.prop("disabled",!1)})},allowAction:function(t){var e,s=t.data("confirm"),n=!1;return s?(i.fire(t,"confirm")&&(n=i.confirm(s),e=i.fire(t,"confirm:complete",[n])),n&&e):!0},blankInputs:function(e,i,s){var n,o,a=t(),r=i||"input,textarea",l=e.find(r);return l.each(function(){if(n=t(this),o=n.is("input[type=checkbox],input[type=radio]")?n.is(":checked"):n.val(),!o==!s){if(n.is("input[type=radio]")&&l.filter('input[type=radio]:checked[name="'+n.attr("name")+'"]').length)return!0;a=a.add(n)}}),a.length?a:!1},nonBlankInputs:function(t,e){return i.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(t){t.data("ujs:enable-with",t.html()),t.html(t.data("disable-with")),t.bind("click.railsDisable",function(t){return i.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable")}},i.fire(s,"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,s){t.crossDomain||i.CSRFProtection(s)}),s.delegate(i.linkDisableSelector,"ajax:complete",function(){i.enableElement(t(this))}),s.delegate(i.linkClickSelector,"click.rails",function(s){var n=t(this),o=n.data("method"),a=n.data("params"),r=s.metaKey||s.ctrlKey;if(!i.allowAction(n))return i.stopEverything(s);if(!r&&n.is(i.linkDisableSelector)&&i.disableElement(n),n.data("remote")!==e){if(r&&(!o||"GET"===o)&&!a)return!0;var l=i.handleRemote(n);return l===!1?i.enableElement(n):l.error(function(){i.enableElement(n)}),!1}return n.data("method")?(i.handleMethod(n),!1):void 0}),s.delegate(i.buttonClickSelector,"click.rails",function(e){var s=t(this);return i.allowAction(s)?(i.handleRemote(s),!1):i.stopEverything(e)}),s.delegate(i.inputChangeSelector,"change.rails",function(e){var s=t(this);return i.allowAction(s)?(i.handleRemote(s),!1):i.stopEverything(e)}),s.delegate(i.formSubmitSelector,"submit.rails",function(s){var n=t(this),o=n.data("remote")!==e,a=i.blankInputs(n,i.requiredInputSelector),r=i.nonBlankInputs(n,i.fileInputSelector);if(!i.allowAction(n))return i.stopEverything(s);if(a&&n.attr("novalidate")==e&&i.fire(n,"ajax:aborted:required",[a]))return i.stopEverything(s);if(o){if(r){setTimeout(function(){i.disableFormElements(n)},13);var l=i.fire(n,"ajax:aborted:file",[r]);return l||setTimeout(function(){i.enableFormElements(n)},13),l}return i.handleRemote(n),!1}setTimeout(function(){i.disableFormElements(n)},13)}),s.delegate(i.formInputClickSelector,"click.rails",function(e){var s=t(this);if(!i.allowAction(s))return i.stopEverything(e);var n=s.attr("name"),o=n?{name:n,value:s.val()}:null;s.closest("form").data("ujs:submit-button",o)}),s.delegate(i.formSubmitSelector,"ajax:beforeSend.rails",function(e){this==e.target&&i.disableFormElements(t(this))}),s.delegate(i.formSubmitSelector,"ajax:complete.rails",function(e){this==e.target&&i.enableFormElements(t(this))}),t(function(){i.refreshCSRFTokens()}))}(jQuery),/*!
 * VERSION: 1.18.4
 * DATE: 2016-04-26
 * UPDATES AND DOCS AT: http://greensock.com
 *
 * @license Copyright (c) 2008-2016, GreenSock. All rights reserved.
 * This work is subject to the terms at http://greensock.com/standard-license or for
 * Club GreenSock members, the software agreement that was issued with your membership.
 * 
 * @author: Jack Doyle, jack@greensock.com
 */
!function(t,e){"use strict";var i=t.GreenSockGlobals=t.GreenSockGlobals||t;if(!i.TweenLite){var s,n,o,a,r,l=function(t){var e,s=t.split("."),n=i;for(e=0;e<s.length;e++)n[s[e]]=n=n[s[e]]||{};return n},d=l("com.greensock"),h=1e-10,c=function(t){var e,i=[],s=t.length;for(e=0;e!==s;i.push(t[e++]));return i},u=function(){},m=function(){var t=Object.prototype.toString,e=t.call([]);return function(i){return null!=i&&(i instanceof Array||"object"==typeof i&&!!i.push&&t.call(i)===e)}}(),p={},f=function(s,n,o,a){this.sc=p[s]?p[s].sc:[],p[s]=this,this.gsClass=null,this.func=o;var r=[];this.check=function(d){for(var h,c,u,m,g,_=n.length,b=_;--_>-1;)(h=p[n[_]]||new f(n[_],[])).gsClass?(r[_]=h.gsClass,b--):d&&h.sc.push(this);if(0===b&&o)for(c=("com.greensock."+s).split("."),u=c.pop(),m=l(c.join("."))[u]=this.gsClass=o.apply(o,r),a&&(i[u]=m,g="undefined"!=typeof module&&module.exports,!g&&"function"==typeof define&&define.amd?define((t.GreenSockAMDPath?t.GreenSockAMDPath+"/":"")+s.split(".").pop(),[],function(){return m}):s===e&&g&&(module.exports=m)),_=0;_<this.sc.length;_++)this.sc[_].check()},this.check(!0)},g=t._gsDefine=function(t,e,i,s){return new f(t,e,i,s)},_=d._class=function(t,e,i){return e=e||function(){},g(t,[],function(){return e},i),e};g.globals=i;var b=[0,0,1,1],v=[],y=_("easing.Ease",function(t,e,i,s){this._func=t,this._type=i||0,this._power=s||0,this._params=e?b.concat(e):b},!0),w=y.map={},C=y.register=function(t,e,i,s){for(var n,o,a,r,l=e.split(","),h=l.length,c=(i||"easeIn,easeOut,easeInOut").split(",");--h>-1;)for(o=l[h],n=s?_("easing."+o,null,!0):d.easing[o]||{},a=c.length;--a>-1;)r=c[a],w[o+"."+r]=w[r+o]=n[r]=t.getRatio?t:t[r]||new t};for(o=y.prototype,o._calcEnd=!1,o.getRatio=function(t){if(this._func)return this._params[0]=t,this._func.apply(null,this._params);var e=this._type,i=this._power,s=1===e?1-t:2===e?t:.5>t?2*t:2*(1-t);return 1===i?s*=s:2===i?s*=s*s:3===i?s*=s*s*s:4===i&&(s*=s*s*s*s),1===e?1-s:2===e?s:.5>t?s/2:1-s/2},s=["Linear","Quad","Cubic","Quart","Quint,Strong"],n=s.length;--n>-1;)o=s[n]+",Power"+n,C(new y(null,null,1,n),o,"easeOut",!0),C(new y(null,null,2,n),o,"easeIn"+(0===n?",easeNone":"")),C(new y(null,null,3,n),o,"easeInOut");w.linear=d.easing.Linear.easeIn,w.swing=d.easing.Quad.easeInOut;var S=_("events.EventDispatcher",function(t){this._listeners={},this._eventTarget=t||this});o=S.prototype,o.addEventListener=function(t,e,i,s,n){n=n||0;var o,l,d=this._listeners[t],h=0;for(null==d&&(this._listeners[t]=d=[]),l=d.length;--l>-1;)o=d[l],o.c===e&&o.s===i?d.splice(l,1):0===h&&o.pr<n&&(h=l+1);d.splice(h,0,{c:e,s:i,up:s,pr:n}),this!==a||r||a.wake()},o.removeEventListener=function(t,e){var i,s=this._listeners[t];if(s)for(i=s.length;--i>-1;)if(s[i].c===e)return void s.splice(i,1)},o.dispatchEvent=function(t){var e,i,s,n=this._listeners[t];if(n)for(e=n.length,i=this._eventTarget;--e>-1;)s=n[e],s&&(s.up?s.c.call(s.s||i,{type:t,target:i}):s.c.call(s.s||i))};var k=t.requestAnimationFrame,M=t.cancelAnimationFrame,T=Date.now||function(){return(new Date).getTime()},D=T();for(s=["ms","moz","webkit","o"],n=s.length;--n>-1&&!k;)k=t[s[n]+"RequestAnimationFrame"],M=t[s[n]+"CancelAnimationFrame"]||t[s[n]+"CancelRequestAnimationFrame"];_("Ticker",function(t,e){var i,s,n,o,l,d=this,c=T(),m=e!==!1&&k?"auto":!1,p=500,f=33,g="tick",_=function(t){var e,a,r=T()-D;r>p&&(c+=r-f),D+=r,d.time=(D-c)/1e3,e=d.time-l,(!i||e>0||t===!0)&&(d.frame++,l+=e+(e>=o?.004:o-e),a=!0),t!==!0&&(n=s(_)),a&&d.dispatchEvent(g)};S.call(d),d.time=d.frame=0,d.tick=function(){_(!0)},d.lagSmoothing=function(t,e){p=t||1/h,f=Math.min(e,p,0)},d.sleep=function(){null!=n&&(m&&M?M(n):clearTimeout(n),s=u,n=null,d===a&&(r=!1))},d.wake=function(t){null!==n?d.sleep():t?c+=-D+(D=T()):d.frame>10&&(D=T()-p+5),s=0===i?u:m&&k?k:function(t){return setTimeout(t,1e3*(l-d.time)+1|0)},d===a&&(r=!0),_(2)},d.fps=function(t){return arguments.length?(i=t,o=1/(i||60),l=this.time+o,void d.wake()):i},d.useRAF=function(t){return arguments.length?(d.sleep(),m=t,void d.fps(i)):m},d.fps(t),setTimeout(function(){"auto"===m&&d.frame<5&&"hidden"!==document.visibilityState&&d.useRAF(!1)},1500)}),o=d.Ticker.prototype=new d.events.EventDispatcher,o.constructor=d.Ticker;var I=_("core.Animation",function(t,e){if(this.vars=e=e||{},this._duration=this._totalDuration=t||0,this._delay=Number(e.delay)||0,this._timeScale=1,this._active=e.immediateRender===!0,this.data=e.data,this._reversed=e.reversed===!0,Q){r||a.wake();var i=this.vars.useFrames?V:Q;i.add(this,i._time),this.vars.paused&&this.paused(!0)}});a=I.ticker=new d.Ticker,o=I.prototype,o._dirty=o._gc=o._initted=o._paused=!1,o._totalTime=o._time=0,o._rawPrevTime=-1,o._next=o._last=o._onUpdate=o._timeline=o.timeline=null,o._paused=!1;var x=function(){r&&T()-D>2e3&&a.wake(),setTimeout(x,2e3)};x(),o.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},o.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},o.resume=function(t,e){return null!=t&&this.seek(t,e),this.paused(!1)},o.seek=function(t,e){return this.totalTime(Number(t),e!==!1)},o.restart=function(t,e){return this.reversed(!1).paused(!1).totalTime(t?-this._delay:0,e!==!1,!0)},o.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},o.render=function(){},o.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},o.isActive=function(){var t,e=this._timeline,i=this._startTime;return!e||!this._gc&&!this._paused&&e.isActive()&&(t=e.rawTime())>=i&&t<i+this.totalDuration()/this._timeScale},o._enabled=function(t,e){return r||a.wake(),this._gc=!t,this._active=this.isActive(),e!==!0&&(t&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!t&&this.timeline&&this._timeline._remove(this,!0)),!1},o._kill=function(){return this._enabled(!1,!1)},o.kill=function(t,e){return this._kill(t,e),this},o._uncache=function(t){for(var e=t?this:this.timeline;e;)e._dirty=!0,e=e.timeline;return this},o._swapSelfInParams=function(t){for(var e=t.length,i=t.concat();--e>-1;)"{self}"===t[e]&&(i[e]=this);return i},o._callback=function(t){var e=this.vars;e[t].apply(e[t+"Scope"]||e.callbackScope||this,e[t+"Params"]||v)},o.eventCallback=function(t,e,i,s){if("on"===(t||"").substr(0,2)){var n=this.vars;if(1===arguments.length)return n[t];null==e?delete n[t]:(n[t]=e,n[t+"Params"]=m(i)&&-1!==i.join("").indexOf("{self}")?this._swapSelfInParams(i):i,n[t+"Scope"]=s),"onUpdate"===t&&(this._onUpdate=e)}return this},o.delay=function(t){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+t-this._delay),this._delay=t,this):this._delay},o.duration=function(t){return arguments.length?(this._duration=this._totalDuration=t,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==t&&this.totalTime(this._totalTime*(t/this._duration),!0),this):(this._dirty=!1,this._duration)},o.totalDuration=function(t){return this._dirty=!1,arguments.length?this.duration(t):this._totalDuration},o.time=function(t,e){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(t>this._duration?this._duration:t,e)):this._time},o.totalTime=function(t,e,i){if(r||a.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>t&&!i&&(t+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var s=this._totalDuration,n=this._timeline;if(t>s&&!i&&(t=s),this._startTime=(this._paused?this._pauseTime:n._time)-(this._reversed?s-t:t)/this._timeScale,n._dirty||this._uncache(!1),n._timeline)for(;n._timeline;)n._timeline._time!==(n._startTime+n._totalTime)/n._timeScale&&n.totalTime(n._totalTime,!0),n=n._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==t||0===this._duration)&&(L.length&&Y(),this.render(t,e,!1),L.length&&Y())}return this},o.progress=o.totalProgress=function(t,e){var i=this.duration();return arguments.length?this.totalTime(i*t,e):i?this._time/i:this.ratio},o.startTime=function(t){return arguments.length?(t!==this._startTime&&(this._startTime=t,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,t-this._delay)),this):this._startTime},o.endTime=function(t){return this._startTime+(0!=t?this.totalDuration():this.duration())/this._timeScale},o.timeScale=function(t){if(!arguments.length)return this._timeScale;if(t=t||h,this._timeline&&this._timeline.smoothChildTiming){var e=this._pauseTime,i=e||0===e?e:this._timeline.totalTime();this._startTime=i-(i-this._startTime)*this._timeScale/t}return this._timeScale=t,this._uncache(!1)},o.reversed=function(t){return arguments.length?(t!=this._reversed&&(this._reversed=t,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},o.paused=function(t){if(!arguments.length)return this._paused;var e,i,s=this._timeline;return t!=this._paused&&s&&(r||t||a.wake(),e=s.rawTime(),i=e-this._pauseTime,!t&&s.smoothChildTiming&&(this._startTime+=i,this._uncache(!1)),this._pauseTime=t?e:null,this._paused=t,this._active=this.isActive(),!t&&0!==i&&this._initted&&this.duration()&&(e=s.smoothChildTiming?this._totalTime:(e-this._startTime)/this._timeScale,this.render(e,e===this._totalTime,!0))),this._gc&&!t&&this._enabled(!0,!1),this};var P=_("core.SimpleTimeline",function(t){I.call(this,0,t),this.autoRemoveChildren=this.smoothChildTiming=!0});o=P.prototype=new I,o.constructor=P,o.kill()._gc=!1,o._first=o._last=o._recent=null,o._sortChildren=!1,o.add=o.insert=function(t,e){var i,s;if(t._startTime=Number(e||0)+t._delay,t._paused&&this!==t._timeline&&(t._pauseTime=t._startTime+(this.rawTime()-t._startTime)/t._timeScale),t.timeline&&t.timeline._remove(t,!0),t.timeline=t._timeline=this,t._gc&&t._enabled(!0,!0),i=this._last,this._sortChildren)for(s=t._startTime;i&&i._startTime>s;)i=i._prev;return i?(t._next=i._next,i._next=t):(t._next=this._first,this._first=t),t._next?t._next._prev=t:this._last=t,t._prev=i,this._recent=t,this._timeline&&this._uncache(!0),this},o._remove=function(t,e){return t.timeline===this&&(e||t._enabled(!1,!0),t._prev?t._prev._next=t._next:this._first===t&&(this._first=t._next),t._next?t._next._prev=t._prev:this._last===t&&(this._last=t._prev),t._next=t._prev=t.timeline=null,t===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},o.render=function(t,e,i){var s,n=this._first;for(this._totalTime=this._time=this._rawPrevTime=t;n;)s=n._next,(n._active||t>=n._startTime&&!n._paused)&&(n._reversed?n.render((n._dirty?n.totalDuration():n._totalDuration)-(t-n._startTime)*n._timeScale,e,i):n.render((t-n._startTime)*n._timeScale,e,i)),n=s},o.rawTime=function(){return r||a.wake(),this._totalTime};var F=_("TweenLite",function(e,i,s){if(I.call(this,i,s),this.render=F.prototype.render,null==e)throw"Cannot tween a null target.";this.target=e="string"!=typeof e?e:F.selector(e)||e;var n,o,a,r=e.jquery||e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType),l=this.vars.overwrite;if(this._overwrite=l=null==l?q[F.defaultOverwrite]:"number"==typeof l?l>>0:q[l],(r||e instanceof Array||e.push&&m(e))&&"number"!=typeof e[0])for(this._targets=a=c(e),this._propLookup=[],this._siblings=[],n=0;n<a.length;n++)o=a[n],o?"string"!=typeof o?o.length&&o!==t&&o[0]&&(o[0]===t||o[0].nodeType&&o[0].style&&!o.nodeType)?(a.splice(n--,1),this._targets=a=a.concat(c(o))):(this._siblings[n]=K(o,this,!1),1===l&&this._siblings[n].length>1&&Z(o,this,null,1,this._siblings[n])):(o=a[n--]=F.selector(o),"string"==typeof o&&a.splice(n+1,1)):a.splice(n--,1);else this._propLookup={},this._siblings=K(e,this,!1),1===l&&this._siblings.length>1&&Z(e,this,null,1,this._siblings);(this.vars.immediateRender||0===i&&0===this._delay&&this.vars.immediateRender!==!1)&&(this._time=-h,this.render(Math.min(0,-this._delay)))},!0),$=function(e){return e&&e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType)},A=function(t,e){var i,s={};for(i in t)H[i]||i in e&&"transform"!==i&&"x"!==i&&"y"!==i&&"width"!==i&&"height"!==i&&"className"!==i&&"border"!==i||!(!R[i]||R[i]&&R[i]._autoCSS)||(s[i]=t[i],delete t[i]);t.css=s};o=F.prototype=new I,o.constructor=F,o.kill()._gc=!1,o.ratio=0,o._firstPT=o._targets=o._overwrittenProps=o._startAt=null,o._notifyPluginsOfEnabled=o._lazy=!1,F.version="1.18.4",F.defaultEase=o._ease=new y(null,null,1,1),F.defaultOverwrite="auto",F.ticker=a,F.autoSleep=120,F.lagSmoothing=function(t,e){a.lagSmoothing(t,e)},F.selector=t.$||t.jQuery||function(e){var i=t.$||t.jQuery;return i?(F.selector=i,i(e)):"undefined"==typeof document?e:document.querySelectorAll?document.querySelectorAll(e):document.getElementById("#"===e.charAt(0)?e.substr(1):e)};var L=[],O={},E=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,W=function(t){for(var e,i=this._firstPT,s=1e-6;i;)e=i.blob?t?this.join(""):this.start:i.c*t+i.s,i.r?e=Math.round(e):s>e&&e>-s&&(e=0),i.f?i.fp?i.t[i.p](i.fp,e):i.t[i.p](e):i.t[i.p]=e,i=i._next},B=function(t,e,i,s){var n,o,a,r,l,d,h,c=[t,e],u=0,m="",p=0;for(c.start=t,i&&(i(c),t=c[0],e=c[1]),c.length=0,n=t.match(E)||[],o=e.match(E)||[],s&&(s._next=null,s.blob=1,c._firstPT=s),l=o.length,r=0;l>r;r++)h=o[r],d=e.substr(u,e.indexOf(h,u)-u),m+=d||!r?d:",",u+=d.length,p?p=(p+1)%5:"rgba("===d.substr(-5)&&(p=1),h===n[r]||n.length<=r?m+=h:(m&&(c.push(m),m=""),a=parseFloat(n[r]),c.push(a),c._firstPT={_next:c._firstPT,t:c,p:c.length-1,s:a,c:("="===h.charAt(1)?parseInt(h.charAt(0)+"1",10)*parseFloat(h.substr(2)):parseFloat(h)-a)||0,f:0,r:p&&4>p}),u+=h.length;return m+=e.substr(u),m&&c.push(m),c.setRatio=W,c},z=function(t,e,i,s,n,o,a,r){var l,d,h="get"===i?t[e]:i,c=typeof t[e],u="string"==typeof s&&"="===s.charAt(1),m={t:t,p:e,s:h,f:"function"===c,pg:0,n:n||e,r:o,pr:0,c:u?parseInt(s.charAt(0)+"1",10)*parseFloat(s.substr(2)):parseFloat(s)-h||0};return"number"!==c&&("function"===c&&"get"===i&&(d=e.indexOf("set")||"function"!=typeof t["get"+e.substr(3)]?e:"get"+e.substr(3),m.s=h=a?t[d](a):t[d]()),"string"==typeof h&&(a||isNaN(h))?(m.fp=a,l=B(h,s,r||F.defaultStringFilter,m),m={t:l,p:"setRatio",s:0,c:1,f:2,pg:0,n:n||e,pr:0}):u||(m.s=parseFloat(h),m.c=parseFloat(s)-m.s||0)),m.c?((m._next=this._firstPT)&&(m._next._prev=m),this._firstPT=m,m):void 0},N=F._internals={isArray:m,isSelector:$,lazyTweens:L,blobDif:B},R=F._plugins={},U=N.tweenLookup={},j=0,H=N.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1,callbackScope:1,stringFilter:1},q={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},V=I._rootFramesTimeline=new P,Q=I._rootTimeline=new P,G=30,Y=N.lazyRender=function(){var t,e=L.length;for(O={};--e>-1;)t=L[e],t&&t._lazy!==!1&&(t.render(t._lazy[0],t._lazy[1],!0),t._lazy=!1);L.length=0};Q._startTime=a.time,V._startTime=a.frame,Q._active=V._active=!0,setTimeout(Y,1),I._updateRoot=F.render=function(){var t,e,i;if(L.length&&Y(),Q.render((a.time-Q._startTime)*Q._timeScale,!1,!1),V.render((a.frame-V._startTime)*V._timeScale,!1,!1),L.length&&Y(),a.frame>=G){G=a.frame+(parseInt(F.autoSleep,10)||120);for(i in U){for(e=U[i].tweens,t=e.length;--t>-1;)e[t]._gc&&e.splice(t,1);0===e.length&&delete U[i]}if(i=Q._first,(!i||i._paused)&&F.autoSleep&&!V._first&&1===a._listeners.tick.length){for(;i&&i._paused;)i=i._next;i||a.sleep()}}},a.addEventListener("tick",I._updateRoot);var K=function(t,e,i){var s,n,o=t._gsTweenID;if(U[o||(t._gsTweenID=o="t"+j++)]||(U[o]={target:t,tweens:[]}),e&&(s=U[o].tweens,s[n=s.length]=e,i))for(;--n>-1;)s[n]===e&&s.splice(n,1);return U[o].tweens},X=function(t,e,i,s){var n,o,a=t.vars.onOverwrite;return a&&(n=a(t,e,i,s)),a=F.onOverwrite,a&&(o=a(t,e,i,s)),n!==!1&&o!==!1},Z=function(t,e,i,s,n){var o,a,r,l;if(1===s||s>=4){for(l=n.length,o=0;l>o;o++)if((r=n[o])!==e)r._gc||r._kill(null,t,e)&&(a=!0);else if(5===s)break;return a}var d,c=e._startTime+h,u=[],m=0,p=0===e._duration;for(o=n.length;--o>-1;)(r=n[o])===e||r._gc||r._paused||(r._timeline!==e._timeline?(d=d||J(e,0,p),0===J(r,d,p)&&(u[m++]=r)):r._startTime<=c&&r._startTime+r.totalDuration()/r._timeScale>c&&((p||!r._initted)&&c-r._startTime<=2e-10||(u[m++]=r)));for(o=m;--o>-1;)if(r=u[o],2===s&&r._kill(i,t,e)&&(a=!0),2!==s||!r._firstPT&&r._initted){if(2!==s&&!X(r,e))continue;r._enabled(!1,!1)&&(a=!0)}return a},J=function(t,e,i){for(var s=t._timeline,n=s._timeScale,o=t._startTime;s._timeline;){if(o+=s._startTime,n*=s._timeScale,s._paused)return-100;s=s._timeline}return o/=n,o>e?o-e:i&&o===e||!t._initted&&2*h>o-e?h:(o+=t.totalDuration()/t._timeScale/n)>e+h?0:o-e-h};o._init=function(){var t,e,i,s,n,o=this.vars,a=this._overwrittenProps,r=this._duration,l=!!o.immediateRender,d=o.ease;if(o.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),n={};for(s in o.startAt)n[s]=o.startAt[s];if(n.overwrite=!1,n.immediateRender=!0,n.lazy=l&&o.lazy!==!1,n.startAt=n.delay=null,this._startAt=F.to(this.target,0,n),l)if(this._time>0)this._startAt=null;else if(0!==r)return}else if(o.runBackwards&&0!==r)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{0!==this._time&&(l=!1),i={};for(s in o)H[s]&&"autoCSS"!==s||(i[s]=o[s]);if(i.overwrite=0,i.data="isFromStart",i.lazy=l&&o.lazy!==!1,i.immediateRender=l,this._startAt=F.to(this.target,0,i),l){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null)}if(this._ease=d=d?d instanceof y?d:"function"==typeof d?new y(d,o.easeParams):w[d]||F.defaultEase:F.defaultEase,o.easeParams instanceof Array&&d.config&&(this._ease=d.config.apply(d,o.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(t=this._targets.length;--t>-1;)this._initProps(this._targets[t],this._propLookup[t]={},this._siblings[t],a?a[t]:null)&&(e=!0);else e=this._initProps(this.target,this._propLookup,this._siblings,a);if(e&&F._onPluginEvent("_onInitAllProps",this),a&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),o.runBackwards)for(i=this._firstPT;i;)i.s+=i.c,i.c=-i.c,i=i._next;this._onUpdate=o.onUpdate,this._initted=!0},o._initProps=function(e,i,s,n){var o,a,r,l,d,h;if(null==e)return!1;O[e._gsTweenID]&&Y(),this.vars.css||e.style&&e!==t&&e.nodeType&&R.css&&this.vars.autoCSS!==!1&&A(this.vars,e);for(o in this.vars)if(h=this.vars[o],H[o])h&&(h instanceof Array||h.push&&m(h))&&-1!==h.join("").indexOf("{self}")&&(this.vars[o]=h=this._swapSelfInParams(h,this));else if(R[o]&&(l=new R[o])._onInitTween(e,this.vars[o],this)){for(this._firstPT=d={_next:this._firstPT,t:l,p:"setRatio",s:0,c:1,f:1,n:o,pg:1,pr:l._priority},a=l._overwriteProps.length;--a>-1;)i[l._overwriteProps[a]]=this._firstPT;(l._priority||l._onInitAllProps)&&(r=!0),(l._onDisable||l._onEnable)&&(this._notifyPluginsOfEnabled=!0),d._next&&(d._next._prev=d)}else i[o]=z.call(this,e,o,"get",h,o,0,null,this.vars.stringFilter);return n&&this._kill(n,e)?this._initProps(e,i,s,n):this._overwrite>1&&this._firstPT&&s.length>1&&Z(e,this,i,this._overwrite,s)?(this._kill(i,e),this._initProps(e,i,s,n)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(O[e._gsTweenID]=!0),r)},o.render=function(t,e,i){var s,n,o,a,r=this._time,l=this._duration,d=this._rawPrevTime;if(t>=l-1e-7)this._totalTime=this._time=l,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(s=!0,n="onComplete",i=i||this._timeline.autoRemoveChildren),0===l&&(this._initted||!this.vars.lazy||i)&&(this._startTime===this._timeline._duration&&(t=0),(0>d||0>=t&&t>=-1e-7||d===h&&"isPause"!==this.data)&&d!==t&&(i=!0,d>h&&(n="onReverseComplete")),this._rawPrevTime=a=!e||t||d===t?t:h);else if(1e-7>t)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==r||0===l&&d>0)&&(n="onReverseComplete",s=this._reversed),0>t&&(this._active=!1,0===l&&(this._initted||!this.vars.lazy||i)&&(d>=0&&(d!==h||"isPause"!==this.data)&&(i=!0),this._rawPrevTime=a=!e||t||d===t?t:h)),this._initted||(i=!0);else if(this._totalTime=this._time=t,this._easeType){var c=t/l,u=this._easeType,m=this._easePower;(1===u||3===u&&c>=.5)&&(c=1-c),3===u&&(c*=2),1===m?c*=c:2===m?c*=c*c:3===m?c*=c*c*c:4===m&&(c*=c*c*c*c),this.ratio=1===u?1-c:2===u?c:.5>t/l?c/2:1-c/2}else this.ratio=this._ease.getRatio(t/l);if(this._time!==r||i){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!i&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=r,this._rawPrevTime=d,L.push(this),void(this._lazy=[t,e]);this._time&&!s?this.ratio=this._ease.getRatio(this._time/l):s&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==r&&t>=0&&(this._active=!0),0===r&&(this._startAt&&(t>=0?this._startAt.render(t,e,i):n||(n="_dummyGS")),this.vars.onStart&&(0!==this._time||0===l)&&(e||this._callback("onStart"))),o=this._firstPT;o;)o.f?o.t[o.p](o.c*this.ratio+o.s):o.t[o.p]=o.c*this.ratio+o.s,o=o._next;this._onUpdate&&(0>t&&this._startAt&&t!==-1e-4&&this._startAt.render(t,e,i),e||(this._time!==r||s||i)&&this._callback("onUpdate")),n&&(!this._gc||i)&&(0>t&&this._startAt&&!this._onUpdate&&t!==-1e-4&&this._startAt.render(t,e,i),s&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[n]&&this._callback(n),0===l&&this._rawPrevTime===h&&a!==h&&(this._rawPrevTime=0))}},o._kill=function(t,e,i){if("all"===t&&(t=null),null==t&&(null==e||e===this.target))return this._lazy=!1,this._enabled(!1,!1);e="string"!=typeof e?e||this._targets||this.target:F.selector(e)||e;var s,n,o,a,r,l,d,h,c,u=i&&this._time&&i._startTime===this._startTime&&this._timeline===i._timeline;if((m(e)||$(e))&&"number"!=typeof e[0])for(s=e.length;--s>-1;)this._kill(t,e[s],i)&&(l=!0);else{if(this._targets){for(s=this._targets.length;--s>-1;)if(e===this._targets[s]){r=this._propLookup[s]||{},this._overwrittenProps=this._overwrittenProps||[],n=this._overwrittenProps[s]=t?this._overwrittenProps[s]||{}:"all";break}}else{if(e!==this.target)return!1;r=this._propLookup,n=this._overwrittenProps=t?this._overwrittenProps||{}:"all"}if(r){if(d=t||r,h=t!==n&&"all"!==n&&t!==r&&("object"!=typeof t||!t._tempKill),i&&(F.onOverwrite||this.vars.onOverwrite)){for(o in d)r[o]&&(c||(c=[]),c.push(o));if((c||!t)&&!X(this,i,e,c))return!1}for(o in d)(a=r[o])&&(u&&(a.f?a.t[a.p](a.s):a.t[a.p]=a.s,l=!0),a.pg&&a.t._kill(d)&&(l=!0),a.pg&&0!==a.t._overwriteProps.length||(a._prev?a._prev._next=a._next:a===this._firstPT&&(this._firstPT=a._next),a._next&&(a._next._prev=a._prev),a._next=a._prev=null),delete r[o]),h&&(n[o]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return l},o.invalidate=function(){return this._notifyPluginsOfEnabled&&F._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],I.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-h,this.render(Math.min(0,-this._delay))),this},o._enabled=function(t,e){if(r||a.wake(),t&&this._gc){var i,s=this._targets;if(s)for(i=s.length;--i>-1;)this._siblings[i]=K(s[i],this,!0);else this._siblings=K(this.target,this,!0)}return I.prototype._enabled.call(this,t,e),this._notifyPluginsOfEnabled&&this._firstPT?F._onPluginEvent(t?"_onEnable":"_onDisable",this):!1},F.to=function(t,e,i){return new F(t,e,i)},F.from=function(t,e,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new F(t,e,i)},F.fromTo=function(t,e,i,s){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,new F(t,e,s)},F.delayedCall=function(t,e,i,s,n){return new F(e,0,{delay:t,onComplete:e,onCompleteParams:i,callbackScope:s,onReverseComplete:e,onReverseCompleteParams:i,immediateRender:!1,lazy:!1,useFrames:n,overwrite:0})},F.set=function(t,e){return new F(t,0,e)},F.getTweensOf=function(t,e){if(null==t)return[];t="string"!=typeof t?t:F.selector(t)||t;var i,s,n,o;if((m(t)||$(t))&&"number"!=typeof t[0]){for(i=t.length,s=[];--i>-1;)s=s.concat(F.getTweensOf(t[i],e));for(i=s.length;--i>-1;)for(o=s[i],n=i;--n>-1;)o===s[n]&&s.splice(i,1)}else for(s=K(t).concat(),i=s.length;--i>-1;)(s[i]._gc||e&&!s[i].isActive())&&s.splice(i,1);return s},F.killTweensOf=F.killDelayedCallsTo=function(t,e,i){"object"==typeof e&&(i=e,e=!1);for(var s=F.getTweensOf(t,e),n=s.length;--n>-1;)s[n]._kill(i,t)};var te=_("plugins.TweenPlugin",function(t,e){this._overwriteProps=(t||"").split(","),this._propName=this._overwriteProps[0],this._priority=e||0,this._super=te.prototype},!0);if(o=te.prototype,te.version="1.18.0",te.API=2,o._firstPT=null,o._addTween=z,o.setRatio=W,o._kill=function(t){var e,i=this._overwriteProps,s=this._firstPT;if(null!=t[this._propName])this._overwriteProps=[];else for(e=i.length;--e>-1;)null!=t[i[e]]&&i.splice(e,1);for(;s;)null!=t[s.n]&&(s._next&&(s._next._prev=s._prev),s._prev?(s._prev._next=s._next,s._prev=null):this._firstPT===s&&(this._firstPT=s._next)),s=s._next;return!1},o._roundProps=function(t,e){for(var i=this._firstPT;i;)(t[this._propName]||null!=i.n&&t[i.n.split(this._propName+"_").join("")])&&(i.r=e),i=i._next},F._onPluginEvent=function(t,e){var i,s,n,o,a,r=e._firstPT;if("_onInitAllProps"===t){for(;r;){for(a=r._next,s=n;s&&s.pr>r.pr;)s=s._next;(r._prev=s?s._prev:o)?r._prev._next=r:n=r,(r._next=s)?s._prev=r:o=r,r=a}r=e._firstPT=n}for(;r;)r.pg&&"function"==typeof r.t[t]&&r.t[t]()&&(i=!0),r=r._next;return i},te.activate=function(t){for(var e=t.length;--e>-1;)t[e].API===te.API&&(R[(new t[e])._propName]=t[e]);return!0},g.plugin=function(t){if(!(t&&t.propName&&t.init&&t.API))throw"illegal plugin definition.";var e,i=t.propName,s=t.priority||0,n=t.overwriteProps,o={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},a=_("plugins."+i.charAt(0).toUpperCase()+i.substr(1)+"Plugin",function(){te.call(this,i,s),this._overwriteProps=n||[]},t.global===!0),r=a.prototype=new te(i);r.constructor=a,a.API=t.API;for(e in o)"function"==typeof t[e]&&(r[o[e]]=t[e]);return a.version=t.version,te.activate([a]),a},s=t._gsQueue){for(n=0;n<s.length;n++)s[n]();for(o in p)p[o].func||t.console.log("GSAP encountered missing dependency: com.greensock."+o)}r=!1}}("undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window,"TweenLite");/*!
 * VERSION: 1.18.4
 * DATE: 2016-04-26
 * UPDATES AND DOCS AT: http://greensock.com
 *
 * @license Copyright (c) 2008-2016, GreenSock. All rights reserved.
 * This work is subject to the terms at http://greensock.com/standard-license or for
 * Club GreenSock members, the software agreement that was issued with your membership.
 * 
 * @author: Jack Doyle, jack@greensock.com
 */
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(t,e,i){var s=function(e){t.call(this,e),this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._dirty=!0},n=1e-10,o=e._internals,a=o.lazyTweens,r=o.lazyRender,l=new i(null,null,1,0),d=s.prototype=new t;return d.constructor=s,d.kill()._gc=!1,s.version="1.18.4",d.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),t.prototype.invalidate.call(this)},d.addCallback=function(t,i,s,n){return this.add(e.delayedCall(0,t,s,n),i)},d.removeCallback=function(t,e){if(t)if(null==e)this._kill(null,t);else for(var i=this.getTweensOf(t,!1),s=i.length,n=this._parseTimeOrLabel(e);--s>-1;)i[s]._startTime===n&&i[s]._enabled(!1,!1);return this},d.removePause=function(e){return this.removeCallback(t._internals.pauseCallback,e)},d.tweenTo=function(t,i){i=i||{};var s,n,o,a={ease:l,useFrames:this.usesFrames(),immediateRender:!1};for(n in i)a[n]=i[n];return a.time=this._parseTimeOrLabel(t),s=Math.abs(Number(a.time)-this._time)/this._timeScale||.001,o=new e(this,s,a),a.onStart=function(){o.target.paused(!0),o.vars.time!==o.target.time()&&s===o.duration()&&o.duration(Math.abs(o.vars.time-o.target.time())/o.target._timeScale),i.onStart&&o._callback("onStart")},o},d.tweenFromTo=function(t,e,i){i=i||{},t=this._parseTimeOrLabel(t),i.startAt={onComplete:this.seek,onCompleteParams:[t],callbackScope:this},i.immediateRender=i.immediateRender!==!1;var s=this.tweenTo(e,i);return s.duration(Math.abs(s.vars.time-t)/this._timeScale||.001)},d.render=function(t,e,i){this._gc&&this._enabled(!0,!1);var s,o,l,d,h,c,u,m,p=this._dirty?this.totalDuration():this._totalDuration,f=this._duration,g=this._time,_=this._totalTime,b=this._startTime,v=this._timeScale,y=this._rawPrevTime,w=this._paused,C=this._cycle;if(t>=p-1e-7)this._locked||(this._totalTime=p,this._cycle=this._repeat),this._reversed||this._hasPausedChild()||(o=!0,d="onComplete",h=!!this._timeline.autoRemoveChildren,0===this._duration&&(0>=t&&t>=-1e-7||0>y||y===n)&&y!==t&&this._first&&(h=!0,y>n&&(d="onReverseComplete"))),this._rawPrevTime=this._duration||!e||t||this._rawPrevTime===t?t:n,this._yoyo&&0!==(1&this._cycle)?this._time=t=0:(this._time=f,t=f+1e-4);else if(1e-7>t)if(this._locked||(this._totalTime=this._cycle=0),this._time=0,(0!==g||0===f&&y!==n&&(y>0||0>t&&y>=0)&&!this._locked)&&(d="onReverseComplete",o=this._reversed),0>t)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(h=o=!0,d="onReverseComplete"):y>=0&&this._first&&(h=!0),this._rawPrevTime=t;else{if(this._rawPrevTime=f||!e||t||this._rawPrevTime===t?t:n,0===t&&o)for(s=this._first;s&&0===s._startTime;)s._duration||(o=!1),s=s._next;t=0,this._initted||(h=!0)}else if(0===f&&0>y&&(h=!0),this._time=this._rawPrevTime=t,this._locked||(this._totalTime=t,0!==this._repeat&&(c=f+this._repeatDelay,this._cycle=this._totalTime/c>>0,0!==this._cycle&&this._cycle===this._totalTime/c&&t>=_&&this._cycle--,this._time=this._totalTime-this._cycle*c,this._yoyo&&0!==(1&this._cycle)&&(this._time=f-this._time),this._time>f?(this._time=f,t=f+1e-4):this._time<0?this._time=t=0:t=this._time)),this._hasPause&&!this._forcingPlayhead&&!e){if(t=this._time,t>=g)for(s=this._first;s&&s._startTime<=t&&!u;)s._duration||"isPause"!==s.data||s.ratio||0===s._startTime&&0===this._rawPrevTime||(u=s),s=s._next;else for(s=this._last;s&&s._startTime>=t&&!u;)s._duration||"isPause"===s.data&&s._rawPrevTime>0&&(u=s),s=s._prev;u&&(this._time=t=u._startTime,this._totalTime=t+this._cycle*(this._totalDuration+this._repeatDelay))}if(this._cycle!==C&&!this._locked){var S=this._yoyo&&0!==(1&C),k=S===(this._yoyo&&0!==(1&this._cycle)),M=this._totalTime,T=this._cycle,D=this._rawPrevTime,I=this._time;if(this._totalTime=C*f,this._cycle<C?S=!S:this._totalTime+=f,this._time=g,this._rawPrevTime=0===f?y-1e-4:y,this._cycle=C,this._locked=!0,g=S?0:f,this.render(g,e,0===f),e||this._gc||this.vars.onRepeat&&this._callback("onRepeat"),g!==this._time)return;if(k&&(g=S?f+1e-4:-1e-4,this.render(g,!0,!1)),this._locked=!1,this._paused&&!w)return;this._time=I,this._totalTime=M,this._cycle=T,this._rawPrevTime=D}if(!(this._time!==g&&this._first||i||h||u))return void(_!==this._totalTime&&this._onUpdate&&(e||this._callback("onUpdate")));if(this._initted||(this._initted=!0),this._active||!this._paused&&this._totalTime!==_&&t>0&&(this._active=!0),0===_&&this.vars.onStart&&0!==this._totalTime&&(e||this._callback("onStart")),m=this._time,m>=g)for(s=this._first;s&&(l=s._next,m===this._time&&(!this._paused||w));)(s._active||s._startTime<=this._time&&!s._paused&&!s._gc)&&(u===s&&this.pause(),s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)),s=l;else for(s=this._last;s&&(l=s._prev,m===this._time&&(!this._paused||w));){if(s._active||s._startTime<=g&&!s._paused&&!s._gc){if(u===s){for(u=s._prev;u&&u.endTime()>this._time;)u.render(u._reversed?u.totalDuration()-(t-u._startTime)*u._timeScale:(t-u._startTime)*u._timeScale,e,i),u=u._prev;u=null,this.pause()}s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)}s=l}this._onUpdate&&(e||(a.length&&r(),this._callback("onUpdate"))),d&&(this._locked||this._gc||(b===this._startTime||v!==this._timeScale)&&(0===this._time||p>=this.totalDuration())&&(o&&(a.length&&r(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[d]&&this._callback(d)))},d.getActive=function(t,e,i){null==t&&(t=!0),null==e&&(e=!0),null==i&&(i=!1);var s,n,o=[],a=this.getChildren(t,e,i),r=0,l=a.length;for(s=0;l>s;s++)n=a[s],n.isActive()&&(o[r++]=n);return o},d.getLabelAfter=function(t){t||0!==t&&(t=this._time);var e,i=this.getLabelsArray(),s=i.length;for(e=0;s>e;e++)if(i[e].time>t)return i[e].name;return null},d.getLabelBefore=function(t){null==t&&(t=this._time);for(var e=this.getLabelsArray(),i=e.length;--i>-1;)if(e[i].time<t)return e[i].name;return null},d.getLabelsArray=function(){var t,e=[],i=0;for(t in this._labels)e[i++]={time:this._labels[t],name:t};return e.sort(function(t,e){return t.time-e.time}),e},d.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-t:t)+this._cycle*(this._duration+this._repeatDelay),e):this._time/this.duration()},d.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this._totalTime/this.totalDuration()},d.totalDuration=function(e){return arguments.length?-1!==this._repeat&&e?this.timeScale(this.totalDuration()/e):this:(this._dirty&&(t.prototype.totalDuration.call(this),this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat),this._totalDuration)},d.time=function(t,e){return arguments.length?(this._dirty&&this.totalDuration(),t>this._duration&&(t=this._duration),this._yoyo&&0!==(1&this._cycle)?t=this._duration-t+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(t+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(t,e)):this._time},d.repeat=function(t){return arguments.length?(this._repeat=t,this._uncache(!0)):this._repeat},d.repeatDelay=function(t){return arguments.length?(this._repeatDelay=t,this._uncache(!0)):this._repeatDelay},d.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},d.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.getLabelBefore(this._time+1e-8)},s},!0),_gsScope._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(t,e,i){var s=function(t){e.call(this,t),this._labels={},this.autoRemoveChildren=this.vars.autoRemoveChildren===!0,this.smoothChildTiming=this.vars.smoothChildTiming===!0,this._sortChildren=!0,this._onUpdate=this.vars.onUpdate;var i,s,n=this.vars;for(s in n)i=n[s],l(i)&&-1!==i.join("").indexOf("{self}")&&(n[s]=this._swapSelfInParams(i));l(n.tweens)&&this.add(n.tweens,0,n.align,n.stagger)},n=1e-10,o=i._internals,a=s._internals={},r=o.isSelector,l=o.isArray,d=o.lazyTweens,h=o.lazyRender,c=_gsScope._gsDefine.globals,u=function(t){var e,i={};for(e in t)i[e]=t[e];return i},m=function(t,e,i){var s,n,o=t.cycle;for(s in o)n=o[s],t[s]="function"==typeof n?n.call(e[i],i):n[i%n.length];delete t.cycle},p=a.pauseCallback=function(){},f=function(t){var e,i=[],s=t.length;for(e=0;e!==s;i.push(t[e++]));return i},g=s.prototype=new e;return s.version="1.18.4",g.constructor=s,g.kill()._gc=g._forcingPlayhead=g._hasPause=!1,g.to=function(t,e,s,n){var o=s.repeat&&c.TweenMax||i;return e?this.add(new o(t,e,s),n):this.set(t,s,n)},g.from=function(t,e,s,n){return this.add((s.repeat&&c.TweenMax||i).from(t,e,s),n)},g.fromTo=function(t,e,s,n,o){var a=n.repeat&&c.TweenMax||i;return e?this.add(a.fromTo(t,e,s,n),o):this.set(t,n,o)},g.staggerTo=function(t,e,n,o,a,l,d,h){var c,p,g=new s({onComplete:l,onCompleteParams:d,callbackScope:h,smoothChildTiming:this.smoothChildTiming}),_=n.cycle;for("string"==typeof t&&(t=i.selector(t)||t),t=t||[],r(t)&&(t=f(t)),o=o||0,0>o&&(t=f(t),t.reverse(),o*=-1),p=0;p<t.length;p++)c=u(n),c.startAt&&(c.startAt=u(c.startAt),c.startAt.cycle&&m(c.startAt,t,p)),_&&m(c,t,p),g.to(t[p],e,c,p*o);return this.add(g,a)},g.staggerFrom=function(t,e,i,s,n,o,a,r){return i.immediateRender=0!=i.immediateRender,i.runBackwards=!0,this.staggerTo(t,e,i,s,n,o,a,r)},g.staggerFromTo=function(t,e,i,s,n,o,a,r,l){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,this.staggerTo(t,e,s,n,o,a,r,l)},g.call=function(t,e,s,n){return this.add(i.delayedCall(0,t,e,s),n)},g.set=function(t,e,s){return s=this._parseTimeOrLabel(s,0,!0),null==e.immediateRender&&(e.immediateRender=s===this._time&&!this._paused),this.add(new i(t,0,e),s)},s.exportRoot=function(t,e){t=t||{},null==t.smoothChildTiming&&(t.smoothChildTiming=!0);var n,o,a=new s(t),r=a._timeline;for(null==e&&(e=!0),r._remove(a,!0),a._startTime=0,a._rawPrevTime=a._time=a._totalTime=r._time,n=r._first;n;)o=n._next,e&&n instanceof i&&n.target===n.vars.onComplete||a.add(n,n._startTime-n._delay),n=o;return r.add(a,0),a},g.add=function(n,o,a,r){var d,h,c,u,m,p;if("number"!=typeof o&&(o=this._parseTimeOrLabel(o,0,!0,n)),!(n instanceof t)){if(n instanceof Array||n&&n.push&&l(n)){for(a=a||"normal",r=r||0,d=o,h=n.length,c=0;h>c;c++)l(u=n[c])&&(u=new s({tweens:u})),this.add(u,d),"string"!=typeof u&&"function"!=typeof u&&("sequence"===a?d=u._startTime+u.totalDuration()/u._timeScale:"start"===a&&(u._startTime-=u.delay())),d+=r;return this._uncache(!0)}if("string"==typeof n)return this.addLabel(n,o);if("function"!=typeof n)throw"Cannot add "+n+" into the timeline; it is not a tween, timeline, function, or string.";n=i.delayedCall(0,n)}if(e.prototype.add.call(this,n,o),(this._gc||this._time===this._duration)&&!this._paused&&this._duration<this.duration())for(m=this,p=m.rawTime()>n._startTime;m._timeline;)p&&m._timeline.smoothChildTiming?m.totalTime(m._totalTime,!0):m._gc&&m._enabled(!0,!1),m=m._timeline;return this},g.remove=function(e){if(e instanceof t){this._remove(e,!1);var i=e._timeline=e.vars.useFrames?t._rootFramesTimeline:t._rootTimeline;return e._startTime=(e._paused?e._pauseTime:i._time)-(e._reversed?e.totalDuration()-e._totalTime:e._totalTime)/e._timeScale,this}if(e instanceof Array||e&&e.push&&l(e)){for(var s=e.length;--s>-1;)this.remove(e[s]);return this}return"string"==typeof e?this.removeLabel(e):this.kill(null,e)},g._remove=function(t,i){e.prototype._remove.call(this,t,i);var s=this._last;return s?this._time>s._startTime+s._totalDuration/s._timeScale&&(this._time=this.duration(),this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},g.append=function(t,e){return this.add(t,this._parseTimeOrLabel(null,e,!0,t))},g.insert=g.insertMultiple=function(t,e,i,s){return this.add(t,e||0,i,s)},g.appendMultiple=function(t,e,i,s){return this.add(t,this._parseTimeOrLabel(null,e,!0,t),i,s)},g.addLabel=function(t,e){return this._labels[t]=this._parseTimeOrLabel(e),this},g.addPause=function(t,e,s,n){var o=i.delayedCall(0,p,s,n||this);return o.vars.onComplete=o.vars.onReverseComplete=e,o.data="isPause",this._hasPause=!0,this.add(o,t)},g.removeLabel=function(t){return delete this._labels[t],this},g.getLabelTime=function(t){return null!=this._labels[t]?this._labels[t]:-1},g._parseTimeOrLabel=function(e,i,s,n){var o;if(n instanceof t&&n.timeline===this)this.remove(n);else if(n&&(n instanceof Array||n.push&&l(n)))for(o=n.length;--o>-1;)n[o]instanceof t&&n[o].timeline===this&&this.remove(n[o]);if("string"==typeof i)return this._parseTimeOrLabel(i,s&&"number"==typeof e&&null==this._labels[i]?e-this.duration():0,s);if(i=i||0,"string"!=typeof e||!isNaN(e)&&null==this._labels[e])null==e&&(e=this.duration());else{if(o=e.indexOf("="),-1===o)return null==this._labels[e]?s?this._labels[e]=this.duration()+i:i:this._labels[e]+i;i=parseInt(e.charAt(o-1)+"1",10)*Number(e.substr(o+1)),e=o>1?this._parseTimeOrLabel(e.substr(0,o-1),0,s):this.duration()}return Number(e)+i},g.seek=function(t,e){return this.totalTime("number"==typeof t?t:this._parseTimeOrLabel(t),e!==!1)},g.stop=function(){return this.paused(!0)},g.gotoAndPlay=function(t,e){return this.play(t,e)},g.gotoAndStop=function(t,e){return this.pause(t,e)},g.render=function(t,e,i){this._gc&&this._enabled(!0,!1);var s,o,a,r,l,c,u,m=this._dirty?this.totalDuration():this._totalDuration,p=this._time,f=this._startTime,g=this._timeScale,_=this._paused;if(t>=m-1e-7)this._totalTime=this._time=m,this._reversed||this._hasPausedChild()||(o=!0,r="onComplete",l=!!this._timeline.autoRemoveChildren,0===this._duration&&(0>=t&&t>=-1e-7||this._rawPrevTime<0||this._rawPrevTime===n)&&this._rawPrevTime!==t&&this._first&&(l=!0,this._rawPrevTime>n&&(r="onReverseComplete"))),this._rawPrevTime=this._duration||!e||t||this._rawPrevTime===t?t:n,t=m+1e-4;else if(1e-7>t)if(this._totalTime=this._time=0,(0!==p||0===this._duration&&this._rawPrevTime!==n&&(this._rawPrevTime>0||0>t&&this._rawPrevTime>=0))&&(r="onReverseComplete",o=this._reversed),0>t)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(l=o=!0,r="onReverseComplete"):this._rawPrevTime>=0&&this._first&&(l=!0),this._rawPrevTime=t;else{if(this._rawPrevTime=this._duration||!e||t||this._rawPrevTime===t?t:n,0===t&&o)for(s=this._first;s&&0===s._startTime;)s._duration||(o=!1),s=s._next;t=0,this._initted||(l=!0)}else{if(this._hasPause&&!this._forcingPlayhead&&!e){if(t>=p)for(s=this._first;s&&s._startTime<=t&&!c;)s._duration||"isPause"!==s.data||s.ratio||0===s._startTime&&0===this._rawPrevTime||(c=s),s=s._next;else for(s=this._last;s&&s._startTime>=t&&!c;)s._duration||"isPause"===s.data&&s._rawPrevTime>0&&(c=s),s=s._prev;c&&(this._time=t=c._startTime,this._totalTime=t+this._cycle*(this._totalDuration+this._repeatDelay))}this._totalTime=this._time=this._rawPrevTime=t}if(this._time!==p&&this._first||i||l||c){if(this._initted||(this._initted=!0),this._active||!this._paused&&this._time!==p&&t>0&&(this._active=!0),0===p&&this.vars.onStart&&0!==this._time&&(e||this._callback("onStart")),u=this._time,u>=p)for(s=this._first;s&&(a=s._next,u===this._time&&(!this._paused||_));)(s._active||s._startTime<=u&&!s._paused&&!s._gc)&&(c===s&&this.pause(),s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)),s=a;else for(s=this._last;s&&(a=s._prev,u===this._time&&(!this._paused||_));){if(s._active||s._startTime<=p&&!s._paused&&!s._gc){if(c===s){for(c=s._prev;c&&c.endTime()>this._time;)c.render(c._reversed?c.totalDuration()-(t-c._startTime)*c._timeScale:(t-c._startTime)*c._timeScale,e,i),c=c._prev;c=null,this.pause()}s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)}s=a}this._onUpdate&&(e||(d.length&&h(),this._callback("onUpdate"))),r&&(this._gc||(f===this._startTime||g!==this._timeScale)&&(0===this._time||m>=this.totalDuration())&&(o&&(d.length&&h(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[r]&&this._callback(r)))}},g._hasPausedChild=function(){for(var t=this._first;t;){if(t._paused||t instanceof s&&t._hasPausedChild())return!0;t=t._next}return!1},g.getChildren=function(t,e,s,n){n=n||-9999999999;for(var o=[],a=this._first,r=0;a;)a._startTime<n||(a instanceof i?e!==!1&&(o[r++]=a):(s!==!1&&(o[r++]=a),t!==!1&&(o=o.concat(a.getChildren(!0,e,s)),r=o.length))),a=a._next;return o},g.getTweensOf=function(t,e){var s,n,o=this._gc,a=[],r=0;for(o&&this._enabled(!0,!0),s=i.getTweensOf(t),n=s.length;--n>-1;)(s[n].timeline===this||e&&this._contains(s[n]))&&(a[r++]=s[n]);return o&&this._enabled(!1,!0),a},g.recent=function(){return this._recent},g._contains=function(t){for(var e=t.timeline;e;){if(e===this)return!0;e=e.timeline}return!1},g.shiftChildren=function(t,e,i){i=i||0;for(var s,n=this._first,o=this._labels;n;)n._startTime>=i&&(n._startTime+=t),n=n._next;if(e)for(s in o)o[s]>=i&&(o[s]+=t);return this._uncache(!0)},g._kill=function(t,e){if(!t&&!e)return this._enabled(!1,!1);for(var i=e?this.getTweensOf(e):this.getChildren(!0,!0,!1),s=i.length,n=!1;--s>-1;)i[s]._kill(t,e)&&(n=!0);return n},g.clear=function(t){var e=this.getChildren(!1,!0,!0),i=e.length;for(this._time=this._totalTime=0;--i>-1;)e[i]._enabled(!1,!1);return t!==!1&&(this._labels={}),this._uncache(!0)},g.invalidate=function(){for(var e=this._first;e;)e.invalidate(),e=e._next;return t.prototype.invalidate.call(this)},g._enabled=function(t,i){if(t===this._gc)for(var s=this._first;s;)s._enabled(t,!0),s=s._next;return e.prototype._enabled.call(this,t,i)},g.totalTime=function(){this._forcingPlayhead=!0;var e=t.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,e},g.duration=function(t){return arguments.length?(0!==this.duration()&&0!==t&&this.timeScale(this._duration/t),this):(this._dirty&&this.totalDuration(),this._duration)},g.totalDuration=function(t){if(!arguments.length){if(this._dirty){for(var e,i,s=0,n=this._last,o=999999999999;n;)e=n._prev,n._dirty&&n.totalDuration(),n._startTime>o&&this._sortChildren&&!n._paused?this.add(n,n._startTime-n._delay):o=n._startTime,n._startTime<0&&!n._paused&&(s-=n._startTime,this._timeline.smoothChildTiming&&(this._startTime+=n._startTime/this._timeScale),this.shiftChildren(-n._startTime,!1,-9999999999),o=0),i=n._startTime+n._totalDuration/n._timeScale,i>s&&(s=i),n=e;this._duration=this._totalDuration=s,this._dirty=!1}return this._totalDuration}return t&&this.totalDuration()?this.timeScale(this._totalDuration/t):this},g.paused=function(e){if(!e)for(var i=this._first,s=this._time;i;)i._startTime===s&&"isPause"===i.data&&(i._rawPrevTime=0),i=i._next;return t.prototype.paused.apply(this,arguments)},g.usesFrames=function(){for(var e=this._timeline;e._timeline;)e=e._timeline;return e===t._rootFramesTimeline},g.rawTime=function(){return this._paused?this._totalTime:(this._timeline.rawTime()-this._startTime)*this._timeScale},s},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(t){"use strict";var e=function(){return(_gsScope.GreenSockGlobals||_gsScope)[t]};"function"==typeof define&&define.amd?define(["TweenLite"],e):"undefined"!=typeof module&&module.exports&&(require("./TweenLite.js"),module.exports=e())}("TimelineMax");/*!
 * VERSION: 1.15.3
 * DATE: 2015-12-22
 * UPDATES AND DOCS AT: http://greensock.com
 *
 * @license Copyright (c) 2008-2016, GreenSock. All rights reserved.
 * This work is subject to the terms at http://greensock.com/standard-license or for
 * Club GreenSock members, the software agreement that was issued with your membership.
 * 
 * @author: Jack Doyle, jack@greensock.com
 **/
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("easing.Back",["easing.Ease"],function(t){var e,i,s,n=_gsScope.GreenSockGlobals||_gsScope,o=n.com.greensock,a=2*Math.PI,r=Math.PI/2,l=o._class,d=function(e,i){var s=l("easing."+e,function(){},!0),n=s.prototype=new t;return n.constructor=s,n.getRatio=i,s},h=t.register||function(){},c=function(t,e,i,s){var n=l("easing."+t,{easeOut:new e,easeIn:new i,easeInOut:new s},!0);return h(n,t),n},u=function(t,e,i){this.t=t,this.v=e,i&&(this.next=i,i.prev=this,this.c=i.v-e,this.gap=i.t-t)},m=function(e,i){var s=l("easing."+e,function(t){this._p1=t||0===t?t:1.70158,this._p2=1.525*this._p1},!0),n=s.prototype=new t;return n.constructor=s,n.getRatio=i,n.config=function(t){return new s(t)},s},p=c("Back",m("BackOut",function(t){return(t-=1)*t*((this._p1+1)*t+this._p1)+1}),m("BackIn",function(t){return t*t*((this._p1+1)*t-this._p1)}),m("BackInOut",function(t){return(t*=2)<1?.5*t*t*((this._p2+1)*t-this._p2):.5*((t-=2)*t*((this._p2+1)*t+this._p2)+2)})),f=l("easing.SlowMo",function(t,e,i){e=e||0===e?e:.7,null==t?t=.7:t>1&&(t=1),this._p=1!==t?e:0,this._p1=(1-t)/2,this._p2=t,this._p3=this._p1+this._p2,this._calcEnd=i===!0},!0),g=f.prototype=new t;return g.constructor=f,g.getRatio=function(t){var e=t+(.5-t)*this._p;return t<this._p1?this._calcEnd?1-(t=1-t/this._p1)*t:e-(t=1-t/this._p1)*t*t*t*e:t>this._p3?this._calcEnd?1-(t=(t-this._p3)/this._p1)*t:e+(t-e)*(t=(t-this._p3)/this._p1)*t*t*t:this._calcEnd?1:e},f.ease=new f(.7,.7),g.config=f.config=function(t,e,i){return new f(t,e,i)},e=l("easing.SteppedEase",function(t){t=t||1,this._p1=1/t,this._p2=t+1},!0),g=e.prototype=new t,g.constructor=e,g.getRatio=function(t){return 0>t?t=0:t>=1&&(t=.999999999),(this._p2*t>>0)*this._p1},g.config=e.config=function(t){return new e(t)},i=l("easing.RoughEase",function(e){e=e||{};for(var i,s,n,o,a,r,l=e.taper||"none",d=[],h=0,c=0|(e.points||20),m=c,p=e.randomize!==!1,f=e.clamp===!0,g=e.template instanceof t?e.template:null,_="number"==typeof e.strength?.4*e.strength:.4;--m>-1;)i=p?Math.random():1/c*m,s=g?g.getRatio(i):i,"none"===l?n=_:"out"===l?(o=1-i,n=o*o*_):"in"===l?n=i*i*_:.5>i?(o=2*i,n=o*o*.5*_):(o=2*(1-i),n=o*o*.5*_),p?s+=Math.random()*n-.5*n:m%2?s+=.5*n:s-=.5*n,f&&(s>1?s=1:0>s&&(s=0)),d[h++]={x:i,y:s};for(d.sort(function(t,e){return t.x-e.x}),r=new u(1,1,null),m=c;--m>-1;)a=d[m],r=new u(a.x,a.y,r);this._prev=new u(0,0,0!==r.t?r:r.next)},!0),g=i.prototype=new t,g.constructor=i,g.getRatio=function(t){var e=this._prev;if(t>e.t){for(;e.next&&t>=e.t;)e=e.next;e=e.prev}else for(;e.prev&&t<=e.t;)e=e.prev;return this._prev=e,e.v+(t-e.t)/e.gap*e.c},g.config=function(t){return new i(t)},i.ease=new i,c("Bounce",d("BounceOut",function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}),d("BounceIn",function(t){return(t=1-t)<1/2.75?1-7.5625*t*t:2/2.75>t?1-(7.5625*(t-=1.5/2.75)*t+.75):2.5/2.75>t?1-(7.5625*(t-=2.25/2.75)*t+.9375):1-(7.5625*(t-=2.625/2.75)*t+.984375)}),d("BounceInOut",function(t){var e=.5>t;return t=e?1-2*t:2*t-1,t=1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,e?.5*(1-t):.5*t+.5})),c("Circ",d("CircOut",function(t){return Math.sqrt(1-(t-=1)*t)}),d("CircIn",function(t){return-(Math.sqrt(1-t*t)-1)}),d("CircInOut",function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)})),s=function(e,i,s){var n=l("easing."+e,function(t,e){this._p1=t>=1?t:1,this._p2=(e||s)/(1>t?t:1),this._p3=this._p2/a*(Math.asin(1/this._p1)||0),this._p2=a/this._p2},!0),o=n.prototype=new t;return o.constructor=n,o.getRatio=i,o.config=function(t,e){return new n(t,e)},n},c("Elastic",s("ElasticOut",function(t){return this._p1*Math.pow(2,-10*t)*Math.sin((t-this._p3)*this._p2)+1},.3),s("ElasticIn",function(t){return-(this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*this._p2))},.3),s("ElasticInOut",function(t){return(t*=2)<1?-.5*this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*this._p2):this._p1*Math.pow(2,-10*(t-=1))*Math.sin((t-this._p3)*this._p2)*.5+1},.45)),c("Expo",d("ExpoOut",function(t){return 1-Math.pow(2,-10*t)}),d("ExpoIn",function(t){return Math.pow(2,10*(t-1))-.001}),d("ExpoInOut",function(t){return(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))})),c("Sine",d("SineOut",function(t){return Math.sin(t*r)}),d("SineIn",function(t){return-Math.cos(t*r)+1}),d("SineInOut",function(t){return-.5*(Math.cos(Math.PI*t)-1)})),l("easing.EaseLookup",{find:function(e){return t.map[e]}},!0),h(n.SlowMo,"SlowMo","ease,"),h(i,"RoughEase","ease,"),h(e,"SteppedEase","ease,"),p},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(){"use strict";var t=function(){return _gsScope.GreenSockGlobals||_gsScope};"function"==typeof define&&define.amd?define(["TweenLite"],t):"undefined"!=typeof module&&module.exports&&(require("../TweenLite.js"),module.exports=t())}();/*!
 * VERSION: 1.18.4
 * DATE: 2016-04-26
 * UPDATES AND DOCS AT: http://greensock.com
 *
 * @license Copyright (c) 2008-2016, GreenSock. All rights reserved.
 * This work is subject to the terms at http://greensock.com/standard-license or for
 * Club GreenSock members, the software agreement that was issued with your membership.
 * 
 * @author: Jack Doyle, jack@greensock.com
 */
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(t,e){var i,s,n,o,a=function(){t.call(this,"css"),this._overwriteProps.length=0,this.setRatio=a.prototype.setRatio},r=_gsScope._gsDefine.globals,l={},d=a.prototype=new t("css");d.constructor=a,a.version="1.18.4",a.API=2,a.defaultTransformPerspective=0,a.defaultSkewType="compensated",a.defaultSmoothOrigin=!0,d="px",a.suffixMap={top:d,right:d,bottom:d,left:d,width:d,height:d,fontSize:d,padding:d,margin:d,perspective:d,lineHeight:""};var h,c,u,m,p,f,g=/(?:\-|\.|\b)(\d|\.|e\-)+/g,_=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,b=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,v=/(?![+-]?\d*\.?\d+|[+-]|e[+-]\d+)[^0-9]/g,y=/(?:\d|\-|\+|=|#|\.)*/g,w=/opacity *= *([^)]*)/i,C=/opacity:([^;]*)/i,S=/alpha\(opacity *=.+?\)/i,k=/^(rgb|hsl)/,M=/([A-Z])/g,T=/-([a-z])/gi,D=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,I=function(t,e){return e.toUpperCase()},x=/(?:Left|Right|Width)/i,P=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,F=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,$=/,(?=[^\)]*(?:\(|$))/gi,A=/[\s,\(]/i,L=Math.PI/180,O=180/Math.PI,E={},W=document,B=function(t){return W.createElementNS?W.createElementNS("http://www.w3.org/1999/xhtml",t):W.createElement(t)},z=B("div"),N=B("img"),R=a._internals={_specialProps:l},U=navigator.userAgent,j=function(){var t=U.indexOf("Android"),e=B("a");return u=-1!==U.indexOf("Safari")&&-1===U.indexOf("Chrome")&&(-1===t||Number(U.substr(t+8,1))>3),p=u&&Number(U.substr(U.indexOf("Version/")+8,1))<6,m=-1!==U.indexOf("Firefox"),(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(U)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(U))&&(f=parseFloat(RegExp.$1)),e?(e.style.cssText="top:1px;opacity:.55;",/^0.55/.test(e.style.opacity)):!1}(),H=function(t){return w.test("string"==typeof t?t:(t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?parseFloat(RegExp.$1)/100:1},q=function(t){window.console&&console.log(t)},V="",Q="",G=function(t,e){e=e||z;var i,s,n=e.style;if(void 0!==n[t])return t;for(t=t.charAt(0).toUpperCase()+t.substr(1),i=["O","Moz","ms","Ms","Webkit"],s=5;--s>-1&&void 0===n[i[s]+t];);return s>=0?(Q=3===s?"ms":i[s],V="-"+Q.toLowerCase()+"-",Q+t):null},Y=W.defaultView?W.defaultView.getComputedStyle:function(){},K=a.getStyle=function(t,e,i,s,n){var o;return j||"opacity"!==e?(!s&&t.style[e]?o=t.style[e]:(i=i||Y(t))?o=i[e]||i.getPropertyValue(e)||i.getPropertyValue(e.replace(M,"-$1").toLowerCase()):t.currentStyle&&(o=t.currentStyle[e]),null==n||o&&"none"!==o&&"auto"!==o&&"auto auto"!==o?o:n):H(t)},X=R.convertToPixels=function(t,i,s,n,o){if("px"===n||!n)return s;if("auto"===n||!s)return 0;var r,l,d,h=x.test(i),c=t,u=z.style,m=0>s;if(m&&(s=-s),"%"===n&&-1!==i.indexOf("border"))r=s/100*(h?t.clientWidth:t.clientHeight);else{if(u.cssText="border:0 solid red;position:"+K(t,"position")+";line-height:0;","%"!==n&&c.appendChild&&"v"!==n.charAt(0)&&"rem"!==n)u[h?"borderLeftWidth":"borderTopWidth"]=s+n;else{if(c=t.parentNode||W.body,l=c._gsCache,d=e.ticker.frame,l&&h&&l.time===d)return l.width*s/100;u[h?"width":"height"]=s+n}c.appendChild(z),r=parseFloat(z[h?"offsetWidth":"offsetHeight"]),c.removeChild(z),h&&"%"===n&&a.cacheWidths!==!1&&(l=c._gsCache=c._gsCache||{},l.time=d,l.width=r/s*100),0!==r||o||(r=X(t,i,s,n,!0))}return m?-r:r},Z=R.calculateOffset=function(t,e,i){if("absolute"!==K(t,"position",i))return 0;var s="left"===e?"Left":"Top",n=K(t,"margin"+s,i);return t["offset"+s]-(X(t,e,parseFloat(n),n.replace(y,""))||0)},J=function(t,e){var i,s,n,o={};if(e=e||Y(t,null))if(i=e.length)for(;--i>-1;)n=e[i],(-1===n.indexOf("-transform")||Te===n)&&(o[n.replace(T,I)]=e.getPropertyValue(n));else for(i in e)(-1===i.indexOf("Transform")||Me===i)&&(o[i]=e[i]);else if(e=t.currentStyle||t.style)for(i in e)"string"==typeof i&&void 0===o[i]&&(o[i.replace(T,I)]=e[i]);return j||(o.opacity=H(t)),s=ze(t,e,!1),o.rotation=s.rotation,o.skewX=s.skewX,o.scaleX=s.scaleX,o.scaleY=s.scaleY,o.x=s.x,o.y=s.y,Ie&&(o.z=s.z,o.rotationX=s.rotationX,o.rotationY=s.rotationY,o.scaleZ=s.scaleZ),o.filters&&delete o.filters,o},te=function(t,e,i,s,n){var o,a,r,l={},d=t.style;for(a in i)"cssText"!==a&&"length"!==a&&isNaN(a)&&(e[a]!==(o=i[a])||n&&n[a])&&-1===a.indexOf("Origin")&&("number"==typeof o||"string"==typeof o)&&(l[a]="auto"!==o||"left"!==a&&"top"!==a?""!==o&&"auto"!==o&&"none"!==o||"string"!=typeof e[a]||""===e[a].replace(v,"")?o:0:Z(t,a),void 0!==d[a]&&(r=new fe(d,a,d[a],r)));if(s)for(a in s)"className"!==a&&(l[a]=s[a]);return{difs:l,firstMPT:r}},ee={width:["Left","Right"],height:["Top","Bottom"]},ie=["marginLeft","marginRight","marginTop","marginBottom"],se=function(t,e,i){if("svg"===(t.nodeName+"").toLowerCase())return(i||Y(t))[e]||0;if(t.getBBox&&Ee(t))return t.getBBox()[e]||0;var s=parseFloat("width"===e?t.offsetWidth:t.offsetHeight),n=ee[e],o=n.length;for(i=i||Y(t,null);--o>-1;)s-=parseFloat(K(t,"padding"+n[o],i,!0))||0,s-=parseFloat(K(t,"border"+n[o]+"Width",i,!0))||0;return s},ne=function(t,e){if("contain"===t||"auto"===t||"auto auto"===t)return t+" ";(null==t||""===t)&&(t="0 0");var i,s=t.split(" "),n=-1!==t.indexOf("left")?"0%":-1!==t.indexOf("right")?"100%":s[0],o=-1!==t.indexOf("top")?"0%":-1!==t.indexOf("bottom")?"100%":s[1];if(s.length>3&&!e){for(s=t.split(", ").join(",").split(","),t=[],i=0;i<s.length;i++)t.push(ne(s[i]));return t.join(",")}return null==o?o="center"===n?"50%":"0":"center"===o&&(o="50%"),("center"===n||isNaN(parseFloat(n))&&-1===(n+"").indexOf("="))&&(n="50%"),t=n+" "+o+(s.length>2?" "+s[2]:""),e&&(e.oxp=-1!==n.indexOf("%"),e.oyp=-1!==o.indexOf("%"),e.oxr="="===n.charAt(1),e.oyr="="===o.charAt(1),e.ox=parseFloat(n.replace(v,"")),e.oy=parseFloat(o.replace(v,"")),e.v=t),e||t},oe=function(t,e){return"string"==typeof t&&"="===t.charAt(1)?parseInt(t.charAt(0)+"1",10)*parseFloat(t.substr(2)):parseFloat(t)-parseFloat(e)||0},ae=function(t,e){return null==t?e:"string"==typeof t&&"="===t.charAt(1)?parseInt(t.charAt(0)+"1",10)*parseFloat(t.substr(2))+e:parseFloat(t)||0},re=function(t,e,i,s){var n,o,a,r,l,d=1e-6;return null==t?r=e:"number"==typeof t?r=t:(n=360,o=t.split("_"),l="="===t.charAt(1),a=(l?parseInt(t.charAt(0)+"1",10)*parseFloat(o[0].substr(2)):parseFloat(o[0]))*(-1===t.indexOf("rad")?1:O)-(l?0:e),o.length&&(s&&(s[i]=e+a),-1!==t.indexOf("short")&&(a%=n,a!==a%(n/2)&&(a=0>a?a+n:a-n)),-1!==t.indexOf("_cw")&&0>a?a=(a+9999999999*n)%n-(a/n|0)*n:-1!==t.indexOf("ccw")&&a>0&&(a=(a-9999999999*n)%n-(a/n|0)*n)),r=e+a),d>r&&r>-d&&(r=0),r},le={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},de=function(t,e,i){return t=0>t?t+1:t>1?t-1:t,255*(1>6*t?e+(i-e)*t*6:.5>t?i:2>3*t?e+(i-e)*(2/3-t)*6:e)+.5|0},he=a.parseColor=function(t,e){var i,s,n,o,a,r,l,d,h,c,u;if(t)if("number"==typeof t)i=[t>>16,t>>8&255,255&t];else{if(","===t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),le[t])i=le[t];else if("#"===t.charAt(0))4===t.length&&(s=t.charAt(1),n=t.charAt(2),o=t.charAt(3),t="#"+s+s+n+n+o+o),t=parseInt(t.substr(1),16),i=[t>>16,t>>8&255,255&t];else if("hsl"===t.substr(0,3))if(i=u=t.match(g),e){if(-1!==t.indexOf("="))return t.match(_)}else a=Number(i[0])%360/360,r=Number(i[1])/100,l=Number(i[2])/100,n=.5>=l?l*(r+1):l+r-l*r,s=2*l-n,i.length>3&&(i[3]=Number(t[3])),i[0]=de(a+1/3,s,n),i[1]=de(a,s,n),i[2]=de(a-1/3,s,n);else i=t.match(g)||le.transparent;i[0]=Number(i[0]),i[1]=Number(i[1]),i[2]=Number(i[2]),i.length>3&&(i[3]=Number(i[3]))}else i=le.black;return e&&!u&&(s=i[0]/255,n=i[1]/255,o=i[2]/255,d=Math.max(s,n,o),h=Math.min(s,n,o),l=(d+h)/2,d===h?a=r=0:(c=d-h,r=l>.5?c/(2-d-h):c/(d+h),a=d===s?(n-o)/c+(o>n?6:0):d===n?(o-s)/c+2:(s-n)/c+4,a*=60),i[0]=a+.5|0,i[1]=100*r+.5|0,i[2]=100*l+.5|0),i},ce=function(t,e){var i,s,n,o=t.match(ue)||[],a=0,r=o.length?"":t;for(i=0;i<o.length;i++)s=o[i],n=t.substr(a,t.indexOf(s,a)-a),a+=n.length+s.length,s=he(s,e),3===s.length&&s.push(1),r+=n+(e?"hsla("+s[0]+","+s[1]+"%,"+s[2]+"%,"+s[3]:"rgba("+s.join(","))+")";return r+t.substr(a)},ue="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3}){1,2}\\b";for(d in le)ue+="|"+d+"\\b";ue=new RegExp(ue+")","gi"),a.colorStringFilter=function(t){var e,i=t[0]+t[1];ue.test(i)&&(e=-1!==i.indexOf("hsl(")||-1!==i.indexOf("hsla("),t[0]=ce(t[0],e),t[1]=ce(t[1],e)),ue.lastIndex=0},e.defaultStringFilter||(e.defaultStringFilter=a.colorStringFilter);var me=function(t,e,i,s){if(null==t)return function(t){return t};var n,o=e?(t.match(ue)||[""])[0]:"",a=t.split(o).join("").match(b)||[],r=t.substr(0,t.indexOf(a[0])),l=")"===t.charAt(t.length-1)?")":"",d=-1!==t.indexOf(" ")?" ":",",h=a.length,c=h>0?a[0].replace(g,""):"";return h?n=e?function(t){var e,u,m,p;if("number"==typeof t)t+=c;else if(s&&$.test(t)){for(p=t.replace($,"|").split("|"),m=0;m<p.length;m++)p[m]=n(p[m]);return p.join(",")}if(e=(t.match(ue)||[o])[0],u=t.split(e).join("").match(b)||[],m=u.length,h>m--)for(;++m<h;)u[m]=i?u[(m-1)/2|0]:a[m];return r+u.join(d)+d+e+l+(-1!==t.indexOf("inset")?" inset":"")}:function(t){var e,o,u;if("number"==typeof t)t+=c;else if(s&&$.test(t)){for(o=t.replace($,"|").split("|"),u=0;u<o.length;u++)o[u]=n(o[u]);return o.join(",")}if(e=t.match(b)||[],u=e.length,h>u--)for(;++u<h;)e[u]=i?e[(u-1)/2|0]:a[u];return r+e.join(d)+l}:function(t){return t}},pe=function(t){return t=t.split(","),function(e,i,s,n,o,a,r){var l,d=(i+"").split(" ");for(r={},l=0;4>l;l++)r[t[l]]=d[l]=d[l]||d[(l-1)/2>>0];return n.parse(e,r,o,a)}},fe=(R._setPluginRatio=function(t){this.plugin.setRatio(t);for(var e,i,s,n,o,a=this.data,r=a.proxy,l=a.firstMPT,d=1e-6;l;)e=r[l.v],l.r?e=Math.round(e):d>e&&e>-d&&(e=0),l.t[l.p]=e,l=l._next;if(a.autoRotate&&(a.autoRotate.rotation=r.rotation),1===t||0===t)for(l=a.firstMPT,o=1===t?"e":"b";l;){if(i=l.t,i.type){if(1===i.type){for(n=i.xs0+i.s+i.xs1,s=1;s<i.l;s++)n+=i["xn"+s]+i["xs"+(s+1)];i[o]=n}}else i[o]=i.s+i.xs0;l=l._next}},function(t,e,i,s,n){this.t=t,this.p=e,this.v=i,this.r=n,s&&(s._prev=this,this._next=s)}),ge=(R._parseToProxy=function(t,e,i,s,n,o){var a,r,l,d,h,c=s,u={},m={},p=i._transform,f=E;for(i._transform=null,E=e,s=h=i.parse(t,e,s,n),E=f,o&&(i._transform=p,c&&(c._prev=null,c._prev&&(c._prev._next=null)));s&&s!==c;){if(s.type<=1&&(r=s.p,m[r]=s.s+s.c,u[r]=s.s,o||(d=new fe(s,"s",r,d,s.r),s.c=0),1===s.type))for(a=s.l;--a>0;)l="xn"+a,r=s.p+"_"+l,m[r]=s.data[l],u[r]=s[l],o||(d=new fe(s,l,r,d,s.rxp[l]));s=s._next}return{proxy:u,end:m,firstMPT:d,pt:h}},R.CSSPropTween=function(t,e,s,n,a,r,l,d,h,c,u){this.t=t,this.p=e,this.s=s,this.c=n,this.n=l||e,t instanceof ge||o.push(this.n),this.r=d,this.type=r||0,h&&(this.pr=h,i=!0),this.b=void 0===c?s:c,this.e=void 0===u?s+n:u,a&&(this._next=a,a._prev=this)}),_e=function(t,e,i,s,n,o){var a=new ge(t,e,i,s-i,n,-1,o);return a.b=i,a.e=a.xs0=s,a},be=a.parseComplex=function(t,e,i,s,n,o,r,l,d,c){i=i||o||"",r=new ge(t,e,0,0,r,c?2:1,null,!1,l,i,s),s+="",n&&ue.test(s+i)&&(s=[i,s],a.colorStringFilter(s),i=s[0],s=s[1]);var u,m,p,f,b,v,y,w,C,S,k,M,T,D=i.split(", ").join(",").split(" "),I=s.split(", ").join(",").split(" "),x=D.length,P=h!==!1;for((-1!==s.indexOf(",")||-1!==i.indexOf(","))&&(D=D.join(" ").replace($,", ").split(" "),I=I.join(" ").replace($,", ").split(" "),x=D.length),x!==I.length&&(D=(o||"").split(" "),x=D.length),r.plugin=d,r.setRatio=c,ue.lastIndex=0,u=0;x>u;u++)if(f=D[u],b=I[u],w=parseFloat(f),w||0===w)r.appendXtra("",w,oe(b,w),b.replace(_,""),P&&-1!==b.indexOf("px"),!0);else if(n&&ue.test(f))M=b.indexOf(")")+1,M=")"+(M?b.substr(M):""),T=-1!==b.indexOf("hsl")&&j,f=he(f,T),b=he(b,T),C=f.length+b.length>6,C&&!j&&0===b[3]?(r["xs"+r.l]+=r.l?" transparent":"transparent",r.e=r.e.split(I[u]).join("transparent")):(j||(C=!1),T?r.appendXtra(C?"hsla(":"hsl(",f[0],oe(b[0],f[0]),",",!1,!0).appendXtra("",f[1],oe(b[1],f[1]),"%,",!1).appendXtra("",f[2],oe(b[2],f[2]),C?"%,":"%"+M,!1):r.appendXtra(C?"rgba(":"rgb(",f[0],b[0]-f[0],",",!0,!0).appendXtra("",f[1],b[1]-f[1],",",!0).appendXtra("",f[2],b[2]-f[2],C?",":M,!0),C&&(f=f.length<4?1:f[3],r.appendXtra("",f,(b.length<4?1:b[3])-f,M,!1))),ue.lastIndex=0;else if(v=f.match(g)){if(y=b.match(_),!y||y.length!==v.length)return r;for(p=0,m=0;m<v.length;m++)k=v[m],S=f.indexOf(k,p),r.appendXtra(f.substr(p,S-p),Number(k),oe(y[m],k),"",P&&"px"===f.substr(S+k.length,2),0===m),p=S+k.length;r["xs"+r.l]+=f.substr(p)}else r["xs"+r.l]+=r.l||r["xs"+r.l]?" "+b:b;if(-1!==s.indexOf("=")&&r.data){for(M=r.xs0+r.data.s,u=1;u<r.l;u++)M+=r["xs"+u]+r.data["xn"+u];r.e=M+r["xs"+u]}return r.l||(r.type=-1,r.xs0=r.e),r.xfirst||r},ve=9;for(d=ge.prototype,d.l=d.pr=0;--ve>0;)d["xn"+ve]=0,d["xs"+ve]="";d.xs0="",d._next=d._prev=d.xfirst=d.data=d.plugin=d.setRatio=d.rxp=null,d.appendXtra=function(t,e,i,s,n,o){var a=this,r=a.l;return a["xs"+r]+=o&&(r||a["xs"+r])?" "+t:t||"",i||0===r||a.plugin?(a.l++,a.type=a.setRatio?2:1,a["xs"+a.l]=s||"",r>0?(a.data["xn"+r]=e+i,a.rxp["xn"+r]=n,a["xn"+r]=e,a.plugin||(a.xfirst=new ge(a,"xn"+r,e,i,a.xfirst||a,0,a.n,n,a.pr),a.xfirst.xs0=0),a):(a.data={s:e+i},a.rxp={},a.s=e,a.c=i,a.r=n,a)):(a["xs"+r]+=e+(s||""),a)};var ye=function(t,e){e=e||{},this.p=e.prefix?G(t)||t:t,l[t]=l[this.p]=this,this.format=e.formatter||me(e.defaultValue,e.color,e.collapsible,e.multi),e.parser&&(this.parse=e.parser),this.clrs=e.color,this.multi=e.multi,this.keyword=e.keyword,this.dflt=e.defaultValue,this.pr=e.priority||0},we=R._registerComplexSpecialProp=function(t,e,i){"object"!=typeof e&&(e={parser:i});var s,n,o=t.split(","),a=e.defaultValue;for(i=i||[a],s=0;s<o.length;s++)e.prefix=0===s&&e.prefix,e.defaultValue=i[s]||a,n=new ye(o[s],e)},Ce=function(t){if(!l[t]){var e=t.charAt(0).toUpperCase()+t.substr(1)+"Plugin";we(t,{parser:function(t,i,s,n,o,a,d){var h=r.com.greensock.plugins[e];return h?(h._cssRegister(),l[s].parse(t,i,s,n,o,a,d)):(q("Error: "+e+" js file not loaded."),o)}})}};d=ye.prototype,d.parseComplex=function(t,e,i,s,n,o){var a,r,l,d,h,c,u=this.keyword;if(this.multi&&($.test(i)||$.test(e)?(r=e.replace($,"|").split("|"),l=i.replace($,"|").split("|")):u&&(r=[e],l=[i])),l){for(d=l.length>r.length?l.length:r.length,a=0;d>a;a++)e=r[a]=r[a]||this.dflt,i=l[a]=l[a]||this.dflt,u&&(h=e.indexOf(u),c=i.indexOf(u),h!==c&&(-1===c?r[a]=r[a].split(u).join(""):-1===h&&(r[a]+=" "+u)));e=r.join(", "),i=l.join(", ")}return be(t,this.p,e,i,this.clrs,this.dflt,s,this.pr,n,o)},d.parse=function(t,e,i,s,o,a){return this.parseComplex(t.style,this.format(K(t,this.p,n,!1,this.dflt)),this.format(e),o,a)},a.registerSpecialProp=function(t,e,i){we(t,{parser:function(t,s,n,o,a,r){var l=new ge(t,n,0,0,a,2,n,!1,i);return l.plugin=r,l.setRatio=e(t,s,o._tween,n),l},priority:i})},a.useSVGTransformAttr=u||m;var Se,ke="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),Me=G("transform"),Te=V+"transform",De=G("transformOrigin"),Ie=null!==G("perspective"),xe=R.Transform=function(){this.perspective=parseFloat(a.defaultTransformPerspective)||0,this.force3D=a.defaultForce3D!==!1&&Ie?a.defaultForce3D||"auto":!1},Pe=window.SVGElement,Fe=function(t,e,i){var s,n=W.createElementNS("http://www.w3.org/2000/svg",t),o=/([a-z])([A-Z])/g;for(s in i)n.setAttributeNS(null,s.replace(o,"$1-$2").toLowerCase(),i[s]);return e.appendChild(n),n},$e=W.documentElement,Ae=function(){var t,e,i,s=f||/Android/i.test(U)&&!window.chrome;return W.createElementNS&&!s&&(t=Fe("svg",$e),e=Fe("rect",t,{width:100,height:50,x:100}),i=e.getBoundingClientRect().width,e.style[De]="50% 50%",e.style[Me]="scaleX(0.5)",s=i===e.getBoundingClientRect().width&&!(m&&Ie),$e.removeChild(t)),s}(),Le=function(t,e,i,s,n,o){var r,l,d,h,c,u,m,p,f,g,_,b,v,y,w=t._gsTransform,C=Be(t,!0);w&&(v=w.xOrigin,y=w.yOrigin),(!s||(r=s.split(" ")).length<2)&&(m=t.getBBox(),e=ne(e).split(" "),r=[(-1!==e[0].indexOf("%")?parseFloat(e[0])/100*m.width:parseFloat(e[0]))+m.x,(-1!==e[1].indexOf("%")?parseFloat(e[1])/100*m.height:parseFloat(e[1]))+m.y]),i.xOrigin=h=parseFloat(r[0]),i.yOrigin=c=parseFloat(r[1]),s&&C!==We&&(u=C[0],m=C[1],p=C[2],f=C[3],g=C[4],_=C[5],b=u*f-m*p,l=h*(f/b)+c*(-p/b)+(p*_-f*g)/b,d=h*(-m/b)+c*(u/b)-(u*_-m*g)/b,h=i.xOrigin=r[0]=l,c=i.yOrigin=r[1]=d),w&&(o&&(i.xOffset=w.xOffset,i.yOffset=w.yOffset,w=i),n||n!==!1&&a.defaultSmoothOrigin!==!1?(l=h-v,d=c-y,w.xOffset+=l*C[0]+d*C[2]-l,w.yOffset+=l*C[1]+d*C[3]-d):w.xOffset=w.yOffset=0),o||t.setAttribute("data-svg-origin",r.join(" "))},Oe=function(t){try{return t.getBBox()}catch(t){}},Ee=function(t){return!!(Pe&&t.getBBox&&t.getCTM&&Oe(t)&&(!t.parentNode||t.parentNode.getBBox&&t.parentNode.getCTM))},We=[1,0,0,1,0,0],Be=function(t,e){var i,s,n,o,a,r=t._gsTransform||new xe,l=1e5;if(Me?s=K(t,Te,null,!0):t.currentStyle&&(s=t.currentStyle.filter.match(P),s=s&&4===s.length?[s[0].substr(4),Number(s[2].substr(4)),Number(s[1].substr(4)),s[3].substr(4),r.x||0,r.y||0].join(","):""),i=!s||"none"===s||"matrix(1, 0, 0, 1, 0, 0)"===s,(r.svg||t.getBBox&&Ee(t))&&(i&&-1!==(t.style[Me]+"").indexOf("matrix")&&(s=t.style[Me],i=0),n=t.getAttribute("transform"),i&&n&&(-1!==n.indexOf("matrix")?(s=n,i=0):-1!==n.indexOf("translate")&&(s="matrix(1,0,0,1,"+n.match(/(?:\-|\b)[\d\-\.e]+\b/gi).join(",")+")",i=0))),i)return We;for(n=(s||"").match(g)||[],ve=n.length;--ve>-1;)o=Number(n[ve]),n[ve]=(a=o-(o|=0))?(a*l+(0>a?-.5:.5)|0)/l+o:o;return e&&n.length>6?[n[0],n[1],n[4],n[5],n[12],n[13]]:n},ze=R.getTransform=function(t,i,s,o){if(t._gsTransform&&s&&!o)return t._gsTransform;var r,l,d,h,c,u,m=s?t._gsTransform||new xe:new xe,p=m.scaleX<0,f=2e-5,g=1e5,_=Ie?parseFloat(K(t,De,i,!1,"0 0 0").split(" ")[2])||m.zOrigin||0:0,b=parseFloat(a.defaultTransformPerspective)||0;if(m.svg=!(!t.getBBox||!Ee(t)),m.svg&&(Le(t,K(t,De,n,!1,"50% 50%")+"",m,t.getAttribute("data-svg-origin")),Se=a.useSVGTransformAttr||Ae),r=Be(t),r!==We){if(16===r.length){var v,y,w,C,S,k=r[0],M=r[1],T=r[2],D=r[3],I=r[4],x=r[5],P=r[6],F=r[7],$=r[8],A=r[9],L=r[10],E=r[12],W=r[13],B=r[14],z=r[11],N=Math.atan2(P,L);m.zOrigin&&(B=-m.zOrigin,E=$*B-r[12],W=A*B-r[13],B=L*B+m.zOrigin-r[14]),m.rotationX=N*O,N&&(C=Math.cos(-N),S=Math.sin(-N),v=I*C+$*S,y=x*C+A*S,w=P*C+L*S,$=I*-S+$*C,A=x*-S+A*C,L=P*-S+L*C,z=F*-S+z*C,I=v,x=y,P=w),N=Math.atan2(-T,L),m.rotationY=N*O,N&&(C=Math.cos(-N),S=Math.sin(-N),v=k*C-$*S,y=M*C-A*S,w=T*C-L*S,A=M*S+A*C,L=T*S+L*C,z=D*S+z*C,k=v,M=y,T=w),N=Math.atan2(M,k),m.rotation=N*O,N&&(C=Math.cos(-N),S=Math.sin(-N),k=k*C+I*S,y=M*C+x*S,x=M*-S+x*C,P=T*-S+P*C,M=y),m.rotationX&&Math.abs(m.rotationX)+Math.abs(m.rotation)>359.9&&(m.rotationX=m.rotation=0,m.rotationY=180-m.rotationY),m.scaleX=(Math.sqrt(k*k+M*M)*g+.5|0)/g,m.scaleY=(Math.sqrt(x*x+A*A)*g+.5|0)/g,m.scaleZ=(Math.sqrt(P*P+L*L)*g+.5|0)/g,m.skewX=I||x?Math.atan2(I,x)*O+m.rotation:m.skewX||0,Math.abs(m.skewX)>90&&Math.abs(m.skewX)<270&&(p?(m.scaleX*=-1,m.skewX+=m.rotation<=0?180:-180,m.rotation+=m.rotation<=0?180:-180):(m.scaleY*=-1,m.skewX+=m.skewX<=0?180:-180)),m.perspective=z?1/(0>z?-z:z):0,m.x=E,m.y=W,m.z=B,m.svg&&(m.x-=m.xOrigin-(m.xOrigin*k-m.yOrigin*I),m.y-=m.yOrigin-(m.yOrigin*M-m.xOrigin*x))}else if(!(Ie&&!o&&r.length&&m.x===r[4]&&m.y===r[5]&&(m.rotationX||m.rotationY)||void 0!==m.x&&"none"===K(t,"display",i))){var R=r.length>=6,U=R?r[0]:1,j=r[1]||0,H=r[2]||0,q=R?r[3]:1;m.x=r[4]||0,m.y=r[5]||0,d=Math.sqrt(U*U+j*j),h=Math.sqrt(q*q+H*H),c=U||j?Math.atan2(j,U)*O:m.rotation||0,u=H||q?Math.atan2(H,q)*O+c:m.skewX||0,Math.abs(u)>90&&Math.abs(u)<270&&(p?(d*=-1,u+=0>=c?180:-180,c+=0>=c?180:-180):(h*=-1,u+=0>=u?180:-180)),m.scaleX=d,m.scaleY=h,m.rotation=c,m.skewX=u,Ie&&(m.rotationX=m.rotationY=m.z=0,m.perspective=b,m.scaleZ=1),m.svg&&(m.x-=m.xOrigin-(m.xOrigin*U+m.yOrigin*H),m.y-=m.yOrigin-(m.xOrigin*j+m.yOrigin*q))}m.zOrigin=_;for(l in m)m[l]<f&&m[l]>-f&&(m[l]=0)}return s&&(t._gsTransform=m,m.svg&&(Se&&t.style[Me]?e.delayedCall(.001,function(){je(t.style,Me)}):!Se&&t.getAttribute("transform")&&e.delayedCall(.001,function(){t.removeAttribute("transform")}))),m},Ne=function(t){var e,i,s=this.data,n=-s.rotation*L,o=n+s.skewX*L,a=1e5,r=(Math.cos(n)*s.scaleX*a|0)/a,l=(Math.sin(n)*s.scaleX*a|0)/a,d=(Math.sin(o)*-s.scaleY*a|0)/a,h=(Math.cos(o)*s.scaleY*a|0)/a,c=this.t.style,u=this.t.currentStyle;if(u){i=l,l=-d,d=-i,e=u.filter,c.filter="";var m,p,g=this.t.offsetWidth,_=this.t.offsetHeight,b="absolute"!==u.position,v="progid:DXImageTransform.Microsoft.Matrix(M11="+r+", M12="+l+", M21="+d+", M22="+h,C=s.x+g*s.xPercent/100,S=s.y+_*s.yPercent/100;if(null!=s.ox&&(m=(s.oxp?g*s.ox*.01:s.ox)-g/2,p=(s.oyp?_*s.oy*.01:s.oy)-_/2,C+=m-(m*r+p*l),S+=p-(m*d+p*h)),b?(m=g/2,p=_/2,v+=", Dx="+(m-(m*r+p*l)+C)+", Dy="+(p-(m*d+p*h)+S)+")"):v+=", sizingMethod='auto expand')",c.filter=-1!==e.indexOf("DXImageTransform.Microsoft.Matrix(")?e.replace(F,v):v+" "+e,(0===t||1===t)&&1===r&&0===l&&0===d&&1===h&&(b&&-1===v.indexOf("Dx=0, Dy=0")||w.test(e)&&100!==parseFloat(RegExp.$1)||-1===e.indexOf(e.indexOf("Alpha"))&&c.removeAttribute("filter")),!b){var k,M,T,D=8>f?1:-1;for(m=s.ieOffsetX||0,p=s.ieOffsetY||0,s.ieOffsetX=Math.round((g-((0>r?-r:r)*g+(0>l?-l:l)*_))/2+C),s.ieOffsetY=Math.round((_-((0>h?-h:h)*_+(0>d?-d:d)*g))/2+S),ve=0;4>ve;ve++)M=ie[ve],k=u[M],i=-1!==k.indexOf("px")?parseFloat(k):X(this.t,M,parseFloat(k),k.replace(y,""))||0,T=i!==s[M]?2>ve?-s.ieOffsetX:-s.ieOffsetY:2>ve?m-s.ieOffsetX:p-s.ieOffsetY,c[M]=(s[M]=Math.round(i-T*(0===ve||2===ve?1:D)))+"px"}}},Re=R.set3DTransformRatio=R.setTransformRatio=function(t){var e,i,s,n,o,a,r,l,d,h,c,u,p,f,g,_,b,v,y,w,C,S,k,M=this.data,T=this.t.style,D=M.rotation,I=M.rotationX,x=M.rotationY,P=M.scaleX,F=M.scaleY,$=M.scaleZ,A=M.x,O=M.y,E=M.z,W=M.svg,B=M.perspective,z=M.force3D;if(!(((1!==t&&0!==t||"auto"!==z||this.tween._totalTime!==this.tween._totalDuration&&this.tween._totalTime)&&z||E||B||x||I||1!==$)&&(!Se||!W)&&Ie))return void(D||M.skewX||W?(D*=L,S=M.skewX*L,k=1e5,e=Math.cos(D)*P,n=Math.sin(D)*P,i=Math.sin(D-S)*-F,o=Math.cos(D-S)*F,S&&"simple"===M.skewType&&(b=Math.tan(S),b=Math.sqrt(1+b*b),i*=b,o*=b,M.skewY&&(e*=b,n*=b)),W&&(A+=M.xOrigin-(M.xOrigin*e+M.yOrigin*i)+M.xOffset,O+=M.yOrigin-(M.xOrigin*n+M.yOrigin*o)+M.yOffset,Se&&(M.xPercent||M.yPercent)&&(f=this.t.getBBox(),A+=.01*M.xPercent*f.width,O+=.01*M.yPercent*f.height),f=1e-6,f>A&&A>-f&&(A=0),f>O&&O>-f&&(O=0)),y=(e*k|0)/k+","+(n*k|0)/k+","+(i*k|0)/k+","+(o*k|0)/k+","+A+","+O+")",W&&Se?this.t.setAttribute("transform","matrix("+y):T[Me]=(M.xPercent||M.yPercent?"translate("+M.xPercent+"%,"+M.yPercent+"%) matrix(":"matrix(")+y):T[Me]=(M.xPercent||M.yPercent?"translate("+M.xPercent+"%,"+M.yPercent+"%) matrix(":"matrix(")+P+",0,0,"+F+","+A+","+O+")");if(m&&(f=1e-4,f>P&&P>-f&&(P=$=2e-5),f>F&&F>-f&&(F=$=2e-5),!B||M.z||M.rotationX||M.rotationY||(B=0)),D||M.skewX)D*=L,g=e=Math.cos(D),_=n=Math.sin(D),M.skewX&&(D-=M.skewX*L,g=Math.cos(D),_=Math.sin(D),"simple"===M.skewType&&(b=Math.tan(M.skewX*L),b=Math.sqrt(1+b*b),g*=b,_*=b,M.skewY&&(e*=b,n*=b))),i=-_,o=g;else{if(!(x||I||1!==$||B||W))return void(T[Me]=(M.xPercent||M.yPercent?"translate("+M.xPercent+"%,"+M.yPercent+"%) translate3d(":"translate3d(")+A+"px,"+O+"px,"+E+"px)"+(1!==P||1!==F?" scale("+P+","+F+")":""));e=o=1,i=n=0}d=1,s=a=r=l=h=c=0,u=B?-1/B:0,p=M.zOrigin,f=1e-6,w=",",C="0",D=x*L,D&&(g=Math.cos(D),_=Math.sin(D),r=-_,h=u*-_,s=e*_,a=n*_,d=g,u*=g,e*=g,n*=g),D=I*L,D&&(g=Math.cos(D),_=Math.sin(D),b=i*g+s*_,v=o*g+a*_,l=d*_,c=u*_,s=i*-_+s*g,a=o*-_+a*g,d*=g,u*=g,i=b,o=v),1!==$&&(s*=$,a*=$,d*=$,u*=$),1!==F&&(i*=F,o*=F,l*=F,c*=F),1!==P&&(e*=P,n*=P,r*=P,h*=P),(p||W)&&(p&&(A+=s*-p,O+=a*-p,E+=d*-p+p),W&&(A+=M.xOrigin-(M.xOrigin*e+M.yOrigin*i)+M.xOffset,O+=M.yOrigin-(M.xOrigin*n+M.yOrigin*o)+M.yOffset),f>A&&A>-f&&(A=C),f>O&&O>-f&&(O=C),f>E&&E>-f&&(E=0)),y=M.xPercent||M.yPercent?"translate("+M.xPercent+"%,"+M.yPercent+"%) matrix3d(":"matrix3d(",y+=(f>e&&e>-f?C:e)+w+(f>n&&n>-f?C:n)+w+(f>r&&r>-f?C:r),y+=w+(f>h&&h>-f?C:h)+w+(f>i&&i>-f?C:i)+w+(f>o&&o>-f?C:o),I||x||1!==$?(y+=w+(f>l&&l>-f?C:l)+w+(f>c&&c>-f?C:c)+w+(f>s&&s>-f?C:s),y+=w+(f>a&&a>-f?C:a)+w+(f>d&&d>-f?C:d)+w+(f>u&&u>-f?C:u)+w):y+=",0,0,0,0,1,0,",y+=A+w+O+w+E+w+(B?1+-E/B:1)+")",T[Me]=y};d=xe.prototype,d.x=d.y=d.z=d.skewX=d.skewY=d.rotation=d.rotationX=d.rotationY=d.zOrigin=d.xPercent=d.yPercent=d.xOffset=d.yOffset=0,d.scaleX=d.scaleY=d.scaleZ=1,we("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,svgOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent,smoothOrigin",{parser:function(t,e,i,s,o,r,l){if(s._lastParsedTransform===l)return o;s._lastParsedTransform=l;var d,h,c,u,m,p,f,g,_,b,v=t._gsTransform,y=t.style,w=1e-6,C=ke.length,S=l,k={},M="transformOrigin";if(l.display?(c=K(t,"display"),y.display="block",d=ze(t,n,!0,l.parseTransform),y.display=c):d=ze(t,n,!0,l.parseTransform),s._transform=d,"string"==typeof S.transform&&Me)c=z.style,c[Me]=S.transform,c.display="block",c.position="absolute",W.body.appendChild(z),h=ze(z,null,!1),d.svg&&(g=d.xOrigin,_=d.yOrigin,h.x-=d.xOffset,h.y-=d.yOffset,(S.transformOrigin||S.svgOrigin)&&(u={},Le(t,ne(S.transformOrigin),u,S.svgOrigin,S.smoothOrigin,!0),g=u.xOrigin,_=u.yOrigin,h.x-=u.xOffset-d.xOffset,h.y-=u.yOffset-d.yOffset),(g||_)&&(b=Be(z),h.x-=g-(g*b[0]+_*b[2]),h.y-=_-(g*b[1]+_*b[3]))),W.body.removeChild(z),h.perspective||(h.perspective=d.perspective),null!=S.xPercent&&(h.xPercent=ae(S.xPercent,d.xPercent)),null!=S.yPercent&&(h.yPercent=ae(S.yPercent,d.yPercent));else if("object"==typeof S){if(h={scaleX:ae(null!=S.scaleX?S.scaleX:S.scale,d.scaleX),scaleY:ae(null!=S.scaleY?S.scaleY:S.scale,d.scaleY),scaleZ:ae(S.scaleZ,d.scaleZ),x:ae(S.x,d.x),y:ae(S.y,d.y),z:ae(S.z,d.z),xPercent:ae(S.xPercent,d.xPercent),yPercent:ae(S.yPercent,d.yPercent),perspective:ae(S.transformPerspective,d.perspective)},f=S.directionalRotation,null!=f)if("object"==typeof f)for(c in f)S[c]=f[c];else S.rotation=f;"string"==typeof S.x&&-1!==S.x.indexOf("%")&&(h.x=0,h.xPercent=ae(S.x,d.xPercent)),"string"==typeof S.y&&-1!==S.y.indexOf("%")&&(h.y=0,h.yPercent=ae(S.y,d.yPercent)),h.rotation=re("rotation"in S?S.rotation:"shortRotation"in S?S.shortRotation+"_short":"rotationZ"in S?S.rotationZ:d.rotation-d.skewY,d.rotation-d.skewY,"rotation",k),Ie&&(h.rotationX=re("rotationX"in S?S.rotationX:"shortRotationX"in S?S.shortRotationX+"_short":d.rotationX||0,d.rotationX,"rotationX",k),h.rotationY=re("rotationY"in S?S.rotationY:"shortRotationY"in S?S.shortRotationY+"_short":d.rotationY||0,d.rotationY,"rotationY",k)),h.skewX=re(S.skewX,d.skewX-d.skewY),(h.skewY=re(S.skewY,d.skewY))&&(h.skewX+=h.skewY,h.rotation+=h.skewY)}for(Ie&&null!=S.force3D&&(d.force3D=S.force3D,p=!0),d.skewType=S.skewType||d.skewType||a.defaultSkewType,m=d.force3D||d.z||d.rotationX||d.rotationY||h.z||h.rotationX||h.rotationY||h.perspective,m||null==S.scale||(h.scaleZ=1);--C>-1;)i=ke[C],u=h[i]-d[i],(u>w||-w>u||null!=S[i]||null!=E[i])&&(p=!0,o=new ge(d,i,d[i],u,o),i in k&&(o.e=k[i]),o.xs0=0,o.plugin=r,s._overwriteProps.push(o.n));return u=S.transformOrigin,d.svg&&(u||S.svgOrigin)&&(g=d.xOffset,_=d.yOffset,Le(t,ne(u),h,S.svgOrigin,S.smoothOrigin),o=_e(d,"xOrigin",(v?d:h).xOrigin,h.xOrigin,o,M),o=_e(d,"yOrigin",(v?d:h).yOrigin,h.yOrigin,o,M),(g!==d.xOffset||_!==d.yOffset)&&(o=_e(d,"xOffset",v?g:d.xOffset,d.xOffset,o,M),o=_e(d,"yOffset",v?_:d.yOffset,d.yOffset,o,M)),u=Se?null:"0px 0px"),(u||Ie&&m&&d.zOrigin)&&(Me?(p=!0,i=De,u=(u||K(t,i,n,!1,"50% 50%"))+"",o=new ge(y,i,0,0,o,-1,M),o.b=y[i],o.plugin=r,Ie?(c=d.zOrigin,u=u.split(" "),d.zOrigin=(u.length>2&&(0===c||"0px"!==u[2])?parseFloat(u[2]):c)||0,o.xs0=o.e=u[0]+" "+(u[1]||"50%")+" 0px",o=new ge(d,"zOrigin",0,0,o,-1,o.n),o.b=c,o.xs0=o.e=d.zOrigin):o.xs0=o.e=u):ne(u+"",d)),p&&(s._transformType=d.svg&&Se||!m&&3!==this._transformType?2:3),o},prefix:!0}),we("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),we("borderRadius",{defaultValue:"0px",parser:function(t,e,i,o,a){e=this.format(e);var r,l,d,h,c,u,m,p,f,g,_,b,v,y,w,C,S=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],k=t.style;for(f=parseFloat(t.offsetWidth),g=parseFloat(t.offsetHeight),r=e.split(" "),l=0;l<S.length;l++)this.p.indexOf("border")&&(S[l]=G(S[l])),c=h=K(t,S[l],n,!1,"0px"),-1!==c.indexOf(" ")&&(h=c.split(" "),c=h[0],h=h[1]),u=d=r[l],m=parseFloat(c),b=c.substr((m+"").length),v="="===u.charAt(1),v?(p=parseInt(u.charAt(0)+"1",10),u=u.substr(2),p*=parseFloat(u),_=u.substr((p+"").length-(0>p?1:0))||""):(p=parseFloat(u),_=u.substr((p+"").length)),""===_&&(_=s[i]||b),_!==b&&(y=X(t,"borderLeft",m,b),w=X(t,"borderTop",m,b),"%"===_?(c=y/f*100+"%",h=w/g*100+"%"):"em"===_?(C=X(t,"borderLeft",1,"em"),c=y/C+"em",h=w/C+"em"):(c=y+"px",h=w+"px"),v&&(u=parseFloat(c)+p+_,d=parseFloat(h)+p+_)),a=be(k,S[l],c+" "+h,u+" "+d,!1,"0px",a);return a},prefix:!0,formatter:me("0px 0px 0px 0px",!1,!0)}),we("borderBottomLeftRadius,borderBottomRightRadius,borderTopLeftRadius,borderTopRightRadius",{defaultValue:"0px",parser:function(t,e,i,s,o){return be(t.style,i,this.format(K(t,i,n,!1,"0px 0px")),this.format(e),!1,"0px",o)},prefix:!0,formatter:me("0px 0px",!1,!0)}),we("backgroundPosition",{defaultValue:"0 0",parser:function(t,e,i,s,o,a){var r,l,d,h,c,u,m="background-position",p=n||Y(t,null),g=this.format((p?f?p.getPropertyValue(m+"-x")+" "+p.getPropertyValue(m+"-y"):p.getPropertyValue(m):t.currentStyle.backgroundPositionX+" "+t.currentStyle.backgroundPositionY)||"0 0"),_=this.format(e);if(-1!==g.indexOf("%")!=(-1!==_.indexOf("%"))&&_.split(",").length<2&&(u=K(t,"backgroundImage").replace(D,""),u&&"none"!==u)){for(r=g.split(" "),l=_.split(" "),N.setAttribute("src",u),d=2;--d>-1;)g=r[d],h=-1!==g.indexOf("%"),h!==(-1!==l[d].indexOf("%"))&&(c=0===d?t.offsetWidth-N.width:t.offsetHeight-N.height,r[d]=h?parseFloat(g)/100*c+"px":parseFloat(g)/c*100+"%");g=r.join(" ")}return this.parseComplex(t.style,g,_,o,a)},formatter:ne}),we("backgroundSize",{defaultValue:"0 0",formatter:ne}),we("perspective",{defaultValue:"0px",prefix:!0}),we("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),we("transformStyle",{prefix:!0}),we("backfaceVisibility",{prefix:!0}),we("userSelect",{prefix:!0}),we("margin",{parser:pe("marginTop,marginRight,marginBottom,marginLeft")}),we("padding",{parser:pe("paddingTop,paddingRight,paddingBottom,paddingLeft")}),we("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(t,e,i,s,o,a){var r,l,d;return 9>f?(l=t.currentStyle,d=8>f?" ":",",r="rect("+l.clipTop+d+l.clipRight+d+l.clipBottom+d+l.clipLeft+")",e=this.format(e).split(",").join(d)):(r=this.format(K(t,this.p,n,!1,this.dflt)),e=this.format(e)),this.parseComplex(t.style,r,e,o,a)}}),we("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),we("autoRound,strictUnits",{parser:function(t,e,i,s,n){return n}}),we("border",{defaultValue:"0px solid #000",parser:function(t,e,i,s,o,a){return this.parseComplex(t.style,this.format(K(t,"borderTopWidth",n,!1,"0px")+" "+K(t,"borderTopStyle",n,!1,"solid")+" "+K(t,"borderTopColor",n,!1,"#000")),this.format(e),o,a)},color:!0,formatter:function(t){var e=t.split(" ");return e[0]+" "+(e[1]||"solid")+" "+(t.match(ue)||["#000"])[0]}}),we("borderWidth",{parser:pe("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),we("float,cssFloat,styleFloat",{parser:function(t,e,i,s,n){var o=t.style,a="cssFloat"in o?"cssFloat":"styleFloat";return new ge(o,a,0,0,n,-1,i,!1,0,o[a],e)}});var Ue=function(t){var e,i=this.t,s=i.filter||K(this.data,"filter")||"",n=this.s+this.c*t|0;100===n&&(-1===s.indexOf("atrix(")&&-1===s.indexOf("radient(")&&-1===s.indexOf("oader(")?(i.removeAttribute("filter"),e=!K(this.data,"filter")):(i.filter=s.replace(S,""),e=!0)),e||(this.xn1&&(i.filter=s=s||"alpha(opacity="+n+")"),-1===s.indexOf("pacity")?0===n&&this.xn1||(i.filter=s+" alpha(opacity="+n+")"):i.filter=s.replace(w,"opacity="+n))};we("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(t,e,i,s,o,a){var r=parseFloat(K(t,"opacity",n,!1,"1")),l=t.style,d="autoAlpha"===i;return"string"==typeof e&&"="===e.charAt(1)&&(e=("-"===e.charAt(0)?-1:1)*parseFloat(e.substr(2))+r),d&&1===r&&"hidden"===K(t,"visibility",n)&&0!==e&&(r=0),j?o=new ge(l,"opacity",r,e-r,o):(o=new ge(l,"opacity",100*r,100*(e-r),o),o.xn1=d?1:0,l.zoom=1,o.type=2,o.b="alpha(opacity="+o.s+")",o.e="alpha(opacity="+(o.s+o.c)+")",o.data=t,o.plugin=a,o.setRatio=Ue),d&&(o=new ge(l,"visibility",0,0,o,-1,null,!1,0,0!==r?"inherit":"hidden",0===e?"hidden":"inherit"),o.xs0="inherit",s._overwriteProps.push(o.n),s._overwriteProps.push(i)),o}});var je=function(t,e){e&&(t.removeProperty?(("ms"===e.substr(0,2)||"webkit"===e.substr(0,6))&&(e="-"+e),t.removeProperty(e.replace(M,"-$1").toLowerCase())):t.removeAttribute(e))},He=function(t){if(this.t._gsClassPT=this,1===t||0===t){this.t.setAttribute("class",0===t?this.b:this.e);
for(var e=this.data,i=this.t.style;e;)e.v?i[e.p]=e.v:je(i,e.p),e=e._next;1===t&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};we("className",{parser:function(t,e,s,o,a,r,l){var d,h,c,u,m,p=t.getAttribute("class")||"",f=t.style.cssText;if(a=o._classNamePT=new ge(t,s,0,0,a,2),a.setRatio=He,a.pr=-11,i=!0,a.b=p,h=J(t,n),c=t._gsClassPT){for(u={},m=c.data;m;)u[m.p]=1,m=m._next;c.setRatio(1)}return t._gsClassPT=a,a.e="="!==e.charAt(1)?e:p.replace(new RegExp("(?:\\s|^)"+e.substr(2)+"(?![\\w-])"),"")+("+"===e.charAt(0)?" "+e.substr(2):""),t.setAttribute("class",a.e),d=te(t,h,J(t),l,u),t.setAttribute("class",p),a.data=d.firstMPT,t.style.cssText=f,a=a.xfirst=o.parse(t,d.difs,a,r)}});var qe=function(t){if((1===t||0===t)&&this.data._totalTime===this.data._totalDuration&&"isFromStart"!==this.data.data){var e,i,s,n,o,a=this.t.style,r=l.transform.parse;if("all"===this.e)a.cssText="",n=!0;else for(e=this.e.split(" ").join("").split(","),s=e.length;--s>-1;)i=e[s],l[i]&&(l[i].parse===r?n=!0:i="transformOrigin"===i?De:l[i].p),je(a,i);n&&(je(a,Me),o=this.t._gsTransform,o&&(o.svg&&(this.t.removeAttribute("data-svg-origin"),this.t.removeAttribute("transform")),delete this.t._gsTransform))}};for(we("clearProps",{parser:function(t,e,s,n,o){return o=new ge(t,s,0,0,o,2),o.setRatio=qe,o.e=e,o.pr=-10,o.data=n._tween,i=!0,o}}),d="bezier,throwProps,physicsProps,physics2D".split(","),ve=d.length;ve--;)Ce(d[ve]);d=a.prototype,d._firstPT=d._lastParsedTransform=d._transform=null,d._onInitTween=function(t,e,r){if(!t.nodeType)return!1;this._target=t,this._tween=r,this._vars=e,h=e.autoRound,i=!1,s=e.suffixMap||a.suffixMap,n=Y(t,""),o=this._overwriteProps;var d,m,f,g,_,b,v,y,w,S=t.style;if(c&&""===S.zIndex&&(d=K(t,"zIndex",n),("auto"===d||""===d)&&this._addLazySet(S,"zIndex",0)),"string"==typeof e&&(g=S.cssText,d=J(t,n),S.cssText=g+";"+e,d=te(t,d,J(t)).difs,!j&&C.test(e)&&(d.opacity=parseFloat(RegExp.$1)),e=d,S.cssText=g),this._firstPT=m=e.className?l.className.parse(t,e.className,"className",this,null,null,e):this.parse(t,e,null),this._transformType){for(w=3===this._transformType,Me?u&&(c=!0,""===S.zIndex&&(v=K(t,"zIndex",n),("auto"===v||""===v)&&this._addLazySet(S,"zIndex",0)),p&&this._addLazySet(S,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(w?"visible":"hidden"))):S.zoom=1,f=m;f&&f._next;)f=f._next;y=new ge(t,"transform",0,0,null,2),this._linkCSSP(y,null,f),y.setRatio=Me?Re:Ne,y.data=this._transform||ze(t,n,!0),y.tween=r,y.pr=-1,o.pop()}if(i){for(;m;){for(b=m._next,f=g;f&&f.pr>m.pr;)f=f._next;(m._prev=f?f._prev:_)?m._prev._next=m:g=m,(m._next=f)?f._prev=m:_=m,m=b}this._firstPT=g}return!0},d.parse=function(t,e,i,o){var a,r,d,c,u,m,p,f,g,_,b=t.style;for(a in e)m=e[a],r=l[a],r?i=r.parse(t,m,a,this,i,o,e):(u=K(t,a,n)+"",g="string"==typeof m,"color"===a||"fill"===a||"stroke"===a||-1!==a.indexOf("Color")||g&&k.test(m)?(g||(m=he(m),m=(m.length>3?"rgba(":"rgb(")+m.join(",")+")"),i=be(b,a,u,m,!0,"transparent",i,0,o)):g&&A.test(m)?i=be(b,a,u,m,!0,null,i,0,o):(d=parseFloat(u),p=d||0===d?u.substr((d+"").length):"",(""===u||"auto"===u)&&("width"===a||"height"===a?(d=se(t,a,n),p="px"):"left"===a||"top"===a?(d=Z(t,a,n),p="px"):(d="opacity"!==a?0:1,p="")),_=g&&"="===m.charAt(1),_?(c=parseInt(m.charAt(0)+"1",10),m=m.substr(2),c*=parseFloat(m),f=m.replace(y,"")):(c=parseFloat(m),f=g?m.replace(y,""):""),""===f&&(f=a in s?s[a]:p),m=c||0===c?(_?c+d:c)+f:e[a],p!==f&&""!==f&&(c||0===c)&&d&&(d=X(t,a,d,p),"%"===f?(d/=X(t,a,100,"%")/100,e.strictUnits!==!0&&(u=d+"%")):"em"===f||"rem"===f||"vw"===f||"vh"===f?d/=X(t,a,1,f):"px"!==f&&(c=X(t,a,c,f),f="px"),_&&(c||0===c)&&(m=c+d+f)),_&&(c+=d),!d&&0!==d||!c&&0!==c?void 0!==b[a]&&(m||m+""!="NaN"&&null!=m)?(i=new ge(b,a,c||d||0,0,i,-1,a,!1,0,u,m),i.xs0="none"!==m||"display"!==a&&-1===a.indexOf("Style")?m:u):q("invalid "+a+" tween value: "+e[a]):(i=new ge(b,a,d,c-d,i,0,a,h!==!1&&("px"===f||"zIndex"===a),0,u,m),i.xs0=f))),o&&i&&!i.plugin&&(i.plugin=o);return i},d.setRatio=function(t){var e,i,s,n=this._firstPT,o=1e-6;if(1!==t||this._tween._time!==this._tween._duration&&0!==this._tween._time)if(t||this._tween._time!==this._tween._duration&&0!==this._tween._time||this._tween._rawPrevTime===-1e-6)for(;n;){if(e=n.c*t+n.s,n.r?e=Math.round(e):o>e&&e>-o&&(e=0),n.type)if(1===n.type)if(s=n.l,2===s)n.t[n.p]=n.xs0+e+n.xs1+n.xn1+n.xs2;else if(3===s)n.t[n.p]=n.xs0+e+n.xs1+n.xn1+n.xs2+n.xn2+n.xs3;else if(4===s)n.t[n.p]=n.xs0+e+n.xs1+n.xn1+n.xs2+n.xn2+n.xs3+n.xn3+n.xs4;else if(5===s)n.t[n.p]=n.xs0+e+n.xs1+n.xn1+n.xs2+n.xn2+n.xs3+n.xn3+n.xs4+n.xn4+n.xs5;else{for(i=n.xs0+e+n.xs1,s=1;s<n.l;s++)i+=n["xn"+s]+n["xs"+(s+1)];n.t[n.p]=i}else-1===n.type?n.t[n.p]=n.xs0:n.setRatio&&n.setRatio(t);else n.t[n.p]=e+n.xs0;n=n._next}else for(;n;)2!==n.type?n.t[n.p]=n.b:n.setRatio(t),n=n._next;else for(;n;){if(2!==n.type)if(n.r&&-1!==n.type)if(e=Math.round(n.s+n.c),n.type){if(1===n.type){for(s=n.l,i=n.xs0+e+n.xs1,s=1;s<n.l;s++)i+=n["xn"+s]+n["xs"+(s+1)];n.t[n.p]=i}}else n.t[n.p]=e+n.xs0;else n.t[n.p]=n.e;else n.setRatio(t);n=n._next}},d._enableTransforms=function(t){this._transform=this._transform||ze(this._target,n,!0),this._transformType=this._transform.svg&&Se||!t&&3!==this._transformType?2:3};var Ve=function(){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};d._addLazySet=function(t,e,i){var s=this._firstPT=new ge(t,e,0,0,this._firstPT,2);s.e=i,s.setRatio=Ve,s.data=this},d._linkCSSP=function(t,e,i,s){return t&&(e&&(e._prev=t),t._next&&(t._next._prev=t._prev),t._prev?t._prev._next=t._next:this._firstPT===t&&(this._firstPT=t._next,s=!0),i?i._next=t:s||null!==this._firstPT||(this._firstPT=t),t._next=e,t._prev=i),t},d._kill=function(e){var i,s,n,o=e;if(e.autoAlpha||e.alpha){o={};for(s in e)o[s]=e[s];o.opacity=1,o.autoAlpha&&(o.visibility=1)}return e.className&&(i=this._classNamePT)&&(n=i.xfirst,n&&n._prev?this._linkCSSP(n._prev,i._next,n._prev._prev):n===this._firstPT&&(this._firstPT=i._next),i._next&&this._linkCSSP(i._next,i._next._next,n._prev),this._classNamePT=null),t.prototype._kill.call(this,o)};var Qe=function(t,e,i){var s,n,o,a;if(t.slice)for(n=t.length;--n>-1;)Qe(t[n],e,i);else for(s=t.childNodes,n=s.length;--n>-1;)o=s[n],a=o.type,o.style&&(e.push(J(o)),i&&i.push(o)),1!==a&&9!==a&&11!==a||!o.childNodes.length||Qe(o,e,i)};return a.cascadeTo=function(t,i,s){var n,o,a,r,l=e.to(t,i,s),d=[l],h=[],c=[],u=[],m=e._internals.reservedProps;for(t=l._targets||l.target,Qe(t,h,u),l.render(i,!0,!0),Qe(t,c),l.render(0,!0,!0),l._enabled(!0),n=u.length;--n>-1;)if(o=te(u[n],h[n],c[n]),o.firstMPT){o=o.difs;for(a in s)m[a]&&(o[a]=s[a]);r={};for(a in o)r[a]=h[n][a];d.push(e.fromTo(u[n],i,r,o))}return d},t.activate([a]),a},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(t){"use strict";var e=function(){return(_gsScope.GreenSockGlobals||_gsScope)[t]};"function"==typeof define&&define.amd?define(["TweenLite"],e):"undefined"!=typeof module&&module.exports&&(require("../TweenLite.js"),module.exports=e())}("CSSPlugin");/*!
 * VERSION: 0.8.4
 * DATE: 2016-02-16
 * UPDATES AND DOCS AT: http://greensock.com
 *
 * @license Copyright (c) 2008-2016, GreenSock. All rights reserved.
 * MorphSVGPlugin is a Club GreenSock membership benefit; You must have a valid membership to use
 * this code without violating the terms of use. Visit http://greensock.com/club/ to sign up or get more details.
 * This work is subject to the software agreement that was issued with your membership.
 *
 * @author: Jack Doyle, jack@greensock.com
 */
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";var t=Math.PI/180,e=180/Math.PI,i=/[achlmqstvz]|(-?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,s=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,n=/[achlmqstvz]/gi,o=/[\+\-]?\d*\.?\d+e[\+\-]?\d+/gi,a=_gsScope._gsDefine.globals.TweenLite,r=function(t){window.console&&console.log(t)},l=function(e,i){var s,n,o,a,r,l,d=Math.ceil(Math.abs(i)/90),h=0,c=[];for(e*=t,i*=t,s=i/d,n=4/3*Math.sin(s/2)/(1+Math.cos(s/2)),l=0;d>l;l++)o=e+l*s,a=Math.cos(o),r=Math.sin(o),c[h++]=a-n*r,c[h++]=r+n*a,o+=s,a=Math.cos(o),r=Math.sin(o),c[h++]=a+n*r,c[h++]=r-n*a,c[h++]=a,c[h++]=r;return c},d=function(i,s,n,o,a,r,d,h,c){if(i!==h||s!==c){n=Math.abs(n),o=Math.abs(o);var u=a%360*t,m=Math.cos(u),p=Math.sin(u),f=(i-h)/2,g=(s-c)/2,_=m*f+p*g,b=-p*f+m*g,v=n*n,y=o*o,w=_*_,C=b*b,S=w/v+C/y;S>1&&(n=Math.sqrt(S)*n,o=Math.sqrt(S)*o,v=n*n,y=o*o);var k=r===d?-1:1,M=(v*y-v*C-y*w)/(v*C+y*w);0>M&&(M=0);var T=k*Math.sqrt(M),D=T*(n*b/o),I=T*-(o*_/n),x=(i+h)/2,P=(s+c)/2,F=x+(m*D-p*I),$=P+(p*D+m*I),A=(_-D)/n,L=(b-I)/o,O=(-_-D)/n,E=(-b-I)/o,W=Math.sqrt(A*A+L*L),B=A;k=0>L?-1:1;var z=k*Math.acos(B/W)*e;W=Math.sqrt((A*A+L*L)*(O*O+E*E)),B=A*O+L*E,k=0>A*E-L*O?-1:1;var N=k*Math.acos(B/W)*e;!d&&N>0?N-=360:d&&0>N&&(N+=360),N%=360,z%=360;var R,U,j,H=l(z,N),q=m*n,V=p*n,Q=p*-o,G=m*o,Y=H.length-2;for(R=0;Y>R;R+=2)U=H[R],j=H[R+1],H[R]=U*q+j*Q+F,H[R+1]=U*V+j*G+$;return H[H.length-2]=h,H[H.length-1]=c,H}},h=function(t){var e,s,n,a,l,h,c,u,m,p,f,g,_,b=(t+"").replace(o,function(t){var e=+t;return 1e-4>e&&e>-1e-4?0:e}).match(i)||[],v=[],y=0,w=0,C=b.length,S=2,k=0;if(!t||!isNaN(b[0])||isNaN(b[1]))return r("ERROR: malformed path data: "+t),v;for(e=0;C>e;e++)if(_=l,isNaN(b[e])?(l=b[e].toUpperCase(),h=l!==b[e]):e--,n=+b[e+1],a=+b[e+2],h&&(n+=y,a+=w),0===e&&(u=n,m=a),"M"===l)c&&c.length<8&&(v.length-=1,S=0),y=u=n,w=m=a,c=[n,a],k+=S,S=2,v.push(c),e+=2,l="L";else if("C"===l)c||(c=[0,0]),c[S++]=n,c[S++]=a,h||(y=w=0),c[S++]=y+1*b[e+3],c[S++]=w+1*b[e+4],c[S++]=y+=1*b[e+5],c[S++]=w+=1*b[e+6],e+=6;else if("S"===l)"C"===_||"S"===_?(p=y-c[S-4],f=w-c[S-3],c[S++]=y+p,c[S++]=w+f):(c[S++]=y,c[S++]=w),c[S++]=n,c[S++]=a,h||(y=w=0),c[S++]=y+=1*b[e+3],c[S++]=w+=1*b[e+4],e+=4;else if("Q"===l)p=n-y,f=a-w,c[S++]=y+2*p/3,c[S++]=w+2*f/3,h||(y=w=0),y+=1*b[e+3],w+=1*b[e+4],p=n-y,f=a-w,c[S++]=y+2*p/3,c[S++]=w+2*f/3,c[S++]=y,c[S++]=w,e+=4;else if("T"===l)p=y-c[S-4],f=w-c[S-3],c[S++]=y+p,c[S++]=w+f,p=y+1.5*p-n,f=w+1.5*f-a,c[S++]=n+2*p/3,c[S++]=a+2*f/3,c[S++]=y=n,c[S++]=w=a,e+=2;else if("H"===l)a=w,c[S++]=y+(n-y)/3,c[S++]=w+(a-w)/3,c[S++]=y+2*(n-y)/3,c[S++]=w+2*(a-w)/3,c[S++]=y=n,c[S++]=a,e+=1;else if("V"===l)a=n,n=y,h&&(a+=w-y),c[S++]=n,c[S++]=w+(a-w)/3,c[S++]=n,c[S++]=w+2*(a-w)/3,c[S++]=n,c[S++]=w=a,e+=1;else if("L"===l||"Z"===l)"Z"===l&&(n=u,a=m,c.closed=!0),("L"===l||Math.abs(y-n)>.5||Math.abs(w-a)>.5)&&(c[S++]=y+(n-y)/3,c[S++]=w+(a-w)/3,c[S++]=y+2*(n-y)/3,c[S++]=w+2*(a-w)/3,c[S++]=n,c[S++]=a,"L"===l&&(e+=2)),y=n,w=a;else if("A"===l){for(g=d(y,w,1*b[e+1],1*b[e+2],1*b[e+3],1*b[e+4],1*b[e+5],(h?y:0)+1*b[e+6],(h?w:0)+1*b[e+7]),s=0;s<g.length;s++)c[S++]=g[s];y=c[S-2],w=c[S-1],e+=7}else r("Error: malformed path data: "+t);return v.totalPoints=k+S,v},c=function(t,e){var i,s,n,o,a,r,l,d,h,c,u,m,p,f,g=0,_=.999999,b=t.length,v=e/((b-2)/6);for(p=2;b>p;p+=6)for(g+=v;g>_;)i=t[p-2],s=t[p-1],n=t[p],o=t[p+1],a=t[p+2],r=t[p+3],l=t[p+4],d=t[p+5],f=1/(Math.floor(g)+1),h=i+(n-i)*f,u=n+(a-n)*f,h+=(u-h)*f,u+=(a+(l-a)*f-u)*f,c=s+(o-s)*f,m=o+(r-o)*f,c+=(m-c)*f,m+=(r+(d-r)*f-m)*f,t.splice(p,4,i+(n-i)*f,s+(o-s)*f,h,c,h+(u-h)*f,c+(m-c)*f,u,m,a+(l-a)*f,r+(d-r)*f),p+=6,b+=6,g--;return t},u=function(t){var e,i,s,n,o="",a=t.length,r=100;for(i=0;a>i;i++){for(n=t[i],o+="M"+n[0]+","+n[1]+" C",e=n.length,s=2;e>s;s++)o+=(n[s++]*r|0)/r+","+(n[s++]*r|0)/r+" "+(n[s++]*r|0)/r+","+(n[s++]*r|0)/r+" "+(n[s++]*r|0)/r+","+(n[s]*r|0)/r+" ";n.closed&&(o+="z")}return o},m=function(t){for(var e=[],i=t.length-1,s=0;--i>-1;)e[s++]=t[i],e[s++]=t[i+1],i--;for(i=0;s>i;i++)t[i]=e[i];t.reversed=t.reversed?!1:!0},p=function(t){var e,i=t.length,s=0,n=0;for(e=0;i>e;e++)s+=t[e++],n+=t[e];return[s/(i/2),n/(i/2)]},f=function(t){var e,i,s,n=t.length,o=t[0],a=o,r=t[1],l=r;for(s=6;n>s;s+=6)e=t[s],i=t[s+1],e>o?o=e:a>e&&(a=e),i>r?r=i:l>i&&(l=i);return t.centerX=(o+a)/2,t.centerY=(r+l)/2,t.size=(o-a)*(r-l)},g=function(t){for(var e,i,s,n,o,a=t.length,r=t[0][0],l=r,d=t[0][1],h=d;--a>-1;)for(o=t[a],e=o.length,n=6;e>n;n+=6)i=o[n],s=o[n+1],i>r?r=i:l>i&&(l=i),s>d?d=s:h>s&&(h=s);return t.centerX=(r+l)/2,t.centerY=(d+h)/2,t.size=(r-l)*(d-h)},_=function(t,e){return e.length-t.length},b=function(t,e){var i=t.size||f(t),s=e.size||f(e);return Math.abs(s-i)<(i+s)/20?e.centerX-t.centerX||e.centerY-t.centerY:s-i},v=function(t,e){var i,s,n=t.slice(0),o=t.length,a=o-2;for(e=0|e,i=0;o>i;i++)s=(i+e)%a,t[i++]=n[s],t[i]=n[s+1]},y=function(t,e,i,s,n){var o,a,r,l,d=t.length,h=0,c=d-2;for(i*=6,a=0;d>a;a+=6)o=(a+i)%c,l=t[o]-(e[a]-s),r=t[o+1]-(e[a+1]-n),h+=Math.sqrt(r*r+l*l);return h},w=function(t,e,i){var s,n,o,a=t.length,r=p(t),l=p(e),d=l[0]-r[0],h=l[1]-r[1],c=y(t,e,0,d,h),u=0;for(o=6;a>o;o+=6)n=y(t,e,o/6,d,h),c>n&&(c=n,u=o);if(i)for(s=t.slice(0),m(s),o=6;a>o;o+=6)n=y(s,e,o/6,d,h),c>n&&(c=n,u=-o);return u/6},C=function(t,e,i){for(var s,n,o,a,r,l,d=t.length,h=99999999999,c=0,u=0;--d>-1;)for(s=t[d],l=s.length,r=0;l>r;r+=6)n=s[r]-e,o=s[r+1]-i,a=Math.sqrt(n*n+o*o),h>a&&(h=a,c=s[r],u=s[r+1]);return[c,u]},S=function(t,e,i,s,n,o){var a,r,l,d,h,c=e.length,u=0,m=Math.min(t.size||f(t),e[i].size||f(e[i]))*s,p=999999999999,g=t.centerX+n,_=t.centerY+o;for(r=i;c>r&&(a=e[r].size||f(e[r]),!(m>a));r++)l=e[r].centerX-g,d=e[r].centerY-_,h=Math.sqrt(l*l+d*d),p>h&&(u=r,p=h);return h=e[u],e.splice(u,1),h},k=function(t,e,i,s){var n,o,a,l,d,h,u,p=e.length-t.length,y=p>0?e:t,k=p>0?t:e,M=0,T="complexity"===s?_:b,D="position"===s?0:"number"==typeof s?s:.8,I=k.length,x="object"==typeof i&&i.push?i.slice(0):[i],P="reverse"===x[0]||x[0]<0,F="log"===i;if(k[0]){if(y.length>1&&(t.sort(T),e.sort(T),h=y.size||g(y),h=k.size||g(k),h=y.centerX-k.centerX,u=y.centerY-k.centerY,T===b))for(I=0;I<k.length;I++)y.splice(I,0,S(k[I],y,I,D,h,u));if(p)for(0>p&&(p=-p),y[0].length>k[0].length&&c(k[0],(y[0].length-k[0].length)/6|0),I=k.length;p>M;)l=y[I].size||f(y[I]),a=C(k,y[I].centerX,y[I].centerY),l=a[0],d=a[1],k[I++]=[l,d,l,d,l,d,l,d],k.totalPoints+=8,M++;for(I=0;I<t.length;I++)n=e[I],o=t[I],p=n.length-o.length,0>p?c(n,-p/6|0):p>0&&c(o,p/6|0),P&&!o.reversed&&m(o),i=x[I]||0===x[I]?x[I]:"auto",i&&(o.closed||Math.abs(o[0]-o[o.length-2])<.5&&Math.abs(o[1]-o[o.length-1])<.5?"auto"===i||"log"===i?(x[I]=i=w(o,n,0===I),0>i&&(P=!0,m(o),i=-i),v(o,6*i)):"reverse"!==i&&(I&&0>i&&m(o),v(o,6*(0>i?-i:i))):!P&&("auto"===i&&Math.abs(n[0]-o[0])+Math.abs(n[1]-o[1])+Math.abs(n[n.length-2]-o[o.length-2])+Math.abs(n[n.length-1]-o[o.length-1])>Math.abs(n[0]-o[o.length-2])+Math.abs(n[1]-o[o.length-1])+Math.abs(n[n.length-2]-o[0])+Math.abs(n[n.length-1]-o[1])||i%2)?(m(o),x[I]=-1,P=!0):"auto"===i?x[I]=0:"reverse"===i&&(x[I]=-1),o.closed!==n.closed&&(o.closed=n.closed=!1));return F&&r("shapeIndex:["+x.join(",")+"]"),x}},M=function(t,e,i,s){var n=h(t[0]),o=h(t[1]);k(n,o,e||0===e?e:"auto",i)&&(t[0]=u(n),t[1]=u(o),("log"===s||s===!0)&&r('precompile:["'+t[0]+'","'+t[1]+'"]'))},T=function(t,e,i){return e||i||t||0===t?function(s){M(s,t,e,i)}:M},D=function(t,e){if(!e)return t;var i,n,o,a=t.match(s)||[],r=a.length,l="";for("reverse"===e?(n=r-1,i=-2):(n=(2*(parseInt(e,10)||0)+1+100*r)%r,i=2),o=0;r>o;o+=2)l+=a[n-1]+","+a[n]+" ",n=(n+i)%r;return l},I=function(t,e){var i,s,n,o,a,r,l,d=0,h=parseFloat(t[0]),c=parseFloat(t[1]),u=h+","+c+" ",m=.999999;for(n=t.length,i=.5*e/(.5*n-1),s=0;n-2>s;s+=2){if(d+=i,r=parseFloat(t[s+2]),l=parseFloat(t[s+3]),d>m)for(a=1/(Math.floor(d)+1),o=1;d>m;)u+=(h+(r-h)*a*o).toFixed(2)+","+(c+(l-c)*a*o).toFixed(2)+" ",d--,o++;u+=r+","+l+" ",h=r,c=l}return u},x=function(t){var e=t[0].match(s)||[],i=t[1].match(s)||[],n=i.length-e.length;n>0?t[0]=I(e,n):t[1]=I(i,-n)},P=function(t){return isNaN(t)?x:function(e){x(e),e[1]=D(e[1],parseInt(t,10))}},F=function(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg","path"),s=Array.prototype.slice.call(t.attributes),n=s.length;for(e=","+e+",";--n>-1;)-1===e.indexOf(","+s[n].nodeName+",")&&i.setAttributeNS(null,s[n].nodeName,s[n].nodeValue);return i},$=function(t,e){var i,n,o,a,r,l,d,h,c,u,m,p,f,g,_,b,v,y,w,C,S,k=t.tagName.toLowerCase(),M=.552284749831;return"path"!==k&&t.getBBox?(l=F(t,"x,y,width,height,cx,cy,rx,ry,r,x1,x2,y1,y2,points"),"rect"===k?(a=+t.getAttribute("rx")||0,r=+t.getAttribute("ry")||0,n=+t.getAttribute("x")||0,o=+t.getAttribute("y")||0,u=(+t.getAttribute("width")||0)-2*a,m=(+t.getAttribute("height")||0)-2*r,a||r?(p=n+a*(1-M),f=n+a,g=f+u,_=g+a*M,b=g+a,v=o+r*(1-M),y=o+r,w=y+m,C=w+r*M,S=w+r,i="M"+b+","+y+" V"+w+" C"+[b,C,_,S,g,S,g-(g-f)/3,S,f+(g-f)/3,S,f,S,p,S,n,C,n,w,n,w-(w-y)/3,n,y+(w-y)/3,n,y,n,v,p,o,f,o,f+(g-f)/3,o,g-(g-f)/3,o,g,o,_,o,b,v,b,y].join(",")+"z"):i="M"+(n+u)+","+o+" v"+m+" h"+-u+" v"+-m+" h"+u+"z"):"circle"===k||"ellipse"===k?("circle"===k?(a=r=+t.getAttribute("r")||0,h=a*M):(a=+t.getAttribute("rx")||0,r=+t.getAttribute("ry")||0,h=r*M),n=+t.getAttribute("cx")||0,o=+t.getAttribute("cy")||0,d=a*M,i="M"+(n+a)+","+o+" C"+[n+a,o+h,n+d,o+r,n,o+r,n-d,o+r,n-a,o+h,n-a,o,n-a,o-h,n-d,o-r,n,o-r,n+d,o-r,n+a,o-h,n+a,o].join(",")+"z"):"line"===k?i="M"+t.getAttribute("x1")+","+t.getAttribute("y1")+" L"+t.getAttribute("x2")+","+t.getAttribute("y2"):("polyline"===k||"polygon"===k)&&(c=(t.getAttribute("points")+"").match(s)||[],n=c.shift(),o=c.shift(),i="M"+n+","+o+" L"+c.join(","),"polygon"===k&&(i+=","+n+","+o+"z")),l.setAttribute("d",i),e&&t.parentNode&&(t.parentNode.insertBefore(l,t),t.parentNode.removeChild(t)),l):t},A=function(t,e,i){var n,o,l="string"==typeof t;return(!l||(t.match(s)||[]).length<3)&&(n=l?a.selector(t):t&&t[0]?t:[t],n&&n[0]?(n=n[0],o=n.nodeName.toUpperCase(),e&&"PATH"!==o&&(n=$(n,!1),o="PATH"),t=n.getAttribute("PATH"===o?"d":"points")||"",n===i&&(t=n.getAttributeNS(null,"data-original")||t)):(r("WARNING: invalid morph to: "+t),t=!1)),t},L="Use MorphSVGPlugin.convertToPath(elementOrSelectorText) to convert to a path before morphing.",O=_gsScope._gsDefine.plugin({propName:"morphSVG",API:2,global:!0,version:"0.8.4",init:function(t,e){var i,s,o,a,l;return"function"!=typeof t.setAttribute?!1:(i=t.nodeName.toUpperCase(),l="POLYLINE"===i||"POLYGON"===i,"PATH"===i||l?(s="PATH"===i?"d":"points",("string"==typeof e||e.getBBox||e[0])&&(e={shape:e}),a=A(e.shape||e.d||e.points||"","d"===s,t),l&&n.test(a)?(r("WARNING: a <"+i+"> cannot accept path data. "+L),!1):(a&&(this._target=t,t.getAttributeNS(null,"data-original")||t.setAttributeNS(null,"data-original",t.getAttribute(s)),o=this._addTween(t,"setAttribute",t.getAttribute(s)+"",a+"","morphSVG",!1,s,"object"==typeof e.precompile?function(t){t[0]=e.precompile[0],t[1]=e.precompile[1]}:"d"===s?T(e.shapeIndex,e.map||O.defaultMap,e.precompile):P(e.shapeIndex)),o&&(this._overwriteProps.push("morphSVG"),o.end=a,o.endProp=s)),!0)):(r("WARNING: cannot morph a <"+i+"> SVG element. "+L),!1))},set:function(t){var e;if(this._super.setRatio.call(this,t),1===t)for(e=this._firstPT;e;)e.end&&this._target.setAttribute(e.endProp,e.end),e=e._next}});O.pathFilter=M,O.pointsFilter=x,O.subdivideRawBezier=c,O.defaultMap="size",O.pathDataToRawBezier=function(t){return h(A(t,!0))},O.equalizeSegmentQuantity=k,O.convertToPath=function(t,e){"string"==typeof t&&(t=a.selector(t));for(var i=t&&0!==t.length?t.length&&t[0]&&t[0].nodeType?Array.prototype.slice.call(t,0):[t]:[],s=i.length;--s>-1;)i[s]=$(i[s],e!==!1);return i},O.pathDataToBezier=function(t,e){var i,s,n,o,r,l,d,c,u=h(A(t,!0))[0]||[],m=0;if(e=e||{},c=e.align||e.relative,o=e.matrix||[1,0,0,1,0,0],r=e.offsetX||0,l=e.offsetY||0,"relative"===c||c===!0?(r-=u[0]*o[0]+u[1]*o[2],l-=u[0]*o[1]+u[1]*o[3],m="+="):(r+=o[4],l+=o[5],c&&(c="string"==typeof c?a.selector(c):c&&c[0]?c:[c],c&&c[0]&&(d=c[0].getBBox()||{x:0,y:0},r-=d.x,l-=d.y))),i=[],n=u.length,o)for(s=0;n>s;s+=2)i.push({x:m+(u[s]*o[0]+u[s+1]*o[2]+r),y:m+(u[s]*o[1]+u[s+1]*o[3]+l)});else for(s=0;n>s;s+=2)i.push({x:m+(u[s]+r),y:m+(u[s+1]+l)});return i}}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()();var Mimi=Mimi||{SIZE_MAP:{l:"master",b:"master",m:"small",s:"small",t:"tiny",a:"tiny"},getParameterByName:function(t,e){var i=new RegExp("[?&]"+t+"=([^&]*)").exec(e||window.location.search);return i&&decodeURIComponent(i[1].replace(/\+/g," "))},fallbackImage:function(t){var e,i,s;t.src.indexOf("thumbs.php")>0?(e=Mimi.getParameterByName("size",t.src),s="https://d2vnkn0bfhsarv.cloudfront.net/assets/promotion_thumb_small.svg".replace("small.svg",Mimi.SIZE_MAP[e]+".svg")):(i=t.src.split("/"),e=i[i.length-1],s="https://d2vnkn0bfhsarv.cloudfront.net/assets/promotion_thumb_small.svg".replace("small.svg",e+".svg")),t.src=s,t.onerror=null},removeLoader:function(t){t.parentNode.removeChild(t.parentNode.querySelectorAll(".loader")[0]),t.onload=null}};marked.setOptions({pedantic:!1,sanitize:!0,cursor:new RegExp("^\n*.*(\u1234)")}),window.debug=function(){window.debug.index||(window.debug.index=0);var t=_.toArray(arguments);t.unshift(++window.debug.index+" "),window.debug.name&&t.unshift(window.debug.name),window.console&&"function"==typeof window.console.log?window.console.log.apply?window.console.log.apply(window.console,t):Function.prototype.apply.call(window.console.log,window.console,t):(window.debug.data||(window.debug.data=[]),window.debug.data.push(t))},window.debug.reset=function(t){window.debug.name=t||"",window.debug.index=0},String.prototype.toQueryParams=function(t){var e=this.trim().match(/([^?#]*)(#.*)?$/);return e?_.inject(e[1].split(t||"&"),function(t,e){if((e=e.split("="))[0]){var i=decodeURIComponent(e.shift()),s=e.length>1?e.join("="):e[0];void 0!==s&&(s=decodeURIComponent(s)),i in t?(_.isArray(t[i])||(t[i]=[t[i]]),t[i].push(s)):t[i]=s}return t},{}):{}},String.prototype.startsWith=function(t){return 0===this.lastIndexOf(t,0)},String.prototype.endsWith=function(t){var e=this.length-t.length;return e>=0&&this.indexOf(t,e)===e},String.prototype.pascalize=function(){var t=this.camelize();return t.substr(0,1).toUpperCase()+t.substr(1)},String.prototype.humanize=function(){var t=this.underscore().split("_").join(" ");return t.substr(0,1).toUpperCase()+t.substr(1)},String.prototype.ljust=function(t,e){var i=this;for(e||(e=" ");i.length<t;)i=e+i;return i},String.RGB_REGEXP=/(\d{1,3})\, ?(\d{1,3})\, ?(\d{1,3})/,String.prototype.toHtmlColor=function(){var t=_.contains(["transparent","rgba(0,0,0,0)"],this.replace(/\s/g,""));if(t)return"transparent";if(this.startsWith("#"))return this;if(this.startsWith("rgb")){var e=String.RGB_REGEXP.exec(this);return("#"+parseInt(e[1],10).toString(16).ljust(2,"0")+parseInt(e[2],10).toString(16).ljust(2,"0")+parseInt(e[3],10).toString(16).ljust(2,"0")).toUpperCase()}},String.prototype.depref=function(t){return this.substr(t.length)},String.prototype.lhash=function(){return this.split("#").last()},String.prototype.stripHTML=function(){return this.stripScripts().stripTags().unescapeHTML().escapeHTML()},String.prototype.unescapeHTML=function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},String.prototype.px=function(){return""},String.prototype.parseInt=function(){return parseInt(this.replace(/,/g,""),10)},String.HAS_EMAIL_REGEXP=/[^\s<>]+@[^\s<>]+\.[^\s<>]+/,String.IS_EMAIL_REGEXP=/^[^\s<>]+@[^\s<>]+\.[^\s<>]+$/,String.prototype.hasEmail=function(){return String.HAS_EMAIL_REGEXP.test(this)},String.prototype.isEmail=function(){return String.IS_EMAIL_REGEXP.test(this)},String.prototype.getEmailAddress=function(){if(this.isEmail())return this;var t=this.split("<");return t.length>1?_.first(_.last(t).split(">")).trim():""},String.prototype.isUrl=function(){return Link.isValid(this)},String.prototype.getEmailName=function(){if(this.isEmail())return"";var t=this.split("<");return t.pop(),t.join("").trim().stripHTML()},String.prototype.truncate=function(t,e){return t=t||30,e=_.isUndefined(e)?"...":e,this.length>t?this.slice(0,t-e.length)+e:String(this)},String.prototype.underscore=function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()},String.prototype.dasherize=function(){return this.replace(/_/g,"-")},String.prototype.camelize=function(){return this.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},String.prototype.stripScripts=function(){return this.replace(new RegExp("<script[^>]*>([\\S\\s]*?)</script>","img"),"")},String.prototype.stripTags=function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},String.prototype.times=function(t){return 1>t?"":new Array(t+1).join(this)},String.prototype.blank=function(){return/^\s*$/.test(this)},String.prototype.makeElement=function(){var t=document.createElement("div");return t.innerHTML=this,t.firstChild},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),Number.prototype.px=function(t){return t?Math.floor(this)+"px":Math.max(Math.floor(this),0)+"px"},Number.prototype.percent=function(){return Math.max(100*this,0)+"%"},Number.prototype.formatThousands=function(t){var e=I18n.t("number.format.delimiter"),i=I18n.t("number.format.separator");t||(t=0);var s=Math.abs(this);try{var n=0>this?"-":"",o=(s.toFixed(t)+"").split(".")[0].split("").reverse().join("").match(/\d{3}|\d+$/g).join(e).split("").reverse().join(""),a=t>0?i+s.toFixed(t).toString().split(".")[1]:"";return n+o+a}catch(r){return this}},Number.prototype.centsToDollars=function(){return this/100},Number.prototype.leadingZero=function(){return 10>this?"0"+this:this.toString()},Number.prototype.toPaddedString=function(t,e){var i=this.toString(e||10);return"0".times(t-i.length)+i},Function.prototype.throttle=function(t){var e=new Date,i=this;return function(){window.debug(new Date-e),new Date-e>t&&(i.apply(this,arguments),e=new Date)}},Function.prototype.argumentNames=function(){var t=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1!=t.length||t[0]?t:[]},function(){Mimi.date={};var t=I18n.t("date.month_names").slice();t.shift();var e=I18n.t("date.day_names"),i=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],s=I18n.t("js.date_util.year_easter_egg");_.extend(Mimi.date,{getYearEasterEgg:function(t){var e=s["year_"+t.toString()];return e?e:""},ordinalize:function(t){return i[parseInt(t)-1]},getMonthByNum:function(e){return t[e]},getNumOfMonth:function(e){return t.indexOf(e)},getCurrentMonth:function(){return t[(new Date).getMonth()]},getCurrentYear:function(){return(new Date).getFullYear()},getCurrentDate:function(){return(new Date).getDate()},getCurrentDayAsWord:function(){return e[this.getCurrentDay()]},getCurrentDay:function(){return(new Date).getDay()},getTodayAtMidnight:function(){var t=new Date;return t.setHours(0,0,0,0),t},getYesterdayAtMidnight:function(){var t=this.getTodayAtMidnight();return t.setDate(t.getDate()-1),t},getFollowingMonths:function(t){for(var e=(new Date).getMonth(),i=[],s=e;e+t>s;s++)i.push(this.getMonthByNum(s>=12?s-12:s));return i},getNumDaysPerMonth:function(t){var e=this.getNumOfMonth(t);return this.daysInMonth(e+1,(new Date).getFullYear())},daysInMonth:function(t,e){return new Date(e,t,0).getDate()},getNumWeeksInMonth:function(t,e){var i=new Date(e,t,1),s=new Date(e,t+1,0),n=i.getDay()+s.getDate();return Math.ceil(n/7)},getNextMonth:function(e){return"string"==typeof e&&(e=this.getNumOfMonth(e)),e+1 in t?t[e+1]:t[0]},getPrevMonth:function(e){return"string"==typeof e&&(e=this.getNumOfMonth(e)),e-1 in t?t[e-1]:t[11]},toJSON:function(t){return t.getFullYear()+"-"+(t.getMonth()+1).leadingZero()+"-"+t.getDate().leadingZero()+"T"+t.getHours().leadingZero()+":"+t.getMinutes().leadingZero()+":"+t.getSeconds().leadingZero()+".000"}})}(),function(){function t(t,e){for(var i=t.length,s=e.length;s--;)t[i+s]=e[s];return t}Function.prototype.wrap=function(e){var i=this;return function(){var s=t([_.bind(i,this)],arguments);return e.apply(this,s)}}}();var Class=function(){function t(){}function e(){function e(){this.initialize.apply(this,arguments)}var i=null,s=_.toArray(arguments);_.isFunction(s[0])&&(i=s.shift()),_.extend(e,Class.Methods),e.superclass=i,e.subclasses=[],i&&(t.prototype=i.prototype,e.prototype=new t,i.subclasses.push(e));for(var n=0,o=s.length;o>n;n++)e.addMethods(s[n]);return e.prototype.initialize||(e.prototype.initialize=function(){}),e.prototype.constructor=e,e}function i(t){var e=this.superclass&&this.superclass.prototype,i=_.keys(t);s&&(t.toString!=Object.prototype.toString&&i.push("toString"),t.valueOf!=Object.prototype.valueOf&&i.push("valueOf"));for(var n=0,o=i.length;o>n;n++){var a=i[n],r=t[a];if(e&&_.isFunction(r)&&"$super"==r.argumentNames()[0]){var l=r;r=function(t){return function(){return e[t].apply(this,arguments)}}(a).wrap(l),r.valueOf=_.bind(l.valueOf,l),r.toString=_.bind(l.toString,l)}this.prototype[a]=r}return this}var s=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}();return{create:e,Methods:{addMethods:i}}}();Class.Methods.include=function(){return _.each(_.toArray(arguments),function(t){this.addMethods(t)},this),this},Class.Methods.singleton=function(){var t=null,e={},i=Class.create(this,{initialize:function($super){if(1===arguments.length&&t)throw"new called on a Singleton. Use `get` method instead.";t=this;var e=[].slice.call(arguments,1);$super.apply(null,e)}});return i.get=function(s){return s?e[s]||(e[s]=new i(s)):t||new i},_.each(_.toArray(arguments),function(t){i[t]=function(){var e=i.get();return e[t].apply(e,_.toArray(arguments))}}),i};var Color={htmlColorToRgb:function(t){if("transparent"==t)return{r:255,g:255,b:255};if(/^#?([a-fA-F0-9]{3}|[a-fA-F0-9]{6})$/.test(t))return Color.hexColorToRgb(t);if(t.startsWith("rgb"))return Color.rgbColorToRgb(t);throw"Unrecognized color format for "+t},rgbColorToRgb:function(t){var e=_.map(_.first(_.last(t.split("(")).split(")")).split(","),function(t){return parseInt(t.trim(),10)});return e.r=e[0],e.g=e[1],e.b=e[2],e},hexColorToRgb:function(t){return _.isString(t)?(t=t.replace("#",""),6==t.length?{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}:3==t.length?{r:parseInt(t.substring(0,1)+t.substring(0,1),16),g:parseInt(t.substring(1,2)+t.substring(1,2),16),b:parseInt(t.substring(2,3)+t.substring(2,3),16)}:void 0):t},rgbBrightness:function(t){return Math.sqrt(t.r*t.r*.241+t.g*t.g*.691+t.b*t.b*.068)},from:function(t,e){e||(e="0");var i=_.select(t.split(""),function(t){return t>="0"&&"9">=t||t>="a"&&"f">=t||t>="A"&&"F">=t}).join("");switch(i.length){case 0:i=e.times(6);break;case 1:i=i.times(6);break;case 2:i=i.charAt(0).times(3)+i.charAt(1).times(3);break;case 3:i=i.charAt(0).times(2)+i.charAt(1).times(2)+i.charAt(2).times(2);break;case 4:i+=i.substr(0,2);break;case 5:i+=e;break;case 6:i=i;break;default:i=i.substr(0,6)}return"#"+i.toUpperCase()}};!function(t){document.getViewport=function(){var e=t(window).width(),i=t(window).height(),s=t(window).scrollLeft(),n=t(window).scrollTop();return{top:n,left:s,bottom:n+i,right:s+e,width:e,height:i,bodyWidth:document.body.clientWidth,bodyHeight:document.body.clientHeight}}}(jQuery);var State={set:function(t,e,i){i=void 0==i?!0:i;var s=State.getHash();return _.isString(t)?s[t]=e:_.each(t,function(t,e){s[e]=t}),State.setHash(s,i),State},get:function(t,e){var i=State.getHash()[t];return""===i&&(i=null),i||e},del:function(t,e){e=void 0==e?!0:e;var i=State.getHash();delete i[t],this.setHash(i,e)},setHash:function(t,e){e=void 0==e?!0:e;var i=jQuery.param(t).replace("%2C",",");State.supportsHistory?(i.length>0&&(i="?"+i),e&&history.pushState(t,document.title,location.pathname+i)):location.hash=i},getHash:function(){var t,e=this.getParamsInHash(),i=this.getParamsInSearch(),s="selected"in e||"selected"in i;s&&(t=this.getCombinedValuesForProp("selected"));var n=_.extend(this.getParamsInHash(),this.getParamsInSearch());return s&&(n.selected=t.join(",")),n},getParamsInHash:function(){return _.last(location.hash.split("#")).toQueryParams()},getParamsInSearch:function(){return _.last(location.search.split("?")).toQueryParams()},getCombinedValuesForProp:function(t){var e,i=this.getParamsInHash(),s=this.getParamsInSearch(),n=[],o=[];for(e in i)e===t&&(n=i[e].split(","));for(e in s)e===t&&(o=s[e].split(","));return _.uniq(n.concat(o))},setCookie:function(t,e,i){var s;if(i){var n=new Date;n.setTime(n.getTime()+864e5),s="; expires="+n.toGMTString()}else s="";document.cookie=t+"="+e+s+"; path=/"},getCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),s=0;s<i.length;s++){for(var n=i[s];" "==n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e))return n.substring(e.length,n.length)}return null},deleteCookie:function(t){this.setCookie(t,"",-1)},supportsHistory:!(!window.history||!history.pushState)},Template=Template||{};Template.from=function(t){var e=jQuery("#"+t);if(e[0]){var i=e.html().replace(/%23%7B(.*)%7D/g,"#{$1}");i.indexOf("#{recent_signup?}")>-1&&(i=i.replace("#{recent_signup?}",'#{obj["recent_signup?"]}'));try{return _.template(i)}catch(s){return debug("ERROR: while creating template",t),""}}else debug("WARNING: Missing template for "+t)},function(t){var e=Class.create(function(){function e(t){var e,i,s,n,o,a=0,r=0;return"number"==typeof t.selectionStart&&"number"==typeof t.selectionEnd?(a=t.selectionStart,r=t.selectionEnd):(t.focus(),i=document.selection.createRange(),i&&(n=t.value.length,e=t.value.replace(/\r\n/g,"\n"),s=t.createTextRange(),s.moveToBookmark(i.getBookmark()),o=t.createTextRange(),o.collapse(!1),s.compareEndPoints("StartToEnd",o)>-1?a=r=n:(a=-s.moveStart("character",-n),a+=e.slice(0,a).split("\n").length-1,s.compareEndPoints("EndToEnd",o)>-1?r=n:(r=-s.moveEnd("character",-n),r+=e.slice(0,r).split("\n").length-1)))),{start:a,end:r}}var i;return i=document.selection?function(t,e){var i=this.element.createTextRange();e-=t+this.getValue().slice(t+1,e).split("\n").length-1,t-=this.getValue().substring(0,t).split("\n").length-1,i.move("character",t),i.moveEnd("character",e),i.select()}:function(t,e){this.element.setSelectionRange(t,e),this.element.focus()},{initialize:function(e){this.element=t(e)[0],this.getDelimiters(),this.getSelection(),this.stripSelection(),this.lines=this.selection.split("\n"),this.length=this.size()},caretPositionModifier:0,map:function(t,e){return _.map(this.lines,t,e)},size:function(){return this.selection.length},isEmpty:function(){return!this.length},hasNewlineBefore:function(){var t=this.getValue().substring(0,this.start);return _.blank(t)||/\n\s*$/.test(t)},hasNewlineAfter:function(){var t=this.getValue().substring(this.end);return _.blank(t)||/^\s*\n/.test(t)},makeBlock:function(){var t=this.replacement;return this.hasNewlineBefore()&&(t="\n"+t),this.hasNewlineAfter()&&(t+="\n"),t!=this.replacement&&this.set(t),this},include:function(t){return this.selection.indexOf(t)>-1},getDelimiters:function(){var t=e(this.element);this.start=t.start,this.end=t.end,_.isUndefined(this.start)&&(this.start=this.end=this.getValue().length)},getSelection:function(){return this.selection=this.getValue().substring(this.start,this.end)},stripSelection:function(){var t,e=this.selection,i=e.match(/(\s+)$/);return t=i&&i[1]?i[1].length:0,this.end-=t,e=e.substring(0,e.length-t),i=e.match(/^(\s+)/),t=i&&i[1]?i[1].length:0,this.start+=t,this.selection=e.substring(t)},get:function(){return this.selection},set:function(t){this.replacement=t;var e=this.getValue();return this.setValue(e.substring(0,this.start)+t+e.substring(this.end)),this.setCaret()},setCaret:function(){var t=this.isEmpty()?this.start+this.caretPositionModifier:this.start+this.replacement.length+1;return this.setSelectionRange(t,t),this},setSelection:function(t){if(-1===this.replacement.indexOf(t))return this.setCaret();var e=this.replacement.indexOf(t),i=this.start+e,s=this.start+e+t.length;if(document.selection){var n=this.getValue().substring(0,this.start).replace(/[^\n]/g,"").length,o=this.replacement.substring(e,e+t.length+1).replace(/[^\n]/g,"").length,a="\n"===this.replacement.charAt(0===e?0:e-1);a&&n++,i+=n,s+=n+o}return this.setSelectionRange(i,s),this},setSelectionRange:i,replace:function(t){return this.getDelimiters(),this.set(t).getSelection(),this},setValue:function(t){return this.element.value=t,this},getValue:function(){return this.element.value},toString:function(){return this.selection},wrap:function(t,e){return t=null==t?"":String(t),e=null==e?"":String(e),this.caretPositionModifier=t.length,this.set(t+this.selection+e),this},wrapEach:function(t,e){return t=null==t?"":String(t),e=null==e?"":String(e),this.caretPositionModifier=t.length,this.set(this.map(function(i){return""===i.trim()?i:t+i+e}).join("\n")),this},fullLines:function(){var t=this.getValue(),e=t.lastIndexOf("\n",this.start)+1,i=t.indexOf("\n",this.end);return 0>i&&(i=t.length),t.substring(e,i).split("\n")},nextLine:function(){var t=this.getValue(),e=t.indexOf("\n",this.end);if(0>e)return"";var i=t.indexOf("\n",e+1);return 0>i&&(i=t.length),t.substring(e+1,i)},allParasSurroundedWithItalic:function(){function t(t){return/^\s*_[^_]/.test(t)&&/[^_]_\s*$/.test(t)||/^\s*\*[^*]/.test(t)&&/[^*]\*\s*$/.test(t)}var e=this.selection.split("\n\n");return _.all(e,t)},allParasSurroundedWithBold:function(){function t(t){return/^\s*__/.test(t)&&/__\s*$/.test(t)||/^\s*\*\*/.test(t)&&/\*\*\s*$/.test(t)}var e=this.selection.split("\n\n");return _.all(e,t)},allParasSurroundedWithCenter:function(){function t(t){return/^\s*->/.test(t)&&/<-\s*$/.test(t)}var e=this.selection.split("\n\n");return _.all(e,t)}}}());window.Selection=e}(jQuery),Array.prototype.difference=function(t){return _.without.apply(this,t)},Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var i;if(null==this)throw new TypeError('"this" is null or not defined');var s=Object(this),n=s.length>>>0;if(0===n)return-1;var o=+e||0;if(1/0===Math.abs(o)&&(o=0),o>=n)return-1;for(i=Math.max(o>=0?o:n-Math.abs(o),0);n>i;){if(i in s&&s[i]===t)return i;i++}return-1}),function(t){window.Link={VALID_URL_HOSTNAMES:["localhost"],VALID_URL_PROTOCOLS:"http https ftp".split(" "),VALID_SPECIAL_PROTOCOLS:"mailto callto skype viber whatsapp telegram tel aim #".split(" "),MAIL_TO_PARAMS_REGEXP:/\?.+$/,PLACEHOLDER_REGEXP:/\{[^}]+\}/,PROTOCOL_REGEXP:/^([^:]+):/,IS_URL_REGEXP:/^([\da-z\u0430-\u044f\.-]+)\.([\da-z\u0430-\u044f\.-]{2,})$/,IS_IP_REGEXP:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,IS_TEL_REGEXP:/^\+?[\d-]+$/,IS_VIBER_REGEXP:/^\+?[\d-]*$/,IS_SKYPE_REGEXP:/^\w*/,URL_MACROS:"social_links forward_link mimi_link tracking_beacon forward peek_image opt_out pinterest_share linked_in_share confirmation_link subscribe unsubscribe facebook_like web_link plusone_share twitter_share manage_subscription".split(" "),getFullUrl:function(t){return t?(t=t.trim(),t.startsWith(window.location.toString())&&(t=t.replace(window.location.toString(),"")),Link.isValidMacro(t)?t:Link.hasValidProtocol(t)?t:(t.indexOf("@")>-1?"mailto:":"http://")+t):""},hasValidProtocol:function(t){return!!_.detect(Link.validProtocolsWithPunctuation(),function(e){return _.startsWith(window.unescape(t),e)})},isValidMacro:function(t){return!!_.detect(Link.URL_MACROS,function(e){return t=="[["+e+"]]"})},isValidEmail:function(t){return!_.blank(t)&&t.indexOf("@")>-1&&t.indexOf(".")>-1},isValidHttp:function(t){return!_.blank(t)&&t.indexOf(".")>-1&&_.startsWith(t,"http")&&!(t.indexOf(" ")>-1)&&!(t.indexOf(":\\")>-1)},isValid:function(t,e){e=e||{};var i=e.validProtocols;if(_.blank(t))return!1;if(Link.isValidMacro(t))return!0;var s=document.createElement("a");s.href=t.replace(Link.PLACEHOLDER_REGEXP,function(){return"example.com"});var n=t.match(Link.PROTOCOL_REGEXP),o=n?n[1]:null,a=s.hostname;if(_.blank(o)||!_.contains(i||Link.validProtocols(),o))return("http://"+t).isUrl();if(_.contains(Link.VALID_URL_HOSTNAMES,a))return!0;if(_.contains(i||Link.VALID_SPECIAL_PROTOCOLS,o)){var r=t.replace(new RegExp("^"+o+":"),"");switch(o){case"mailto":return r.replace(Link.MAIL_TO_PARAMS_REGEXP).isEmail();case"tel":return Link.IS_TEL_REGEXP.test(r);case"viber":return Link.IS_VIBER_REGEXP.test(r);case"skype":return Link.IS_SKYPE_REGEXP.test(r)}return!0}return Link.IS_IP_REGEXP.test(a)?!0:Link.IS_URL_REGEXP.test(a)},withoutParam:function(e,i){e=e||"";
var s=e.trim().toQueryParams(),n=s[i];if(n){var o=_.first(e.split("?")).trim();delete s[i],_.keys(s).length>0&&(o+="?"+t.param(s));var a=e.split("#");return a.length>1&&a[1].trim().length>0&&(o+="#"+a[1].trim()),{url:o,param:n}}return{url:e.trim(),param:null}},addParam:function(e,i,s){var n="",o=o=e.indexOf("?")>-1?e.trim().toQueryParams():{},a=_.first(e.split("?")).trim();if(a.indexOf("#")>-1){var r=a.split("#");a=r[0].trim(),n=r[1].trim()}return o[i]=s,a+="?"+t.param(o),n.length>0&&(a+="#"+n),a},validProtocols:function(){return Link.VALID_URL_PROTOCOLS.concat(Link.VALID_SPECIAL_PROTOCOLS)},validProtocolsWithPunctuation:function(){var e=[];return t.each(Link.VALID_URL_PROTOCOLS,function(t,i){e.push(i+"://")}),t.each(Link.VALID_SPECIAL_PROTOCOLS,function(t,i){e.push("#"==i?i:i+":")}),e}}}(jQuery),window.MadDown=function(){function t(t){c=p.makeHtml(o(s(i(e(t.replace(/\r\n?/g,"\n"))))));var m=document.createDocumentFragment();return u=document.createElement("div"),m.appendChild(u),u.innerHTML=c,_.each(f,function(t){l(t)}),d(),h(),a(n(r(u.innerHTML)))}function e(t){return t.replace(g,b)}function i(t){return t.replace(v,y).replace(w,C).replace(S,k).replace(M,T).replace(D,I).replace(x,P)}function s(t){return t.replace(F,$).replace(A,L).replace(O,E).replace(W,B)}function n(t){return t.replace(z,N).replace(R,U)}function o(t){return t.replace(j,H)}function a(t){return t.replace(q,V)}function r(t){return t.replace(Q,G)}function l(t){_.each(_.toArray(u.getElementsByTagName(t)),function(t){var e,i;_.each(_.toArray(t.childNodes),function(t){3==t.nodeType&&(i=t,e||(e=t))});var s=e&&i&&e.nodeValue.startsWith("->")&&i.nodeValue.endsWith("<-");s&&(t.style.textAlign="center",e.nodeValue=e.nodeValue.substr(2),i.nodeValue=i.nodeValue.slice(0,-2))})}function d(){_.each(_.toArray(u.getElementsByTagName("p")),function(t){t.innerHTML=t.innerHTML.replace(Y,"\n<br>\n")})}function h(){_.each(_.toArray(u.getElementsByTagName("a")),function(t){var e=Link.getFullUrl(t.href);e&&(t.href=e),t.target||!e||_.detect(K,function(t){return e.startsWith(t)})||(t.target="_blank")})}var c,u,m=function(){return[{type:"output",filter:function(t){return t.replace(/<em>\*(\s*.*\s*)\*<\/em>/g,"<strong>$1</strong>").replace(/<em>\*(\s*.*\s*)<\/em>\*/g,"<strong>$1</strong>")}}]},p=new Showdown.converter({extensions:[m]}),f="p h1 h2 h3".split(" "),g=/^[\s]+/gm,b="\n",v=/<center>((?:.|\n)*?)<\/center>/gi,y="->$1<-",w=/\n={3,}(?:\n|$)/g,C="MIMI-HEADER",S=/\n\-{3,}(?:\n|$)/g,k="MIMI-SUBHEADER",M=/->((?:.|\n)*?)<-/g,T="\n->$1<-\n",D=/\n?MIMI-HEADER/g,I="\n==========\n",x=/\n?MIMI-SUBHEADER/g,P="\n----------\n",F=/__/g,$="MIMI-UNDERSCORE-INA-WORDMIMI-UNDERSCORE-INA-WORD",A=/(\w)_(\w)_(\w)/g,L="$1MIMI-UNDERSCORE-INA-WORD$2MIMI-UNDERSCORE-INA-WORD$3",O=/(\w)_(\w)/g,E="$1MIMI-UNDERSCORE-INA-WORD$2",W=/([\w\d])\*([\w\d])/g,B="$1MIMI-ASTERISK-INA-WORD$2",z=/MIMI-UNDERSCORE-INA-WORD/g,N="_",R=/MIMI-ASTERISK-INA-WORD/g,U="*",j=/`/g,H="MIMI-BACKTICK",q=/MIMI-BACKTICK/g,V="`",Q=/\*(.*\s*)\*/gm,G="<em>$1</em>",Y=/\n+/g,K="mailto: aim: callto: #".split(" ");return{convert:t}}();var Query=function(t){"use strict";var e=function(t){var e,i,s,n,o=[];if("undefined"==typeof t||null===t||""===t)return o;for(0===t.indexOf("?")&&(t=t.substring(1)),i=t.toString().split(/[&;]/),e=0;e<i.length;e++)s=i[e],n=s.split("="),o.push([n[0],n[1]]);return o},i=e(t),s=function(){var t,e,s="";for(t=0;t<i.length;t++)e=i[t],s.length>0&&(s+="&"),s+=e.join("=");return s.length>0?"?"+s:s},n=function(t){return t=decodeURIComponent(t),t=t.replace("+"," ")},o=function(t){var e,s;for(s=0;s<i.length;s++)if(e=i[s],n(t)===n(e[0]))return e[1]},a=function(t){var e,s,o=[];for(e=0;e<i.length;e++)s=i[e],n(t)===n(s[0])&&o.push(s[1]);return o},r=function(t,e){var s,o,a,r,l=[];for(s=0;s<i.length;s++)o=i[s],a=n(o[0])===n(t),r=n(o[1])===n(e),(1===arguments.length&&!a||2===arguments.length&&!a&&!r)&&l.push(o);return i=l,this},l=function(t,e,s){return 3===arguments.length&&-1!==s?(s=Math.min(s,i.length),i.splice(s,0,[t,e])):arguments.length>0&&i.push([t,e]),this},d=function(t,e,s){var o,a,d=-1;if(3===arguments.length){for(o=0;o<i.length;o++)if(a=i[o],n(a[0])===n(t)&&decodeURIComponent(a[1])===n(s)){d=o;break}r(t,s).addParam(t,e,d)}else{for(o=0;o<i.length;o++)if(a=i[o],n(a[0])===n(t)){d=o;break}r(t),l(t,e,d)}return this};return{getParamValue:o,getParamValues:a,deleteParam:r,addParam:l,replaceParam:d,toString:s}},Uri=function(t){"use strict";var e=!1,i=function(t){for(var i={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},s=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],n={name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},o=i[e?"strict":"loose"].exec(t),a={},r=14;r--;)a[s[r]]=o[r]||"";return a[n.name]={},a[s[12]].replace(n.parser,function(t,e,i){e&&(a[n.name][e]=i)}),a},s=i(t||""),n=new Query(s.query),o=function(t){return"undefined"!=typeof t&&(s.protocol=t),s.protocol},a=null,r=function(t){return"undefined"!=typeof t&&(a=t),null===a?-1!==s.source.indexOf("//"):a},l=function(t){return"undefined"!=typeof t&&(s.userInfo=t),s.userInfo},d=function(t){return"undefined"!=typeof t&&(s.host=t),s.host},h=function(t){return"undefined"!=typeof t&&(s.port=t),s.port},c=function(t){return"undefined"!=typeof t&&(s.path=t),s.path},u=function(t){return"undefined"!=typeof t&&(n=new Query(t)),n},m=function(t){return"undefined"!=typeof t&&(s.anchor=t),s.anchor},p=function(t){return o(t),this},f=function(t){return r(t),this},g=function(t){return l(t),this},_=function(t){return d(t),this},b=function(t){return h(t),this},v=function(t){return c(t),this},y=function(t){return u(t),this},w=function(t){return m(t),this},C=function(t){return u().getParamValue(t)},S=function(t){return u().getParamValues(t)},k=function(t,e){return 2===arguments.length?u().deleteParam(t,e):u().deleteParam(t),this},M=function(t,e,i){return 3===arguments.length?u().addParam(t,e,i):u().addParam(t,e),this},T=function(t,e,i){return 3===arguments.length?u().replaceParam(t,e,i):u().replaceParam(t,e),this},D=function(){var t="",e=function(t){return null!==t&&""!==t};return e(o())?(t+=o(),o().indexOf(":")!==o().length-1&&(t+=":"),t+="//"):r()&&e(d())&&(t+="//"),e(l())&&e(d())&&(t+=l(),l().indexOf("@")!==l().length-1&&(t+="@")),e(d())&&(t+=d(),e(h())&&(t+=":"+h())),e(c())?t+=c():e(d())&&(e(u().toString())||e(m()))&&(t+="/"),e(u().toString())&&(0!==u().toString().indexOf("?")&&(t+="?"),t+=u().toString()),e(m())&&(0!==m().indexOf("#")&&(t+="#"),t+=m()),t},I=function(){return new Uri(D())};return{protocol:o,hasAuthorityPrefix:r,userInfo:l,host:d,port:h,path:c,query:u,anchor:m,setProtocol:p,setHasAuthorityPrefix:f,setUserInfo:g,setHost:_,setPort:b,setPath:v,setQuery:y,setAnchor:w,getQueryParamValue:C,getQueryParamValues:S,deleteQueryParam:k,addQueryParam:M,replaceQueryParam:T,toString:D,clone:I}},jsUri=Uri;if(function(t){"use strict";var e;"undefined"!=typeof module&&module.exports&&(e=require("buffer").Buffer);var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=function(t){for(var e={},i=0,s=t.length;s>i;i++)e[t.charAt(i)]=i;return e}(i),n=String.fromCharCode,o=function(t){var e=t.charCodeAt(0);return 128>e?t:2048>e?n(192|e>>>6)+n(128|63&e):n(224|e>>>12&15)+n(128|e>>>6&63)+n(128|63&e)},a=function(t){return t.replace(/[^\x00-\x7F]/g,o)},r=function(t){var e=[0,2,1][t.length%3],s=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0),n=[i.charAt(s>>>18),i.charAt(s>>>12&63),e>=2?"=":i.charAt(s>>>6&63),e>=1?"=":i.charAt(63&s)];return n.join("")},l=t.btoa||function(t){return t.replace(/[\s\S]{1,3}/g,r)},d=e?function(t){return new e(t).toString("base64")}:function(t){return l(a(t))},h=function(t,e){return e?d(t).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}):d(t)},c=function(t){return h(t,!0)},u=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}/g,m=function(t){return n(t.length<3?(31&t.charCodeAt(0))<<6|63&t.charCodeAt(1):(15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2))},p=function(t){return t.replace(u,m)},f=function(t){var e=t.length,i=e%4,o=(e>0?s[t.charAt(0)]<<18:0)|(e>1?s[t.charAt(1)]<<12:0)|(e>2?s[t.charAt(2)]<<6:0)|(e>3?s[t.charAt(3)]:0),a=[n(o>>>16),n(o>>>8&255),n(255&o)];return a.length-=[0,0,2,1][i],a.join("")},g=t.atob||function(t){return t.replace(/[\s\S]{1,4}/g,f)},_=e?function(t){return new e(t,"base64").toString()}:function(t){return p(g(t))},b=function(t){return _(t.replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};if(t.Base64={atob:g,btoa:l,fromBase64:b,toBase64:h,utob:a,encode:h,encodeURI:c,btou:p,decode:b},"function"==typeof Object.defineProperty){var v=function(t){return{value:t,enumerable:!1,writable:!0,configurable:!0}};t.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",v(function(){return b(this)})),Object.defineProperty(String.prototype,"toBase64",v(function(t){return h(this,t)}))}}}(this),Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var t=0,e=this.length;e>t;t++)this[t]&&this[t].parentElement&&this[t].parentElement.removeChild(this[t])},RegExp.escape=function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},"File"in window&&(File.IMAGE_FILE_TYPES=/(image\/jpeg|image\/jpg|image\/pjpeg|image\/png|image\/x-png|image\/gif)$/i,File.prototype.isImage=function(){return File.IMAGE_FILE_TYPES.test(this.type)}),_.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,isKey:function(t,e){return t.which===Event["KEY_"+e.toUpperCase()]}}),jQuery.Event.prototype.isKey=function(t){return Event.isKey(this,t)},jQuery.Event.prototype.die=function(t){this.stopPropagation(),this.preventDefault(),jQuery(this.target).trigger("traffic:"+(t||this.type))},Mimi.ABtest=function(t){var e="B",i=function(){return window.ABtestSplit};return t.isTestGroup=function(){return i()==e},t.isControlGroup=function(){return!t.isTestGroup()},t.useEither=function(e,i){return t.isControlGroup()?e:i},t}({}),function(t){function e(t){var e=[t[0]];for(i=1;i<t.length;++i)t[i]!=t[i-1]&&e.push(t[i]);return e.join("")}Mimi.Password={validate:function(t){return 3==this.strength(t)},strength:function(t){var e=this.rulesMet(t),i=this.rulesRequired(t);return Math.max(Math.min(3+e-i,3),0)},rulesMet:function(t){var e=""+t,i=0;return this.noCommonWords(e)&&(i+=1),this.lowerLetter(e)&&(i+=1),this.capitalLetter(e)&&(i+=1),this.number(e)&&(i+=1),this.symbol(e)&&(i+=1),this.noRepeats(e)&&(i+=1),i},rulesRequired:function(t){var e=(""+t).length;return 6>e?100:8>e?6:10>e?5:14>e?4:3},hint:function(t){var e=""+t;return this.validate(e)?I18n.t("js.password.victory"):e.length<6?I18n.t("js.password.tooShort"):this.noCommonWords(e)?this.lowerLetter(e)?this.capitalLetter(e)?this.number(e)?this.symbol(e)?this.noRepeats(e)?void 0:I18n.t("js.password.noRepeats"):I18n.t("js.password.symbol"):I18n.t("js.password.number"):I18n.t("js.password.capitalLetter"):I18n.t("js.password.lowerLetter"):I18n.t("js.password.noCommonWords")},noCommonWords:function(t){var e=t.toLowerCase(),i=_.find(this.common,function(t){return _.startsWith(e,t)});return!i},lowerLetter:function(t){return!!t.match(/[a-z]/g)},capitalLetter:function(t){return!!t.match(/[A-Z]/g)},number:function(t){return!!t.match(/[0-9]/g)},symbol:function(t){return!!t.match(/[! @ # $ % \^ & \* ( ) _ - \+ = { } \[ \] \\ ' " ; : \/ \? > \. < \, ~ ` \xb1 \xa7]/g)},noRepeats:function(t){return t==e(t)},common:["password","qwerty","1234","baseball","dragon","football","monkey","letmein","abc123","admin"]},Mimi.Password.Form={apply:function(){function e(){clearTimeout(h),l.hasClass("hide")?h=setTimeout(i,600):i()}function i(){var t=a.val();0==t.length?l.addClass("hide"):(l.html(Mimi.Password.hint(t)),l.removeClass("hide"))}function s(t){var i=25*(Mimi.Password.strength(t)+1)+"%";return r.css({width:i}),e(),Mimi.Password.validate(t)}function n(){var t=a.val(),e=s(t);o(e)}function o(t){d.prop("disabled",!t)}var a=t("#user_password"),r=t(".password__info .indicator_bar .inner"),l=t(".password__info small"),d=t("#new_signup_submit");a.on("focus keyup change input",n),o(!1);var h=null}}}(jQuery),function(t){Mimi.TrackEvent={track:function(e,i){t.post("/track_events",{event:e,extra:i})}}}(jQuery),_.extend(Mimi,{supportsFileAPI:function(){return!Mimi.isIE9()},isIE9:function(){return jQuery("html").hasClass("ie9")}}),window.Widget={},Widget.Observable={fire:function(t,e){jQuery(this).trigger(t,_.extend({source:this},e||{})),jQuery(document).trigger(t,_.extend({source:this},e||{}))}},function(t){function e(e){_.each(e._observers,function(e){e&&_.each(e,function(e){t(e.element).off(e.eventName,e.__handler)})},e),delete e._observers}function i(e,i){_.each(e._observers,function(s,n){_.each(s,function(e,n){e.eventName===i&&(t(e.element).off(e.eventName,e.__handler),s[n]=null)}),e._observers[n]=_.compact(s)},e)}function s(e,i){_.each(e._observers,function(s,n){_.each(s,function(e,n){e.handler.handler===i&&(t(e.element).off(e.eventName,e.__handler),s[n]=null)}),e._observers[n]=_.compact(s)},e)}function n(e,i){var s=i.element||t(i)[0];_.each(e._observers,function(i,n){_.each(i,function(e,n){e.element===s&&(t(e.element).off(e.eventName,e.__handler),i[n]=null)}),e._observers[n]=_.compact(i)},e)}function o(e,i,s){e._observers[i]&&_.each(e._observers,function(n,o){_.each(n,function(e,o){e.eventName===i&&e.__handler.__handler===s&&(t(e.element).off(e.eventName,e.__handler),n[o]=null)}),e._observers[o]=_.compact(n)},e)}function a(e,i,s){var n=i==window?window:i.element||t(i)[0];_.each(e._observers,function(i,o){_.each(i,function(e,o){e&&e.element===n&&e.__handler.__handler===s&&(t(e.element).off(e.eventName,e.__handler),i[o]=null)}),e._observers[o]=_.compact(i)},e)}function r(e,i,s,n){var o=i==window?window:i.element||t(i)[0];_.each(e._observers,function(i,a){_.each(i,function(e,a){e.element===o&&e.eventName===s&&e.__handler.__handler===n&&(t(e.element).off(e.eventName,e.__handler),i[a]=null)}),e._observers[a]=_.compact(i)},e)}Widget.Observer={observe:function(){switch(this._observers||(this._observers={}),arguments.length){case 2:t(this).on(arguments[0],_.bind(arguments[1],this));break;case 3:t(arguments[0]).on(arguments[1],_.bind(arguments[2],this));break;default:throw"Incorrect number of arguments for observe. 2 or 3 expected but got "+arguments.length+"."}},stopObserving:function(){if(this._observers)switch(arguments.length){case 0:e(this);break;case 1:_.isString(arguments[0])?i(this,arguments[0]):"function"==typeof arguments[0]?s(this,arguments[0]):n(this,arguments[0]);break;case 2:"string"==typeof arguments[0]?o(this,arguments[0],arguments[1]):a(this,arguments[0],arguments[1]);break;case 3:r(this,arguments[0],arguments[1],arguments[2])}}}}(jQuery),function(t){Widget.OverlayBase=Class.create({initialize:function(e){this.options=_.extend({zIndex:10000004,className:"page-overlay",hideOnClick:!0},e||{}),this.$element=t("<div>").attr({style:"position:fixed;top:0;left:0;bottom:0;right:0;z-index:"+this.options.zIndex,"class":this.options.className}),t("body").append(this.$element),this.options.hideOnClick&&(this.boundClick=_.bind(this.click,this),this.$element.on("click",this.boundClick)),this.hide()},show:function(t,e){this.callback=t&&e?_.bind(t,e):t?t:function(){},this.$element.show()},hide:function(){this.$element.hide()},visible:function(){return this.$element.is(":visible")},click:function(t){this.callback(t),this.hide()},darken:function(){return this.$element.css({opacity:.2}),this},destroy:function(){this.$element.off("click",this.boundClick),this.$element.remove(),clearInterval(this.scrollTimer)}}),Widget.Overlay=Class.create(Widget.OverlayBase,{initialize:function($super,t){$super(t),this.scrollBound=_.bind(this.scroll,this),this.enableScroll()},scroll:function(){this.scrolled=!0},doScroll:function(){this.scrolled&&(this.$element.trigger("window:scrolled"),this.scrolled=!1)},enableScroll:function(){t(window).on("scroll",this.scrollBound),this.scrollTimer=setInterval(_.bind(this.doScroll,this),250),this.doScroll()},disableScroll:function(){this.scrollTimer&&(t(window).off("scroll",this.scrollBound),clearInterval(this.scrollTimer),this.scrollTimer=null)}}).singleton("show","hide","visible","enableScroll","disableScroll"),Widget.ModalOverlay=Class.create(Widget.OverlayBase,Widget.Observer,{initialize:function($super){$super({zIndex:1500,className:"page-overlay modal",hideOnClick:!1})}}).singleton("show","hide","visible")}(jQuery),function(t){Widget.BlockOverlay=Class.create({initialize:function(e){this.options=_.extend({element:null,insert:t("body"),cover:null,zIndex:1e3,className:"",loadingClass:"loading",hideOnClick:!1},e||{}),this.$element=t(this.options.element||"<div>").attr({style:"display:none;position:absolute;z-index:"+this.options.zIndex,"class":"block "+this.options.className}),t(this.options.insert).append(this.$element),this.options.hideOnClick&&(this.boundClick=_.bind(this.click,this),this.$element.on("click",this.boundClick))},show:function(e){e||(e=this.options.cover),this.options.cover=t(e)[0],this.position(this.options.cover),this.$element.addClass(this.options.loadingClass).show()},hide:function(){this.$element.removeClass(this.options.loadingClass).hide()},click:function(){this.hide()},visible:function(){return this.$element.is(":visible")},position:function(t){this.$element.clonePosition(t||this.options.cover),this.$element.height()<80&&this.$element.css({height:"80px"})},destroy:function(){this.$element.remove()}})}(jQuery),Widget.Styles=Class.create({//   others from yui-ext 0.33 (C) Copyright(c) 2006, Jack Slocum. */
initialize:function(t){this.document=t||document,this.headEl=this.document.getElementsByTagName("head")[0],this.cache={},this.mustRefresh=!0,this.styleSheet=null},getRules:function(t){if(!this.styleSheet)return null;if(this.mustRefresh||t){this.cache={};for(var e=this.styleSheet.cssRules||this.styleSheet.rules,i=e.length;i--;)this.cache[e[i].selectorText.toLowerCase()]=e[i]}return this.cache},getRule:function(t,e){var i=this.getRules(e);if(!i)return null;if(!(t instanceof Array))return this.findRule(i,t);for(var s=0;s<t.length;s++)if(i[t[s]])return i[t[s]];return null},findRule:function(t,e){if(t[e])return t[e];for(var i=_.invoke(e.split(/\s*,\s*/),"trim"),s=i.length;s--;)if(t[i[s]])return t[i[s]]},addRule:function(t,e){if(!this.styleSheet&&this.document.styleSheets){var i;this.document.createElement&&(i=this.document.createElement("style"))&&(i.type="text/css",this.document.getElementsByTagName("head")[0].appendChild(i),this.styleSheet=i.sheet||this.document.styleSheets[this.document.styleSheets.length-1])}var s=t.split(/\s*,\s*/),n=Widget.Styles.makeStyleString(e);if(this.styleSheet){var o;if(this.styleSheet.insertRule)for(o=s.length;o--;)this.styleSheet.insertRule(s[o]+" { "+n+" }",this.styleSheet.cssRules.length);else if(this.styleSheet.addRule)for(o=s.length;o--;)this.styleSheet.addRule(s[o],n)}},updateRule:function(t,e){for(var i=t.split(/\s*,\s*/),s=this.getRules(),n=i.length;n--;){var o=s&&this.findRule(s,i[n]);if(o)for(var a in e)o.style[a.camelize()]=e[a];else this.addRule(i[n],e)}}}),Widget.Styles.makeStyleString=function(t){var e=[];for(var i in t)e.push(i.underscore().dasherize()+":"+t[i]+";");return e.join("")},function(t){Widget.Popup=Class.create(Widget.Observer,Widget.Observable,{initialize:function(e,i){this.$element=t(e),this.options={autoHide:!0,escClose:!0,overlay:Widget.Overlay,onShowing:function(){return!0},onShown:function(){},onHiding:function(){return!0},onHidden:function(){},parent:document.body,anchor:window,position:"center center",fixedPosition:!0,repositioning:!0,offset:"0 0",styles:{position:"absolute",zIndex:10000005,display:"none"},showMethod:"show",hideMethod:"hide",cssClass:""},this.setOptions(i),this.$element[0]&&(this.$element.css(this.options.styles),this.$element.addClass(this.options.cssClass),t(this.options.parent).append(this.$element),this.positionRe=/\bposition-([a-z]+-[a-z]+)\b/i,this.offsetRe=/\boffset-(-?[0-9]+)-(-?[0-9]+)\b/i,this.options.hideTrigger&&this.$element.on("click",this.options.hideTrigger,_.bind(this.hideClick,this)),this.options.clickEids&&_.each(this.options.clickEids,_.bind(function(t,e){this.$element.find(e).data("click-eid",t)},this)))},position:function(t,e,i){if(this.$element[0]){this.options.fixedPosition&&this.$element.css({position:"absolute"});var s,n={width:this.$element.outerWidth(),height:this.$element.outerHeight()},o=document.getViewport();if(t=this.getPosition(t),"none"!==t)return e=this.getOffset(e),this.options.anchor==window?(s=this.positionToWindow(t,e,n,o),s=this.positionInViewport(s.left,s.top,n,o)):(s=this.positionToAnchor(t,e,n),i?s=this.positionInViewport(s.left,s.top,n,o):this.options.repositioning&&this.needsRepositioning(t,e,s.left,s.top,n,o)&&(s=this.position(t,e,!0))),i||(s=this.options.fixedPosition?{left:(s.left-o.left).px(this.options.allowNegatives),top:(s.top-o.top).px(this.options.allowNegatives),position:"fixed"}:{left:s.left.px(this.options.allowNegatives),top:s.top.px(this.options.allowNegatives)},this.$element.css(s)),s}},setOptions:function(e){this.options=_.extend(this.options,e),e&&e.parent&&t(this.options.parent).append(this.$element)},show:function(e){this.options.onShowing(this,e)&&(_.last(Widget.Popup.visibleStack)!==this&&Widget.Popup.visibleStack.push(this),this.position(),this.options.overlay&&this.options.overlay.get().show(this.clickOff,this),this.$element[this.options.showMethod](),this.options.onShown(this,e),t(document).trigger("popup:shown"))},hide:function(e){this.options.onHiding(this,e)&&(this.$element[this.options.hideMethod](),_.last(Widget.Popup.visibleStack)===this&&Widget.Popup.visibleStack.pop(),this.options.overlay&&(this.options.overlay.get().$element.removeClass("animation-base"),this.options.overlay.get().hide()),this.options.onHidden(this,e),t(document).trigger("popup:hidden"))},hideClick:function(t){t.die(),this.hide()},clickOff:function(t){this.options.autoHide&&this.hide(t)},getPosition:function(t){if(!t){var e=this.positionRe.exec(this.$element[0].className);t=e?e[1].toLowerCase().split("-"):this.options.position.toLowerCase().split(" ")}return t},getOffset:function(t){if(!t){var e=this.offsetRe.exec(this.$element[0].className);e?t=[parseInt(e[1],10),parseInt(e[2],10)]:(e=this.options.offset.toLowerCase().split(" "),t=[parseInt(e[0],10),parseInt(e[1],10)])}return t},positionToWindow:function(t,e,i,s){var n=0,o=0;switch(t[0]){case"left":n=s.left;break;case"center":n=s.left+Math.round((s.width-i.width)/2);break;case"right":n=s.right-i.width}switch(t[1]){case"top":o=s.top;break;case"center":o=s.top+Math.round((s.height-i.height)/2);break;case"bottom":o=s.bottom-i.height}return n+=e[0],"center"===t[0]&&"center"===t[1]&&0===e[1]?o-=75:o+=e[1],{left:n,top:o}},positionToAnchor:function(e,i,s){var n=t(this.options.anchor),o={width:n.outerWidth(),height:n.outerHeight()},a=0,r=0;switch(e[0]){case"farleft":a=-s.width;break;case"center":a=Math.round(o.width-s.width)/2;break;case"right":a=o.width-s.width;break;case"farright":a=o.width}switch(e[1]){case"fartop":r=-s.height;break;case"center":r=Math.round(o.height-s.height)/2;break;case"bottom":r=o.height-s.height;break;case"farbottom":r=o.height}return this.$element.clonePosition(n[0],{offsetLeft:a+i[0],offsetTop:r+i[1],setWidth:!1,setHeight:!1}),a=this.$element.parseIntStyle("left"),r=this.$element.parseIntStyle("top"),{left:a,top:r}},positionInViewport:function(t,e,i,s){return t<s.left&&(t=s.left),t+i.width>s.right&&(t=s.right-i.width),e<s.top&&(e=s.top),e+i.height>s.bottom&&(e=s.bottom-i.height),{left:t,top:e}},needsRepositioning:function(t,e,i,s,n,o){var a=!1;return(i<o.left||i+n.height>o.right)&&(t[0]=Widget.Popup.POSITION_MAP[t[0]],e[0]=-e[0],a=!0),(s<o.top||s+n.height>o.bottom)&&(t[1]=Widget.Popup.POSITION_MAP[t[1]],e[1]=-e[1],a=!0),a},visible:function(){return this.$element.is(":visible")},toggle:function(){this.visible()?this.hide():this.show()},destroy:function(){this.options.hideTrigger&&this.$element.off("click",this.options.hideTrigger)}}),Widget.Popup.POSITION_MAP={top:"bottom",fartop:"farbottom",bottom:"top",farbottom:"fartop",left:"right",farleft:"farright",right:"left",farright:"farleft",center:"center"},Widget.Popup.visibleStack=[],t(document).on("keyup",function(t){if(27===t.keyCode){var e=_.last(Widget.Popup.visibleStack);e&&e.options.escClose&&e.hide()}})}(jQuery),function(t){Widget.Select=Class.create(Widget.Popup,Widget.Observer,{initialize:function($super,e,i){this.$element=t(e),this.dom=this.$element.getChildren(Widget.Select.DOM),this.dom.$container=this.$element,this.dom.$menu[0]||window.debug("<Widget.Select> menu element is missing for "+this.$element.identify()),$super(this.dom.$menu[0],_.extend({position:"center farBottom",anchor:this.dom.$button[0],fixedPosition:!1,styles:{position:"absolute",zIndex:10000006,display:"none"}},i||{})),this.dom.$button.on("click",_.bind(this.onButtonClicked,this))},onButtonClicked:function(t){t.preventDefault&&t.preventDefault(),this.show()},destroy:function(){this.stopObserving()}}),Widget.Select.DOM={button:"button",menu:"menu",list:"menu ul",textSpan:"button > span",valueInput:"input"}}(jQuery),function(t){Widget.Dropdown=Class.create(Widget.Select,Widget.Observer,{initialize:function($super,t,e){e=_.extend({ignore:[],onItemClick:function(){},useClassValue:!1,selectDefault:!0,defaultToFirst:!1,fixedPosition:!1,noSelection:!1,keepStartText:!1,keepMissing:!1,enabled:!0},e||{}),$super(t,e),!this.options.noSelection&&this.dom.$container.attr("data-no-selection")&&(this.options.noSelection=this.dom.$container.attr("data-no-selection")),!this.options.keepMissing&&this.dom.$container.attr("data-keep-missing")&&(this.options.keepMissing=!0),this.dom.$container.attr("data-fixed-position")&&(this.options.fixedPosition=!0),this.options.selectDefault&&this.setDefaultSelection(),this.options.enabled?this.enabled=!0:this.disable(),this.dropDownScrollBarClicked=!1,this.initializeEvents(),this.removeEmptyListItems(),Widget.Dropdown.initializeGlobalEvents()},initializeEvents:function(){t(document).on("popup:hidden",_.bind(this.hide,this)),this.dom.$list.on("mousedown",_.bind(this.itemClick,this)),this.dom.$button.on("focus",_.bind(this.onButtonFocus,this)).on("blur",_.bind(this.onButtonBlur,this))},onButtonFocus:function(){Widget.Dropdown.activeInstance=this},onButtonBlur:function(e){return this.shouldTrackScrollBarClick()&&this.dropDownScrollBarClicked?(this.dropDownScrollBarClicked=!1,void this.dom.$button.focus()):void(e.relatedTarget&&!t.contains(this.dom.$menu[0],e.relatedTarget)&&this.hide(!0))},shouldTrackScrollBarClick:function(){return-1==navigator.userAgent.indexOf("Firefox")},show:function($super){this.dom.$button.focus(),$super(),Widget.Dropdown.activeInstance=this,this.getItems().each(function(e,i){t(i).parent().removeClass("selected")});var e=this.getItem();e&&(t(e).parent().addClass("selected"),this.dom.$list[0].scrollTop=e.offsetTop-Math.round(this.dom.$list[0].offsetHeight/2))},hide:function($super,t){if(this.visible()){if($super(),delete Widget.Dropdown.activeInstance,!t)try{this.dom.$button.focus()}catch(e){}if(navigator.userAgent.indexOf("MSIE")>-1){var i=this.$element;i.css({display:"block",left:"-1000px"}),setTimeout(function(){i.css({display:"none"})},1)}this.fire("dropdown:hidden")}},disable:function(){this.enabled&&(this.enabled=!1,this.dom.$button.addClass("disabled"))},enable:function(){this.enabled||(this.enabled=!0,this.dom.$button.removeClass("disabled"))},removeEmptyListItems:function(){this.dom.$list.find("li").each(function(e,i){t(i).find("a")||t(i).remove()})},itemClick:function(e){if(t(e.target.parentNode).is("menu")||t(e.target.parentNode).is("section"))return void(this.dropDownScrollBarClicked=!0);var i=e.target,s=t(i).closest("a");if(!_.find(this.options.ignore,function(e){return t(i).is(e)})){if(s[0]){var n=this.getValue();this.setSelection(s[0]),this.options.onItemClick(s[0],e,this.getValue(),n),this.fire("dropdown:item:selected",{element:s[0],value:this.getValue(),originalValue:n})}return this.hide(),!1}},setText:function(t){this.options.keepStartText||this.dom.$textSpan.html(t)},getText:function(){return this.dom.$textSpan.html()},setValue:function(t){this.dom.$valueInput.val(t).trigger("change")},getValue:function(){return this.dom.$valueInput.val()},setDefaultSelection:function(){this.oldValue=this.getValue()||this.oldValue,this.setSelection(this.oldValue,this.options.defaultToFirst,this.options.noSelection)},setSelection:function(t,e,i){if(this.options.noSelection=i,_.isElement(t))this.setText(this.getItemText(t)),this.setValue(this.getItemValue(t));else{var s=this.getItems(),n=_.detect(s,function(e){return this.getItemValue(e)==t},this);n?this.setSelection(n):this.options.keepMissing?(this.setText(t),this.setValue(t)):e?this.setSelection(this.getItems().first()):this.options.noSelection&&(this.setText(this.options.noSelection),this.setValue(""))}},getItemValue:function(t){return this.options.useClassValue?t.className:t.getAttribute("data-value")},getItemText:function(e){return t(e).text()},getItems:function(){return this.dom.$menu.find("li a")},getItem:function(t){return t=t||this.getValue(),_.isUndefined(t)?void 0:_.detect(this.getItems(),function(e){return this.getItemValue(e)===t.toString()},this)},setItems:function(t,e,i){var s,n,o,a=[],r=t.length;for(this.oldValue=this.getValue()||this.oldValue,s=0;r>s;++s)n=t[s],o=_.isString(n)?{value:n,text:n}:{value:t[s][1],text:t[s][0]},a.push(Widget.Dropdown.ITEM_TEMPLATE(o));this.dom.$list.html(a.join("")),this.options.defaultToFirst=e,this.options.noSelection=i,this.setDefaultSelection()},convertToTextField:function(t,e){t&&this.setValue(""),this.dom.$button.remove(),this.dom.$valueInput.attr("type","text"),this.stopObserving(),e&&this.dom.$valueInput.focus()},translatePersonalizationTags:function(t){var e=t.tag.toLowerCase();if("email"===e)return I18n.t("personalization_tags.index.email");if("name"===e)return I18n.t("personalization_tags.index.name");if("first_name"===e)return I18n.t("personalization_tags.index.first_name");if("last_name"===e)return I18n.t("personalization_tags.index.last_name");if("city"===e)return I18n.t("personalization_tags.index.city");if("phone"===e)return I18n.t("personalization_tags.index.phone");if("company"===e)return I18n.t("personalization_tags.index.company");if("title"===e)return I18n.t("personalization_tags.index.title");if("address"===e)return I18n.t("personalization_tags.index.address");if("state"===e)return I18n.t("personalization_tags.index.state");if("zip"===e)return I18n.t("personalization_tags.index.zip");if("country"===e)return I18n.t("personalization_tags.index.country");var i=t.tag.replace(/_/g," ");return i.substring(0,1).toUpperCase()+i.substring(1)},destroy:function($super){$super(),this.stopObserving()}}),Widget.Dropdown.ITEM_TEMPLATE=_.template("<li><a data-value='#{value}' href='#'>#{text}</a></li>"),Widget.Dropdown.instances={},Widget.Select.instances={},Widget.Dropdown.getInstanceByName=function(t){var e=_.detect(Widget.Dropdown.instances,function(e){return e.dom.$valueInput.prop("name")===t});return e},Widget.Dropdown.initializeGlobalEvents=function(){function e(){d.options.onItemClick(l[0]),d.setSelection(l[0]),d.hide(),d.dom.$button.focus(),d.fire("dropdown:item:selected",{element:l[0]})}function i(){for(var e=r.find("li"),i=0,s=e.length;s>i;i++){var n=t(e[i]).text().trim()===d.dom.$button.text().trim();n&&(l=e.eq(i).find("a"))}!l[0]&&e[0]&&(l=e.first().find("a")),l[0]&&(l.addClass("selected").focus(),l.closest("li").addClass("selected"))}function s(){if(l[0]){l.removeClass("selected").closest("li").removeClass("selected");var t=l.closest("li").next();t[0]||(t=r.find("li").first()),t.find("a").addClass("selected").focus(),t.addClass("selected"),d.onButtonFocus(),d.dom.$list.is(":visible")||(l=t.find("a"),e(),d.onButtonFocus())}}function n(){if(l[0]){l.removeClass("selected"),l.closest("li").removeClass("selected");var t=l.closest("li").prev();t[0]||(t=r.find("li").last()),t.find("a").addClass("selected").focus(),t.addClass("selected"),d.onButtonFocus(),d.dom.$list.is(":visible")||(l=t.find("a"),e(),d.onButtonFocus())}}function o(i){clearTimeout(h),u+=i,h=setTimeout(function(){u=""},m);for(var s=r.find("li a"),n=0,o=s.length;o>n;n++){var a=t(s[n]).text().toLowerCase(),c=0===a.indexOf(u.toLowerCase());if(c)return l.removeClass("selected"),l.closest("li").removeClass("selected"),l=t(s[n]),l.addClass("selected").focus(),l.closest("li").addClass("selected"),d.onButtonFocus(),void(d.dom.$list.is(":visible")||(e(),d.onButtonFocus()))}}function a(t){if(d=Widget.Dropdown.activeInstance,d&&"INPUT"!==t.target.nodeName.toUpperCase()){if(r=d.dom.$list,l=r.find("li a.selected"),l[0]||i(),38===t.keyCode)return n(),!1;if(40===t.keyCode)return s(),!1;if(13===t.keyCode){if(d.dom.$list.is(":visible"))return e(),!1;d.show(),l[0]&&(d.dom.$list[0].scrollTop=l[0].offsetTop-10)}else o(String.fromCharCode(t.keyCode))}}var r,l,d,h,c=!1,u="",m=1e3;return function(){c||(c=!0,t(document).on("keydown",a))}}(),Widget.Dropdown.initFromElements=function(){t("span.select").each(function(e,i){var s=t(i);s.hasClass("ignore")||(s.hasClass("auto")?Widget.Dropdown.instances[s.identify()]=new Widget.Dropdown(i):Widget.Select.instances[s.identify()]=new Widget.Select(i))}),t(document).trigger("dropdown:initialized")},t(Widget.Dropdown.initFromElements)}(jQuery),function(t){Widget.Dialog=Class.create(Widget.Popup,{initialize:function($super,e,i,s){var n="dialog_"+Widget.Dialog.id++;t("body").append(Widget.Dialog.TEMPLATE({id:n,header:e,content:i})),s=s||{},s.hideTrigger=(s.hideTrigger?s.hideTrigger+", ":"")+".window_close",s.overlay=Widget.ModalOverlay,$super("#"+n,s),s.narrow&&this.$element.addClass("narrow"),this.dom=this.$element.getChildren(Widget.Dialog.DOM)},setTitle:function(t){this.dom.$title.html(t)},setBody:function(t){this.dom.$body.html(t)}}),Widget.Dialog.TEMPLATE=_.template('<div class="window" id="#{id}"><header><h1 class="window_title">#{header}</h1><a class="window_close"><span>\xd7</span></a></header><div class="window_contents">#{content}</div></div>'),Widget.Dialog.id=0,Widget.Dialog.DOM={title:"h1.window_title",body:"div.window_contents"}}(jQuery),Widget.ConfirmDialog=Class.create(Widget.Dialog,Widget.Observable,Widget.Observer,{initialize:function($super,t,e,i,s){e||i||(i=t,t=e=""),s||(s=I18n.t("js.confirm_dialog.ok"));var n=Widget.ConfirmDialog.TEMPLATE({body:e,buttonText:s});i=_.extend({hideTrigger:".back",onOk:function(){},onHide:function(){}},i||{}),$super(t,n,i),this.$element.on("click","button[type=submit]",_.bind(this.ok,this))},ok:function(){return this.hide(),this.fire("dialog:ok"),this.options.onOk(),!1},show:function($super,t,e){t&&this.setTitle(t),e&&this.setMessage(e),$super()},hide:function($super){$super(),this.fire("dialog:hidden"),this.options.onHide()},setMessage:function(t){try{this.setBody(Widget.ConfirmDialog.TEMPLATE({body:t,buttonText:I18n.t("js.confirm_dialog.ok")}))}catch(e){debug("confirm_dialog#setMessage"),debug(e)}},destroy:function($super){$super(),this.$element.remove()}}),Widget.ConfirmDialog.TEMPLATE=_.template('<div class="field">#{body}</div><footer><form><p class="actions"><span class="left"><a class="back" href="#">'+I18n.t("js.confirm_dialog.cancel")+'</span></a></span> <span class="right"><button class="btn primary current" type="submit"><span>#{buttonText}</span></button></span></p></form></footer>'),function(t){Widget.ApiKeyConfirmLink=Class.create(Widget.Observer,{initialize:function(e,i,s,n){this.$element=t("#"+e),this.$element.on("click",_.bind(this.click,this)),this.confirm=new Widget.ConfirmDialog(i,s),t(document).on("dialog:ok",_.bind(this.confirmed,this)),this.method=n,this.$to_replace=t("#"+this.$element.attr("data-replace"))},click:function(){return this.confirm.show(),!1},confirmed:function(){t.ajax({url:this.$element.prop("href"),type:this.method}).done(_.bind(this.update_replaced,this))},update_replaced:function(t){this.$to_replace.html(t.api_key)}})}(jQuery),function(t){Widget.Toolbar=Class.create(Widget.Observer,Widget.Observable,{initialize:function(e,i){this.$element=t(e),this.options=_.extend({buttonSelector:"a",selectedClass:"on",toggleClass:"toggle",singleSelect:!1},i||{}),this.$element.on("click",this.options.buttonSelector,_.bind(this.click,this)),this.$buttons=this.$element.find(this.options.buttonSelector)},click:function(t){var e=t.currentTarget,i=!1;return this.select(e),this.fire("toolbar:clicked",{button:e,selected:i}),!1},select:function(e){var i,s=t(_.isNumber(e)?this.$buttons[e]:e);(this.options.singleSelect||s.hasClass(this.options.toggleClass))&&(this.options.singleSelect?(this.$buttons.removeClass(this.options.selectedClass),i=!0,s.addClass(this.options.selectedClass)):i=!s.hasClass(this.options.selectedClass),s.toggleClass(this.options.selectedClass,i))},destroy:function(){this.stopObserving()}})}(jQuery),function(t){Widget.Tabs=Class.create(Widget.Observable,Widget.Observer,{initialize:function(e,i){try{this.$element=t(e),this.options=_.extend({stateKey:this.$element.identify(),noState:!1,showOnInit:!0},i||{}),this.$element.on("click","li",_.bind(this.click,this)),this.$tabs=this.$element.find("li"),this.initTabs()}catch(s){debug("WARNING: Tabs for "+(this.$element[0]?this.$element.identify():e||"<missing element>")+" could not be initialized: "+s.message)}},initTabs:function(){var t=this.options.noState?null:State.get(this.options.stateKey);if(null!=t){var e=this.findTab(t);e&&this.show(e)}else this.options.showOnInit&&this.show(this.findCurrentTab())},click:function(t){t.die(),this.show(t.currentTarget)},show:function(e,i){this.fire("tab:before_switched",{tab:e}),i=void 0===i?!0:i,this.hideAll(),_.isNumber(e)&&(e=this.$tabs[e]),this.$currentTab=t(e);var s=this.getTabId(e);t(s).show().addClass("current"),t(e).addClass("current"),!this.options.noState&&i&&State.set(this.options.stateKey,s.replace("#","")),this.fire("tab:switched",{tab:e})},hide:function(e){_.isNumber(e)&&(e=this.$tabs[e]),t(this.getTabId(e)).hide().removeClass("current"),t(e).removeClass("current")},hideAll:function(){_.each(this.$tabs,function(t){this.hide(t)},this)},nextTab:function(){var t=this.findCurrentTab(),e=this.$tabs.index(t);this.show(e+1)},previousTab:function(){var t=this.findCurrentTab(),e=this.$tabs.index(t);this.show(e-1)},getTabId:function(e){if(!e)return"";var i=t(e).find("a").prop("href"),s=i;return i.indexOf("#")>-1&&(s=_.last(i.split("#"))),"#"+s},getCurrentTabId:function(){return this.getTabId(this.$currentTab)},hasCurrentTab:function(){return void 0!==this.$currentTab},findTab:function(t){return _.detect(this.$tabs,function(e){return this.getTabId(e)=="#"+t},this)},findCurrentTab:function(){var e=this.options.noState?null:State.get(this.options.stateKey),i=this.findTab(e);return i||_.detect(this.$tabs,function(e){return t(e).hasClass("current")})||this.$tabs[0]},destroy:function(){this.$element.off("click")}})}(jQuery),function(t){Widget.MultiPanel=Class.create({initialize:function(e,i){this.$element=t(e),this.options=_.extend({panels:".popover_pane"},i||{}),this.$panels=this.$element.find(this.options.panels),this.$currentPanel=this.$panels.first(),this.currentIndex=0,this.$element[0].scrollLeft=this.options.offset},setHeight:function(){var e=_.map(this.$panels,function(e){return t(e).height()}),i=Math.max.apply(null,e);_.each(this.$panels,function(e){t(e).css({height:i.px()})})},show:function(e){var i,s;_.isElement(e)?(i=e,s=_.indexOf(this.$panels,i)):_.isString(e)?(i=t(e),s=_.indexOf(this.$panels,i)):(s=e,i=this.$panels[s]),s!=this.currentIndex&&(s>this.currentIndex?this.$currentPanel.after(i):this.$currentPanel.before(i),this.$element[0].scrollLeft=this.$currentPanel[0].offsetLeft,this.$element.animate({scrollLeft:i.offsetLeft},200),this.$currentPanel=t(i),this.currentIndex=s)},home:function(t){this.$currentPanel[0]!==this.$panels[0]&&(t?(this.$currentPanel.before(this.$panels[0]),this.$currentPanel=this.$panels.eq(0),this.currentIndex=0,this.$element[0].scrollLeft=0):this.show(0))},destroy:function(){}})}(jQuery),function(t){Widget.StateButton=Class.create({initialize:function(e,i){this.$element=t(e),this.states=i||Widget.StateButton.ON_OFF_STATES,this.stateClasses=_.map(this.states,function(t,e){return t.className||e}),this.ajaxOptions={success:_.bind(this.success,this),error:_.bind(this.failure,this)}},state:function(t){var e;return t?(e=this.states[t],this.$element.addRemoveClassNames(this.stateClasses,e.className),this):(e=_.detect(this.stateClasses,function(t){return this.$element.hasClass(t)},this),_.detect(this.states,function(t,i){return(t.className||i)===e}))},setStateIfNot:function(t,e){(_.isArray(e)&&e.indexOf(this.state())<0||e!==this.state())&&this.state(t)},observe:function(t,e){return this.$element.on(t,e),this},success:function(t,e,i){if(!t||!t.success)return this.failure(i);var s=this.states[this.currentRequestOptions.state||"busy"];this.setStateIfNot(s.success||"off",s.successIfNot||"__unlikely__"),clearTimeout(this.currentRequestTimeout),this.$element.trigger("ajax:success",_.extend({stateButton:this,response:i},this.currentRequestOptions))},failure:function(t){var e=this.states[this.currentRequestOptions.state||"busy"];this.state(e?e.failure||"on":"on"),this.currentRequestOptions.request.abort(),clearTimeout(this.currentRequestTimeout),this.$element.trigger("ajax:failure",_.extend({stateButton:this,response:t},this.currentRequestOptions))},request:function(e,i,s){i.url=e;var n=t.ajax(_.extend(this.ajaxOptions,i||{}));this.beginRequest(s,{url:e,state:s,options:i,request:n})},submit:function(e,i,s){i.url=t(e).attr("action");var n=t.ajax(_.extend(this.ajaxOptions,i||{}));this.beginRequest(s,{form:e,state:s,request:n})},beginRequest:function(t,e){t=t||"busy",this.currentRequestTimeout=_.delay(this.failure,this.states[t]?this.states[t].timeout||6e4:6e4),this.currentRequestOptions=e,this.state(t)}}),Widget.StateButton.ON_OFF_STATES={on:{className:"on",disabled:!1},off:{className:"off",disabled:!0}},Widget.StateButton.ON_OFF_BUSY_STATES=_.extend({busy:{className:"busy",disabled:!0,timeout:60,failure:"on",success:"off",successIfNot:"on"}},Widget.StateButton.ON_OFF_STATES)}(jQuery),function(t){Widget.DropOutPanels=Class.create({initialize:function(e,i){this.panels=e,this.options=_.extend({home:_.first(_.keys(this.panels)),current:_.first(_.keys(this.panels)),doHilight:!0,minHeight:320,heightElement:"application-sub"},i||{}),this.current=t(this.panels[this.options.current])[0]},show:function(e,i){var s=t(this.panels[e]),n=this.current;return s===n&&(s=t(this.panels[this.options.home])[0]),s===n?void(this.options.doHilight&&s.highlight()):(this.current=s,n!==this.options.home&&t(this.options.heightElement).css({minHeight:Math.max(t(this.options.heightElement).height(),320).px()}),s.fadeIn(400,function(){i&&i()}),void n.absolutize().dropOut({after:function(){t(n).attr("style","").hide(),t("body").css({overflow:""})}}))},home:function(t){this.show(this.options.home,t)}})}(jQuery),function(t){Widget.ColorPicker=Class.create(Widget.Observer,{initialize:function(e,i){this.$element=t(e),this.$element.is("input")&&(this.$element=this.$element.parent()),this.dom=this.$element.getChildren(Widget.ColorPicker.DOM),this.options=_.extend({popup:!0,position:"right farBottom",onButtonClick:function(){},onColorSelected:function(){},onColorHover:function(){},onColorLeave:function(){}},i||{}),this.dom.$button.on("click",_.bind(this.onClick,this)),this.dom.$input.on("keyup",_.bind(this.onKeyup,this)),this.dom.$input.on("blur",_.bind(this.onBlur,this)),this.options.popup&&(this.popup=new Widget.ColorPicker.Popup(this.options.popupElement))},onClick:function(t){this.originalColor=this.dom.$input.val(),this.options.onButtonClick(t),this.options.popup&&(this.popup.setOptions(),this.popup.show({anchor:this.dom.$button[0],position:this.options.position,onColorSelected:_.bind(this.onColorSelected,this),onColorHover:_.bind(this.onColorHover,this),onColorLeave:_.bind(this.onColorLeave,this)}))},onColorSelected:function(t){t||(t="transparent"),this.popup.hide(),this.dom.$color.css({backgroundColor:"transparent"===t?"":Mimi.util.hexToRgb(t)}),this.dom.$input.val(t),this.options.onColorSelected(t)},onColorHover:function(t){t||(t="transparent"),this.dom.$color.css({backgroundColor:"transparent"===t?"":Mimi.util.hexToRgb(t)}),this.dom.$input.val(t),this.options.onColorHover(t)},onColorLeave:function(){var t=this.originalColor;this.dom.$color.css({backgroundColor:"transparent"===t?"":Mimi.util.hexToRgb(t)}),this.dom.$input.val(t),this.options.onColorLeave(t)},onKeyup:function(){var t=Color.from(this.dom.$input.val());this.dom.$color.css({backgroundColor:"transparent"===t?"":Mimi.util.hexToRgb(t)})},onBlur:function(){var t=Color.from(this.dom.$input.val());this.dom.$input.val(t),this.dom.$color.css({backgroundColor:"transparent"===t?"":Mimi.util.hexToRgb(t)}),this.options.onColorSelected(t)},destroy:function(){this.stopObserving()}}),Widget.ColorPicker.DOM={input:"input",button:"button",color:"button span"},Widget.ColorPicker.Popup=Class.create(Widget.Popup,Widget.Observer,{initialize:function($super,t,e){t||(t="#color_picker_grid"),e=_.extend({onColorSelected:function(){},onColorHover:function(){},onColorLeave:function(){}},e||{}),$super(t,e),this.dom=this.$element.getChildren(Widget.ColorPicker.Popup.DOM),this.dom.$list.on("click","li",_.bind(this.onClick,this)).on("mouseover","li",_.bind(this.onMouseOver,this)).on("mouseleave",_.bind(this.onMouseLeave,this))},show:function($super,t){this.setOptions(t||{}),$super()},onClick:function(e){var i=t(e.currentTarget);this.options.onColorSelected(i.find("a").css("backgroundColor").toHtmlColor())},onMouseOver:function(e){var i=t(e.currentTarget);this.options.onColorHover(i.find("a").css("backgroundColor").toHtmlColor())},onMouseLeave:function(){return this.$element.is(":visible")?void this.options.onColorLeave():!1},destroy:function($super){this.stopObserving(),$super()}}),Widget.ColorPicker.Popup.DOM={list:"ul"}}(jQuery),function(t){window.AsyncNotification=Class.create({initialize:function(e){this.options=_.extend({container:null,defaultMessage:"Saving",workingMessage:"Still working...",workingTimeout:3e3,disableElements:[],doneMessage:"Done"},e||{}),t(this.options.container||t("body")).append("<div id='notification'></div>"),this.$element=t("#notification"),this.originalTop=this.$element.offset().top,this.$element.hide(),t(document).on("scroll",_.bind(this.position,this))},show:function(e){this.update(e||this.options.defaultMessage).show(),_.each(this.options.disableElements,function(e){t(e).css({opacity:.3}).prop("disabled",!0)}),this.clearTimeout(),this.timeout=_.delay(_.bind(this.working,this),this.options.workingTimeout)},hide:function(e){_.each(this.options.disableElements,function(e){t(e).css({opacity:1}).prop("disabled",!1)}),this.update(e||this.options.doneMessage).fadeOut(200),this.clearTimeout()},working:function(t){this.update(t||this.options.workingMessage)},update:function(t){return this.$element.html(t),this.$element},clearTimeout:function(){this.timeout&&clearTimeout(this.timeout),this.timeout=null},position:function(){var e=this.originalTop;t(window).offsetTop()>e?(e=t(window).offsetTop(),this.$element.addClass("scrolled")):this.$element.removeClass("scrolled"),this.$element.css({top:e.px()})},visible:function(){return this.$element.is(":visible")}})}(jQuery),function(t){if(Widget.Placeholder=Class.create(Widget.Observer,{initialize:function(e){this.$element=t(e),Widget.Placeholder.supported||(this.placeholder=this.$element.attr("placeholder"),this.blur(),this.$element.on("focus",_.bind(this.focus,this)),this.$element.on("blur",_.bind(this.blur,this)))},focus:function(){this.$element.hasClass("placeholder")&&this.$element.val("").removeClass("placeholder")},blur:function(){this.$element.val()&&this.$element.val()!==this.placeholder||this.$element.addClass("placeholder").val(this.placeholder)}}),Widget.Placeholder.supported="placeholder"in document.createElement("input"),!Widget.Placeholder.supported){var e=t("[type=submit], [type=button]");e.on("click",function(){t("[placeholder]").each(function(e,i){i.value===i.getAttribute("placeholder")&&(i.value="",setTimeout(function(){t(i).addClass("placeholder").val(i.getAttribute("placeholder"))},100))})})}Widget.Placeholder.supported||t(function(){t("[placeholder]").each(function(t,e){new Widget.Placeholder(e)})})}(jQuery),function(t){Widget.DelayedInput=Class.create(Widget.Observer,Widget.Observable,{initialize:function(e,i){this.$element=t(e),this.options=_.extend({delay:500},i||{}),this.$element.on("keypress",_.bind(this.keypress,this)),this.delay=_.delay(_.bind(this.elapsed,this,this.options.delay)),this.lastValue=this.$element.val()},keypress:function(t){13===t.which&&this.elapsed(),this.lastValue!==this.$element.val()&&(this.timeout&&clearTimeout(this.timeout),this.lastValue=this.$element.val(),this.timeout=_.delay(_.bind(this.elapsed,this),500))},elapsed:function(){this.fire("delayedInput:elapsed",_.extend({value:this.$element.val()},this.options.data||{})),delete this.timeout},destroy:function(){this.stopObserving()}})}(jQuery),function(t){Widget.Paginator=Class.create(Widget.Observer,Widget.Observable,{initialize:function(e,i,s){this.$element=t(e),this.dom=this.$element.getChildren(Widget.Paginator.DOM),this.$element.on("click","a",_.bind(this.click,this));var n=_.detect(this.dom.$pages,function(e){return t(e).hasClass("current")});this.page=n?parseInt(t(n).text().trim(),10):1,this.total=this.dom.$pages.length,i&&this.update(i,s),this.updateButtonsState()},click:function(e){var i,s=t(e.currentTarget);return i=s.hasClass("previous")?Math.max(this.page-1,1):s.hasClass("next")?Math.min(this.page+1,this.total):parseInt(s.text().trim(),10),this.update(i),this.fire("paginator:paged",{page:i}),this.updateButtonsState(),!1},update:function(e,i){var s,n,o=this.dom.$pages.length;if(null==i&&(i=this.total),this.page=e,this.total=i,1>=i)return void this.$element.hide();if(this.$element.show(),this.dom.$pages.show(),o>i){o=i;for(var a,r=i;a=this.dom.$pages[r++];)t(a).hide()}else this.dom.$pages.show();s=Math.max(Math.floor(o/2)-1,0),s>=e&&(s=e-1),n=e-s,n+o>i&&(n=i-o+1),this.dom.$pages.each(function(i,s){var o=n+i;t(s).html(o).toggleClass("current",o===e)})},updateButtonsState:function(){function t(t){t.addClass("disabled").prop("disabled",!0)}function e(t){t.removeClass("disabled").prop("disabled",!1)
}1===this.page?t(this.dom.$prev):e(this.dom.$prev),this.page===this.total?t(this.dom.$next):e(this.dom.$next)}}),Widget.Paginator.DOM={prev:"a.previous",next:"a.next",pages:["a.page"]}}(jQuery),function(t){Widget.CreditCard=Class.create(Widget.Observer,{initialize:function(e,i){this.$element=t(e),this.dom=this.$element.getChildren(Widget.CreditCard.DOM),this.dom.$input.on("keyup",_.bind(this.keyup,this)),this.$element.addRemoveClassNames(Widget.CreditCard.ALL_CLASSES,i),this.dom.$input.val()&&this.dom.$input.val().length>0?this.keyup():this.setType(i)},keyup:function(){var t=this.getType(this.dom.$input.val(),!0).toLowerCase();this.$element.addRemoveClassNames(Widget.CreditCard.ALL_CLASSES,t),this.setType(t)},setType:function(t){("visa"===t||"mastercard"===t)&&this.$element.addClass("ui_dark"),"amex"===t?(this.dom.$cvvLabel.attr("data-default-label")||this.dom.$cvvLabel.attr("data-default-label",this.dom.$cvvLabel.html()),this.dom.$cvvLabel.html(this.dom.$cvvLabel.attr("data-amex-label"))):this.dom.$cvvLabel.attr("data-default-label")&&this.dom.$cvvLabel.html(this.dom.$cvvLabel.attr("data-default-label"))},getType:function(t,e){var i=(t+"").replace(/\s/g,"");return e=e||!1,/^(34|37)/.test(i)&&(15===i.length||e)?"AMEX":/^(22|23|24|25|26|27|51|52|53|54|55)/.test(i)&&(16===i.length||e)?"MasterCard":/^(4)/.test(i)&&(13===i.length||16===i.length||e)?"Visa":/^(300|301|302|303|304|305|36|38)/.test(i)&&(14===i.length||e)?"DinersClub":/^(2014|2149)/.test(i)&&(15===i.length||e)?"enRoute":/^(6011)/.test(i)&&(16===i.length||e)?"Discover":/^(3)/.test(i)&&(16===i.length||e)?"JCB":/^(2131|1800)/.test(i)&&(15===i.length||e)?"JCB":""},destroy:function(){this.stopObserving()}}),Widget.CreditCard.DOM={input:".card-number",cvvLabel:"label[for=service_agreement_credit_card_code]"},Widget.CreditCard.ALL_CLASSES="amex visa discover mastercard ui_dark".split(" ")}(jQuery),function(t){Widget.FormChanger=Class.create({initialize:function(e,i,s){this.$element=t(e),this.$root=t(i),this.changes=s,this.interval=setInterval(_.bind(this.apply,this),200),s["default"]&&this.applyChanges(s["default"]),this.apply()},apply:function(){this.currentValue!==this.$element.val()&&(this.undo(),this.currentValue=this.$element.val(),this.currentChanges=this.changes[this.currentValue],this.currentChanges&&this.applyChanges(this.currentChanges))},undo:function(){this.currentChanges&&(this.undoChanges(this.currentChanges),this.currentChanges=null)},applyChanges:function(t){_.each(t,function(t,e){var i=e,s=t,n=this.$root.find(i);n[0]&&("hide"===s?n.hide():"show"===s?n.show():s.label?n.data("label",n.html()).html(s.label):s.type?n.data("type",n.attr("type")).attr("type",s.type):s.dropdown&&Widget.Dropdown.instances[n.identify()].setItems(s.dropdown,!1,s.noSelection))},this)},undoChanges:function(){_.each(this.currentChanges,function(t,e){var i=e,s=t,n=this.$root.find(i);n[0]&&("hide"===s?n.show():"show"===s?n.hide():s.type?n.attr("type",n.data("type")):s.label&&n.html(n.data("label")))},this)},isHidden:function(t){return this.currentChanges&&this.currentChanges[t]&&"hide"===this.currentChanges[t]},destroy:function(){clearInterval(this.interval)}})}(jQuery),Widget.PieChart=Class.create({initialize:function(t,e,i){this.$element=jQuery(t),this.data=e,this.options=_.extend({startAngle:-Math.PI/2,canvasWidth:160,canvasHeight:120,labelEdgeOffset:-20,labelXOffset:-5,labelYOffset:0,labelShadowOffsetX:1,labelShadowOffsetY:1,labelShadowColor:"rgba(255,255,255,0.9)",labelFont:"12px helvetica neue, sans-serif",labelColor:"#666666",labelBgColor:"rgba(255,255,255,0.9)",labelRadius:I18n.locale.endsWith("-gd")?0:12,labelPadding:5,chartEdgeOffset:15,maxExtension:10,extendSteps:4,animateSpeed:10,updateSteps:80,isDarkBg:!1,showPercents:!1},i||{}),this.initializeCanvas(),this.extendedSectors={names:[]},this.render(),_.delay(_.bind(this.render,this),1e3)},extendSectors:function(t,e){this.extendedSectors.names!==t&&(this.extendedSectors.timeout&&clearTimeout(this.extendedSectors.timeout),this.extendedSectors={names:t,position:0,timeout:null,label:e},this.animateExtension())},cancelExtension:function(){this.extendedSectors.timeout&&clearTimeout(this.extendedSectors.timeout),this.extendedSectors={names:[]},this.render()},animateExtension:function(){return this.extendedSectors.position+=this.options.maxExtension/this.options.extendSteps,this.extendedSectors.position>this.options.maxExtension?void(this.extendedSectors.timeout=null):(this.render(),void(this.extendedSectors.timeout=setTimeout(_.bind(this.animateExtension,this),this.options.animateSpeed)))},updateData:function(t,e){if(this.updatedData&&this.updatedData.timeout&&clearTimeout(this.updatedData.timeout),e)this.data=t,this.numSectors=_.keys(this.data).length,this.render();else{var i=_.keys(this.data);_.each(_.keys(t),function(t){i.push(t)}),this.numSectors=i.length,this.updatedData={data:t,original:_.clone(this.data),sectors:i,steps:0},this.animateUpdate()}},animateUpdate:function(){var t=this.options.updateSteps;if(this.updatedData.steps<t){var e=this.data,i=this.updatedData.original,s=this.updatedData.data;_.each(this.updatedData.sectors,function(n){var o=i[n]||0,a=s[n]||0;e[n]+=(a-o)/t}),this.updatedData.steps++,this.updatedData.timeout=setTimeout(_.bind(this.animateUpdate,this),this.options.animateSpeed)}else this.data=this.updatedData.data,this.updatedData=null;this.render()},initializeCanvas:function(){this.$canvas=jQuery("<canvas>");var t=this.$canvas[0];"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement&&G_vmlCanvasManager.initElement(t),this.canvasWidth=t.width=this.options.canvasWidth,this.canvasHeight=t.height=this.options.canvasHeight,this.centerX=this.canvasWidth/2,this.centerY=this.canvasHeight/2,this.radius=Math.min(this.canvasWidth,this.canvasHeight)/2-this.options.chartEdgeOffset,this.numSectors=_.keys(this.data).length,this.ctx=t.getContext("2d"),this.$element.append(t);var e=this.$canvas.find("div");e[0]&&(e[0].style.width=this.$canvas[0].width+"px",e[0].style.height=this.$canvas[0].height+"px"),this.setHiDPI()},render:function(){this.renderData(),this.renderLabels()},renderData:function(){this.ctx.clearRect(0,0,this.options.canvasWidth,this.options.canvasHeight);var t=0;this.currentAngle=this.options.startAngle;for(var e in this.data){var i=this.data[e],s=360*i/100,n=Math.PI/180*s,o=_.include(this.extendedSectors.names,e)?this.extendedSectors.position:0;this.ctx.fillStyle=this.getRandomBgColor(this.numSectors,t++),this.ctx.beginPath(),this.ctx.moveTo(this.centerX,this.centerY),this.ctx.arc(this.centerX,this.centerY,this.radius+o,this.currentAngle,this.currentAngle+n,!1),this.ctx.lineTo(this.centerX,this.centerY),this.ctx.closePath(),this.ctx.fill(),this.currentAngle+=n}},renderLabels:function(){var t=!1;this.currentAngle=this.options.startAngle;for(var e in this.data)this.data[e]>0&&(this.options.showPercents&&this.renderPercentLabel(this.data[e]),_.include(this.extendedSectors.names,e)&&!t&&(this.renderTextLabel(this.data[e],this.extendedSectors.label||e),this.extendedSectors.label&&(t=!0)),this.currentAngle+=Math.PI/180*(360*this.data[e]/100))},renderPercentLabel:function(t){var e=t.toFixed(t.toFixed(1).endsWith(".0")?0:1)+"%";this.renderLabel({percents:t,text:e,hasBackground:!1,edgeOffset:30,labelColor:this.options.isDarkBg?"#000":"#fff",labelShadowColor:"",labelFont:"12px sans-serif",labelXOffset:0})},renderTextLabel:function(t,e){this.renderLabel({percents:t,text:e,hasBackground:!0,edgeOffset:2>t?this.options.labelEdgeOffset/2:this.options.labelEdgeOffset,labelColor:this.options.labelColor,labelShadowColor:this.options.labelShadowColor,labelFont:this.options.labelFont,labelXOffset:this.options.labelXOffset})},renderLabel:function(t){var e=360*t.percents/100,i=Math.PI/180*e,s=this.currentAngle+i/2,n=this.centerX+Math.round(Math.cos(s)*(this.radius-t.edgeOffset))+t.labelXOffset,o=this.centerY+Math.round(Math.sin(s)*(this.radius-t.edgeOffset))+this.options.labelYOffset;this.ctx.save(),this.ctx.fillStyle=t.labelColor,this.ctx.font=t.labelFont,this.ctx.shadowOffsetX=this.options.labelShadowOffsetX,this.ctx.shadowOffsetY=this.options.labelShadowOffsetY,this.ctx.shadowColor=t.labelShadowColor;var a=this.ctx.measureText?Math.floor(this.ctx.measureText(t.text).width):100,r=12,l=3;t.hasBackground&&(this.ctx.save(),this.ctx.fillStyle=this.options.labelBgColor,this.fillRoundedRect({left:n-a/2-this.options.labelPadding,top:o-r/2-l-this.options.labelPadding,width:a+2*this.options.labelPadding,height:r+2*this.options.labelPadding,radius:this.options.labelRadius}),this.ctx.restore()),this.ctx.fillText&&this.ctx.fillText(t.text,n-a/2,o+2),this.ctx.restore()},getRandomBgColor:function(t,e){for(var i=[],s=20,n=s,o=(100-s)/t;100>n;n+=o)i.push(n);var a=i[e]/100;return this.options.isDarkBg?"rgba(255, 255, 255,"+a+")":"rgba(0, 0, 0,"+a+")"},setHiDPI:function(){var t=window.devicePixelRatio||1,e=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,i=t/e;if(t!==e){var s=this.$canvas.width(),n=this.$canvas.height();this.$canvas.attr({width:s*i,height:n*i}),this.$canvas.css({width:s+"px",height:n+"px"}),this.ctx.scale(i,i)}},destroy:function(){},fillRoundedRect:function(t){var e=t;this.ctx.beginPath(),this.ctx.moveTo(e.left+e.radius,e.top),this.ctx.lineTo(e.left+e.width-e.radius,e.top),this.ctx.quadraticCurveTo(e.left+e.width,e.top,e.left+e.width,e.top+e.radius),this.ctx.lineTo(e.left+e.width,e.top+e.height-e.radius),this.ctx.quadraticCurveTo(e.left+e.width,e.top+e.height,e.left+e.width-e.radius,e.top+e.height),this.ctx.lineTo(e.left+e.radius,e.top+e.height),this.ctx.quadraticCurveTo(e.left,e.top+e.height,e.left,e.top+e.height-e.radius),this.ctx.lineTo(e.left,e.top+e.radius),this.ctx.quadraticCurveTo(e.left,e.top,e.left+e.radius,e.top),this.ctx.fill()}}),Widget.PieChart.supported=function(){var t=document.createElement("canvas");return"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement&&G_vmlCanvasManager.initElement(t),"undefined"!=typeof t&&"undefined"!=typeof t.getContext&&"undefined"!=typeof t.getContext("2d")}(),function(t){Widget.MimiVoice=Class.create(Widget.Popup,{initialize:function($super){this.options={overlay:!1,position:"right farTop",fixedPosition:!1,repositioning:!1,escClose:!1,showMethod:"fadeIn",hideMethod:"fadeOut"},this.$element=t("<div>").attr({"class":"mimi_voice tip positive"}),this.$element.html("<div class='content'><p></p></div>"),this.$element.appendTo("body"),$super(this.$element[0],this.options),this.dom=this.$element.getChildren(Widget.MimiVoice.DOM),this.boundShow=_.bind(this.show,this),this.boundHide=_.bind(this.hide,this),this.$element.on("click",this.boundHide)},show:function($super,t,e){t&&e&&(this.setOptions({anchor:t}),this.dom.$text.html(e)),$super(),this.delayedHide()},delayedShow:function(t,e,i){this.$element.hide(),this.setOptions({anchor:t}),this.dom.$text.html(e),this.timeout&&clearTimeout(this.timeout),this.timeout=_.delay(this.boundShow,i||1e3)},delayedHide:function(t){this.timeout&&clearTimeout(this.timeout),this.timeout=_.delay(this.boundHide,t||12e3)}}).include(Widget.Observer).singleton("show","hide","delayedShow","delayedHide"),Widget.MimiVoice.DOM={text:"div.content p"},Widget.MimiFlash=Class.create(Widget.Observer,Widget.Observable,{initialize:function(e,i){this.options=_.extend({type:"notice",autohide:!0},i||{}),this.$element=t("<div>").attr({"class":"mimi_voice global "+this.options.type}).html(Widget.MimiFlash.TEMPLATE({content:e})),this.$element.appendTo("body"),this.dom=this.$element.getChildren(Widget.MimiFlash.DOM),this.dom.$close.on("click",_.bind(this.hide,this)),t(document).on("flash:hidden",_.bind(this.moveUp,this)),this.index=Widget.MimiFlash.instances.push(this)-1,this.$element.css({top:this.top().px()}),this.show()},show:function(){var t=this.$element.outerWidth();if(this.$element.css({right:(-t).px(!0),display:"block"}),this.$element.animate({right:"0px"},500),this.fire("flash:shown"),this.options.autohide){var e=_.select(Widget.MimiFlash.instances,function(t){return t.visible()}).length;_.delay(_.bind(this.hide,this),1e3*(e+10))}},hide:function(){var t=this.$element.outerWidth(),e=this;return this.$element.animate({right:(-t).px(!0)},500,function(){e.stopObserving(),e.$element.hide(),e.fire("flash:hidden")}),!1},height:function(){return this.$element.outerHeight()},visible:function(){return this.$element.is(":visible")},top:function(){return _.inject(Widget.MimiFlash.instances,function(t,e,i){return!e.visible()||i>this.index-1?t:t+e.height()+20},80,this)},moveUp:function(){this.$element.animate({top:this.top().px()},500)}}),_.extend(Widget.MimiFlash,{instances:[],create:function(t,e){return _.isArray(t)||(t=t.split("\n")),new Widget.MimiFlash("<p>"+t.join("</p><p>")+"</p>",e)},createFromFlash:function(e){return new Widget.MimiFlash(t(e).html())},sticky:function(t,e){return Widget.MimiFlash.create(t,_.extend({autohide:!1},e||{}))},error:function(t,e){return Widget.MimiFlash.create(t,_.extend({type:"error"},e||{}))},TEMPLATE:_.template("<div class='content'>#{content}<a href='#' title='"+I18n.t("js.widgets.mimi_voice.close")+"' class='close'><span>\xd7</span></a></div>"),DOM:{close:"a.close"},AUTOHIDING_TYPES:["notice"]}),t(function(){Widget.MimiFlash.MESSAGES&&0===Widget.MimiFlash.MESSAGES.length||_.each(Widget.MimiFlash.MESSAGES,function(t,e){new Widget.MimiFlash("<p>"+t+"</p>",{type:e,autohide:Widget.MimiFlash.AUTOHIDING_TYPES.indexOf(e)>=0})})})}(jQuery),function(t){Widget.Announcement=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#announcement_banner"),this.dom=this.$element.getChildren(Widget.Announcement.DOM),this.initObservers()},initObservers:function(){this.dom.$closeButton.on("click",_.bind(this.onCloseButtonClick,this))},onCloseButtonClick:function(e){return e.preventDefault(),this.hide(),t.ajax({url:e.currentTarget.href,type:"put"}),!1},hide:function(){this.$element.slideUp()}}).singleton("hide"),Widget.Announcement.DOM={message:"span.message",closeButton:"div.close a"},t(function(){t("#announcement_banner")[0]&&Widget.Announcement.get()})}(jQuery),function($){Widget.ImageUploader=Class.create(Widget.Observer,Widget.Observable,{initialize:function(t,e){this.$element=$(t),this.dom=this.$element.getChildren(Widget.ImageUploader.DOM),this.options=_.extend({dragDrop:!1,disableOnLoad:!1},e||{}),this.options.disableOnLoad&&this.disableUploads(),this.initObservers(),this.options.dragDrop&&this.initDragDrop()},initObservers:function(){this.dom.$form.on("submit",_.bind(this.onSubmit,this)),this.dom.$file.on("change",_.bind(this.setFilename,this))},initDragDrop:function(){window.ondragover=_.bind(this.ondragover,this),window.ondragleave=_.bind(this.ondragleave,this),window.ondrop=_.bind(this.ondrop,this)},ondragover:function(t){t.preventDefault&&t.preventDefault(),this.dom.$list.parent().addClass("over")},ondragleave:function(){this.dom.$list.parent().removeClass("over")},ondrop:function(t){t.preventDefault&&t.preventDefault();var e=t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files[0];return this.uploadFile(e),this.dom.$list.parent().removeClass("over"),!1},uploadFile:function(file){if("undefined"!=typeof FormData&&file&&file.type&&file.type.match(/^image\/.*/)){var formData=new FormData;formData.append("upload[id]",this.dom.$uploadId.val()),formData.append(this.dom.$objectId.prop("name"),this.dom.$objectId.val()),formData.append(_.first(this.dom.$objectId[0].split("["))+"[uploaded_data]",file);var xhr=new XMLHttpRequest;xhr.open("POST",this.dom.$form.attr("action")),xhr.onreadystatechange=function(){if(4===xhr.readyState&&200===xhr.status){var responseScript=xhr.responseText.extractScripts()[0];responseScript=responseScript.replace("parent.jQuery('#uploader_form')","jQuery('#uploader_form')"),eval(responseScript)}},xhr.send(formData),this.$element.trigger("upload:started")}},setFilename:function(){this.dom.$filename.val(this.dom.$file.val()),this.dom.$submit.show(),this.fire("layout:changed")},resetFilename:function(){this.dom.$filename.val(this.dom.$filename.attr("placeholder")),this.dom.$submit.hide()},enableUploads:function(){this.enable(!0)},disableUploads:function(){this.enable(!1)},enable:function(t){this.dom.$browse.toggleClass("disabled",t),this.dom.$file[t?"show":"hide"](),this.disabled=!t},onSubmit:function(){return this.disabled?!1:(this.dom.$submit.hide(),this.$element.trigger("upload:started"),!0)},clear:function(){this.dom.$filename.val("")},destroy:function(){this.stopObserving()}}),Widget.ImageUploader.DOM={iframe:"iframe",form:"form",file:"input[type=file]",filename:".combo_input > input",browse:".combo_input > button",submit:"div > button.upload-image",objectId:"input[type=hidden]",uploadId:"input[name='upload[id]']"}}(jQuery),function(t){Widget.Modal=function(e,i){var s=t(e),n=t('<div class="window_header">'),o=t('<h1 class="window_title">'),a=t('<a class="window_close" title="Close this window">').html("&times;"),r=t('<div class="window_contents">'),l=new Control.Modal(s[0],_.extend({className:"window loading",closeOnClick:a[0],draggable:n[0],overlayOpacity:.75,insertRemoteContentAt:r[0],afterOpen:function(){t(this.container).removeClass("loading"),o.html(s.attr("title"))},onRemoteContentLoaded:function(){t(this.container).removeClass("loading")},onComplete:function(){t(this.container).removeClass("loading")},method:"get",fade:!0},i||{}));return t(l.container).append(n),n.append(o),n.append(a),t(l.container).append(r),l}}(jQuery),function(t){Widget.PostRoute=Class.create({initialize:function(e,i){i=_.extend({method:"post",overlay:Widget.ModalOverlay},i||{});var s=t("<form method='post' style='display:none'>").attr({action:e}),n=t("<input type='hidden' name='_method' value='"+i.method+"'>");s.append(n),t("body").append(s),s.submit(),i.overlay&&i.overlay.show()}})}(jQuery),function(t){Widget.GuideTip=Class.create(Widget.Popup,{initialize:function($super,t,e,i){i=_.extend({offset:"0 10",position:"center farBottom",anchor:e,overlay:!1,fixedPosition:!1,repositioning:!1},i||{}),$super(t,i),this.$element.find(".guide_close").on("click",_.bind(this.dismiss,this))},show:function(){this.options.delay?this.showDelay=_.delay(_.bind(this.appear,this),this.options.delay):this.appear()},appear:function(){clearTimeout(this.showDelay),this.position(),this.$element.show(),this.options.autohide&&(this.hideDelay=_.delay(_.bind(this.hide,this),this.options.autohide))},hide:function(){this.visible()&&(clearTimeout(this.hideDelay),clearTimeout(this.showDelay),this.$element.hide())},dismiss:function(){return this.hide(),this.dismissed=!0,!1}}),Widget.GuideTip.instances={},Widget.GuideTip.show=function(e,i,s){var n=Widget.GuideTip.instances[t(e).identify()];n?n.setOptions(_.extend({anchor:i},s||{})):(n=new Widget.GuideTip(e,i,s),Widget.GuideTip.instances[t(e).identify()]=n),n.dismissed||n.show()},Widget.GuideTip.hide=function(e){var i=Widget.GuideTip.instances[t(e).identify()];i&&i.hide()}}(jQuery),Mimi.Modules={},Mimi.Modules.preloadedPagination=function(t){function e(){return o.find(".row:visible:first").data("page-id")}function i(){o.find(".row").hide()}function s(t){o.find(".row[data-page-id="+t+"]").show()}function n(t,e,i){if(1>=i)return void t.html("");var s=4,n=s/2,o=e-n;1>o&&(o=1);var a=e+(s-(e-o));a>i&&(a=i);var r=[];r.push(1===e?'<a href="#" class="previous btn subtle icon disabled" data-page-id="'+(e-1)+'"><span>Previous</span></a>':'<a href="#" data-page-id="'+(e-1)+'" class="previous btn subtle icon"><span>Previous</span></a>');for(var l=o;a>=l;l++)r.push(e===l?'<span class="page current">'+l+"</span>":'<a href="#" class="page" data-page-id="'+l+'">'+l+"</a>");r.push(e===i?'<a href="#" class="next btn subtle icon disabled" data-page-id="'+(e+1)+'"><span>Next</span></a>':'<a href="#" class="next btn subtle icon" data-page-id="'+(e+1)+'"><span>Next</span></a>'),t.html(r.join(" "))}var o,a,r,l={};return l.init=function(l,d,h){o=l,a=d,r=h,a.on("click","a",function(o){o.preventDefault();var l=t(o.currentTarget),d=l.data("page-id");i(),s(d),n(a,e(),r)}),n(a,e(),r)},l}(jQuery),function(t){Mimi.AudienceListSelect=Class.create(Widget.Dropdown,{initialize:function($super,t,e){this.options=_.extend({ajaxCreateLists:!1,onListCreated:function(){},itemTextTemplate:Mimi.AudienceListSelect.ITEM_TEXT_FORMAT_WITH_SMALL_TEMPLATE},e||{}),$super(t,this.options),this.dom=_.extend(this.dom,this.dom.$container.getChildren(Mimi.AudienceListSelect.BUTTON_DOM)),this.dom=_.extend(this.dom,this.dom.$menu.getChildren(Mimi.AudienceListSelect.MENU_DOM)),this.dom.$createList[0]&&this.initializeCreateList(),this.originalText=this.getText(),this.initObservers();try{this.setSelection(Mimi.Audience.Data.listId)}catch(i){}},initObservers:function(){t(document).on("audience_list:add_or_update",_.bind(this.onAddOrUpdateItem,this)),t(document).on("audience:members:added",_.bind(this.clearNewListName,this)),t(document).on("audience:member:added",_.bind(this.clearNewListName,this)),t(document).on("audience:list_count:updated",_.bind(this.onListCountUpdated,this)),t(document).on("audience_list:context_changed",_.bind(this.onListContextChange,this)),t(document).on("audience_list:created",_.bind(this.onListAdded,this)),t(document).on("audience_list:updated",_.bind(this.onListUpdated,this)),t(document).on("audience_list:deleted",_.bind(this.onListDeleted,this))},initializeCreateList:function(){this.dom.$addButton.on("click",_.bind(this.createList,this)),this.dom.$listName.on("keydown",_.bind(this.createListKeydown,this))},onListContextChange:function(t,e){this.setSelection(e.listId)},onListCountUpdated:function(e,i){var s=i.list,n=this.getItem(s.id);t("span.select").each(function(){var e=t(this).find("span.name"),i=t(this).find("span.count");e[0]&&i[0]&&e.html().trim()===s.name&&i.html(s.size)}),this.updateItem(n,s.name,s.size)},onListUpdated:function(t,e){if(!this.listAlreadySelected(t,e)){var i=e,s=this.addOrUpdateItem(i.id,i.name,i.size);(this.getValue()==i.id||void 0!=this.dom.$button.last().find(".name")&&this.dom.$button.last().find(".name").text()==i.name)&&this.setSelection(s)}},listAlreadySelected:function(t,e){return"audience_list:updated"===t.eventName&&!this.getItem(e.id)},onListAdded:function(t,e){this.options.onListAdded?this.options.onListAdded(t,e):this.onListUpdated(t,e)},onListDeleted:function(t,e){var i=this.getItem(e.listId);this.removeItem(i)},createList:function(){var e=t.trim(this.dom.$listName.val());return e.blank()?(this.dom.$listName.addClass("error"),!1):(this.options.ajaxCreateLists?Mimi.Signups.Edit.get().addCustomList(e):(this.setAudienceList(""),this.setAddList(e),this.setText(this.options.itemTextTemplate({name:e,count:0})),this.fire("audience_list:list_created",{name:e}),this.options.onListCreated(e)),void this.hide())},createListKeydown:function(t){return 13===t.keyCode?(this.createList(),!1):void this.dom.$listName.removeClass("error")},onListCreated:function(t){this.options.onListCreated(t.id,t.name)},clearNewListName:function(){this.dom.$listName.val("")},addItem:function(t,e,i,s){i=i||0,s||(s=Mimi.AudienceListSelect.NEW_LIST_TEMPLATE),this.dom.$list.append(s({id:t,name:e,count:i.formatThousands()}));var n=this.dom.$list.last().find("a");return n.attr("data-name",e),n},removeItem:function(e){return t(e).parents("li:eq(0)").remove()},updateItem:function(e,i,s){return e?(1!==e.nodeType&&(e=this.getItem(e)),t(e).find("span.name").html(i),t(e).find("span.count").html(s.formatThousands()),e):null},addOrUpdateItem:function(t,e,i){var s,n=t;return!t||e||i||(n=t.id,e=t.name,i=t.count||t.size||0),s=this.getItem(n),s?this.updateItem(s,e,i):this.addItem(n,e,i)},onAddOrUpdateItem:function(t,e){this.clearNewListName(),this.addOrUpdateItem(e),this.clearSelection()},clearSelection:function(){this.setSelection(!1)},getItemText:function(t){return this.options.itemTextTemplate(this.getItemData(t))},setSelection:function($super,t,e,i){this.dom.$addList&&(t?1!==t.nodeType||t.getAttribute("data-value")?Mimi.AudienceList.Salesforce.salesforceList(t)?(this.setAddList(""),$super("all",e,i)):(this.setAddList(""),$super(t,e,i)):(this.setAddList(t.getAttribute("data-name")),$super(t,e,i)):(this.setAddList(""),$super(t,!1,this.originalText)))},getAudienceList:function(){return this.getValue()},getAddList:function(){return this.dom.$addList.val()},setAudienceList:function(t){this.setValue(t)},setAddList:function(t){this.dom.$addList.val(t)},getItemData:function(e){var i=t(e).find(".count").text().parseInt(),s=t(e).find("a")[0]?t(e).find("a"):t(e);return{id:s.data("value"),name:t(e).find(".name").text(),count:i,size:i}},disable:function(){this.dom.$button.disable(),this.dom.$button.addClass("disabled")},enable:function(){this.dom.$button.enable(),this.dom.$button.removeClass("disabled")}}),_.extend(Mimi.AudienceListSelect,{addOrUpdateItem:function(e,i,s){e&&i&&s&&(e={id:e,name:i,count:s}),t(document).trigger("audience_list:add_or_update",e)},BUTTON_DOM:{addList:"input[name=add_list]"},MENU_DOM:{createList:".create_list",listName:".create_list input",addButton:".create_list button"},NEW_LIST_TEMPLATE:_.template('<li data-value="#{id}"><a href="#" data-value="#{id}"><span class="count">#{count}</span><span class="name hide_overflow">#{name}</span></a></li>'),ITEM_TEXT_FORMAT_WITH_SMALL_TEMPLATE:_.template("#{name}<small>#{count}</small>"),ITEM_TEXT_FORMAT_WITH_SPAN_TEMPLATE:_.template('<span class="count">#{count}</span><span class="name hide_overflow">#{name}</span>')})}(jQuery),function(t,e){e.Time={MONTHS:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),shift:function(){t(".timeshift").each(function(){var e=t(this);if(!e.data("date")){var i=new Date(e.text());"Invalid Date"!==String(i)&&e.html(Time.formatDate(i)).data("date",i)}})},formatDate:function(t){var e,i="am";return e=t.getHours(),e>12&&(i="pm",e-=12),Time.MONTHS[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()+" @"+e+":"+t.getMinutes().leadingZero()+i},offset:function(){document.cookie="timezone_offset="+-60*(new Date).getTimezoneOffset()}},t(function(){Time.offset(),Time.shift()})}(jQuery,this),Mimi.AudienceList={},function(t){Mimi.AudienceList.List=Class.create({initialize:function(){this.$element=t("#audience_lists"),this.dom=this.$element.getChildren(Mimi.AudienceList.List.DOM),this.data={currentList:this.initialList(),countedLists:[]},this.initObservers(),this.firstLoad=!0,this.waiting=!1,this.determineInitialState()},initObservers:function(){this.$element.on("click","a",_.bind(this.onClick,this)),t(document).on("audience:list_count:updated",_.bind(this.onListCountUpdated,this)),t(document).on("audience:list_count:bulk_updated",_.bind(this.onListCountBulkUpdated,this)),t(document).on("audience_list:deleting",_.bind(this.onListDeleting,this)),t(document).on("audience_list:delete:failure",_.bind(this.onListDeleteFailure,this)),t(document).on("audience_list:force_selection:first",_.bind(this.onForceFirstListSelection,this)),t(document).on("audience_list:deleted",_.bind(this.onForceListSelection,this)),t(document).on("suppression_reason:selected",_.bind(this.onSuppressionSelected,this)),t(document).on("suppression_reason:unselected",_.bind(this.onSuppressionUnselected,this)),t(document).on("audience_loader:loading",_.bind(this.onAudienceLoading,this)),t(document).on("audience_loader:complete",_.bind(this.onAudienceLoaded,this)),t(document).on("audience_loader:success",_.bind(this.onListLoaded,this)),t(document).on("audience_list:created",_.bind(this.onListCreated,this)),t(document).on("audience_list:updated",_.bind(this.onListUpdated,this)),t(document).on("audience_list:destroyed",_.bind(this.onListDestroyed,this)),t(window).on("popstate",_.bind(this.onPopState,this))},initialList:function(){var t=this.dom.$audienceListContainer.find("a");return t.attr("data-value")},determineInitialState:function(){var t=_.keys(State.getHash())[0],e="audience_list_";if(t||(t="audience_list_"+this.initialList()),t.startsWith(e)){var i=t.replace(e,"");this.setSelected(this.parsifyListId(i))}},onAudienceLoaded:function(){this.waiting=!1},onAudienceLoading:function(){this.waiting=!0},onListCreated:function(t,e){this.tryInsertNewList(e)},onListUpdated:function(t,e){var i=this.findList(e.listId||e.id)||this.tryInsertNewList(e);i.find("span.list_name").html(e.name).attr("title",e.name),i.find("span.count").html(e.size)},onListDestroyed:function(t,e){this.data.currentList===e.id&&this.selectFirstList();var i=this.findList(e.id);if(i[0]){var s=i.closest("li");s.is(":visible")?s.slideUp(300,_.bind(s.remove,s)):s.remove()}},onListDeleting:function(t,e){var i=this.findList(e.listId);i.parents("li:eq(0)").slideUp(300)},onListDeleteFailure:function(t,e){var i=this.findList(e.listId);i.parents("li:eq(0)").slideDown(300),Widget.MimiFlash.error(I18n.t("MimiFlash.audience_list.list.onListDeleteFailure"))},onClick:function(e){var i=t(e.currentTarget).attr("data-action");return"load"===i?(this.onListSelected(t(e.currentTarget)),!1):void 0},onListLoaded:function(t,e){if("suppressed"!=e.listId){var i=e.search,s=e.count,n={id:e.listId,size:s,search:i};this.setListSize(n)}},onListCountUpdated:function(t,e){this.setListSize(e.list),this.tryInsertNewList(e.list),this.incrementAllList(e.new_members)},onListCountBulkUpdated:function(t,e){if(e.lists){var i=this;_.each(e.lists,function(t){i.setListSize(t)})}},tryInsertNewList:function(e){e&&!this.hasList(e.id)&&t(document).trigger("audience_list:async_created",{id:e.id,name:e.name,size:e.size,crm:e.crm})},hasList:function(t){var e=this.findList(t);return e[0]?!0:!1},findList:function(t){var e="a[data-value="+t+"]",i=this.dom.$audienceListContainer.find(e);return i[0]||(i=this.dom.$automaticListContainer.find(e)),i[0]||(i=this.dom.$salesforceListContainer.find(e)),i[0]||(i=this.dom.$zohoListContainer.find(e)),i},incrementAllList:function(t){if(t&&!isNaN(t)){var e=this.dom.$allList.find("span.count"),i=e.html().parseInt()+t,s=i.formatThousands();e.html(s)}},setListSize:function(t){if(t&&this.hasList(t.id)){var e=this.findList(t.id).find("span.count"),i=t.size,s=i.formatThousands();if(t.search){this.storeMetaCount(e);var n=I18n.t(1===i?"js.audience_list.list.search.one":"js.audience_list.list.search.more");s=s+" "+n}e.html(s)}},storeMetaCount:function(t){var e=t.html(),i=/match/i;i.test(e)||t.attr("data-precount",e)},onForceListSelection:function(t,e){this.data.currentList===e.listId&&this.onForceFirstListSelection()},onForceFirstListSelection:function(){var t=this.findFirstList();t[0]&&this.setSelected(t.attr("data-value"))},findFirstList:function(){var t=this.dom.$audienceListContainer.find("a[data-action=load]");return t},onListSelected:function(e){if(this.waiting&&(t(document).trigger("audience_loader:interrupted"),this.waiting=!1),"load"===e.attr("data-action")){var i=e.attr("data-value");return this.setUrl(e.attr("href"),{type:"list:selected",value:i}),this.updateSelectedUi(i,!0),this.updateListCount(i),!1}},updateListCount:function(e){if(this.data.countedLists[e])this.setSelected(e);else{this.data.countedLists[e]=!0;var i="/audience_lists/"+e+"/list_size";t.get(i).done(_.bind(function(t){this.updateListCountSuccess(t,e)},this)).fail(_.bind(function(){this.setSelected(e)},this))}},updateListCountSuccess:function(t,e){if(t.result){var i=t.result.count,s=this.findList(e);if(s[0]){var n=s.parent("li:eq(0)");n.find("span.count").html(i),this.setSelected(e)}}},setSelected:function(t){var e=this.updateSelectedUi(t);if(e&&0!=e.length){null!=this.data.currentList&&this.tryResetToPreCount(this.findList(this.data.currentList));var i=e.find("span.count").html().trim();this.setCurrentList(t),this.triggerListSelected(t,i)}},tryResetToPreCount:function(t){var e=t.find("span.count"),i=e.html(),s=e.attr("data-precount")||"",n=/match/i;n.test(i)&&s.trim().length>0&&e.html(s).attr("data-precount","")},parsifyListId:function(t){var e=parseInt(t,10);return isNaN(e)?t:e},updateSelectedUi:function(e){var i=this.findList(e),s=i.parent("li:eq(0)");return i[0]?(t(document).trigger("audience_loader:loading",{page:1}),t("#audience_lists li.current").removeClass("current"),s.addClass("current"),s):null},triggerListSelected:function(e,i){Mimi.Audience.Data.listId=e,t(document).trigger("audience_list:context_changed",{listId:e,count:i}),"all"===e||"signups"===e||"suppressed"===e?t(document).trigger("audience_list:selected:automatic_list",{id:e,page:1,count:i}):t(document).trigger("audience_list:selected",{id:e,page:1,count:i})},setCurrentList:function(t){this.data.currentList=t},getCurrentList:function(){return this.data.currentList},setUrl:function(t,e){"undefined"!=typeof history&&history.pushState&&history.pushState(e,"",t)},onSuppressionSelected:function(t,e){if(!e.silent&&this.isAppropriateForUrlSetting(e.reason)){var i=document.URL.replace(/#.*$/,"")+"#"+encodeURIComponent(e.reason);
this.setUrl(i,{type:"suppression:selected",value:e.reason})}},isAppropriateForUrlSetting:function(t){var e=["Unsubscribed","By me","Unconfirmed","Marked as spam","Hard bounce","Soft bounce","General bounce","Still trying","Mail block","Auto reply"];-1===e.indexOf(t)},onSuppressionUnselected:function(t,e){if(!e.silent){var i=document.URL.replace(/#.*$/,"");this.setUrl(i,{type:"suppression:unselected",value:e.reason})}},onPopState:function(t){return this.firstLoad?(this.firstLoad=!1,void this.onFirstPopState()):void this.onConsequentPopstate(t)},onFirstPopState:function(){var t=/#audience_list_(\d+)/.exec(document.location.hash),e=t&&t[1];e&&(history.replaceState({type:"list:selected",value:e},"",document.URL),parseInt(e,10)!==this.getCurrentList()&&this.setSelected(e))},onConsequentPopstate:function(t){if(t.state)switch(t.state.type){case"list:selected":this.setSelected(t.state.value);break;case"suppression:selected":Mimi.Audience.SuppressionReason.get().selectFilter(t.state.value,{silent:!0});break;case"suppression:unselected":Mimi.Audience.SuppressionReason.get().unselectFilter(t.state.value,{silent:!0})}else this.setSelected("all")}}).singleton(),Mimi.AudienceList.List.DOM={zohoListContainer:"#zoho_crm_audience_lists",audienceListContainer:"#audience_list_container",automaticListContainer:"#audience_auto_lists",salesforceListContainer:"#salesforce_lists",allList:"#audience_list_container a[data-value=all]"}}(jQuery),function(t){Mimi.AudienceList.NewList=Class.create({initialize:function(){this.$element=t("#audience_lists"),this.dom=this.$element.getChildren(Mimi.AudienceList.NewList.DOM),this.initObservers()},initObservers:function(){this.dom.$submit.on("click",_.bind(this.onNewListSubmit,this)),t(document).on("keyup",_.bind(this.onKeyUp,this)),t(document).on("click",_.bind(this.tryClickHide,this)),t(document).on("audience_list:async_created",_.bind(this.onAsyncListCreated,this))},tryClickHide:function(e){this.$element.find("#audience_new_list").is(":visible")&&!t(e.target).closest(this.$element).length&&this.dom.$newAudienceList.hide()},onAsyncListCreated:function(t,e){this.insertList(e.id,e.name,e.crm,e.size)},onKeyUp:function(t){27===t.keyCode&&this.dom.$newAudienceList.hide()},insertList:function(t,e,i,s,n){n="undefined"==typeof n?"deletable":n;var o=Template.from("audience_list_template")({id:t,name:e,size:s,crm:i,delete_data_property:n});this.dom.$newAudienceList.after(o)},nameIsBlank:function(){return 0===this.dom.$newAudienceList.find("#audience_list_name").val().trim().length},onNewListSubmit:function(){var e=this.dom.$newAudienceList.find("form");return this.dom.$newAudienceList.hide(),this.nameIsBlank()?void 0:(t.ajax({url:e.attr("action"),type:e.attr("method"),data:e.serialize()}).done(_.bind(this.onNewListSubmitSuccess,this)).fail(_.bind(this.onNewListSubmitFailure,this)),!1)},onNewListSubmitSuccess:function(e){e.success?(this.dom.$newAudienceList.find("form")[0].reset(),t(document).trigger("audience_list:created",{id:e.result.id,name:e.result.name,size:e.result.size})):Widget.MimiFlash.error(I18n.t("MimiFlash.audience_list.new_list.onNewListSubmitSuccess")+" "+e.error)},onNewListSubmitFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.audience_list.new_list.onNewListSubmitFailure"))}}).singleton(),Mimi.AudienceList.NewList.DOM={newAudienceList:"#audience_new_list",allList:"#audience_list_container a[data-value=all]",submit:'button[type="submit"]'}}(jQuery),function(t){Mimi.AudienceList.UpdateList=Class.create({initialize:function(){this.$element=t("#audience_lists"),this.initConfirmations(),this.initObservers(),this.data={listId:null}},initConfirmations:function(){this.confirmations={deleteDialog:new Widget.ConfirmDialog({onOk:_.bind(this.onListDelete,this)})}},initObservers:function(){this.$element.on("click","button",_.bind(this.onListClick,this)),this.$element.on("click","button.update_list",_.bind(this.onSubmitListName,this)),this.$element.on("keypress","input.update_list",_.bind(this.keyupHandler,this)),t(document).on("keyup",_.bind(this.onKeyUp,this)).on("click",_.bind(this.tryClickHide,this))},tryClickHide:function(e){var i=t("#audience_lists span.update_audience_list:visible");i[0]&&!t(e.target).find(this.$element)[0]&&this.hideVisibleEditForms()},keyupHandler:function(t){return 13===t.keyCode?(this.submitUpdateForm(t.target),!1):void 0},onSubmitListName:function(t){return this.submitUpdateForm(t.target),!1},submitUpdateForm:function(e){var i=t(e).parents("form:eq(0)"),s=i.attr("data-action");"edit:list"===s&&t.ajax({url:i.attr("action"),type:i.attr("method"),data:i.serialize()}).done(_.bind(this.onSubmitListNameSuccess,this)).fail(_.bind(this.onSubmitListNameFailure,this))},onSubmitListNameSuccess:function(e){if(e.success){t(document).trigger("audience_list:updated",e.result);var i=_.template(I18n.t("MimiFlash.audience_list.update_list.onSubmitListNameSuccessTemplate")),s=i({list_name:e.result.name});Widget.MimiFlash.create(s),this.hideVisibleEditForms()}else Widget.MimiFlash.error(I18n.t("MimiFlash.audience_list.update_list.onSubmitListNameSuccess")+" "+e.error)},onSubmitListNameFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.audience_list.update_list.onSubmitListNameFailure"))},onKeyUp:function(t){27===t.keyCode&&this.hideVisibleEditForms()},onListClick:function(e){var i=t(e.currentTarget),s=i.attr("data-action");if("edit"===s)this.onListEdit(i);else if("delete"===s){var n=i.attr("data-property");"deletable"===n?(this.data.listId=i.attr("data-value"),this.confirmations.deleteDialog.show(I18n.t("MimiFlash.audience_list.update_list.onListClick.title"),I18n.t("MimiFlash.audience_list.update_list.onListClick.confirm")+'<p class="info">'+I18n.t("MimiFlash.audience_list.update_list.onListClick.info")+"</p>")):"both"==n?Widget.MimiVoice.get().show(i.parents("li:eq(0)")[0],I18n.t("MimiFlash.audience_list.update_list.onListClick.has_trigger_and_drip")):"trigger"==n?Widget.MimiVoice.get().show(i.parents("li:eq(0)")[0],I18n.t("MimiFlash.audience_list.update_list.onListClick.has_trigger")):Widget.MimiVoice.get().show(i.parents("li:eq(0)")[0],I18n.t("MimiFlash.audience_list.update_list.onListClick.denied"))}return!1},hideVisibleEditForms:function(){var e=this;t(".update_audience_list").each(function(i,s){e.toggleFormAndSiblings(t(s),!1),t(s).closest("li").removeClass("editing")})},onListEdit:function(t){this.hideVisibleEditForms();var e=t.parents("li:eq(0)").find(".update_audience_list");this.toggleFormAndSiblings(e,!0),e.find("input.name_field").select()},toggleFormAndSiblings:function(t,e){e?t.show().siblings().hide():t.hide().siblings().show()},onListDelete:function(){var e="/audience_lists/"+this.data.listId+".json";t(document).trigger("audience_list:deleting",{listId:this.data.listId}),t.ajax({url:e,type:"delete",dataType:"json"}).done(_.bind(this.onDeleteSuccess,this)).fail(_.bind(this.onDeleteFailure,this))},onDeleteSuccess:function(){Widget.MimiFlash.create("Audience list deleted."),t(document).trigger("audience_list:deleted",{listId:this.data.listId})},onDeleteFailure:function(){t(document).trigger("audience_list:failure",{id:this.data.listId})}}).singleton()}(jQuery),function(t){Mimi.AudienceList.ZohoAudienceList=Class.create(Widget.Observer,Widget.Observable,{initialize:function(e){return this.$element=t(e),this.$element[0]?(this.$refreshButton=t("#zoho_crm_refresh_button"),this.$listItems=t("#zoho_auto_lists li"),void this.initObservers()):!1},initObservers:function(){this.$refreshButton.on("click",_.bind(this.onClick,this)),t(document).on("import:started",_.bind(this.startedImport,this)),t(document).on("import:finished",_.bind(this.finishedImport,this)),t(document).on("import:failed",_.bind(this.failedImport,this))},onClick:function(){return this.isBusy?void 0:(t.post("/zoho_crm_import/").done(function(){Widget.Observable.fire("import:started")}),!1)},isBusy:!1,startedImport:function(){this.isBusy=!0,this.$listItems.addClass("busy").removeClass("ready"),this.$refreshButton.addClass("disabled")},finishedImport:function(){this.isBusy=!1,this.$listItems.addClass("ready").removeClass("busy"),this.$refreshButton.removeClass("disabled")},failedImport:function(){this.isBusy=!1,this.$listItems.addClass("ready").removeClass("busy"),t("#zoho_crm_refresh_button").hide(),t("#zoho_crm_config_button").show()}}),t(function(){Mimi.AudienceList.zoho_audience_list=new Mimi.AudienceList.ZohoAudienceList("#zoho_crm_audience_lists")})}(jQuery),function(t){Mimi.AudienceList.Salesforce=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#audience_lists"),this.dom=this.$element.getChildren(Mimi.AudienceList.Salesforce.DOM),this.initializeObservers()},initializeObservers:function(){t(document).on("audience_list:context_changed",_.bind(this.toggleSalesforceListSelectVisibility,this)),t("#audience_add_contacts").click(_.bind(this.hideSalesforceListSelect,this)),this.dom.$newListButton.click(_.bind(this.onNewListButtonClick,this)),this.dom.$newListSubmit.click(_.bind(this.onNewListSubmit,this)),t(document).keyup(_.bind(this.onKeyUp,this)),t(document).click(_.bind(this.tryClickHide,this))},toggleSalesforceListSelectVisibility:function(e,i){this.dom.$salesforceLists.find("a[data-value="+i.listId+"]").length?t(".salesforce_list_select").show():this.hideSalesforceListSelect()},hideSalesforceListSelect:function(){t(".salesforce_list_select").hide()},onNewListButtonClick:function(t){t.preventDefault(),this.dom.$newAudienceList.show(),this.dom.$newListName.focus()},nameIsBlank:function(){return 0==this.dom.$newListName.val().trim().length},onNewListSubmit:function(e){e.preventDefault();var i=this.dom.$newAudienceList.find("form");this.dom.$newAudienceList.hide(),this.nameIsBlank()||t.ajax({url:i.attr("action"),type:i.attr("method"),data:i.serialize()}).done(_.bind(this.onNewListSubmitSuccess,this)).fail(_.bind(this.onNewListSubmitFailure,this))},onNewListSubmitSuccess:function(t){t.success?(this.dom.$newAudienceList.find("form")[0].reset(),this.tryInsertNewList(t.result),this.addToAudienceListDropdowns(t.result),this.salesforceListCurrentlySelected()||this.hideSalesforceListSelect()):Widget.MimiFlash.error(I18n.t("MimiFlash.audience_list.new_list.onNewListSubmitSuccess")+" "+t.error)},tryInsertNewList:function(e){if(e&&!Mimi.AudienceList.List.get().hasList(e.id)){var i=_.template(t("#salesforce_list_template").html())(e);this.dom.$newAudienceList.after(i)}},addToAudienceListDropdowns:function(t){var e=t.id,i=t.name,s=t.size;Mimi.Audience.Dashboard.List.get().rowListSelect.addItem(e,i,s,Mimi.AudienceList.Salesforce.NEW_LIST_TEMPLATE),Mimi.Audience.Dashboard.Bulk.get().listChooser.addItem(e,i,s,Mimi.AudienceList.Salesforce.NEW_LIST_TEMPLATE)},salesforceListCurrentlySelected:function(){return 1==t(".salesforce_lists li.current").length},onNewListSubmitFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.audience_list.new_list.onNewListSubmitFailure"))},onKeyUp:function(t){27==t.keyCode&&this.dom.$newAudienceList.hide()},tryClickHide:function(e){this.dom.$newAudienceList.is(":visible")&&!t(e.target).closest(this.$element).length&&this.dom.$newAudienceList.hide()},salesforceList:function(e){return"string"!=typeof e?!1:t(".salesforce_lists a[data-value="+e+"]").length>0}}).singleton("salesforceList"),Mimi.AudienceList.Salesforce.DOM={newListButton:"#add_salesforce_list",newAudienceList:"#salesforce_new_list",newListName:"#salesforce_list_name",newListSubmit:"#new_salesforce_list button",salesforceLists:"#salesforce_lists"},_.extend(Mimi.AudienceList.Salesforce,{NEW_LIST_TEMPLATE:_.template('<li class="salesforce_list_select" data-value="#{id}" style="display:none;"><a href="#" data-value="#{id}"><span class="count">#{count}</span><span class="name hide_overflow">#{name}</span></a></li>')})}(jQuery),Mimi.Dashboard={},function(t){Mimi.Dashboard.PromotionItem=Class.create(Widget.Observable,Widget.Observer,{initialize:function(e){this.$element=t(e),this.dom=this.$element.getChildren(this.constructor.DOM),this.initializeData(),Mimi.Dashboard.PromotionItem.collection[this.id]=this,this.stats=new Mimi.Dashboard.PromotionItemStats(this),this.fire("dashboard:item:changed",{change:"created"}),this.shareSelect=new Widget.Select(this.dom.$shareBtn[0],{position:"center fartop",onShown:_.bind(this.showShare,this),onHidden:_.bind(this.hideShare,this)}),this.dom.$pauseBtn[0].onclick=null,this.dom.$deliverBtn[0].onclick=null,this.dom.$cancelBtn[0].onclick=null},initializeData:function(){this.$element.data("promotion_item",this),this.id=parseInt(_.last(this.$element.identify().split("_")),10),this.name=this.$element.find("h3 a span:eq(0)").text().trim()},showShare:function(){return this.dom.$shareBtn.find("button").addClass("show"),t(this.shareSelect.dom.menu).find("input").select(),!0},hideShare:function(){return this.dom.$shareBtn.find("button").removeClass("show"),!0},busy:function(t){this.hidden=[this.dom.$deleteBtn,this.dom.$statsChart,this.dom.$statsList],_.invoke(this.hidden,"hide"),this.header=this.dom.$statsHeader.text(),this.dom.$statsHeader.html(t),Widget.Overlay.get().darken().show()},normal:function(){_.invoke(this.hidden,"show"),this.dom.$statsHeader.html(this.header)},hide:function(){this.$element.hide(),this.fire("dashboard:item:changed",{change:"hidden"})},show:function(){this.$element.show(),this.fire("dashboard:item:changed",{change:"shown"})},visible:function(){return this.$element.is(":visible")},pause:function(){t.post(this.dom.$pauseBtn.attr("href")+".json").done(_.bind(this.onPauseSuccess,this)).fail(_.bind(this.onPauseFailure,this)),this.disableDeliveringButtons()},onPauseSuccess:function(t){t.success?this.stats.setData(t.result):Widget.MimiFlash.error(I18n.t("MimiFlash.dashboard.promotion_item.onPauseSuccess")+"\n"+t.error)},onPauseFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.dashboard.promotion_item.onPauseFailure"))},deliver:function(){t.post(this.dom.$deliverBtn.attr("href")+".json").done(_.bind(this.onDeliverSuccess,this)).fail(_.bind(this.onDeliverFailure,this)),this.disableDeliveringButtons()},onDeliverSuccess:function(t){t.success?(this.stats.setData(t.result),t.result.alert&&Widget.MimiFlash.error(t.result.alert)):Widget.MimiFlash.error(I18n.t("MimiFlash.dashboard.promotion_item.onDeliverSuccess")+"\n"+t.error)},onDeliverFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.dashboard.promotion_item.onDeliverFailure"))},cancel:function(){t.post(this.dom.$cancelBtn.attr("href")+".json").done(_.bind(this.onCancelSuccess,this)).fail(_.bind(this.onCancelFailure,this)),this.disableDeliveringButtons()},onCancelSuccess:function(t){t.success?this.stats.setData(t.result):Widget.MimiFlash.error(I18n.t("MimiFlash.dashboard.promotion_item.onCancelSuccess")+"\n"+t.error)},onCancelFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.dashboard.promotion_item.onCancelFailure"))},trash:function(){this.$element.fadeSlide(),this.trashed=!0,this.fire("dashboard:item:changed",{change:"trashed",id:this.id})},untrash:function(){this.$element.appearSlide(),this.trashed=!1,this.fire("dashboard:item:changed",{change:"untrashed",id:this.id})},cloneItem:function(e,i,s,n){("self"===e||"admin_clone"==e)&&this.updateDomAndFlashUserOnCloneToSelf();var o="/promotions/"+this.id+"/async_clone.json";t.post(o,{"new_owner_ids[]":i,new_owner_email:n,force:s,new_owner_type:e}).done(_.bind(function(t,s,n){this.handleCloneSuccess(t,s,n,e,i)},this)).fail(_.bind(function(t){this.handleCloneFailure(t,e)},this))},handleCloneSuccess:function(t,e,i,s,n){if(this.fire("promotion:clone:complete",{response:t}),t.success)"self"===s?this.handleSelfCloneSuccess(t,e,i):"child"===s?this.handleChildCloneSuccess(t,e,i):"drip_campaign"===s?this.handleDripCampaignCloneSuccess(t,e,i):"admin_clone"===s&&this.handleAdminCloneSuccess(t,e,i);else{var o=I18n.t("MimiFlash.dashboard.promotion_item.handleCloneSuccess");t.warning?new Widget.ConfirmDialog({onOk:_.bind(function(){this.confirmClone(s,n)},this)}).show(o,t.warning):(new Widget.ConfirmDialog).show(o,t.error)}},handleChildCloneSuccess:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.dashboard.promotion_item.handleChildCloneSuccess"))},handleDripCampaignCloneSuccess:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.dashboard.promotion_item.handleDripCampaignCloneSuccess"))},handleCloneFailure:function(t){Widget.MimiFlash.error(I18n.t("MimiFlash.dashboard.promotion_item.handleCloneFailure")),this.fire("promotion:clone:error",{response:t})},confirmClone:function(t,e){this.cloneItem(t,e,!0)},updateDomAndFlashUserOnCloneToSelf:function(){this.dom.$cloneText.html(I18n.t("MimiFlash.dashboard.promotion_item.cloneTextCloning")),this.dom.$cloneBtn.addClass("show");var t=_.template(I18n.t("MimiFlash.dashboard.promotion_item.updateDomAndFlashUserOnCloneToSelf")),e=t({promotion:"<i>"+this.name+"</i>"});this.cloneFlash=Widget.MimiFlash.create(e),this.$element.addClass("clone_original")},handleSelfCloneSuccess:function(e,i,s){try{this.dom.$cloneText.html(I18n.t("js.dashboard.promotion_item.handleSelfCloneSuccess")),s.item&&s.item.parentNode&&t(s.item).remove(),this.fire("dashboard:search:selection"),s.completedCallback&&s.completedCallback(e),this.dom.$cloneBtn.removeClass("show"),t(document).trigger("dashboard:item:cloned",{data:e.result,group:appView.promotionList.findById(this.id).get("group")}),this.cloneFlash.hide();var n=_.template(I18n.t("MimiFlash.dashboard.promotion_item.handleSelfCloneSuccess")),o=n({promotion:"<i>"+this.name+"</i>"});Widget.MimiFlash.create(o)}catch(a){window.console.log("ERR",a)}},handleAdminCloneSuccess:function(){try{this.dom.$cloneText.html(I18n.t("js.dashboard.promotion_item.handleSelfCloneSuccess")),this.dom.$cloneBtn.removeClass("show"),this.cloneFlash.hide();var t=_.template(I18n.t("MimiFlash.dashboard.promotion_item.handleSelfCloneSuccess")),e=t({promotion:"<i>"+this.name+"</i>"});Widget.MimiFlash.create(e)}catch(i){console.log("ERR",i)}},isSent:function(){return this.stats.isSent()},updateState:function(t,e){t?(this.dom.$editBtn.parent().hide(),this.dom.$sendBtn.parent().hide(),this.dom.$cancelBtn.parent().show(),this.dom.$refreshStats.disable(),this.dom.$sendingMeta.addClass("promo-sending"),e?(this.dom.$deliverBtn.parent().show(),this.dom.$pauseBtn.parent().hide(),this.dom.$sendingMeta.html(I18n.t("js.dashboard.promotion_item.updateState.paused"))):(this.dom.$deliverBtn.parent().hide(),this.dom.$pauseBtn.parent().show(),this.dom.$sendingMeta.html(I18n.t("js.dashboard.promotion_item.updateState.sending")))):(this.dom.$sendingMeta.removeClass("promo-sending"),this.dom.$editBtn.parent().show(),this.dom.$sendBtn.parent().show(),this.dom.$cancelBtn.parent().hide(),this.dom.$deliverBtn.parent().hide(),this.dom.$pauseBtn.parent().hide(),this.dom.$refreshStats.enable()),this.enableDeliveringButtons()},disableDeliveringButtons:function(){this.dom.$cancelBtn.disable(),this.dom.$deliverBtn.disable(),this.dom.$pauseBtn.disable()},enableDeliveringButtons:function(){this.dom.$cancelBtn.enable(),this.dom.$deliverBtn.enable(),this.dom.$pauseBtn.enable()},startSending:function(){this.dom.$sendingMeta.html(I18n.t("js.dashboard.promotion_item.startSending")),this.stats.refresh()}}),Mimi.Dashboard.PromotionItem.collection={},Mimi.Dashboard.PromotionItem.get=function(e){var i=e;if(!_.isNumber(e)){var s=t(e);if(s.hasClass("promotion_item")||(s=s.parents("li.promotion_item")),!s[0])return null;if(i=parseInt(_.last(s.attr("id").split("_")),10),isNaN(i)||"undefined"==typeof i)return null}return Mimi.Dashboard.PromotionItem.collection[i]?Mimi.Dashboard.PromotionItem.collection[i]:t("#promotion_"+i)[0]?new Mimi.Dashboard.PromotionItem("#promotion_"+i):null},Mimi.Dashboard.PromotionItem.DOM={editBtn:".btn.edit",sendBtn:".btn.send",scheduleBtn:".btn.schedule",pauseBtn:".btn.pause",deliverBtn:".btn.play",cancelBtn:".btn.cancel",deleteBtn:".btn.delete",cloneBtn:".btn.clone",cloneText:".btn.clone span",shareBtn:"li.share span.select",preview:"a.thumb",thumb:"a.thumb img",sendingMeta:"span.promo-sent",statsArea:".promotion-stats",statsHeader:".promotion-stats h4",statsChart:".promotion-stats .graph",statsList:".promotion-stats ul",refreshStats:".refresh"}}(jQuery),function(t){Mimi.Dashboard.PromotionItemStats=Class.create(Widget.Observer,{initialize:function(t){this.initializeSupport(),this.promotionItem=t,this.$element=t.$element,this.dom=t.dom,this.doRefreshBound=_.bind(this.doRefresh,this),this.refreshUrl="/promotions/"+this.promotionItem.id+"/stats.json",this.initializeData(),this.initializeEvents(),this.createChart()},initializeSupport:function(){Widget.PieChart.supported||(this.initializeStats=this.initializeEvents=this.refresh=this.createChart=this.updateChart=function(){})},initializeData:function(){var t=this.$element.find(".graph");this.data=JSON.parse(t.attr("data-stats")||""),this.currently={delivering:this.data.delivering,refreshing_stats:this.data.refreshing_stats},this.refresh()},initializeEvents:function(){this.$element.on("mouseover","div.promotion-stats ul .view_stats",_.bind(this.onMouseOver,this)),this.$element.on("mouseleave","div.promotion-stats",_.bind(this.onMouseLeave,this)),this.dom.$refreshStats.on("click",_.bind(this.onRefreshClick,this))},onRefreshClick:function(){return this.dom.$statsHeader.html(I18n.t("js.dashboard.promotion_item_stats.onRefreshClick")),this.promotionItem.dom.$refreshStats.disable(),t.get(this.dom.$refreshStats.attr("href")+".json").done(_.bind(this.onRefreshStatsSuccess,this)).fail(_.bind(this.onRefreshStatsSuccess,this)),!1},onRefreshStatsSuccess:function(t){t.success?this.setData(t.result,!0):(Widget.MimiFlash.error(I18n.t("MimiFlash.dashboard.promotion_item_stats.onRefreshStatsSuccess")+"\n"+t.error),this.dom.$statsHeader.html(I18n.t("js.dashboard.promotion_item_stats.onRefreshStatsSuccess")),this.promotionItem.dom.$refreshStats.enable())},onRefreshStatsFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.dashboard.promotion_item_stats.onRefreshStatsFailure")),this.dom.$statsHeader.html(I18n.t("js.dashboard.promotion_item_stats.onRefreshStatsFailure")),this.promotionItem.dom.$refreshStats.enable()},setData:function(t,e){this.data=t,this.updateChart(e),this.refresh()},refresh:function(t){if(this.data.delivering||this.data.refreshing_stats||t)clearTimeout(this.refreshTimeout),this.refreshTimeout=_.delay(this.doRefreshBound,5e3),this.data.refreshing_stats&&(this.dom.$statsHeader.html(I18n.t("js.dashboard.promotion_item_stats.refresh.header")),this.promotionItem.dom.$refreshStats.disable());else if(this.currently.delivering){var e=new Date,i=_.template(I18n.t("MimiFlash.dashboard.promotion_item_stats.refresh.finished_sending")),s=i({promotionName:this.promotionItem.name,time:Time.formatDate(e)});Widget.MimiFlash.sticky(s),this.dom.$sendingMeta.html(I18n.t("js.dashboard.promotion_item_stats.refresh.sent")+" "+Time.formatDate(e)),this.updateChart(!0)}else this.currently.refreshing_stats&&(Widget.MimiFlash.create(this.promotionItem.name+" "+I18n.t("MimiFlash.dashboard.promotion_item_stats.refresh.stats_refreshed")),this.updateChart(!0),this.dom.$statsHeader.html(I18n.t("js.dashboard.promotion_item_stats.refresh.totals")),this.promotionItem.dom.$refreshStats.enable());this.currently={delivering:this.data.delivering,refreshing_stats:this.data.refreshing_stats}},doRefresh:function(){t.get(this.refreshUrl).done(_.bind(this.onRefreshSuccess,this)).always(_.bind(this.onRefreshComplete,this))},onRefreshSuccess:function(t){t.success&&(this.data=t.result,this.updateChart(),this.updateDisplay(),this.updateState())},onRefreshComplete:function(){this.refresh()},updateDisplay:function(){var t=this.$element.find(".promotion-stats ul");_.each(this.data.counts,function(e,i){var s,n;"opt_out"===i&&(i="unsubscribed"),"spam"===i&&(i="marked-spam"),s=t.find("li a."+i+" span"),s[0]&&(n=s.text().split(" "),n.shift(),n=e+" "+n.join(" "),s.html(n))})},updateState:function(){this.promotionItem.updateState(this.data.delivering,this.data.paused)},statsInPercents:function(){if(this.data.refreshing_stats)return{Progress:parseFloat((100*this.data.refreshing_stats_done/this.data.refreshing_stats_total).toFixed(2)),Total:parseFloat((100*(this.data.refreshing_stats_total-this.data.refreshing_stats_done)/this.data.refreshing_stats_total).toFixed(2))};var t=this.data.counts,e=t.viewed-t.engaged,i=t.sent-t.engaged-t.bounced-t.opt_out-t.spam;return{Untraced:parseFloat((100*i/t.sent).toFixed(2)),Viewed:parseFloat((100*e/t.sent).toFixed(2)),Engaged:parseFloat((100*t.engaged/t.sent).toFixed(2)),Bounced:parseFloat((100*t.bounced/t.sent).toFixed(2)),Unsubscribed:parseFloat((100*t.opt_out/t.sent).toFixed(2)),"Marked Spam":parseFloat((100*t.spam/t.sent).toFixed(2))}},createChart:function(t){var e=this.$element.find(".graph"),i=this.statsInPercents(),s=e.data("chart");s?s.updateData(i,t):e.data("chart",new Widget.PieChart(e[0],i,{canvasWidth:e.width()+40,canvasHeight:e.height(),isDarkBg:e.parents(".content").hasClass("ui_dark"),labelColor:"#000",labelShadowColor:"",labelEdgeOffset:17,labelBgColor:"#fff"}))},updateChart:function(t){this.createChart(t)},isSent:function(){return this.data.counts&&this.data.counts.sent>0},shouldClone:function(){return!1},onMouseOver:function(i){var s=t(i.currentTarget);if(s[0]){var n="sent accepted viewed engaged shared bounced unsubscribed marked-spam".split(" "),o=s.detectClass.apply(s,n),a=e[o],r=this.$element.find(".graph").data("chart");o&&r&&a&&r.extendSectors(a.names,a.label)}},onMouseLeave:function(){var t=this.$element.find(".graph").data("chart");t&&t.cancelExtension()}});var e={sent:{label:I18n.t("js.dashboard.promotion_item_stats.chart_map.sent"),names:["Untraced","Viewed","Clicked","Shared","Engaged","Bounced","Unsubscribed","Marked Spam"]},accepted:{label:I18n.t("js.dashboard.promotion_item_stats.chart_map.accepted"),names:["Untraced","Viewed","Clicked","Shared","Engaged"]},viewed:{label:I18n.t("js.dashboard.promotion_item_stats.chart_map.viewed"),names:["Viewed","Engaged"]},engaged:{label:I18n.t("js.dashboard.promotion_item_stats.chart_map.engaged"),names:["Engaged","Clicked","Shared"]},shared:{label:I18n.t("js.dashboard.promotion_item_stats.chart_map.shared"),names:["Shared"]},bounced:{label:I18n.t("js.dashboard.promotion_item_stats.chart_map.bounced"),names:["Bounced"]},unsubscribed:{label:I18n.t("js.dashboard.promotion_item_stats.chart_map.unsubscribed"),names:["Unsubscribed"]},"marked-spam":{label:I18n.t("js.dashboard.promotion_item_stats.chart_map.marked_spam"),names:["Marked Spam"]}}}(jQuery),function(t){Mimi.Dashboard.ChildCloneDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t(document.body),this.dom=this.$element.getChildren(this.DOM),this.initData(),this.initDialog(),this.initObservers(),this.initUi()},initData:function(){this.data={cloneType:"",promotion:{name:"Empty"}}},initDialog:function(){this.dialog=new Widget.Popup("#child_clone_dialog",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1})},initObservers:function(){this.dom.$dialog.on("click",".actions",_.bind(this.onActionClick,this)),this.dom.form.$cloneChildRadio.on("change",_.bind(this.onRadioChange,this)),this.dom.form.$cloneAccountRadio.on("change",_.bind(this.onRadioChange,this)),this.dom.form.$cloneDripCampaignRadio.on("change",_.bind(this.onRadioChange,this)),this.dom.form.$adminCloneRadio.on("change",_.bind(this.onRadioChange,this)),this.dom.$dialog.on("click",".children",_.bind(this.onChildrenClick,this)),this.dom.$dialog.on("click",".drip_campaigns",_.bind(this.onDripCampaignsClick,this)),t(document).on("promotion:will:clone",_.bind(this.onClone,this)),t(document).on("promotion:clone:complete",_.bind(this.onAfterChildClone,this)),t(document).on("promotion:clone:error",_.bind(this.onAfterChildClone,this))},initUi:function(){this.dom.form.$cloneAccountRadio.prop("checked",!0),this.data.cloneType=this.dom.form.$cloneAccountRadio.val(),this.dom.form.$cloneChildRadio[0]&&(this.dom.form.$cloneChildRadio.prop("checked",!1),this.toggleChildren(!1),this.clearCheckedChildren()),this.dom.form.$cloneDripCampaignRadio[0]&&(this.dom.form.$cloneDripCampaignRadio.prop("checked",!1),this.toggleDripCampaigns(!1),this.clearCheckedDripCampaigns()),this.setPromotionName(this.data.promotion.name),this.setSubmitbtnText(I18n.t("js.promotions.child_clone.clone")),this.toggleSubmit()},setPromotionName:function(t){this.dom.$dialog.find("h1.window_title span.subtle").html(t)},onAfterChildClone:function(){this.dialog.hide()},onActionClick:function(e){var i=t(e.target);return i.is(".back")||i.parents(".back").length?(this.dialog.hide(),!1):i.is(".primary")||i.parents(".primary").length?(this.clonePromotion(),!1):void 0},onChildrenClick:function(){this.toggleSubmit()},checkedChildrenCount:function(){return this.checkedChildren().size()},checkedChildren:function(){return t("#child_clone_dialog input[type=checkbox]:checked")},clearCheckedChildren:function(){this.checkedChildren().prop("checked",!1)},onDripCampaignsClick:function(){this.toggleSubmit()},checkedDripCampaignsCount:function(){return this.checkedDripCampaigns().size()},checkedDripCampaigns:function(){return t("#child_clone_dialog .drip_campaigns input[type=checkbox]:checked")},clearCheckedDripCampaigns:function(){this.checkedDripCampaigns().prop("checked",!1)},onRadioChange:function(e){var i=t(e.target);"select_child_account"===i.attr("id")?(this.toggleChildren(!0),this.toggleDripCampaigns(!1),this.data.cloneType=i.val()):"select_drip_campaign"===i.attr("id")?(this.toggleChildren(!1),this.toggleDripCampaigns(!0),this.data.cloneType=i.val()):"select_my_account"===i.attr("id")?(this.toggleChildren(!1),this.toggleDripCampaigns(!1),this.data.cloneType=i.val()):"select_admin_clone"===i.attr("id")&&(this.toggleChildren(!1),this.toggleDripCampaigns(!1),this.data.cloneType=i.val()),this.toggleSubmit()},toggleChildren:function(t){t?this.dom.$dialog.find(".children").show():this.dom.$dialog.find(".children").hide()},toggleDripCampaigns:function(t){t?this.dom.$dialog.find(".drip_campaigns").show():this.dom.$dialog.find(".drip_campaigns").hide()},onClone:function(t,e){return this.isAccountWithChildren()||this.isAccountWithDripCampaigns()||this.isAdminAccount()?(this.initData(),this.data.promotion=e,this.initUi(),this.dialog.show()):e.cloneItem("self"),!1},clonePromotion:function(){var e;if(this.disableSubmit(),this.setSubmitbtnText("Cloning..."),"child_account"===this.data.cloneType)e=_.map(this.checkedChildren(),function(e){return t(e).val()}),this.data.promotion.cloneItem("child",e);else if("drip_campaign"===this.data.cloneType)e=_.map(this.checkedDripCampaigns(),function(e){return t(e).val()}),this.data.promotion.cloneItem("drip_campaign",e);else if("admin_clone"===this.data.cloneType){var i=t("#admin_clone_user_email").val();this.data.promotion.cloneItem("admin_clone","",!1,i)}else this.data.promotion.cloneItem("self")},isAdminAccount:function(){return t("#select_admin_clone").length>0},isAccountWithChildren:function(){return Mimi.Dashboard.Data.children.length>0},isAccountWithDripCampaigns:function(){return Mimi.Dashboard.Data.dripCampaigns.length>0},submitbtn:function(){return this.dom.$dialog.find("button.primary")},setSubmitbtnText:function(t){this.submitbtn().find("span").html(t)},disableSubmit:function(){this.submitbtn().addClass("disabled")},enableSubmit:function(){this.submitbtn().removeClass("disabled")},toggleSubmit:function(){""===this.data.cloneType?this.disableSubmit():"my_account"===this.data.cloneType?this.enableSubmit():"admin_clone"===this.data.cloneType?this.enableSubmit():"child_account"===this.data.cloneType?this.checkedChildrenCount()>0?this.enableSubmit():this.disableSubmit():"drip_campaign"===this.data.cloneType&&(this.checkedDripCampaignsCount()>0?this.enableSubmit():this.disableSubmit())},DOM:{dialog:"#child_clone_dialog",form:{cloneChildRadio:"#select_child_account",cloneAccountRadio:"#select_my_account",cloneDripCampaignRadio:"#select_drip_campaign",adminCloneRadio:"#select_admin_clone"}}}).singleton()}(jQuery),function(t){Mimi.Dashboard.PublishToAffiliates=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("body"),this.initState(),this.initObservers()},initState:function(){this.state={}},initObservers:function(){t(document).on("promotion:affiliates:publish",_.bind(this.onPublishToAffiliates,this))},isBusyPublishing:function(t){return"publishing"===this.state[t.id]},setPublishing:function(t,e){var i=e?"publishing":null;this.state[t.id]=i},publishButton:function(e){var i="#promotion_"+e.id;return t(i).find("button.publish_to_affiliates")},disableButtons:function(t){this.publishButton(t).addClass("disabled")},enableButtons:function(t){this.publishButton(t).removeClass("disabled")},publishPath:function(t){return this.publishButton(t).attr("data-url")},onPublishToAffiliates:function(e,i){var s=i.instance;
if(!this.isBusyPublishing(s)){this.setPublishing(s,!0),this.disableButtons(s);var n=this;t.post(this.publishPath(s)).done(function(t){n.onPublishToAffiliatesSuccess(n,s,t)}).fail(function(t){n.onPublishToAffiliatesFailure(n,s,t)})}},onPublishToAffiliatesSuccess:function(t,e,i){t.enableButtons(e),t.setPublishing(e,!1),i.success?Widget.MimiFlash.create(I18n.t("MimiFlash.composer.setup.onPublishToAffiliatesSuccess.success")):Widget.MimiFlash.error(I18n.t("MimiFlash.composer.setup.onPublishToAffiliatesSuccess.fail")+"\n"+i.error)},onPublishToAffiliatesFailure:function(t,e){t.enableButtons(e),t.setPublishing(e,!1),Widget.MimiFlash.error(I18n.t("MimiFlash.composer.setup.onPublishToAffiliatesFailure"))}}).singleton()}(jQuery),function(t){Mimi.Dashboard.ConfirmAccountDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(i){this.$element=t("body"),this.dom=this.$element.getChildren(e),this.updateAccountRoute=i,this.createUI()},createUI:function(){this.dialog=new Widget.Popup("#confirm-account-step-1",{hideTrigger:".window_close, .close",overlay:Widget.ModalOverlay,parent:Widget.ModalOverlay.get().element,fixedPosition:!1,showMethod:"cssShowSlow",hideMethod:"cssHideCross",cssClass:"animate",styles:{zIndex:10000007},position:"none",onHiding:_.bind(this.dialogValidateCancel,this)}),this.dom.dialog.$ok.on("click",_.bind(this.onStep1Ok,this))},show:function(){this.isAccountAlreadyConfirmed()||(this.dialog.show(),this.focusOnFirstName())},focusOnFirstName:function(){var t=this;setTimeout(function(){t.dom.dialog.$firstName.is(":visible")?t.dom.dialog.$firstName.focus():t.focusOnFirstName()},300)},onStep1Ok:function(t){return this.dialogValidate(t)&&(this.updateAccountDetails(),this.dialog.hide(),Widget.ModalOverlay.hide()),!1},dialogValidate:function(t){return this.validateFirstName(t)&&this.validateLastName(t)&&this.validateOrganizationName(t)&&this.validateAgreeToTerms(t)},validateFirstName:function(t){return this.validateField(this.dom.dialog.$firstName,I18n.t("js.dashboard.confirm_account_dialog.validateFirstName"),t.keyCode)},validateLastName:function(t){return this.validateField(this.dom.dialog.$lastName,I18n.t("js.dashboard.confirm_account_dialog.validateLastName"),t.keyCode)},validateOrganizationName:function(t){return this.validateField(this.dom.dialog.$organizationName,I18n.t("js.dashboard.confirm_account_dialog.validateOrganizationName"),t.keyCode)},validateAgreeToTerms:function(t){return this.validateField(this.dom.dialog.$agreeToTerms,"",t.keyCode,I18n.t("js.dashboard.confirm_account_dialog.validateAgreeToTerms"))},validateField:function(t,e,i,s){return s||(s=I18n.t("js.dashboard.confirm_account_dialog.validateField")+" "),9!==i&&this.isBlankOrNotChecked(t)?(t.errorFlash(),Widget.MimiFlash.error(s+e+"."),!1):!0},dialogValidateCancel:function(t){return this.dialogValidate(t)},setSubmitEnabled:function(e){t("#confirm-account-step-1 .btn")[e?"removeClass":"addClass"]("disabled")},setConfirmedCookie:function(){var t="1",e=1;State.setCookie("accountConfirmed",t,e)},isAccountAlreadyConfirmed:function(){return"1"===State.getCookie("accountConfirmed")},updateAccountDetails:function(){var e=this;this.setSubmitEnabled(!1),t.post(this.updateAccountRoute,this.dom.dialog.$form.serialize()).done(function(){e.setConfirmedCookie(),e.dialog.hide(),e.setSubmitEnabled(!0)}).fail(function(t){return Widget.MimiFlash.error(t.error),e.setSubmitEnabled(!0),!1})},isBlank:function(t){return null==t||""===t.trim()},isBlankOrNotChecked:function(t){return t.is(":checkbox")?!t.is(":checked"):this.isBlank(t.val())}});var e={dialog:{form:"#confirm-account-step-1 #confirm-account-form",ok:"#confirm-account-step-1 p.actions button.continue",firstName:"#confirm-account-step-1 #first_name",lastName:"#confirm-account-step-1 #last_name",organizationName:"#confirm-account-step-1 #organization_name",agreeToTerms:"#confirm-account-step-1 #agree_to_terms"}}}(jQuery),function(t){Mimi.Dashboard.CARLToSConfirmDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(i){this.$element=t("body"),this.dom=this.$element.getChildren(e),this.updateAccountRoute=i,this.createUI()},createUI:function(){this.dialog=new Widget.Popup("#carl-confirm-account-dlg",{hideTrigger:".window_close, .close",overlay:Widget.ModalOverlay,parent:Widget.ModalOverlay.get().element,fixedPosition:!1,showMethod:"cssShowSlow",hideMethod:"cssHideCross",cssClass:"animate",styles:{zIndex:10000007},position:"none",onHiding:_.bind(function(){return this.isAccountAlreadyConfirmed()},this)}),this.dom.dialog.$ok.on("click",_.bind(this.onOk,this))},show:function(){this.isAccountAlreadyConfirmed()||this.dialog.show()},onOk:function(t){return this.dialogValidate(t)&&(this.updateAccountDetails(),this.dialog.hide(),Widget.ModalOverlay.hide()),!1},dialogValidate:function(){var t=this.dom.dialog.$agreeToTerms.is(":checked");return t||Widget.MimiFlash.error(I18n.t("js.dashboard.confirm_account_dialog.validateAgreeToTerms")),t},setSubmitEnabled:function(t){this.dom.dialog.$ok[t?"removeClass":"addClass"]("disabled")},setConfirmedCookie:function(){var t="1",e=1;State.setCookie("accountConfirmed",t,e)},isAccountAlreadyConfirmed:function(){return"1"===State.getCookie("accountConfirmed")},updateAccountDetails:function(){var e=this;this.setSubmitEnabled(!1),t.post(this.updateAccountRoute,this.dom.dialog.$form.serialize()).done(function(){e.setConfirmedCookie(),e.dialog.hide(),e.setSubmitEnabled(!0)}).fail(function(t){return Widget.MimiFlash.error(t.error),e.setSubmitEnabled(!0),!1})}});var e={dialog:{form:"#carl-confirm-account-dlg #confirm-account-form",ok:"#carl-confirm-account-dlg p.actions button.continue",agreeToTerms:"#carl-confirm-account-dlg #agree_to_terms"}}}(jQuery),function(t){var e={okButton:"#import_from_free_account_dialog p.actions button.primary",radioButtons:["#import_from_free_account_dialog :radio"],firstRadioButton:"#import_from_free_account_dialog :radio :first",initOverlay:"#confirm_account_overlay"};Mimi.Dashboard.ImportFromFreeAccountDialog=Class.create({initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(e),this.initializeData(),this.createUI()},initializeData:function(){this.data=Mimi.Dashboard.ImportFromFreeAccountDialog.DATA},createUI:function(){this.modal=new Widget.Popup("#import_from_free_account_dialog",{hideTrigger:".window_close, .close",overlay:Widget.ModalOverlay,parent:Widget.ModalOverlay.get().element,fixedPosition:!0,showMethod:"cssShowSlow",hideMethod:"cssHideCross",cssClass:"animate",styles:{position:"absolute",zIndex:10000007},position:"none"}),this.dom.$okButton.on("click",_.bind(this.onOk,this)),this.dom.$radioButtons.on("click",_.bind(this.onAccountSelection,this)),t("#import-cancel").on("click",_.bind(this.hideDialog,this)),t(".window_close").on("click",_.bind(this.hideDialog,this))},show:function(){this.dom.$initOverlay.hide(),this.modal.show(),this.dom.$firstRadioButton.prop("checked")&&this.dom.$okButton.removeClass("disabled")},hideDialog:function(){var e=this;t.ajax({type:"PUT",url:"/user/decline_free_import"}).always(function(){e.modal.hide(),Widget.ModalOverlay.hide(),this.redirectToGettingStarted()})},onAccountSelection:function(){this.dom.$okButton.removeClass("disabled")},onOk:function(){var e=t("input[name=account]:checked").attr("data-value");return this.modal.hide(),Widget.ModalOverlay.hide(),t.ajax({type:"PUT",url:"/user/import_from_starter_account",data:{id:e}}).done(_.bind(this.freeAccountImportSuccess,this)).fail(_.bind(this.freeAccountImportFailure,this)),!1},freeAccountImportSuccess:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.dashboard.import_from_starter_account.onImportSuccess")),this.redirectToGettingStarted()},freeAccountImportFailure:function(t){Widget.MimiFlash.error(t.responseText),this.redirectToGettingStarted()},redirectToGettingStarted:function(){document.location.href=this.data.gettingStartedPath}})}(jQuery),function(t){Mimi.Dashboard.DeleteDialog=Class.create(Widget.Dialog,{initialize:function($super){$super(I18n.t("MimiFlash.dashboard.delete_dialog.dialog.title"),Mimi.Dashboard.DeleteDialog.CONTENT,{hideTrigger:".back"}),this.parentDom=this.dom,this.dom=this.$element.getChildren(Mimi.Dashboard.DeleteDialog.DOM),this.dom.$go.on("click",_.bind(this.go,this))},setBody:function(t){this.parentDom.$body.html(t),this.dom=this.$element.getChildren(Mimi.Dashboard.DeleteDialog.DOM),this.dom.$go.on("click",_.bind(this.go,this))},show:function($super,t,e){this.href=t,this.promotionItem=e;var i=_.template(Mimi.Dashboard.DeleteDialog.CONTENT),s=i({name:this.promotionItem.name});this.setBody(s),$super()},go:function(e){var i=t(e.currentTarget).closest("button.primary");if(i[0])return this.hide(),this.promotionItem.busy(I18n.t("MimiFlash.dashboard.delete_dialog.deleting")),t.ajax({url:this.href+".js",type:"put"}).done(_.bind(this.deleted,this)),!1},deleted:function(){this.promotionItem.trash(),new Mimi.Dashboard.DeletedFlash(this.promotionItem)}}).singleton("show"),Mimi.Dashboard.DeleteDialog.CONTENT="<form><fieldset><div class='description'>"+I18n.t("MimiFlash.dashboard.delete_dialog.dialog.description")+"</div><p class='actions'><span class='left'><a href='#' class='back'><span>"+I18n.t("MimiFlash.dashboard.delete_dialog.dialog.cancel")+"</span></a></span><span class='right'><button class='btn primary delete' type='submit'>"+I18n.t("MimiFlash.dashboard.delete_dialog.dialog.delete")+"</span></button></span></p></fieldset></form>",Mimi.Dashboard.DeleteDialog.DOM={go:"button.primary",name:"span.name"}}(jQuery),function(t){Mimi.Dashboard.DeletedFlash=Class.create(Widget.MimiFlash,{initialize:function($super,t){this.promotionItem=t,$super("<p>"+this.promotionItem.name+" "+I18n.t("MimiFlash.dashboard.undo_delete_flash.deleted")+"</p><p><a href='#' class='undo back btn'><svg class='iconsvg svg_back' viewBox='0 0 16 16' aria-hidden='true'>    <path fill=\"#000\" d=\"M3.285 7.5l3.992-4.5v3.006c2.103 0 6.577 1.723 4.557 5.994 0-3.378-4.557-2.974-4.557-2.974v2.974l-3.992-4.5z\"></path>\n</svg><span>"+I18n.t("MimiFlash.dashboard.undo_delete_flash.undo")+"</span></a></p>",{type:"notice",autohide:!1}),this.$element.on("click","a.undo",_.bind(this.undo,this))},undo:function(){return this.hide(),t.ajax({url:"/promotions/"+this.promotionItem.id+"/untrash",type:"PUT"}).done(_.bind(this.untrashed,this)),!1},untrashed:function(){this.promotionItem.normal(),this.promotionItem.untrash()}})}(jQuery),function(t){t(function(){var e=new Widget.Popup("#mimi-helper-1",{hideTrigger:".window_close, .back, .save",overlay:Widget.ModalOverlay});t("#mimi_watch_helper_1")&&e&&t("#mimi_watch_helper_1").on("click",_.bind(e.show,e))})}(jQuery),jQuery(function(t){function e(){return h.hasClass("enable")}function i(){e()?o():n()}function s(){return c?!1:(c=!0,setTimeout(function(){c=!1},500),!0)}function n(){s()&&(h.addClass("enable"),t(".switch_tutorials").filter(function(){var e=t(this),i=e.data("help-bind-element");return r(e,i),i&&i.is(":visible")}).addClass("slideIn").on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){t(".switch_tutorials").addClass("animate")}))}function o(){s()&&(h.removeClass("enable"),t(".switch_tutorials").removeClass("slideIn").on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){t(".switch_tutorials").removeClass("animate")}))}function a(e){if(!e.data("help-tooltip-initialized")){var i=e.data("help-unique-identifier");if(i){if(p[i])return;p[i]=!0}h.show();var s=t(u({body:e.data("help-text"),index:m++}));d.append(s),e.data("help-tooltip-initialized",!0),s.data("help-bind-element",e),r(s,e),t(window).on("resize",function(){r(s,e)})}}function r(t,e){var i,s,n=e.data("help-pos"),o=30,a=e.offset(),r=d.offset();switch(n){case"top":i=a.left-t.width()/2+e.width()/2,s=a.top-t.height()-o,t.addClass("beak_bottom");break;case"left":i=a.left-t.width()-o,s=a.top-t.height()/2+e.height()/2,t.addClass("beak_right");break;case"right":i=a.left+e.width()+o,s=a.top-t.height()/2+e.height()/2,t.addClass("beak_left");break;case"bottom":i=a.left-t.width()/2+e.width()/2,s=a.top+e.height()+o,t.addClass("beak_top")}if(e.data("help-offset-parent")){var l=e.data("help-offset").split(/\s*,\s*/),h=e.data("help-offset-parent"),c=e.closest(h);i=parseInt(l[0],10)+c.offset().left,s=parseInt(l[1],10)+c.offset().top}i-=r.left,s-=r.top,t.css({left:i,top:s})}function l(){t("[data-help-text]").each(function(e,i){a(t(i))}),f||(h.on("click",function(){return i(),!1}),t(document).on("keyup",function(t){var s=t.keyCode||t.which;27===s&&e()?o():112===s&&i()}),t(document).on("click tab:switched",function(i){var s=t(i.target);e()&&!s.is(".switch_tutorials div")&&o()}),f=!0)}var d=t("#main > section"),h=t("#tips"),c=!1,u=_.template('<div class="popover switch_tutorials beak popover_#{index}" id="" style="position: absolute"><div class="popover_content">#{body}</div></div>'),m=1,p={},f=!1;l(),t(document).on("dashboard:item:changed",function(t,e){"created"===e.change&&l()}),t(document).on("promotion:module:shown",l)}),"undefined"!=typeof Backbone&&(Mimi.Dashboard.Models={}),Mimi.Dashboard.Models.Promotion=Backbone.Model.extend({defaults:{name:"",id:null,tiny_thumbnail_url:"",displayName:"",selected:!1,visible:!0},toJSON:function(t){var e={name:this.get("name"),id:this.get("id")};return t&&(e.selected=this.get("selected"),e.visible=this.get("visible"),e.displayName=this.get("displayName")||e.name,e.imageUrl=this.imageUrl||this.get("tiny_thumbnail_url"),e.ownerName=this.get("owner_name")===Mimi.User.name?"":this.get("owner_name")),e}}),Mimi.Dashboard.Models.PromotionGroup=Backbone.Model.extend({urlRoot:"/apiv2/promotion_groups",defaults:function(){return{name:"",id:null,promotions:[],displayName:"",open:!1,editing:!1}},initialize:function(t,e){Backbone.Model.prototype.initialize.call(this,t,e),this.associatePromotions()},set:function(t,e){void 0===t.promotions||t.promotions instanceof Mimi.Dashboard.Models.PromotionList||(this.size()>0?(_.each(t.promotions,function(t){var e=this.find(t.id);e?e.set(t):this.add(new Mimi.Dashboard.Models.Promotion(t))},this),delete t.promotions):t.promotions=new Mimi.Dashboard.Models.PromotionList(t.promotions));var i=Backbone.Model.prototype.set.call(this,t,e);return this.associatePromotions(),i},validate:function(t){return/^\s*$/.test(t.name)?"Name can not be empty":void 0},add:function(t,e){this.get("promotions").add(t,e),this.associatePromotions(),this.changed("promotions")},remove:function(t,e){this.get("promotions").remove(t,e),this.changed("promotions")},find:function(t){return this.has("promotions")?this.get("promotions").get(t):null},size:function(){return this.has("promotions")?this.get("promotions").length:0},associatePromotions:function(){this.get("promotions").each(function(t){t.set("group",this)},this)},changed:function(t){this.trigger("change"),this.trigger("change:"+t)},toJSON:function(t){var e={name:this.get("name"),id:this.get("id"),promotions:this.get("promotions")};return t&&_.extend(e,{open:this.get("open"),editing:this.get("editing"),displayName:this.get("displayName")}),e}}),Mimi.Dashboard.Models.PromotionList=Backbone.Collection.extend({model:Mimi.Dashboard.Models.Promotion,getSelected:function(){return this.select(function(t){return t.get("selected")})}}),Mimi.Dashboard.Models.PromotionPaginator=function(t,e,i){return t.Collection.extend({model:Mimi.Dashboard.Models.Promotion,PAGE_SIZE:10,initialize:function(t){e.bindAll(this,"onSearchResults","onSearchComplete"),this.allModels=this.resultModels=this.models=e.isEmpty(t)?[]:this.modelsFromData(t.promotions),this.page=1,this.totalEntries=t.totalEntries,this.totalPages=this.allTotalPages=Math.ceil(this.totalEntries/this.PAGE_SIZE),this.serverPageSize=t.pageSize,this.queries={"":{totalPages:this.totalPages,page:1}},this.query=""},modelsFromData:function(t){return e.isEmpty(t)?[]:e.map(t,function(t){return"undefined"!=typeof t.group?new Mimi.Dashboard.Models.PromotionGroup(t.group):new Mimi.Dashboard.Models.Promotion(t.promotion)})},nextPage:function(){this.page++,this.pager()},prevPage:function(){this.page=--this.page||1,this.pager()},"goto":function(t){void 0!==t&&(this.page=parseInt(t,10),this.pager())},gotoModel:function(t){var e=Math.ceil((this.indexOf(t,{all:!0})+1)/parseFloat(this.PAGE_SIZE));e>0&&e!==this.page&&this.goto(e)},pager:function(){var t=(this.page-1)*this.PAGE_SIZE,e=t+this.PAGE_SIZE,i=this.resultModels.slice(t,e);this.reset(i),i.length<this.PAGE_SIZE&&this.fetchSearchResults()},pagerInfo:function(){return{page:this.page,totalPages:this.totalPages}},search:function(t){""===t?this.clearSearch():this.query!==t.toLowerCase()&&this.doSearch(t)},clearSearch:function(){this.query="",e.each(this.allModels,function(t){t.attributes.displayName=t.attributes.name,t instanceof Mimi.Dashboard.Models.PromotionGroup&&e.each(t.get("promotions").models,function(t){t.attributes.displayName=t.attributes.name})}),this.totalPages=this.allTotalPages,this.resultModels=this.allModels,this.pager()},doSearch:function(t){this.query=t.toLowerCase(),this.getSearchResults(),this.totalPages=Math.ceil(this.resultModels.length/this.PAGE_SIZE),this.page=1,this.pager(),this.fetchSearchResults()},getSearchResults:function(){this.resultModels=e.isEmpty(this.query)?this.allModels:e.select(this.allModels,function(t){return t instanceof Mimi.Dashboard.Models.Promotion?this.searchPromotion(t):t instanceof Mimi.Dashboard.Models.PromotionGroup?this.searchGroup(t):void 0},this)},searchPromotion:function(t){t.attributes.displayName=t.attributes.name;var e=this.findAndHighlight(t.attributes.name);return e?(t.attributes.displayName=e,!0):void 0},searchGroup:function(t){t.attributes.displayName=t.attributes.name;var i=!1,s=this.findAndHighlight(t.attributes.name);return s&&(t.attributes.displayName=s,i=!0),e.each(t.get("promotions").models,function(e){this.searchPromotion(e)&&(i=!0,t.get("open")||t.set("open",!0))},this),i},findAndHighlight:function(t){var e=t.toLowerCase(),i=e.indexOf(this.query);return i>-1?t.slice(0,i)+"<b>"+t.slice(i,i+this.query.length)+"</b>"+t.slice(i+this.query.length):void 0},fetchSearchResults:function(){var t=this;e.isEmpty(this.queries[this.query])&&(this.queries[this.query]={totalPages:1,page:0});var s=parseInt(this.queries[this.query].page)+1;s>this.queries[this.query].totalPages||(i.getJSON("promotions/search",{page_size:t.serverPageSize,query:this.query,page:s},this.onSearchResults).complete(this.onSearchComplete),Mimi.dispatcher.trigger("promotions:loading:start"))},onSearchResults:function(t){this.allModels=e.uniq(this.allModels.concat(this.modelsFromData(t.promotions)),!1,function(t){return t.get("id")}),this.getSearchResults(),this.queries[this.query].totalPages=this.totalPages=Math.ceil(t.total/this.PAGE_SIZE),this.queries[this.query].page=t.page,this.pager()},onSearchComplete:function(){Mimi.dispatcher.trigger("promotions:loading:finish")},add:function(e,i){i&&i.all?(this.reset(this.allModels,{silent:!0}),t.Collection.prototype.add.call(this,e,i),this.allModels=this.models,this.getSearchResults(),this.pager()):t.Collection.prototype.add.call(this,e,i)},remove:function(e,i){i&&i.all?(this.reset(this.allModels,{silent:!0}),t.Collection.prototype.remove.call(this,e,i),this.allModels=this.models,this.getSearchResults(),this.pager()):t.Collection.prototype.remove.call(this,e,i)},find:function(t,e){var i;return this._each(function(e,s,n){return t(e,s,n)?void(i=e):void 0},e),i},findById:function(t){var e;return this._each(function(i){return i.get("id")===t?(e=i,!1):void 0}),e},indexOf:function(i,s){return s&&s.all?e.indexOf(this.allModels,i):t.Collection.prototype.indexOf.call(this,i)},getSelected:function(){return this._select(function(t){return t.get("selected")})},getCurrentIds:function(){var t=e.map(this.getSelected(),function(t){return t.get("id")});return 0===t.length&&(t=Mimi.Dashboard.Data.recentPromotionIds),t},_each:function(t,e,i){return this.__each(i||this.allModels,t,e)},__each:function(t,e,i){for(var s=0,n=t.length;n>s;s++)if(t[s]instanceof Mimi.Dashboard.Models.Promotion)e.call(i,t[s],s,t);else if(t[s]instanceof Mimi.Dashboard.Models.PromotionGroup)for(var o=t[s].get("promotions").models,a=0,r=o.length;r>a;a++)e.call(i,o[a],a,o)},_map:function(t,e){var i=[];return this._each(function(s){i.push(t.call(e||this,s))},this),i},_select:function(t,e,i){var s=[];return this._each(function(i){t.call(e||this,i)&&s.push(i)},this,i),s}})}(Backbone,_,jQuery),Mimi.PromotionViewTemplate='<a class="promo #{visible ? "" : "invisible"}" title="">  <span class="promotion_thumb" style="background-image: none;" title="#{_.escape(displayName)}">    <span>      <img src="#{imageUrl}" onerror="Mimi.fallbackImage(this)">    </span>  </span>  <span class="promo_name hide_overflow nowrap small" title="#{_.escape(displayName)}">    #{displayName}    <span class="item_owner_name nowrap" title="Owner">#{_.escape(ownerName)}</span>    <input type="checkbox" autocomplete="off" #{selected ? "checked" : ""}>  </span></a>',Mimi.PromotionGroupViewTemplate='<a class="group" id="anonymous_element_19">  <span class="promotion_group_thumb">    <span>      #{img}    </span>  </span>  <span class="group_name hide_overflow nowrap small">#{ displayName || name }</span>  <span class="promotion_counts">    <span class="count_selected"></span>    <span class="count"></span>  </span>  <span class="promotion_group_edit">    <button class="small simple edit icon btn">      <svg class="iconsvg svg_pencil" viewBox="0 0 16 16" aria-hidden="true">    <path d="M3.604 9.81l2.83 2.828L12.2 6.87 9.372 4.043 3.604 9.81zM10.3 3.114l2.83 2.828 1.647-1.648-2.83-2.828L10.3 3.114zM2.392 13.85l3.062-.233-2.828-2.83-.234 3.063z" id="pencil"/><path d="M.6 14h7.5a.5.5 0 0 0 0-1H.6a.5.5 0 0 0 0 1z" id="line" opacity="0"/></svg>      <span>Edit</span>    </button>  </span></a><span class="group_editor combo_input" style="#{ editing ? "" : "display:none" }">  <input type="text" name="group_name" class="group_name" value="#{ name }">  <button type="submit" class="btn icon primary check-mark update_list">    <svg class="iconsvg svg_checkmark" viewBox="0 0 16 16" aria-hidden="true">    <path d="M1 9.997s2.781 1.368 5.279 5.003c.104-.013 2.594-4.879 9.783-14 .063.063-2.31 0-2.31 0l-7.707 9.745-3.421-2.818-1.624 2.07z"></path></svg>    <span>OK</span>  </button></span><ul style="overflow-x: visible; overflow-y: visible; #{open ? "" : "display: none;"}" class="promotion_search_list group_promotions"></ul>',Mimi.SelectedPromotionsViewTemplate='<li class="single-item #{selected ? "selected" : ""} #{group ? "item_in_group" : ""}" data-model-id="#{id}">    <a class="promo">      <span class="promotion_thumb" style="background-image: none; ">        <span>          #{img}          <span class="thumb_overlay">            <img src="#{imageUrl}" onerror="Mimi.fallbackImage(this);">          </span>        </span>      </span>      <span class="promo_name hide_overflow nowrap small">        #{_.escape(name)}        #{group ? ("<span class=\'item_group_name\'>Group: " + _.escape(group.get("name")) + "</span>") : ""}        #{!group && ownerName ? ("<span class=\'item_owner_name nowrap\' >" + _.escape(ownerName) + "</span>") : ""}        <input type="checkbox" autocomplete="off" #{selected ? "checked" : ""}>      </span>    </a>  </li>',Mimi.PaginatorTemplate="<div class=breadcrumb><span class='cell last pages'><a href=# class='previous btn subtle icon #{ page != 1 ? '' : 'disabled' }'><svg class='iconsvg svg_previous' viewBox='0 0 16 16' aria-hidden='true'>    <path d=\"M12.438 12.161v-8l-5 4 5 4z\"></path><path d=\"M8.438 10.561v1.6l-5-4 5-4v1.6l-3 2.4 3 2.4z\"></path>\n</svg><span>Previous</span></a>#{ pages }<a href=# class='next btn subtle icon #{ (page != totalPages) ? '' : 'disabled' }''><svg class='iconsvg svg_next' viewBox='0 0 16 16' aria-hidden='true'>    <path d=\"M4 4v8l5-4-5-4z\"></path><path d=\"M8 5.6v-1.6l5 4-5 4v-1.6l3-2.4-3-2.4z\"></path>\n</svg><span>Next</span></a></span></div>",function(t){Mimi.PromotionView=Backbone.View.extend({tagName:"li",className:"single-item",promotionItemHeight:60,template:_.template(Mimi.PromotionViewTemplate),events:{click:"onClick"},initialize:function(){_.bindAll(this,"onDrop"),this.model.on("change",this.onChange,this),this.model.on("destroy",this.onDestroy,this),this.$el.data("model-id",this.model.get("id")),this.$el.attr("data-model-id",this.model.get("id"))},onChange:function(){var t=this.model&&this.model.changedAttributes()&&"selected"===_.keys(this.model.changedAttributes()).join("");if(t)this.$el.toggleClass("selected",this.model.get("selected"));else{this.render();try{this.$el.droppable("option","disabled",!this.isInGroup())}catch(e){}}},render:function(){return this.$el.html(this.template(this.model.toJSON(!0))),this.$el.toggleClass("selected",this.model.get("selected")),this.$img=this.$el.find("img:first")[0],this},onClick:function(e){if(window.appView.setScrollTo(t(window).scrollTop()),!this.$el.hasClass("ui-draggable-dragging")){var i=""!==this.$el[0].style.top;if(i)return this.model.trigger("change"),void e.die();this.model.set("selected",!this.model.get("selected")),e.die()}},appendTo:function(t){Backbone.View.prototype.appendTo.call(this,t),this.initDroppable()},isInGroup:function(){return this.model.has("group")},initDroppable:function(){this.isInGroup()||this.$el.droppable({greedy:!0,drop:this.onDrop,hoverClass:"drag-target",tolerance:"pointer"})},onDrop:function(t,e){Mimi.dispatcher.trigger("promotion:drop",{bottomId:this.model.get("id"),topId:e.draggable.data("model-id")})},onDestroy:function(){this.remove(),this.destroy()},destroy:function(){this.model.off("change",this.render,this),this.model.off("destroy",this.onDestroy,this),this.model.imageUrl=this.$img.src}})}(jQuery),function(t){Mimi.PromotionGroupView=Backbone.View.extend({tagName:"li",className:"group",template:_.template(Mimi.PromotionGroupViewTemplate),events:{"click .promotion_group_edit":"startEditing","click .group":"toggleCollapse","click .group_editor button":"updateName","keyup .group_editor input":"onNameKeyUp"},initialize:function(){_.bindAll(this,"onDragStart","onDragStop","onDrop","onChange"),this.model.get("promotions").initialized||(this.model.on("change",this.render,this),this.model.on("destroy",this.onDestroy,this)),this.model.get("promotions").on("change",this.onChange,this)},onChange:function(t){var e=t&&"selected"===_.keys(t.changedAttributes()).join("");e||this.render()},render:function(){var t=this.model.toJSON(!0),e="";return _.each(this.model.get("promotions").models,function(t,i){4>i&&(e+='<img src="'+(t.imageUrl||t.get("tiny_thumbnail_url"))+'" onerror="Mimi.fallbackImage(this);">')}),t.img=e,this.$el.html(this.template(t)),this.postRender(t),this.initPromotionViews(),this.updateCounters(),this.initDroppable(),this},postRender:function(t){t.editing?(this.$el.addClass("editing"),_.defer(_.bind(function(){this.$el.find(".group_name").select()},this))):this.$el.removeClass("editing")},initPromotionViews:function(){var t=this.$(".promotion_search_list").get(0),e=this.model.get("promotions");e.destroyViews(),e.each(function(i){var s=new Mimi.PromotionView({model:i});s.appendTo(t),e.registerView(s)},this),this.initDraggable()},initDraggable:function(){this.$(".promotion_search_list li").draggable({zIndex:1e3,axis:"y",appendTo:"body",revert:"invalid",revertDuration:400,distance:5,cursorAt:{top:25},start:this.onDragStart,stop:this.onDragStop})},onDragStart:function(e,i){this.$placeholder=i.helper.clone().addClass("drag_drop_placeholder"),this.$placeholder.find(".promo_name").html("Drop here to remove"),this.$el.after(this.$placeholder),t("body").addClass("dragging")},onDragStop:function(){t("body").removeClass("dragging"),this.$placeholder.remove()},initDroppable:function(){this.$el.droppable({greedy:!0,drop:this.onDrop,hoverClass:"drag-target"})},onDrop:function(t,e){Mimi.dispatcher.trigger("group:drop",{group:this.model,promoId:e.draggable.data("model-id")})},updateCounters:function(){var t=this.model.get("promotions").filter(function(t){return t.get("selected")}).length;this.$(".count").html(this.model.get("promotions").length),this.$(".count_selected").html(t)},toggleCollapse:function(){window.appView.setScrollTo(t(window).scrollTop()),this.model.get("editing")||this.model.set("open",!this.model.get("open")),this.$(".promotion_search_list").toggle(this.model.get("open"))},startEditing:function(){this.model.set("editing",!0)},onNameKeyUp:function(t){t.keyCode===jQuery.ui.keyCode.ENTER?this.updateName():t.keyCode===jQuery.ui.keyCode.ESCAPE&&this.model.set({editing:!1})},updateName:function(){this.model.set({name:_.escape(this.$(".group_editor input").val()),editing:!1}),Mimi.dispatcher.trigger("group:name:change",this.model)},onDestroy:function(){this.remove(),this.destroy()},destroy:function(){this.model.off("change",this.render,this),this.model.off("destroy",this.onDestroy,this),this.model.get("promotions").off("change",this.render,this)}})}(jQuery),function(t){Mimi.PromotionListView=Backbone.View.extend({tagName:"ul",className:"promotion_search_list groups promotion_search_view",searchStr:"",initialize:function(){_.bindAll(this,"onDrop"),this.appendTo(this.options.appendTo),this.initObservers(),this.loadingBlock=new Widget.BlockOverlay({cover:this.$el[0],className:"centered sidebar"}),this.loadingCount=0,this.removedPromotionsDescriptors={}},initObservers:function(){Mimi.dispatcher.on("promotion:drop",this.onPromotionDrop,this),Mimi.dispatcher.on("group:drop",this.onGroupDrop,this),Mimi.dispatcher.on("selected_section:drop",this.onSelectedSectionDrop,this),Mimi.dispatcher.on("promotions:search",this.onPromotionsSearch,this),Mimi.dispatcher.on("selected_section:toggle",this.onSelectedSectionToggle,this),Mimi.dispatcher.on("promotions:loading:start",this.onLoadingStart,this),Mimi.dispatcher.on("promotions:loading:finish",this.onLoadingFinish,this),Mimi.dispatcher.on("group:name:change",this.onGroupNameChange,this),t(document).on("dashboard:item:changed",_.bind(this.onPromotionChanged,this)),t(document).on("dashboard:item:cloned",_.bind(this.onPromotionCloned,this))},onLoadingStart:function(){this.loadingCount++,this.loadingBlock.show()},onLoadingFinish:function(){this.loadingCount--,this.loadingCount<1?(this.loadingBlock.hide(),this.loadingCount=0):this.loadingBlock.position()},initGroupObservers:function(){this.collection.each(function(t){if(t instanceof Mimi.Dashboard.Models.PromotionGroup){var e=t.get("promotions");if(e.initialized)return;e.on("change:selected",function(){this.collection.trigger("change:selected")},this),e.initialized=!0}},this)},initDraggable:function(){this.$("> li").draggable({cancel:".group",zIndex:1e3,axis:"y",appendTo:"body",revert:"invalid",revertDuration:400,distance:5,cursorAt:{top:25},start:function(){t("body").addClass("dragging")},stop:function(){t("body").removeClass("dragging")}})},initDroppable:function(){this.$el.droppable({greedy:!0,drop:this.onDrop})},onDrop:function(t,e){this.$el.removeClass("drag-target"),this.onViewDrop(e.draggable,t)},render:function(){this.collection.destroyViews(),this.$el.html("");var t,e=document.createDocumentFragment();return this.collection.each(function(i){i instanceof Mimi.Dashboard.Models.Promotion?t=new Mimi.PromotionView({model:i}):i instanceof Mimi.Dashboard.Models.PromotionGroup&&(t=new Mimi.PromotionGroupView({model:i})),t.appendTo(e),this.collection.registerView(t)},this),this.$el.append(e),this.initGroupObservers(),this.initDraggable(),this.initDroppable(),this},trashPromo:function(t){var e=this.collection.findById(t);if(e){var i=e.get("group"),s=this.collection.indexOf(i||e),n=i?_.indexOf(i,e):-1;this.removedPromotionsDescriptors[t]={promo:e,index:s,group:e.get("group"),groupIndex:n},i?i.remove(e):this.collection.remove(e,{all:!0});var o=e.get("selected");o&&(e.set("selected",!1),this.collection.trigger("change:selected"))}},untrashPromo:function(t){var e=this.removedPromotionsDescriptors[t];e.group&&this.collection.indexOf(e.group)>-1?e.group.add(e.promo,{at:e.groupIndex}):this.collection.add(e.promo,{at:e.index})},onPromotionChanged:function(t,e){switch(e.change){case"trashed":this.trashPromo(e.id);break;case"untrashed":this.untrashPromo(e.id)}},onPromotionCloned:function(t,e){var i=new Mimi.Dashboard.Models.Promotion(e.data),s=e.group;i.set("selected",!0),s?s.add(i):this.collection.add(i,{all:!0,at:0}),this.addToRecentPromotionIds(i),this.collection.trigger("change:selected")},addToRecentPromotionIds:function(t){Mimi.Dashboard.Data.recentPromotionIds.unshift(t.id)},onPromotionDrop:function(t){var e=this.collection.findById(t.bottomId),i=this.collection.findById(t.topId),s=this.insertionPoint(e);this.collection.remove([i,e],{all:!0});var n=new Mimi.Dashboard.Models.PromotionGroup({name:I18n.t("js.dashboard.promotion_list.untitled_group"),promotions:new Mimi.Dashboard.Models.PromotionList([e,i]),open:!0,editing:!0});
this.collection.add(n,{at:s,all:!0}),n.save(),this.collection.gotoModel(n)},onGroupDrop:function(t){var e=this.collection.findById(t.promoId),i=e.get("group");i!==t.group&&(i?(i.remove(e),this.destroyOrSaveGroup(i)):this.collection.remove(e,{all:!0}),t.group.add(e),t.group.save())},onViewDrop:function(t){var e=this.collection.findById(t.data("model-id"));if(e.has("group")){var i=e.get("group"),s=this.insertionPoint(i)+1;i.remove(e),e.unset("group"),this.collection.add(e,{at:s,all:!0}),this.destroyOrSaveGroup(i)}},destroyOrSaveGroup:function(t){if(t.size()<=1){var e=this.insertionPoint(t);t.get("promotions").each(function(i){t.remove(i),i.unset("group"),this.collection.add(i,{at:e,all:!0})},this),this.collection.remove(t,{all:!0}),t.destroy()}else t.save()},insertionPoint:function(t){var e=this.collection.indexOf(t,{all:!0});return e>0?e:0},onSelectedSectionDrop:function(t){var e=this.collection.findById(t.bottomId),i=e.get("group");i?this.onGroupDrop({promoId:t.topId,group:i}):this.onPromotionDrop(t)},onSelectedSectionToggle:function(t){var e=this.collection.findById(t.promoId);e&&e.set("selected",!e.get("selected")),this.collection.trigger("change:selected")},onPromotionsSearch:function(t){this.collection.search(t)},onGroupNameChange:function(){this.collection.getSearchResults()},getSelected:function(){return this.collection.getSelected()},getCurrentIds:function(){return this.collection.getCurrentIds()}})}(jQuery),function(t){var e=200;Mimi.LargePromotionListView=Backbone.View.extend({events:{"click a.edit":"onEdit","click a.send":"onSend","click a.schedule":"onSchedule","click a.delete":"onDelete","click a.view_stats":"onViewStats","click a.cancel":"onCancel","click a.play":"onPlay","click a.pause":"onPause","click button.publish_to_affiliates":"onPublishToAffiliates","click a.clone":"onClone"},initialize:function(){this.fetched={},this.toLoad=[],this.loadingBlock=new Widget.BlockOverlay({cover:this.$el[0],className:"centered"}),setInterval(_.bind(this.loadPromotions,this),e)},show:function(t){this.hideOthers(),this.shown=t,this.updateCompareLink(t),this.updateHeader();var e=_.select(t,function(t){var e=Mimi.Dashboard.PromotionItem.get(t);if(e&&!this.isDeleted(e))e.show();else if(!this.fetched[t])return!0;return!1},this);e.length>0&&this.fetchPromotions(e)},hideOthers:function(t){_.each(_.difference(this.shown,t),function(t){var e=Mimi.Dashboard.PromotionItem.get(t);e&&e.hide()},this)},isDeleted:function(e){var i=t("#promotion_"+e.id);return i.is(":visible")&&0===i.height()},loadPromotions:function(){if(this.toLoad.length>0){this.visibleItems().length>0?this.loadingBlock.hide():this.loadingBlock.show();var t=this.toLoad.splice(0);this.loadPromotionsByIds(t)}},loadPromotionsByIds:function(e){this.loadingBlock.position(),t.get("/promotions/items",{ids:e.join(",")}).done(_.bind(this.onPromotionLoaded,this)).fail(_.bind(this.onPromotionFailed,this))},onPromotionLoaded:function(t){this.render(t),this.loadingBlock.hide(),this.updateCompareLink(this.shown)},onPromotionFailed:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.dashboard.promotion_item.onPromotionFailed"))},fetchPromotions:function(t){_.each(t,function(t){this.fetched[t]=!0,this.toLoad.unshift(t)},this)},render:function(t){if(t.indexOf("new_clone")>0)this.$el.prepend(t);else if(this.shown===Mimi.Dashboard.Data.recentPromotionIds){this.$el.append(t);var e=this.visibleItems(),i=_.sortBy(e,function(t){var i=Mimi.Dashboard.PromotionItem.get(t),s=_.indexOf(Mimi.Dashboard.Data.recentPromotionIds,i.id);return-1===s?1e4+_.indexOf(e,t):s});this.$el.append(i)}else this.$el.append(t);_.each(this.$el.find("> li.promotion_item"),function(t){var e=Mimi.Dashboard.PromotionItem.get(t);e[_.include(this.shown,e.id)?"show":"hide"]()},this),Time.shift()},visibleItems:function(){return t("li.promotion_item:visible")},updateCompareLink:function(e){var i=t("#promotions_compare_link").get(0),s=_.first(i.href.split("?")),n=[];_.each(e,function(t){var e=Mimi.Dashboard.PromotionItem.get(t);e&&e.stats.data.counts.sent>0&&n.push(e.id)},this),n.length>1?t(i).removeClass("disabled"):t(i).addClass("disabled"),i.href=s+"?ids="+n.join(",")},updateHeader:function(){this.options.headerEl&&(0!==appView.promotionList.getSelected().length?(t(this.options.headerEl).find("span.recent").hide(),t(this.options.headerEl).find("span.selected").show()):(t(this.options.headerEl).find("span.recent").show(),t(this.options.headerEl).find("span.selected").hide()))},go:function(t,e){var i=Mimi.Dashboard.PromotionItem.get(t.currentTarget);i.busy(I18n.t("MimiFlash.dashboard.large_promotion_list.preparing")+" "+e+"...")},onEdit:function(e){t(e.currentTarget).hasClass("upgrade")?Mimi.UpgradeDialog.show():this.go(e,I18n.t("MimiFlash.dashboard.large_promotion_list.edit"))},onSend:function(t){this.go(t,I18n.t("MimiFlash.dashboard.large_promotion_list.send"))},onSchedule:function(t){this.go(t,I18n.t("MimiFlash.dashboard.large_promotion_list.schedule"))},onClone:function(e){e.die();var i=t(e.target);i.hasClass("upgrade")||i.parent("a").hasClass("upgrade")||t(document).trigger("promotion:will:clone",Mimi.Dashboard.PromotionItem.get(e.currentTarget))},onPublishToAffiliates:function(t){t.die(),document.fire("promotion:affiliates:publish",{instance:Mimi.Dashboard.PromotionItem.get(t.currentTarget)})},onDelete:function(t){Mimi.Dashboard.DeleteDialog.show(t.currentTarget.href,Mimi.Dashboard.PromotionItem.get(t.currentTarget)),t.die()},onViewStats:function(){},onCancel:function(t){Mimi.Dashboard.PromotionItem.get(t.currentTarget).cancel(),t.die()},onPlay:function(t){t.die(),Mimi.Dashboard.PromotionItem.get(t.currentTarget).deliver()},onPause:function(t){t.die(),Mimi.Dashboard.PromotionItem.get(t.currentTarget).pause()}})}(jQuery),function(t){Mimi.SelectedPromotionsView=Backbone.View.extend({tagName:"ul",className:"promotion_selected_list promotion_search_list",promotionTemplate:_.template(Mimi.SelectedPromotionsViewTemplate),events:{"click li":"onClick"},initialize:function(){_.bindAll(this,"onDrop"),this.options.appendTo&&this.appendTo(this.options.appendTo)},getImgMarkup:function(t,e){var i="";return t?_.each(t.get("promotions").models,function(t,s){4>s&&(i+='<img src="'+e+'" onerror="Mimi.fallbackImage(this)">')}):i+='<img src="'+e+'" onerror="Mimi.fallbackImage(this)">',i},render:function(e){if(e&&e.length>0){var i=_.map(e,function(t){var e=t.imageUrl||t.get("tiny_thumbnail_url");return this.promotionTemplate({name:t.get("name"),img:this.getImgMarkup(t.get("group"),e),group:t.get("group"),id:t.get("id"),imageUrl:e,selected:t.get("selected"),ownerName:t.get("owner_name")===Mimi.User.name?"":t.get("owner_name")})},this);this.$el.empty().html(i.join(""))}else this.$el.empty();this.options.headerEl&&e&&t(this.options.headerEl)[0===e.length?"hide":"show"](),this.initDroppable()},onClick:function(e){Mimi.dispatcher.trigger("selected_section:toggle",{promoId:parseInt(t(e.currentTarget).data("model-id"),10)})},initDroppable:function(){this.$(".single-item").droppable({drop:this.onDrop,hoverClass:"drag-target"})},onDrop:function(e,i){Mimi.dispatcher.trigger("selected_section:drop",{bottomId:parseInt(t(e.target).data("model-id"),10),topId:parseInt(i.draggable.data("model-id"),10)})}})}(jQuery),function(t){Mimi.PaginatorView=Backbone.View.extend({events:{"click a.first":"gotoFirst","click a.previous":"gotoPrev","click a.next":"gotoNext","click a.last":"gotoLast","click a.page":"gotoPage"},template:_.template(Mimi.PaginatorTemplate),tagName:"aside",initialize:function(){this.collection.on("reset",this.render,this),this.collection.on("change",this.render,this),this.$el.appendTo(this.options.appendTo)},render:function(){var t=this.collection.pagerInfo(),e=this.getPagesMarkup(t),i="";""!==e&&(i=this.template(_.extend(t,{pages:e}))),this.$el.html(i)},getPagesMarkup:function(t){if(1===t.totalPages)return"";var e="",i=5,s=Math.max(1,t.page-Math.floor(i/2));t.totalPages-s<i&&(s=t.totalPages-i),t.totalPages<=5&&(s=1);for(var n=s;n<Math.min(s+i,t.totalPages+1);n++)e+=t.page===n?'<span class="page current">'+n+"</span>":'<a href="#" class="page">'+n+"</a>";return e},gotoFirst:function(t){t.preventDefault(),this.collection.goTo(1)},gotoPrev:function(t){t.preventDefault(),this.collection.prevPage()},gotoNext:function(t){t.preventDefault(),this.collection.nextPage()},gotoLast:function(t){t.preventDefault(),this.collection.goTo(this.collection.information.lastPage)},gotoPage:function(e){e.preventDefault();var i=t(e.target).text();this.collection.goto(i)}})}(jQuery),function(t){var e={"input input.search":"oninput","click img.clear_search":"clearSearch"};navigator.userAgent.indexOf("MSIE")>-1&&(e.keyup="oninput"),Mimi.SearchView=Backbone.View.extend({events:e,template:'<span class="full"><input type="text" placeholder="'+I18n.t("js.promotions.search.placeholder")+'" class="search" id="search_promotions" autocomplete="off" tabindex="1"/><img class="clear_search hidden" src="https://d2vnkn0bfhsarv.cloudfront.net/assets/img/clear_search.png" /></span>',initialize:function(){this.setElement(t(this.template)),this.$el.appendTo(this.options.appendTo),this.$searchField=this.$el.find("input"),this.$clearButton=this.$el.find("img.clear_search")},oninput:function(){var t=this.$searchField.val();t.length>0?this.$clearButton.removeClass("hidden"):this.$clearButton.addClass("hidden"),clearTimeout(this.timeout),this.timeout=setTimeout(function(){Mimi.dispatcher.trigger("promotions:search",t)},300)},setValue:function(t){this.$searchField.val(t)},clearSearch:function(){this.$searchField.val(""),Mimi.dispatcher.trigger("promotions:search",""),this.$searchField.focus(),this.$clearButton.addClass("hidden")}})}(jQuery),function(t){Mimi.AppView=Backbone.View.extend({initialize:function(){this.options.largePromotionsEl&&(this.promotionList=new Mimi.Dashboard.Models.PromotionPaginator(this.options.data),this.initPaginator(this.options.paginationEl),this.promotionListView=new Mimi.PromotionListView({collection:this.promotionList,appendTo:this.options.searchListEl}),this.initLargePromotionList(this.options.largePromotionsEl,this.options.largePromotionsHeaderEl),this.initSelectedPromotions(this.options.selectedPromotionsEl,this.options.selectedPromotionsHeaderEl),this.initSearch(this.options.searchEl),this.initRouter())},initRouter:function(){_.bindAll(this,"onRouteEmpty","onRouteWithQuery","onRouteWithParams","onShowRecent","onChange");var t=this,e=Backbone.Router.extend({initialize:function(){this.route("","empty",t.onRouteEmpty),this.route("recent","empty",t.onRouteEmpty),this.route("_=_","empty",t.onRouteEmpty),this.route(/(?:&query=(.*))/,"withParams",t.onRouteWithQuery),this.route(/selected=([^&]*)(?:&query=(.*))?/,"withParams",t.onRouteWithParams)}});Mimi.Dashboard.ChildCloneDialog.get(),Mimi.Dashboard.PublishToAffiliates.get(),this.router=new e},onRouteEmpty:function(){this.render(),this.largePromotionListView.show(this.getCurrentIds()),this.initObservers()},onRouteWithQuery:function(t){this.onRouteWithParams("",t)},onRouteWithParams:function(t,e){this.render(),this.largePromotionListView.show(this.getCurrentIds()),this.initObservers(),e&&(this.searchView.setValue(e),this.promotionListView.onPromotionsSearch(e)),this.selectPromotions(t),this.renderSelectedSection()},selectPromotions:function(t){t=t.split(","),_.each(t,function(t){t=parseInt(t,10);var e=this.promotionList.findById(t);e&&e.set("selected",!0)},this)},initObservers:function(){Mimi.dispatcher.on("after:promotions:search",this.afterPromotionsSearch,this),Mimi.dispatcher.on("promotions:search",this.updateUrl,this),t("header a.recent").on("click",this.onShowRecent),t(document).on("dashboard:item:changed",_.bind(this.updateUrl,this)),this.initPromotionObservers()},onShowRecent:function(t){t.preventDefault(),_.each(this.getSelected(),function(t){t.set("selected",!1)})},initPromotionObservers:function(){this.promotionList.on("change",this.onChange,this),this.promotionList.on("reset",this.render,this),this.promotionList.on("change:selected",this.onSelectionChanged,this),this.promotionList.on("change:name",this.saveGroupName,this)},removePromotionObservers:function(){this.promotionList.off("change",this.onChange,this),this.promotionList.off("reset",this.render,this),this.promotionList.off("change:selected",this.onSelectionChanged,this),this.promotionList.off("change:name",this.saveData,this)},saveGroupName:function(t){t.save()},initLargePromotionList:function(t,e){this.largePromotionListView=new Mimi.LargePromotionListView({collection:this.promotionList,el:t,headerEl:e})},initPaginator:function(e){t(e).empty(),this.paginator=new Mimi.PaginatorView({collection:this.promotionList,appendTo:e}),this.paginator.render(),this.promotionList.pager()},initSearch:function(t){this.searchView=new Mimi.SearchView({appendTo:t}),this.searchView.render()},initSelectedPromotions:function(t,e){this.selectedPromotions=new Mimi.SelectedPromotionsView({appendTo:t,headerEl:e})},render:function(){this.promotionListView.render(),this.paginator.render(),this.renderSelectedSection(),t("html,body").scrollTop(this.getScrollTo())},getScrollTo:function(){return this._scrollTo},setScrollTo:function(t){this._scrollTo=t},afterPromotionsSearch:function(t){this.removePromotionObservers(),this.promotionList=t,this.initPromotionObservers(),this.paginator.collection=this.promotionList,this.promotionList.pager()},onChange:function(t){var e=t&&"selected"===_.keys(t.changedAttributes()).join(""),i=t&&"open"===_.keys(t.changedAttributes()).join("");e||i||this.render()},onSelectionChanged:function(){this.largePromotionListView.show(this.getCurrentIds());var t=this.getSelectedIds();this.updateRoute(t),this.saveSelected(t),this.renderSelectedSection()},getSelectedIds:function(){return _.map(this.getSelected(),function(t){return t.get("id")})},updateUrl:function(){this.updateRoute()},updateRoute:function(t){t=t||this.getSelectedIds();var e=t.length>0?"selected="+t:"",i=this.promotionListView.searchStr?"&query="+this.promotionListView.searchStr:"",s="recent";e+i!=""&&(s=e+i),this.router.navigate(s),this.setDashboardTabLinkRoute(s)},setDashboardTabLinkRoute:function(e){t("li.dashboard-nav.nav.current a").attr("href","promotions#"+e)},saveSelected:function(e){e=e||this.getSelectedIds(),t.post("promotions/save_selected",{selected:e.join(",")})},renderSelectedSection:function(){this.selectedPromotions.render(this.getSelected())},toJSON:function(){return this.promotionList.toJSON()},serialize:function(){window.alert(JSON.stringify(this))},getSelected:function(){return this.promotionListView.getSelected()},getCurrentIds:function(){return this.promotionListView.getCurrentIds()}})}(jQuery),Mimi.Dashboard.bootstrap=function(t){window.appView=new Mimi.AppView({data:Mimi.Dashboard.Data,searchListEl:t(".promotion_lists")[0],searchEl:t("#promotion_search_form .field")[0],paginationEl:t(".pagination")[0],selectedPromotionsEl:t(".promotion_selected_list")[0],selectedPromotionsHeaderEl:t(".selected_promotions_header")[0],largePromotionsEl:t("#promotion_list")[0],largePromotionsHeaderEl:t(".main header h2")[0]}),Backbone.history&&Backbone.history.start({root:"/promotions"})},function(t){var e="#action_nav .scheduled_mailings, .subtab.scheduled_mailings";t(e).on("click",function(){return Mimi.Dashboard.ScheduledMailingsDialog.show(),!1}),Mimi.Dashboard.ScheduledMailingsDialog=Class.create(Widget.Dialog,{initialize:function($super){$super(I18n.t("js.dashboard.scheduled_mailings_dialog.title"),this.LOADING,{autoHide:!0,fixedPosition:!1,hideTrigger:".window_close, .close"}),this.$element.on("click",_.bind(this.click,this)),this.initConfirmation()},initConfirmation:function(){this.confirmDialog=new Widget.ConfirmDialog(I18n.t("js.dashboard.scheduled_mailings_dialog.initConfirmation.title"),I18n.t("js.dashboard.scheduled_mailings_dialog.initConfirmation.body"),{onOk:_.bind(this.deleteSchedule,this),onHide:_.bind(this.options.overlay.show,this.options.overlay),styles:{position:"absolute",zIndex:10000007,display:"none"}})},show:function($super,i){t(e).addClass("selected"),this.account=i?t(i).identify():Mimi.User.email,this.setBody(this.LOADING),$super(),this.populateData()},populateData:function(){t.get("/scheduled_mailings",{account:this.account}).done(_.bind(function(e){this.dom.$body.html(e),this.account="All Accounts",this.setAccountButtonDisplay(),t("#scheduled_mailings_search_bar").on("keypress",_.bind(this.checkForEnter,this)),this.position()},this)).fail(function(t){Widget.MimiFlash.error(t)})},checkForEnter:function(t){return 13===t.keyCode?(this.searchFor(),!1):void 0},setAccountButtonDisplay:function(){this.addSelect=new Widget.Dropdown(t("#account_select"),{keepStartText:!0,onItemClick:_.bind(this.selectAccount,this)}),this.showMailings("All Accounts")},updatePlaceholder:function(e,i){var s;s=e==Mimi.User.id?I18n.t("js.dashboard.scheduled_mailings_dialog.search_placeholder.my_account"):"All Accounts"==e?I18n.t("js.dashboard.scheduled_mailings_dialog.search_placeholder.all_accounts"):_.template(I18n.t("js.dashboard.scheduled_mailings_dialog.search_placeholder.child_account"))({name:i}),t("#scheduled_mailings_search_bar").attr("placeholder",s)},showMailings:function(e){t("tr").each(function(){if(t(this).show(),"All Accounts"!==e){var i="user_"+e;t(this).hasClass(i)||t(this).hide()}}),this.countVisible()},countVisible:function(){var e=t("tr:visible").length;t("#no_mailings").toggle(0==e)},searchFor:function(){var e=t("#scheduled_mailings_search_bar").val().toLowerCase(),i="user_"+this.account,s="All Accounts"===this.account;t("tr").each(function(){var n=t(this);n.hide();var o=n.children().first().text().toLowerCase();o.indexOf(e)>-1&&(n.hasClass(i)||s)&&n.show()}),this.countVisible()},selectAccount:function(e){var i="all_accounts"===t(e).parent("li").attr("id")?"All Accounts":t(e).parent("li").attr("id").split("user_")[1];this.account=i,t(".select_account").show(),t(e).parent("li").hide();var s=t(e).text();if(i===Mimi.User.id)s=I18n.t("js.dashboard.scheduled_mailings_dialog.button_text.my_account");else if("All Accounts"===i)s=I18n.t("js.dashboard.scheduled_mailings_dialog.button_text.all_accounts");else{var n=_.template(I18n.t("js.dashboard.scheduled_mailings_dialog.button_text.child_account"));s=n({name:s})}t("#account_name").html(s),t("#scheduled_mailings_search_bar").html(""),this.updatePlaceholder(i,s),this.showMailings(i)},hide:function($super){t(e).removeClass("selected"),$super()},click:function(e){var i=t(e.target).closest(".btn.delete"),s=t(e.target).closest(".btn.search");return i.length>0?(this.deleteUrl=i.attr("href"),this.deleteId=i.data("id"),this.confirmDialog.show(),!1):s.length>0?(this.searchFor(),!1):void 0},deleteSchedule:function(){this.setBody(this.LOADING),t.ajax({url:this.deleteUrl,type:"delete"}).done(_.bind(this.onDeleteSuccess,this))},onDeleteSuccess:function(){this.populateData(),this.fire("schedule:deleted",{id:this.deleteId})},LOADING:'<p class="loading">&nbsp;</p>'}).singleton("show")}(jQuery),function(t){Mimi.Dashboard.GettingStarted=Class.create({initialize:function(){this.resetTimer(),this.initializeData(),Mimi.Dashboard.GettingStarted.Step1.get(),Mimi.Dashboard.GettingStarted.Step2.get(),Mimi.Dashboard.GettingStarted.Step3.get()},initializeData:function(){this.data=Mimi.Dashboard.GettingStarted.Data},trackEvent:function(e){t.ajax({type:"PUT",url:this.data.trackingUrl,data:{event:e,seconds_spent:this.calculateSecondsSpentSinceLastEvent()},error:console.error}),this.resetTimer()},calculateSecondsSpentSinceLastEvent:function(){return Math.round((new Date-this.timerStartedAt)/1e3)},resetTimer:function(){this.timerStartedAt=new Date}}).singleton("trackEvent","calculateSecondsSpentSinceLastEvent")}(jQuery),function(t){Mimi.Dashboard.GettingStarted.Base=Class.create({setup:function(e){this.$element=t("body"),this.dom=this.$element.getChildren(_.extend({},Mimi.Dashboard.GettingStarted.Base.DOM,Mimi.Dashboard.GettingStarted[e].DOM)),this.$step=this.dom["$"+e.toLowerCase()]},initializeData:function(){this.data=Mimi.Dashboard.GettingStarted.Data},show:function(t){this.dom.$step1.toggle("step1"==t),this.dom.$step2.toggle("step2"==t),this.dom.$step3.toggle("step3"==t)},isVisible:function(){return this.$step.is(":visible")}}),Mimi.Dashboard.GettingStarted.Base.DOM={step1:".getting_started__section1",step2:".getting_started__section2",step3:".getting_started__section3"}}(jQuery),function(t){Mimi.Dashboard.GettingStarted.Step1=Class.create(Mimi.Dashboard.GettingStarted.Base,{initialize:function(){this.setup("Step1"),this.initializeData(),this.initializeObservers()},enableDragDrop:function(){this.originalDragOver=window.ondragover,this.originalDragLeave=window.ondragleave,this.originalDrop=window.ondrop,window.ondragover=_.bind(this.onDragOver,this),window.ondragleave=_.bind(this.onDragLeave,this),window.ondrop=_.bind(this.onDrop,this)},disableDragDrop:function(){window.ondragover=this.originalDragOver,window.ondragleave=this.originalDragLeave,window.ondrop=this.originalDrop},initializeObservers:function(){this.dom.$fileInput.on("change",_.bind(this.onFileInputChanged,this)),this.dom.$dropArea.on("mousemove",_.bind(this.onDropAreaMouseMoved,this)),this.dom.$colors.on("click",_.bind(this.onColorClicked,this))},show:function($super){$super("step1"),this.dom.$fileInput=this.$element.find("#promotion_image")},onDragOver:function(e){e.preventDefault();var i=t(e.target).closest(this.dom.$dropArea);0==i.length?this.updateDropArea("dragged error","dragged-drop-area",I18n.t("js.getting_started.step1.drop_image")):this.updateDropArea("dragged-drop-area error","dragged",I18n.t("js.getting_started.step1.let_go")),this.dom.$errorElem.hide()},onDragLeave:function(t){t.preventDefault(),this.dom.$dropArea.removeClass("dragged dragged-drop-area")},onDrop:function(e){e.preventDefault();var i=t(e.target).closest(this.dom.$dropArea);return this.file=e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files[0],0==i.length?void this.dom.$dropArea.removeClass("dragged dragged-drop-area"):(this.submitFile(),!1)},onFileInputChanged:function(e){e.preventDefault(),t(e.target).attr("id")==this.dom.$fileInput.attr("id")&&(this.file=e.target.files&&e.target.files[0],this.submitFile())},submitFile:function(){this.file&&this.validateFile()&&(delete this.data.themeId,this.data.file=this.file,this.resetDropArea(),Mimi.Dashboard.GettingStarted.trackEvent("uploaded_logo"),Mimi.Dashboard.GettingStarted.Step2.show())},validateFile:function(){return!Mimi.supportsFileAPI()||0!=this.file.size&&this.file.isImage()?!0:(this.updateDropArea("dragged dragged-drop-area","error",I18n.t("js.getting_started.step1.drop_area_error_message")),this.showElement("errorElem"),this.dom.$errorElem.text(I18n.t("js.getting_started.step1.file_type_error_message")),!1)},showElement:function(t){this.dom.$errorElem.toggle("errorElem"==t),this.dom.$statusBar.toggle("statusBar"==t),this.dom.$trophy.toggle("trophy"==t)},updateDropArea:function(t,e,i){this.dom.$dropArea.removeClass(t).addClass(e).find("span").html(i)},resetDropArea:function(){var t=Mimi.supportsFileAPI()?It.it("js.getting_started.show.section1.drop_logo",{br:It.tag("br")}):It.it("js.getting_started.show.section1.click_to_upload",{br:It.tag("br")});this.updateDropArea("dragged dragged-drop-area error","",t)},onDropAreaMouseMoved:function(t){var e=this.dom.$fileInput.outerWidth(),i=this.dom.$fileInput.outerHeight(),s=this.dom.$dropArea.offset();this.dom.$fileInput.css({top:t.pageY-s.top-i/2,left:t.pageX-s.left-e+20})},onColorClicked:function(e){e.preventDefault(),this.resetDropArea();var i=t(e.currentTarget);delete this.data.file,this.data.themeId=i.data("theme-id"),Mimi.Dashboard.GettingStarted.trackEvent("selected_color"),Mimi.Dashboard.GettingStarted.Step2.show()}}).singleton("show","enableDragDrop","disableDragDrop"),Mimi.Dashboard.GettingStarted.Step1.DOM={dropArea:"#getting_started__drop_image",statusBar:".status_bar",errorElem:".error_message",trophy:".complete_trophy",fileInput:"#promotion_image",colors:[".colors .btn"]}}(jQuery),function(){Mimi.Dashboard.GettingStarted.Step2=Class.create(Mimi.Dashboard.GettingStarted.Base,{initialize:function(){this.setup("Step2"),this.initializeData(),this.initializeObservers()},initializeObservers:function(){this.dom.$organization.on("keyup",_.bind(this.orgValidation,this)),this.dom.$postalAddress.on("keyup",_.bind(this.postalAddressValidation,this)),this.dom.$url.on("keyup",_.bind(this.urlValidation,this)),this.dom.$back.on("click",_.bind(this.onBackClick,this)),this.$element.on("keyup",_.bind(this.onKeyUp,this)),this.dom.$submit.on("click",_.bind(this.submit,this))},show:function($super){$super("step2"),this.invalidateUI(),Mimi.isIE9()||this.dom.$organization.focus()},invalidateUI:function(){this.dom.$urlField.toggle(!this.data.themeId)},orgValidation:function(t){if(t.preventDefault(),!t.isKey("tab")){var e=(this.isEmptyOrPlaceholder(this.dom.$organization),this.organizationValid());this.updateClasses(this.dom.$organization,e),this.updateSubmitButton({organizationValid:e})}},postalAddressValidation:function(t){if(t.preventDefault(),!t.isKey("tab")){var e=(this.isEmptyOrPlaceholder(this.dom.$postalAddress),this.postalAddressValid());this.updateClasses(this.dom.$postalAddress,e),this.updateSubmitButton({postalAddressValid:e})}},urlValidation:function(t){if(t.preventDefault(),!t.isKey("tab")){var e=this.urlValid();this.updateClasses(this.dom.$url,e),this.updateSubmitButton({urlValid:e})}},updateSubmitButton:function(t){this.dom.$submit.toggleClass("disabled",!this.formValid(t))},formValid:function(t){t=t||{};var e=t.postalAddressValid||this.postalAddressValid(),i=t.organizationValid||this.organizationValid(),s=t.urlValid||this.urlValid();return i&&e&&s},organizationValid:function(){return!this.isEmptyOrPlaceholder(this.dom.$organization)},postalAddressValid:function(){return!this.isEmptyOrPlaceholder(this.dom.$postalAddress)},urlValid:function(){return this.isEmptyOrPlaceholder(this.dom.$url)||this.dom.$url.val().isUrl()},isEmptyOrPlaceholder:function(t){var e=t.val(),i=t.attr("placeholder");return 0==e.length||e==i},onKeyUp:function(t){t.preventDefault(),t.isKey("return")&&this.isVisible()&&this.formValid()&&this.submit()},submit:function(t){t&&t.preventDefault(),this.dom.$submit.hasClass("disabled")||(this.dom.$submit.addClass("disabled"),this.data.organizationName=this.dom.$organization.val(),this.data.postalAddress=this.dom.$postalAddress.val(),this.data.url=this.dom.$url.val(),this.data.url==this.dom.$url.attr("placeholder")?this.data.url="":this.data.url.length>0&&!/^https?:\/\//.test(this.data.url)&&(this.data.url="http://"+this.data.url),Mimi.Dashboard.GettingStarted.trackEvent("submitted_information"),Mimi.Dashboard.GettingStarted.Step3.show(),this.dom.$submit.removeClass("disabled"))},onBackClick:function(t){t.preventDefault(),Mimi.Dashboard.GettingStarted.Step1.show()},updateClasses:function(t,e){var i=this.isEmptyOrPlaceholder(t);t.toggleClass("attention",!e).parent().toggleClass("filled",!i).toggleClass("completed",!i&&e)}}).singleton("show"),Mimi.Dashboard.GettingStarted.Step2.DOM={inputs:[".getting_started__section2 .input_group .input"],organization:"#getting_started__organization",postalAddress:"#getting_started__postal_address",urlField:".getting_started__url_field",url:"#getting_started__url",submit:".getting_started__section2 .getting_started__go",back:".getting_started__section2 .back"}}(jQuery),function(t){Mimi.Dashboard.GettingStarted.Step3=Class.create(Mimi.Dashboard.GettingStarted.Base,{initialize:function(){this.setup("Step3"),this.initializeData(),this.initializeObservers()},initializeObservers:function(){},show:function($super){$super("step3"),this.updatePromotion()},updatePromotion:function(){var e=this.buildParams();Mimi.supportsFileAPI()?t.ajax({type:"POST",url:this.data.gettingStartedUrl,data:t.serializeFormData(e),cache:!1,contentType:!1,processData:!1,success:_.bind(this.onCreatePromotionSuccess,this),error:_.bind(this.onCreatePromotionError,this)}):t.iframeAjax({url:this.data.gettingStartedUrl,data:e,complete:_.bind(this.onCreatePromotionComplete,this)})},onCreatePromotionComplete:function(e){var i=t.parseJSON(e);i.success?this.onCreatePromotionSuccess(i.result):this.onCreatePromotionError({responseText:i.error})},onCreatePromotionSuccess:function(t){document.location.href=t.edit_promotion_url},onCreatePromotionError:function(t){Mimi.Dashboard.GettingStarted.Step2.show(),Widget.MimiFlash.error(t.responseText)},buildParams:function(){var t={promotion_id:this.data.promotionId,user:{organization_name:this.data.organizationName,postal_address:this.data.postalAddress},promotion_module:{organization_name:this.data.organizationName,url:this.data.url}};return _.extend(t,this.buildThemeLogoParams()),_.extend(t,this.buildPromotionParams()),t},buildThemeLogoParams:function(){return this.data.themeId?{}:{theme_logo:{theme_logo:this.data.file||t("#promotion_image"),url:this.data.url}}},buildPromotionParams:function(){return this.data.themeId?{promotion:{master_theme_id:this.data.themeId}}:{}}}).singleton("show"),Mimi.Dashboard.GettingStarted.Step3.DOM={}}(jQuery),Mimi.Addons={},function(t){Mimi.Addons.SelectAddons=Class.create(Widget.Observer,{initialize:function(){this.block=new Widget.BlockOverlay,this.$element=t("#addons"),this.$element.on("click",_.bind(this.click,this)),this.confirm=new Widget.ConfirmDialog(I18n.t("MimiFlash.addons.select_addons.initialize.disable_title"),I18n.t("MimiFlash.addons.select_addons.initialize.confirm_disable.start")+"<br><br>"+I18n.t("MimiFlash.addons.select_addons.initialize.confirm_disable.end")),t(document).on("dialog:ok",_.bind(this.toggle,this))},click:function(e){var i=t(e.target).parents("a.switch"),s=t(e.target).parents("li");if(i[0]&&!i.hasClass("disabled"))return s.hasClass("subscribed")||s.hasClass("free")?(this.data={$a:i,$li:s},s.hasClass("free")?this.toggle():this.confirm.show()):document.location=i.find("span").attr("href"),!1},toggle:function(e,i){if(!e||i.source===this.confirm){var s=this.data.$li,n=this.data.$a;this.toggleOnOff(n,s);var o=t.post(n.prop("href")).done(_.bind(this.onToggleSuccess,this)).fail(_.bind(this.onToggleFailure,this));o.data=this.data}},onToggleSuccess:function(t,e,i){var s=i.data.$li;s.find("span.addon-setup > span").toggle(s.hasClass("subscribed")),this.block.hide()},onToggleFailure:function(t,e,i){var s=i.data.$a,n=i.data.$li;this.block.hide(),this.toggleOnOff(s,n),Widget.MimiFlash.error(I18n.t("MimiFlash.addons.select_addons.onToggleFailure"))},toggleOnOff:function(t,e){t.hasClass("on")?(e.addClass("unsubscribed").removeClass("subscribed"),t.removeClass("on")):(e.addClass("subscribed").removeClass("unsubscribed"),t.addClass("on"))}}).singleton()}(jQuery),function(t){Mimi.Addons.DisplayNames=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#main"),this.dom=this.$element.getChildren(e),this.dom.$addSelect[0]&&(this.addSelect=new Widget.Dropdown(this.dom.$addSelect[0],{keepStartText:!0,onItemClick:_.bind(this.onAdd,this)}),this.dom.$form.on("click",_.bind(this.onClick,this)),this.dom.$form.on("submit",_.bind(this.onSubmit,this)),this.dom.$inputs.on("keydown",_.bind(this.onKeyDown,this)),t(window).on("beforeunload",_.bind(this.onBeforeUnload,this)),this.setAddState())},onAdd:function(e){var i=t(e).parents("li"),s=_.last(i.identify().split("_")),n=t("#list_"+s);i.hide(),n.show(),this.onEdit(n),this.switchToHasDisplayNames(),this.setAddState()},switchToHasDisplayNames:function(){this.dom.$welcome.is(":visible")&&(this.dom.$welcome.fadeSlide(),this.dom.$header.appearSlide(),this.dom.$actions.show(),this.dom.$addAction.removeClass("bottom").addClass("top"))},setAddState:function(e){var i=_.select(this.addSelect.getItems(),function(e){return"none"!=t(e).parent().css("display")});e||i.length>0?this.addSelect.enable():this.addSelect.disable()},onClick:function(e){var i=t(e.target).closest(".btn");if(i[0]){var s=i.detectClass("edit","save","delete"),n=i.closest(".field");switch(s){case"edit":this.onEdit(n);break;case"save":this.onSave(n);break;case"delete":this.onDelete(n)}}},onEdit:function(t){t.addClass("editing"),_.defer(function(){t.find("input").select()})},onKeyDown:function(e){if(13===e.keyCode){var i=t(e.target).parents(".field");return this.onSave(i),!1}},onSave:function(t){t.removeClass("editing").find(".editor .name").html(t.find("input").val()),this.dom.$submit.enable()},onDelete:function(e){e.hide().removeClass("editing"),e.find("input").val("");var i=_.last(e.identify().split("_"));t("#list_available_"+i).show(),this.dom.$submit.enable(),this.setAddState(!0)},onSubmit:function(){return t.ajax({url:this.dom.$form.attr("action"),type:this.dom.$form.attr("method")||"get",data:this.dom.$form.serialize()}).done(_.bind(this.onSubmitSuccess,this)).fail(_.bind(this.onSubmitFailure,this)),this.dom.$submit.disable().html(I18n.t("MimiFlash.addons.display_names.onSubmit")),!1
},onSubmitSuccess:function(t){this.restoreSubmitButton(),t.success?Widget.MimiFlash.create(I18n.t("MimiFlash.addons.display_names.onSubmitSuccess.success")):(Widget.MimiFlash.error(I18n.t("MimiFlash.addons.display_names.onSubmitSuccess.error")+"\n"+t.error),this.dom.$submit.enable())},onSubmitFailure:function(){this.restoreSubmitButton(),Widget.MimiFlash.error(I18n.t("MimiFlash.addons.display_names.onSubmitFailure")),this.dom.$submit.enable()},onBeforeUnload:function(){return this.needsSaving()?I18n.t("MimiFlash.addons.display_names.onBeforeUnload.start")+"\n\n"+I18n.t("MimiFlash.addons.display_names.onBeforeUnload.end"):void 0},restoreSubmitButton:function(){this.dom.$submit.disable().html(I18n.t("MimiFlash.addons.display_names.restoreSubmitButton"))},needsSaving:function(){return!this.dom.$submit.prop("disabled")}}).singleton();var e={form:"#display_names",addSelect:"#display_name_add",addSelect:"#display_name_add",submit:"#display_names_save",inputs:["#display_names input"],header:".has_display_names",welcome:".no_display_names",addAction:"#display_names_add_action",actions:"#display_names_actions"}}(jQuery),function(t){Mimi.Addons.SurveyMonkeySurveys=Class.create(Widget.Dropdown,{initialize:function($super){$super("#survey_monkey_surveys_select",{position:"center farTop"}),this.options.keepStartText=!0,this.observe("dropdown:item:selected",_.bind(this.click,this))},show:function($super,t,e,i){this.editor=t,this.owner=e,this.dom.$button=e,this.setItems(_.map(i,function(t){return[t.title,t.url]})),this.setOptions({anchor:e}),$super()},click:function(e,i){var s=t(i.element);if(s[0])return this.hide(),this.editor.insertSurveyMonkeyLink(s.text(),s.data("value")),!1},destroy:function($super){this.stopObserving(),$super()}}).singleton("show"),Mimi.Addons.SurveyMonkeySurveys.DOM={list:"ul",items:["ul li a"]},Mimi.Addons.SurveyMonkeySurveys.ITEM_TEMPLATE=_.template("<li><a href='#'><span>#{name}</span></a></li>")}(jQuery),function(t){Mimi.Addons.EventBriteEvents=Class.create(Widget.Dropdown,{initialize:function($super){$super("#event_brite_events_select",{position:"center farTop"}),this.options.keepStartText=!0,this.observe("dropdown:item:selected",_.bind(this.click,this))},show:function($super,e,i,s){this.editor=e,this.owner=i,this.dom.$button=t(i),this.setItems(_.map(s,function(t){return[t.title,t.url]})),this.setOptions({anchor:i}),$super()},click:function(e,i){var s=t(i.element);if(s[0])return this.hide(),this.editor.insertEventBriteLink(s.text(),s.data("value")),!1},destroy:function($super){this.stopObserving(),$super()}}).singleton("show"),Mimi.Addons.EventBriteEvents.DOM={list:"ul",items:["ul li a"]},Mimi.Addons.EventBriteEvents.ITEM_TEMPLATE=_.template("<li><a href='#'><span>#{name}</span></a></li>")}(jQuery),function(t){Mimi.Addons.Shared=Class.create(Widget.Observer,{initialize:function(){t("#shared_items a.delete").on("click",_.bind(this.onClick,this))},onClick:function(e){var i=t(e.target),s=t.ajax({url:i.attr("href"),type:"delete"}).done(_.bind(this.onDeleteSuccess,this)).fail(_.bind(this.onDeleteFailure,this));return s.$item=i.parents("tr"),s.$item.hide(),!1},onDeleteSuccess:function(t,e,i){t.success||(Widget.MimiFlash.error(I18n.t("MimiFlash.addons.shared.onDeleteSuccess")+"\n"+t.error),i.$item.show())},onDeleteFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.addons.shared.onDeleteFailure"))}}).singleton()}(jQuery),function(t){Mimi.Addons.Search=Class.create({initialize:function(){this.$element=t("#search_addons"),this.$element.val(""),this.$featureListItems=t("ul#features li[data-keywords]"),this.$integrationsListItems=t("ul#integrations li[data-keywords]"),this.$resultList=t("#results"),this.$element.on("keyup",_.bind(this.onSearchAddonsKeyUp,this)),this.$noResults=t("#no_search_results_features"),this.initTabs(),t("#no_search_results").on("click",_.bind(this.clearSearch,this))},initTabs:function(){this.tabs=new Widget.Tabs("#addon_tabs",{noState:!0}),this.tabs.show(0),this.$resultsTab=t(this.tabs.$tabs[2]),this.$resultsTab.hide(),t(document).on("tab:switched",_.bind(this.onTabSwitched,this))},onSearchAddonsKeyUp:function(t){if(27===t.keyCode)return this.clearSearch(),!1;var e=_.select(this.$element.val().split(/\s+/),function(t){return""!==t.trim()});0===e.length?this.clearSearch():this.search(e)?this.hideNoSeachResults():this.showNoSearchResults()},onTabSwitched:function(e,i){!t(i.tab).hasClass("results")&&this.searchVisible()&&(this.lastTab=null,this.clearSearch())},search:function(e){this.lastTab||(this.lastTab=this.tabs.findCurrentTab()),this.$resultList.html(""),this.$resultsTab.show(),this.tabs.show(2);var i=this.getSearchResults(e);return this.$resultList.append(_.map(i,function(e){return t(e).clone()})),i.length>0},getSearchResults:function(t){return this.getSearchResultsFor(this.$featureListItems,t).concat(this.getSearchResultsFor(this.$integrationsListItems,t))},getSearchResultsFor:function(e,i){var s=_.select(e,function(e){return this.checkIfItemMatchesHard(t(e),i)},this);return 0==s.length&&(s=_.select(e,function(e){return this.checkIfItemMatchesSoft(t(e),i)},this)),s},checkIfItemMatchesHard:function(t,e){return _.all(e,function(e){return t.attr("data-keywords").indexOf(e.toLowerCase())>-1})},checkIfItemMatchesSoft:function(t,e){return _.any(e,function(e){return t.attr("data-keywords").indexOf(e.toLowerCase())>-1})},showSearchResults:function(t){t.each(function(t){this.$resultList.insert(t.cloneNode(!0))},this)},hideNoSeachResults:function(){this.$noResults.hide()},showNoSeachResults:function(){this.$noResults.hide().find(".query").html(this.$element.val())},clearSearch:function(){this.$element.val("").focus(),this.hideNoSeachResults(),this.$resultsTab.hide(),this.lastTab&&this.tabs.show(this.lastTab),this.lastTab=null},searchVisible:function(){return this.$resultsTab.is(":visible")}}).singleton()}(jQuery),function(t){Mimi.Addons.Zoho=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#main"),this.dom=this.$element.getChildren(Mimi.Addons.Zoho.DOM),this.initObservers()},initObservers:function(){t(document).on("import:finished",_.bind(this.importFinished,this)),t(document).on("import:failed",_.bind(this.importFailed,this)),this.dom.$importButton.on("click",_.bind(this.startImport,this))},startImport:function(){return t.ajax({url:"/zoho_crm_import/",type:"post",headers:{Accept:"application/json"}}).always(_.bind(function(t){this.importStarted(t)},this)),!1},importFinished:function(){this.dom.$importPane.show(),this.dom.$currentImportStatus.slideUp(),this.dom.$importButton.enable()},importStarted:function(t){Widget.MimiFlash.create(I18n.t("MimiFlash.addons.zoho.importStarted")),this.dom.$currentImportStatus.is(":visible")||(this.dom.$importStartedAtTime.html(t.import_started_at),this.dom.$importPane.slideUp(),this.dom.$currentImportStatus.slideDown())},importFailed:function(){this.dom.$currentImportStatus.slideUp(),this.dom.$importFailed.slideDown(),this.dom.$zohoCredentials.slideDown()}}).singleton(),Mimi.Addons.Zoho.DOM={zohoCredentials:"#zoho_credentials",importPane:"#import_pane",importButton:"#import_button",currentImportStatus:"#current_import_status",importFailed:"#import_failed",importStartedAtTime:"#import_started_at_time"}}(jQuery),Mimi.Addons.SubscriptionManagement=function(t){function e(t){return S.find(".row[data-list-id="+t+"]")}function i(t){return k.find(".row[data-list-id="+t+"]")}function s(t){return t.displayName||t.name}function n(t){var s=e(t.id),n=i(t.id);s.replaceWith(_.template(I)(t)),n.replaceWith(_.template(D)(t))}function o(t){x.data("list-id",t.id),x.val(s(t)),P.show()}function a(t){return _.find(F,function(e){return e.id===t})}function r(){return _.select(F,function(t){return t.isPublic})}function l(t){return _.select(F,function(e){var i=t.toLowerCase();return e.name.toLowerCase().match(i)||e.displayName.toLowerCase().match(i)})}function d(){S.on("click","li.row",function(e){e.preventDefault();var i=t(e.currentTarget),s=a(i.data("list-id"));s.isPublic=!s.isPublic,g(s);var n=k.find(".row[data-list-id="+s.id+"]");n.find("td").highlight({duration:1500})})}function h(){return k.find("tbody tr:first .edit")[0]}function c(){Widget.MimiVoice.show(h(),I18n.t("MimiFlash.addons.subscription_management.showTip"))}function u(){Widget.MimiVoice.hide(h())}function m(){k.on("click","a.js_remove",function(e){e.die();var i=t(e.currentTarget),s=i.parents(".row"),n=a(s.data("list-id"));n.isPublic=!1,g(n)})}function p(t){var e=_.template(I18n.t("MimiFlash.addons.subscription_management.showUpdateNotice")),i=e({list_name:t.name});Widget.MimiFlash.create(i)}function f(t){var e=_.template(I18n.t("MimiFlash.addons.subscription_management.showUpdateError")),i=e({list_name:t.name});Widget.MimiFlash.error(i)}function g(i){var s=e(i.id);i.hidden=!1,s.replaceWith(_.template(I)(i)),y(),t.ajax({type:"PUT",url:"/subscription_management",data:{list_id:i.id,is_public:i.isPublic}})}function b(){t("#edit_display_name_form").on("submit",function(e){e.preventDefault();var i=x.data("list-id"),s=x.val(),o=a(i);o.displayName=s;var r={};r[o.id]=o.displayName,t.ajax({type:"POST",url:"/display_names/update_async",data:{audience_lists:r}}).done(function(){n(o),P.hide(),p(o)}).fail(function(){f(o)})})}function v(){k.on("click","tr.js_edit",function(e){e.preventDefault();var i=t(e.currentTarget),s=a(i.data("list-id"));u(),o(s)})}function y(){var e=[],i=r();if(t.each(i,function(t,i){e.push(_.template(D)(i))}),k.find("tbody").html(e.join("")),i.length){k.attr("style","display: table !important"),M.hide();var s=!_.detect(i,function(t){return t.displayName});s&&c()}else k.attr("style","display: none !important"),M.show()}function w(e){var i=[],s=Math.ceil(e.length/$);t.each(e,function(t,e){e.page=Math.ceil((t+1)/$),e.hidden=e.page>1,i.push(_.template(I)(e))}),S.html(i.join("")),Mimi.Modules.preloadedPagination.init(S,T,s)}function C(){t("#search_lists").on("keyup",_.debounce(function(){var e=t(this).val(),i=l(e);w(i)},300))}var S,k,M,T,D,I,x,P,F,$,A={};return A.init=function(e,i){F=e,$=i,S=t("#all_audience_lists"),k=t("#public_audience_lists"),M=t("#no_public_audience_lists"),T=t("#all_audience_lists_pagination .pages"),D=t(".public-list-template").html(),I=t(".list-template").html(),x=t("#display_name"),P=new Widget.Popup("#edit_display_name_modal",{hideTrigger:".back, .window_close",overlay:Widget.ModalOverlay,fixedPosition:!1}),w(F),b(),v(),y(),d(),m(),C()},A}(jQuery),function(t){Mimi.Addons.Personalization=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#main"),this.dom=this.$element.getChildren(this.DOM),this.addSelect=new Widget.Dropdown(this.dom.$addSelect,{keepStartText:!0,onItemClick:_.bind(this.onAdd,this)}),this.dom.$customButton.on("click",_.bind(this.showModal,this)),this.dom.$form.on("click",_.bind(this.onClick,this)),this.dom.$customSave.on("click",_.bind(this.onCustomSave,this)),this.dom.$form.on("submit",_.bind(this.onSubmit,this)),this.dom.$checkboxes.on("click",_.bind(this.showFallback,this)),this.dom.$inputs.on("keydown",_.bind(this.onKeyDown,this)),this.dialog=new Widget.Popup("#custom_fields_dialog",{hideTrigger:".window_close, .back",overlay:Widget.ModalOverlay,fixedPosition:!1}),t(window).on("beforeunload",_.bind(this.onBeforeUnload,this))},tagItem:function(t){return Template.from("tag_field_template")(t)},onAdd:function(e){var i=t(e).closest("li"),s=i.data("value"),n=this.tagItem({tagName:s,tagDisplay:this.translateTagContent(s),fallback:""});i.hide();var o=t("#personalization_tag_fields").append(n);this.onEdit(o.find("li:last-child .field")),this.switchToHasPersonalizationTags(),t("#personalization_tags input").on("keydown",_.bind(this.onKeyDown,this))},translateTagContent:function(t){return"email"===t?I18n.t("personalization_tags.index.email"):"name"===t?I18n.t("personalization_tags.index.name"):"first_name"===t?I18n.t("personalization_tags.index.first_name"):"last_name"===t?I18n.t("personalization_tags.index.last_name"):"city"===t?I18n.t("personalization_tags.index.city"):"phone"===t?I18n.t("personalization_tags.index.phone"):"company"===t?I18n.t("personalization_tags.index.company"):"title"===t?I18n.t("personalization_tags.index.title"):"address"===t?I18n.t("personalization_tags.index.address"):"state"===t?I18n.t("personalization_tags.index.state"):"zip"===t?I18n.t("personalization_tags.index.zip"):"country"===t?I18n.t("personalization_tags.index.country"):void 0},switchToHasPersonalizationTags:function(){this.dom.$welcome.is(":visible")&&(this.dom.$welcome.fadeSlide(),this.dom.$header.appearSlide(),this.dom.$actions.show(),this.dom.$addAction.removeClass("bottom").addClass("top"))},onClick:function(e){var i=t(e.target).closest(".btn");if(i[0]){var s=i.detectClass("edit","save","delete"),n=i.closest(".field");switch(s){case"edit":this.onEdit(n);break;case"save":this.onSave(n);break;case"delete":this.onDelete(n)}}},onEdit:function(t){t.addClass("editing"),t.find(".editor .fallback").hide(),_.defer(function(){t.find("input").select()})},onKeyDown:function(e){if(13==e.which){var i=t(e.target).closest(".field");return this.onSave(i),!1}},onSave:function(t){var e,i=t.find(".editor .fallback"),s=t.find("input").val();i.show(),this.styleNewTag(i,s),i.html(e),t.removeClass("editing"),this.dom.$submit.enable()},onDelete:function(e){e.hide().removeClass("editing"),e.find("input").val(""),e.find(".editor .delete_tag").val("true");var i=e.find(".name").identify().toLowerCase(),s="#"+i.replace(" ","_")+"_item";this.dom.$menuItems.find(s)&&this.dom.$menuItems.find(s).show(),this.dom.$customFields.each(function(e,s){var n=t(s).identify();n==i&&t(s).show()}),this.dom.$submit.enable()},humanize:function(t){return t=t.replace("_"," "),t.charAt(0).toUpperCase()+t.slice(1)},onSubmit:function(){return this.dom.$submit.disable().html(I18n.t("MimiFlash.addons.personalization_tags.onSubmit")),t.ajax({url:this.dom.$form.attr("action"),type:this.dom.$form.attr("method")||"get",data:this.dom.$form.serialize(),dataType:"json"}).done(_.bind(this.onSubmitSuccess,this)).fail(_.bind(this.onSubmitFailure,this)),!1},onSubmitSuccess:function(t){this.restoreSubmitButton(),t.success?Widget.MimiFlash.create(I18n.t("MimiFlash.addons.personalization_tags.onSubmitSuccess.success")):(Widget.MimiFlash.error(I18n.t("MimiFlash.addons.personalization_tags.onSubmitSuccess.error")+t.error),this.dom.$submit.enable())},onSubmitFailure:function(){this.restoreSubmitButton(),Widget.MimiFlash.error(I18n.t("MimiFlash.addons.personalization_tags.onSubmitFailure")),this.dom.$submit.enable()},onBeforeUnload:function(){return this.needsSaving()?I18n.t("MimiFlash.addons.personalization_tags.onBeforeUnload.start")+"\n\n"+I18n.t("MimiFlash.addons.personalization_tags.onBeforeUnload.end"):void 0},restoreSubmitButton:function(){this.dom.$submit.disable().html(I18n.t("MimiFlash.addons.personalization_tags.restoreSubmitButton"))},needsSaving:function(){return!this.dom.$submit.is(":disabled")},showModal:function(){t("#menu_items").parent().hide(),this.dialog.show()},showFallback:function(e){var i=t(e.toElement).is(":checked"),s=t(e.toElement).nextAll("input");s[i?"show":"hide"]()},addSavedCustomFields:function(){_.each(this.dom.$customFields,function(e){var i=t(e).find(".checkbox:checked");if(!i[0])return!0;var s=t(e).find(".fallback"),n=this.humanize(s.prop("name").split("[")[1].split("]")[0]),o=s.val(),a=Template.from("tag_field_template")({tagName:n,tagDisplay:n,fallback:o});t("#personalization_tag_fields").append(a),$newFallback=t("#personalization_tag_fields li:last-child").find(".fallback"),this.styleNewTag($newFallback,o),t(e).hide(),i.prop("checked",!1),s.val(""),s.hide()},this)},styleNewTag:function(t,e){""===e?(t.html(I18n.t("personalization_tags.tag_field.no_fallback")),t.addClass("no_fallback")):(t.removeClass("no_fallback"),t.html(I18n.t("personalization_tags.tag_field.fallback")+" "+e))},onCustomSave:function(){this.addSavedCustomFields(),this.dialog.hide(),this.switchToHasPersonalizationTags(),this.dom.$submit.enable()},DOM:{form:"#personalization_tags",menuItems:"#menu_items",customSave:"#custom_save",checkboxes:[".tag_checkbox"],customFields:[".custom_field"],addSelect:"#personalization_add",submit:"#personalization_tags_save",inputs:["#personalization_tags input"],header:".has_personalization_tags",welcome:".no_personalization_tags",addAction:"#personalization_add_action",actions:"#personalization_actions",customButton:"#customfields"}}).singleton()}(jQuery),function(t){Mimi.Addons.PersonalizationTags=Class.create(Widget.Dropdown,{initialize:function($super){$super("#personalization_tags_select",{position:"center farTop"}),this.options.keepStartText=!0,this.$element.find("#add_more_link").hide(),this.observe("dropdown:item:selected",_.bind(this.click,this)),this.$element.find("#add_more_link").on("click",_.bind(this.hide,this))},show:function($super,t,e,i){this.$element.find("header").show(),this.$element.find("#add_more_link").hide(),this.editor=t,this.owner=e,this.dom.button=e,i[0]||(this.$element.find("header").hide(),this.$element.find("#add_more_link").show()),this.setItems(_.map(i,function(t){return t.displayTag=this.translatePersonalizationTags(t),""===t.fallback?[t.displayTag,t.tag]:(t.tagAndFallback=t.tag+",fallback="+t.fallback,[t.displayTag,t.tagAndFallback])},this)),this.setOptions({anchor:e}),$super()},click:function(e,i){var s=t(i.element);if(s[0])return this.hide(),this.editor.insertPersonalizationTag(s.attr("data-value")),!1},destroy:function($super){return $super(),!1}}).singleton("show"),Mimi.Addons.PersonalizationTags.DOM={list:"ul"}}(jQuery),function(t){var e=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("#madmimi_body"),this.$upgradeLinks=t(".upgrade"),_.each("Loader Tutorial ModuleAdder DragOverlay Sidebar ModuleTypeSelect Banner".split(" "),function(t){try{e[t].get()}catch(i){window.debug("Error while initializing <"+t+"> module",i)}}),this.styles=new e.PromotionModuleStyles,this.promotion=new e.Promotion(e.Data),this.dom=t("body").getChildren(i),this.initObservers(),this.setContinuation(),new e.PromotionTutorial(e.Data),Mimi.Pusher.trackPresence("promotion-"+this.promotion.getId(),_.bind(this.onPresenceChanged,this))},initObservers:function(){var i=t(document);e.Data.dripCampaign?this.dom.$continueBtn.on("click",_.bind(this.dripCampaignContinue,this)):e.Data.rssFeed?this.dom.$continueBtn.on("click",_.bind(this.rssFeedContinue,this)):this.dom.$continueBtn.on("click",_.bind(this.promotionContinue,this)),this.dom.$promotionNameInput.on("keydown",_.bind(this.onPromotionNameInput,this)),this.dom.$promotionNameInput.on("focus",_.bind(this.onPromotionNameFocus,this)),this.dom.$previewBtn.on("click",_.bind(this.promotionPreview,this)),this.dom.$saveBtn.on("click",_.bind(this.savePromotion,this)),i.on("click","a.upgrade",_.bind(this.upgrade,this)),Mimi.ABtest.isTestGroup()&&t("#madmimi_outer_wrapper").on("click",_.bind(this.changeMode,this)),t("#main").on("click",_.bind(this.changeMode,this)),t("body").on("keydown",_.bind(this.keypress,this)),setInterval(_.bind(this.checkSaveState,this),500),i.on("promotion:save:ok",_.bind(this.onPromotionSaveOk,this)),i.on("promotion:save:failed",_.bind(this.onPromotionSaveFailed,this)),i.on("promotion:module:deleted",_.bind(this.onModuleDeleted,this)),i.on("promotion:created",_.bind(this.onPromotionCreated,this)),i.on("promotion:module:deleted promotion:module:undeleted promotion:module:added composer:banner:imageChanged",_.bind(this.setContinuation,this))},checkSaveState:function(){t("body.composer")[(this.promotion.needsSaving()?"remove":"add")+"Class"]("saved")},beginSave:function(){t("body.composer").addClass("saving").removeClass("saved")},onPromotionNameInput:function(t){var e=t.which||t.keyCode,i=13==e;return i?(this.savePromotion(),!1):void 0},onPromotionNameFocus:function(){this.removeTitleTipFromInput(),this.isUntitled()&&this.dom.$promotionNameInput.select()},onPromotionCreated:function(){this.hasTitle()&&this.removeTitleTipFromInput()},onPromotionSaveOk:function(e,i){var s=i.source;this.savingComplete(s),t("#promotion-saved-timestamp .time").html(s.data.saved_at),t("#promotion-saved-timestamp").show(),this.afterSave()},onPromotionSaveFailed:function(t,e){this.savingComplete(e.source)},onPresenceChanged:function(t){if(1==t.count)this.clearStatus();else{var e=t.me,i=null;_.each(t.members,function(t,s){s!==e.id&&(i=t)});var s=e.info.session_id===i.session_id,n=e.info.ip===i.ip,o=!!i.admin;this.updateStatus(o?I18n.t("js.composer.setup.presence.admin_editing",{name:i.admin}):s&&n?I18n.t("js.composer.setup.presence.multiple_tabs"):n?I18n.t("js.composer.setup.presence.multiple_browsers"):I18n.t("js.composer.setup.presence.someone_editing"))}},updateStatus:function(t){this.dom.$statusBar.show().find("span").html(t)},clearStatus:function(){this.dom.$statusBar.hide()},savingComplete:function(){var e=t("body.composer");e.removeClass("saving"),this.promotion.needsSaving()||e.addClass("saved"),this.setContinuation()},onModuleDeleted:function(t,i){var s=i.source;(""!==s.getText().stripHTML().trim()||s.visibleImages(!0).length>0)&&new e.DeletedModule(s)},keypress:function(t){var e=t.which||t.keyCode,i=String.fromCharCode(e).toLowerCase(),s="s"===i&&(t.ctrlKey||t.metaKey)&&!t.altKey;return s?(this.savePromotion(),!1):void 0},changeMode:function(e){var i=Mimi.ABtest.isTestGroup()&&t(e.target).is("#madmimi_outer_wrapper"),s=t(e.target).is("#main");(i||s)&&this.promotion.switchMode()},loadPromotion:function(){this.fire("promotion:loading"),t.get(Promotion.ASYNC_LOAD_URL).fail(_.bind(this.promotionLoadError,this)).always(_.bind(this.promotionLoaded,this))},promotionLoaded:function(t){this.fire("promotion:loaded"),this.promotion=new Promotion(t)},promotionLoadError:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.composer.setup.promotionLoadError"))},savePromotion:function(){this.beginSave(),this.promotion.save()},enablePromotionButtons:function(){this.dom.$continueBtn.enable()},disablePromotionButtons:function(){this.dom.$continueBtn.disable()},promotionPreview:function(){this.promotion.needsSaving()&&this.savePromotion()},setContinuation:function(){this.promotion.isContentPresent()?this.enablePromotionButtons():this.disablePromotionButtons()},continueAction:function(t){this.afterSaving=t,this.disablePromotionButtons(),this.promotion.needsSaving()?this.savePromotion():this.afterSave()},promotionSchedule:function(){return this.continueAction("schedule"),!1},promotionContinue:function(t){t.die(),this.continueAction("send")},dripCampaignContinue:function(t){t.die(),this.continueAction("drip")},rssFeedContinue:function(t){t.die(),this.continueAction("feed")},upgrade:function(e,i){i||(i=""),Mimi.UpgradeDialog&&Mimi.UpgradeDialog.destroy(),Mimi.UpgradeDialog=new Mimi.Plans.UpgradeFromFreeDialog(null,i),this.$upgradeElement=t(e.target),this.$upgradeElement.hasClass("btn")&&(this.upgradePreviousText=this.$upgradeElement.text(),this.$upgradeElement.addClass("disabled"),this.$upgradeElement.html(I18n.t("MimiFlash.composer.setup.upgrade"))),this.continueAction("upgrade")},afterSave:function(){switch(this.setSelectedPromotions(),this.afterSaving){case"schedule":window.location=e.Data.schedulePath;break;case"send":window.location=e.Data.sendPath;break;case"drip":window.location=e.Data.dripCampaign.path+"#drip="+e.Data.dripCampaign.dripId;break;case"feed":window.location=e.Data.rssFeed.path+"#feed="+e.Data.rssFeed.id;break;case"upgrade":this.$upgradeElement.hasClass("btn")&&this.$upgradeElement.removeClass("disabled").html(this.upgradePreviousText),this.$upgradeElement.attr("data-mimi-upgrade","/compose/images/limit"),Mimi.UpgradeDialog.show(this.$upgradeElement),this.setContinuation();break;default:this.setContinuation()}this.afterSaving=null,this.dom.$sendBtn.children(":eq(0)").html("Send")},setSelectedPromotions:function(){var e=t("#nav_main li.current a"),i=e.prop("href").split("?"),s=i[1]?i[1].toQueryParams():{},n=s.selected?s.selected.split(","):[];n.push(this.promotion.getId().toString()),i[1]=t.param(_.extend(s,{selected:_.uniq(n).join(",")})),e.prop("href",i.join("?"))},getPromotion:function(){return this.promotion},hasTitle:function(){return!this.isUntitled()},isUntitled:function(){return _.startsWith(this.dom.$promotionNameInput.val(),I18n.t("js.models.promotion.default_name"))},removeTitleTipFromInput:function(){this.dom.$promotionNameInfo.addClass("stay")}}).singleton("savePromotion","getPromotion","markdown","upgrade");window.Composer=e;var i={sendBtn:"div.actions button.send",continueBtn:[".btn.continue"],previewBtn:"#promotion-saved-timestamp a.view",saveBtn:[".btn.save"],statusBar:".promotion-status",promotionNameInput:"input#promotion_name",promotionNameInfo:".promotion_name__info"}}(jQuery),!Mimi)var Mimi={};Mimi.util||(Mimi.util={}),function(t){var e=Array.prototype.slice,i="A H1 H2 UL OL B I SPAN CENTER DIV".split(" ");_.extend(Mimi.util,{getSelection:function(t){return t||(t=window),t.getSelection?t.getSelection():t.document.selection},getRange:function(t){var e=Mimi.util.getSelection(t);return e&&e.rangeCount>0?e.getRangeAt?e.getRangeAt(0):e.createRange?e.createRange():null:void 0},inspectRange:function(t){window.debug("range: ",t,"\nstart: ",t.startContainer,"\nstart value: ",t.startContainer.nodeValue,"\nstart parent: ",t.startContainer.parentNode,"\nstart offset: ",t.startOffset,"\nend: ",t.endContainer,"\nend value: ",t.endContainer.nodeValue,"\nend parent: ",t.endContainer.parentNode,"\nend offset: ",t.endOffset,"\nIs start node the first node in parent? ",t.startContainer.parentNode.firstChild===t.startContainer,"\nIs selection at the beginning of the first node? ",0===t.startOffset)},isListElementSelectedEntirely:function(e){return t.isNodeName(e.startContainer.parentNode,"li")&&e.startContainer.parentNode.firstChild===e.startContainer&&0===e.startOffset&&e.endContainer.parentNode.lastChild===e.endContainer&&e.endContainer.nodeValue.length===e.endOffset},isCenterElementSelectedEntirely:function(e){return 3===e.startContainer.nodeType&&t.isNodeName(e.startContainer.parentNode,"center")&&e.startContainer===e.startContainer.parentNode.firstChild&&0===e.startOffset&&e.endContainer===e.endContainer.parentNode.lastChild&&e.endOffset===e.endContainer.parentNode.lastChild.nodeValue.length},isSingleElement:function(t){return t.startContainer===t.endContainer&&t.startContainer.nodeType===Node.ELEMENT_NODE},isWithinLinkElement:function(e){return t.isNodeName(e.startContainer.parentNode,"a")||t.isNodeName(e.endContainer.parentNode,"a")},shouldClearLink:function(t){return t.startOffset!==t.endOffset&&(t.startContainer===t.startContainer.parentNode.firstChild&&0===t.startOffset||t.endOffset===t.endContainer.nodeValue.length&&t.endContainer===t.endContainer.parentNode.lastChild)},stripMarkupFromNodes:function(i){for(var s,n,o=i.length;o--;){s=t.isNodeName(i[o],"a","center")?[i[o]]:e.call(i[o].getElementsByTagName("a")).concat(e.call(i[o].getElementsByTagName("center"))),n=t.isNodeName(i[o],"ul","ol")?[i[o]]:e.call(i[o].getElementsByTagName("ul")).concat(e.call(i[o].getElementsByTagName("ol")));var a;for(a=s.length;a--;)t(s[a]).replace(s[a].innerHTML);for(a=n.length;a--;)t(n[a]).replace(n[a].innerHTML.replace(/<li>/g,"").replace(/<\/li>/g,"<br>"))}},collectNodesForMarkupStripping:function(e){var i=[],s=e.startContainer;if(this.isSingleElement(e))i.push(e.startContainer);else if(this.isWithinLinkElement(e))this.shouldClearLink(e)&&(t.isNodeName(e.startContainer.parentNode,"a")&&i.push(e.startContainer.parentNode),t.isNodeName(e.endContainer.parentNode,"a")&&e.startContainer.parentNode!==e.endContainer.parentNode&&i.push(e.endContainer.parentNode));else if(this.isCenterElementSelectedEntirely(e))i.push(e.startContainer.parentNode);else for(;s&&s!==e.endContainer;)s.nodeType===Node.ELEMENT_NODE&&i.push(s),s=s.nextSibling;return i},stripMarkupFromListElement:function(e){var i=e.startContainer.parentNode,s=i.innerHTML,n=i.parentNode,o=n.getElementsByTagName("li"),a=o.length;o[0]===i?(t(i).remove(),t(n).before(s)):o[o.length-1]===i?(t(i).remove(),t(n).after(s)):t(i).replace(s),1===a&&t(n).replace(n.innerHTML)},stripMarkupFromSelection:function(t){var e=Mimi.util.getRange(t);if(this.inspectRange(e),this.isListElementSelectedEntirely(e))return void this.stripMarkupFromListElement(e);var i=this.collectNodesForMarkupStripping(e);this.stripMarkupFromNodes(i)},getSelectionCoords:function(){var t,e="\ufeff",i="&#xfeff;",s="sel_"+(new Date).getTime()+"_"+Math.random().toString().substr(2);return function(n){var o,a;if(n.document.selection&&n.document.selection.createRange?(a=n.document.selection.createRange().duplicate(),a.collapse(!1),a.pasteHTML('<span id="'+s+'">'+i+"</span>"),t=n.document.getElementById(s)):n.getSelection&&(o=n.getSelection(),o.getRangeAt?a=o.getRangeAt(0).cloneRange():(a.setStart(o.anchorNode,o.anchorOffset),a.setEnd(o.focusNode,o.focusOffset),a.collapsed!==o.isCollapsed&&(a.setStart(o.focusNode,o.focusOffset),a.setEnd(o.anchorNode,o.anchorOffset))),a.collapse(!1),t=n.document.createElement("span"),t.id=s,t.appendChild(n.document.createTextNode(e)),a.insertNode(t)),t){var r={left:t.parentNode.offsetLeft,top:t.parentNode.offsetTop,height:t.parentNode.offsetHeight};return t.parentNode.removeChild(t),r}}}(),isCursorWithinLink:function(t){var e=this.getRange(t);return e?e.startContainer===e.endContainer&&"A"===e.startContainer.parentNode.nodeName.toUpperCase():!1},getCursorWithin:function(t){var e=this.getRange(t),i=e?e.startContainer:null,s=e?e.endContainer:null,n={};return e&&(this.findInterestingNodes(i,n),this.findInterestingNodes(s,n)),n},findInterestingNodes:function(t,e){for(var s;t=t.parentNode;)s=t.nodeName.toUpperCase(),i.include(s)&&("bold"===t.style.fontWeight&&(e.B=!0),"italic"===t.style.fontStyle&&(e.I=!0),"center"===t.style.textAlign&&(e.CENTER=!0),e[s]=!0)},selectNode:function(t,e,i){var s,n=e.createRange();n.selectNode(i),s=t.getSelection(),s.removeAllRanges(),s.addRange(n)}}),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}(),window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()}(jQuery),Composer.DragOverlay=Class.create(Widget.Observer,{initialize:function(){jQuery(document).on({dragstart:this.show,dragstop:this.hide})},show:function(){Widget.Overlay.get().show()},hide:function(){Widget.Overlay.get().hide()},destroy:function(){this.stopObserving()}}).singleton(),function(t){Composer.ImageList=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#image_list_container"),this.dom=this.$element.getChildren(Composer.ImageList.DOM),this.$navEl=t("#composer_nav"),this.$imageCountEl=t("#image_count"),this.overQuotaTemplate=Template.from("over_quota_error_template"),this.uploader=new Composer.ImageUploader,this.trash=new Composer.ImageTrash,this.observeList()},observeList:function(){t(document).on("upload:started",_.bind(this.onUploadStarted,this)),t(document).on("upload:succeeded",_.bind(this.onImageUploaded,this)),t(document).on("upload:failed",_.bind(this.onImageUploadFailed,this)),t(document).on("composer:image:deleted",_.bind(this.onImageDeleted,this)),t(document).on("composer:image:created",_.bind(this.onImageCreated,this)),this.dom.$list.on("scroll",_.bind(this.onScroll,this)),this.dom.$loadMore.on("click",_.bind(this.onLoadMoreImages,this))},onScroll:function(){this.loadImages()},onLoadMoreImages:function(e){if(e.die(),!this.dom.$loadMore.hasClass("loading")){if(this.moreImages)return this.addMoreImages();this.dom.$loadMore.addClass("loading"),t.get("/promotion_images").done(_.bind(this.onMoreImagesSucesss,this)).always(_.bind(this.onMoreImagesComplete,this))}},onMoreImagesSucesss:function(t){var e=this.images;this.moreImages=_.reject(t,function(t){return _.detect(e,function(e){return e.id===t.id})}),this.addMoreImages()},onMoreImagesComplete:function(){this.dom.$loadMore.removeClass("loading"),this.moreImages&&0!==this.moreImages.length||this.dom.$loadMore.hide()},addMoreImages:function(){for(var t=this.dom.$list,e=t[0].scrollHeight-t[0].scrollTop,i=Math.min(this.moreImages.length,12),s=0;i>s;++s)this.images.push(new Composer.Image(t[0],this.moreImages.pop(),!0,!0));t[0].scrollTop=t[0].scrollHeight-e,this.dom.$loadMore[this.moreImages.length>0?"show":"hide"](),this.loadImages()},setData:function(t){var e=this.dom.$list;this.data={quota:Composer.Data.imageQuota,count:Composer.Data.imageCount},this.checkQuota(),this.clearImages(),this.images=_.map(t,function(t){return new Composer.Image(e[0],t,!0)
}),this.loadImages()},findImage:function(t){return _.detect(this.images,function(e){return e.id===t})},addImage:function(t){this.images.push(t),this.dom.$note.hide()},setHeight:function(){},clearImages:function(){this.images&&_.invoke(this.images,"destroy"),this.images=[]},loadImages:function(){var t=this.dom.$list,e=t[0].scrollTop,i=e+t[0].scrollHeight,s=_.select(this.images,function(t){return t.$element[0].offsetTop+t.$element[0].offsetHeight>e+10&&t.$element[0].offsetTop<i-10});_.each(s,function(t){t.load()})},onUploadStarted:function(){this.dom.$note.hide(),this.incrementImageCount()},onImageUploadFailed:function(){this.decrementImageCount()},onImageUploaded:function(){this.checkQuota()},onImageDeleted:function(){this.decrementImageCount(),this.checkQuota()},onImageCreated:function(t,e){var i=new Composer.Image(this.dom.$list[0],e,!1,!0);i.load(),this.images.push(i)},incrementImageCount:function(){this.data.count++,this.updateImageCount()},decrementImageCount:function(){this.data.count--,this.updateImageCount()},updateImageCount:function(){this.$imageCountEl.html(this.data.count)},checkQuota:function(){this.overQuota()?(this.$imageCountEl.addClass("important"),this.uploader.disableUploads(),this.uploader.dom.$uploadGroup.hide(),this.uploader.dom.$upgradeGroup.show()):(this.$imageCountEl.removeClass("important"),this.uploader.disabled&&this.uploader.enableUploads(),this.uploader.dom.$uploadGroup.show(),this.uploader.dom.$upgradeGroup.hide())},overQuota:function(){return this.data.count>=this.data.quota},remainingImageQuota:function(){return this.data.quota-this.data.count},overQuotaError:function(){Widget.MimiFlash.error(this.overQuotaTemplate(),{autohide:!1})}}).singleton("setData","findImage","addImage","setHeight"),Composer.ImageList.DOM={list:"#image_list ul",loadMore:"#image_list ul li.load_more",note:".note"}}(jQuery),function(t){Composer.ImageTrash=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#image_trash"),this.dom=this.$element.getChildren(Composer.ImageTrash.DOM),this.dom.$target=t("<div>").css({position:"absolute",opacity:"0",display:"none"}).appendTo("body"),this.targetVisible=!1,this.dom.$container=Composer.ImageList.get().dom.$element,this.initDroppables()},initObservers:function(){t(document).on("composer:image:drag:started",_.bind(this.showDropTarget,this)),t(document).on("composer:image:drag:ended",_.bind(this.hideDropTarget,this)),t(document).on("composer:image_list:resized",_.bind(this.positionDropTarget,this)),t(this.document).on("window:scrolled",_.bind(this.positionDropTarget,this))},initDroppables:function(){this.$element.droppable({over:_.bind(this.enter,this),out:_.bind(this.leave,this),drop:_.bind(this.drop,this),tolerance:"pointer"})},showDropTarget:function(){this.dom.$target.show(),this.targetVisible=!0,this.positionDropTarget()},positionDropTarget:function(){this.targetVisible&&(this.dom.$target.clonePosition(this.dom.$trash[0]),this.dom.$target.viewportOffset().top!==this.dom.$trash.viewportOffset().top&&(this.dom.$target[0].style.top=parseInt(this.dom.$target[0].getStyle("top"),10)+document.viewport.getScrollOffsets().top+"px"))},hideDropTarget:function(){this.dom.$target.hide(),this.targetVisible=!1},enter:function(){this.$element.addClass("hover")},leave:function(){this.$element.removeClass("hover")},drop:function(t,e){this.$element.removeClass("hover");var i=_.detect(Composer.ImageList.get().images,function(t){return t.$element.find("img")[0]===e.draggable[0]});i&&i.trash()},destroy:function(){this.stopObserving()}}),Composer.ImageTrash.DOM={trash:".well"}}(jQuery),function($){Composer.ImageUploader=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=$("#image_upload_form"),this.dom=this.$element.getChildren(Composer.ImageUploader.DOM),this.dom.$promotionId.val(Composer.Data.promotion.id),this.list=Composer.ImageList.get(),this.dom.$list=this.list.dom.$list,this.uploadBatchTooLargeErrorTemplate=Template.from("upload_batch_too_large_error_template"),this.disableUploads(),this.initObservers(),this.initDragDrop(),this.enable(!0)},initObservers:function(){this.dom.$unlock.on("click",_.bind(this.unlockMoreImages,this)),this.dom.$file.on("change",_.bind(this.submit,this)),$(document).on("promotion:loading",_.bind(this.disableUploads,this))},initDragDrop:function(){window.ondragover=_.bind(this.ondragover,this),window.ondragleave=_.bind(this.ondragleave,this),window.ondrop=_.bind(this.ondrop,this)},ondragover:function(t){t.preventDefault&&t.preventDefault();var e=this.getDisplayElement(t.target);e&&e.addClass("hover")},ondragleave:function(t){t.preventDefault&&t.preventDefault();var e=this.getDisplayElement(t.target);e&&e.removeClass("hover")},ondrop:function(t){if(t.preventDefault&&t.preventDefault(),this.isInsideDroppableArea(t.target)){if(this.disabled)return this.ondragleave(t),!1;var e=t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files[0];if(!e)return void this.ondragleave(t);var i=this.getDisplayElement(t.target);i&&i.addClass("processing"),this.isInsideBannerContainer(t.target)&&Composer.Banner.initialExpand();var s=t.dataTransfer.files.length;if(s>this.list.remainingImageQuota())return this.overQuotaError(s),this.ondragleave(t),!1;this.disableUploads();var n;if(this.checkForCORS())for(var o,a=0;o=t.dataTransfer.files[a];a++){n=new Composer.Image(this.dom.$list[0]);var r=new Composer.CORSUploader(n,this,"afterUpload"),l=r.uploadFile(o);l||this.stopProcessing(t.target)}else n=this.uploadFile(e);if(this.ondragleave(t),!n)return void this.stopProcessing(t.target);var d="."+n.$element.selector;return $(document).on("image:thumbnail:success"+d,_.bind(this.uploadComplete,this,n,t.target)),$(document).on("upload:failed"+d,_.bind(this.uploadComplete,this,null,t.target)),!1}},checkForCORS:function(){var t=new XMLHttpRequest;return"withCredentials"in t},uploadFile:function(file){if("undefined"!=typeof FormData&&file&&file.type&&file.type.match(/^image\/.*/)){var formData=new FormData,image=new Composer.Image(this.dom.$list[0]);formData.append("upload[id]",image.upload()),formData.append("promotion[id]",this.dom.$promotionId.val()),formData.append("promotion_image[promotion_image]",file),this.dom.$list[0].scrollTop=0;var xhr=new XMLHttpRequest;return xhr.open("POST",this.dom.$form.attr("action")),xhr.onreadystatechange=function(){if(4===xhr.readyState&&200===xhr.status){var responseScript=xhr.responseText.extractScripts()[0];responseScript=responseScript.replace("parent.jQuery('#uploader_form')","jQuery('#uploader_form')"),eval(responseScript)}},xhr.send(formData),image}},uploadComplete:function(t,e){var i="."+t.$element.selector;if($(document).off("image:thumbnail:success"+i),$(document).off("upload:failed"+i),this.stopProcessing(e),t)if(this.isInsideBannerContainer(e))Composer.Banner.setImage(t);else if(this.isInsideImageModule(e)){var s=this.getImageModule(e);s&&s.processImage(t)}},stopProcessing:function(t){var e=this.getDisplayElement(t);e&&e.removeClass("processing")},resetFilename:function(){this.dom.$file.val("")},enableUploads:function(){this.enable(!0)},disableUploads:function(){this.enable(!1)},enable:function(t){this.dom.$browse[(t?"remove":"add")+"Class"]("disabled"),this.dom.$file[t?"show":"hide"](),this.dom.$form[t?"show":"hide"](),this.disabled=!t},submit:function(){if(this.disabled)return!1;this.list.overQuota()&&this.overQuotaError(1),this.disableUploads();var t=new Composer.Image(this.dom.$list[0]);if(this.checkForCORS()){var e=document.getElementById("promotion_image_promotion_image").files[0],i=new Composer.CORSUploader(t,this,"afterUpload");return i.uploadFile(e),this.dom.$list[0].scrollTop=0,!1}return t.observe("upload:failed",_.bind(this.afterUpload,this)),t.observe("upload:succeeded",_.bind(this.afterUpload,this)),this.dom.$uploadId.val(t.upload()),this.dom.$list[0].scrollTop=0,!0},afterUpload:function(){this.enableUploads(),this.resetFilename()},destroy:function(){this.stopObserving()},overQuotaError:function(t){var e=t?t.dataTransfer.files.length:1,i=this.list.data.quota;Composer.upgrade(t,"Uploading "+(e>1?"these "+e+" images":"this image")+" is more than the "+i+" your free plan allows.")},unlockMoreImages:function(t){var e=this.list.data.quota;Composer.upgrade(t,"You've reached the "+e+" image limit your free plan allows.  Upgrade now to unlock unlimited images!")},isInsideDroppableArea:function(t){return this.isInsideBannerContainer(t)||this.isInsideImageModule(t)||this.isInsideImageListContainer(t)},isInsideBannerContainer:function(t){var e=$(t).closest("#madmimi_header");return e.length>0},isInsideImageModule:function(t){return!!this.getImageModule(t)},getImageModule:function(t){var e=$(t).closest(".module-container");if(!(e.length<=0)){var i=Composer.get().promotion.findModuleById(e.identify());if(i)return _.detect(i.images,function(e){var i=e.dom.$image[0];return $(t).is("img")?i===t:i===$(t).find("img")[0]})}},getDisplayElement:function(t){if(this.isInsideImageListContainer(t))return this.dom.$list.parent();if(this.isInsideBannerContainer(t))return Composer.Banner.getElement();if(this.isInsideImageModule(t)){var e=this.getImageModule(t);return e.$element}},isInsideImageListContainer:function(t){var e=$(t).closest("#image_list_container");return e.length>0}}),Composer.ImageUploader.DOM={iframe:"#upload_target",form:"#uploader_form",file:"#promotion_image_promotion_image",uploadGroup:"#upload_group",upgradeGroup:"#upgrade_group",browse:".combo_input > button",promotionId:"[name='promotion[id]']",uploadId:"[name='upload[id]']",unlock:"a.upgrade"}}(jQuery),function(t){function e(){return s++}Composer.Image=Class.create(Widget.Observer,Widget.Observable,{initialize:function(e,s,n,o){this.$container=t(e),this.$element=this.create(n,o),this.dom=this.$element.getChildren(i),s&&(this.setData(s),this.markAsProcessed()),this.$element.on("mousedown",_.bind(this.onMouseDown,this)),this.$element.on("contextmenu",_.bind(this.onContextMenu,this)),this.$element.on("mouseenter",_.bind(this.onMouseEnter,this)),this.$element.on("mouseleave",_.bind(this.onMouseLeave,this)),t(document).on("image:thumbnail:success",_.bind(this.onThumbnailSuccess,this)),t(document).on("image:thumbnail:failure",_.bind(this.onThumbnailFailure,this)),this.usable=!1,this.initDragging()},create:function(i,s){var a=e(),r=(i?n:o)({cid:a});return s?this.$container.find("li.load_more").before(r):this.$container.prepend(r),this.$element=t("#composer_image_"+a),this.$container[0].scrollTop=0,this.$element},setData:function(t){_.extend(this,t),this.minHeight=Math.ceil(Composer.ImageResizer.MIN_IMAGE_WIDTH/this.ratio)},load:function(){this.loading||(this.loading=!0,_.delay(_.bind(this.beginLoading,this),200))},beginLoading:function(){this.dom.$image.prop("src")===this.src?this.finishLoading():(this.$element.addClass("loading"),ImageLoader.load(this.dom.$image[0],this.src,_.bind(this.finishLoading,this),_.bind(this.errorLoading,this)))},finishLoading:function(){this.setThumbnail(),this.$element.removeClass("loading"),this.calculateDimensions(),this.fire("composer:image:loaded"),this.usable=!0},errorLoading:function(){this.dom.$image.prop("src","https://d1lggihq2bt4jo.cloudfront.net/assets/promotion_thumb_small.png"),this.finishLoading()},fullSrc:function(){return this.src.replace("/composer_thumb/","/original/")},loadFullImage:function(){var t=new Image;t.onload=_.bind(this.onFullImageLoaded,this,t),t.onerror=_.bind(this.onFullImageFailed,this),t.src=this.fullSrc()},onFullImageLoaded:function(t){this.fire("image:full:success",{id:this.id,src:t.src}),this.src=t.src,this.calculateDimensions(t),this.setThumbnail()},onFullImageFailed:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.composer.image.onFullImageFailed")+" "+_.last(this.src.split("/")))},upload:function(){return this.fire("upload:started"),this.uploadId=e(),t(document).on("upload:failed",_.bind(this.uploadFailed,this)),t(document).on("upload:succeeded",_.bind(this.uploadComplete,this)),this.uploadId},uploadFailed:function(t,e){e.uploadId===this.uploadId&&(Widget.MimiFlash.error(e.message),this.$element.fadeOut(_.bind(this.destroy,this)))},uploadComplete:function(t,e){e.uploadId===this.uploadId&&(this.setData(e),this.dom.$image.prop("src",this.src),this.$element.removeClass("loading"),this.fire("composer:image:upload:complete"),this.usable=!0,Composer.ImageList.addImage(this),this.setThumbnail())},reprocess:function(e){this.setProcessing(e?"rotating":"processing");var i="/promotion_images/"+this.id+"/reprocess";t.post(i,{width:this.width,height:this.height,rotate:e}).fail(_.bind(function(){this.reprocess(e)},this))},trash:function(){var t=Composer.get().promotion.findModulesByImageId(this.id),e=Composer.Banner.get().data.id===this.id;t.length>0||e||this.in_use?_.delay(_.bind(this.confirm,this),100):this.sendDestroyRequest()},confirm:function(){window.confirm(I18n.t("MimiFlash.composer.image.trash"))&&this.sendDestroyRequest()},sendDestroyRequest:function(){this.$element.addClass("deleting"),t.post("/promotion_images/destroy/"+this.id).done(_.bind(this.trashComplete,this))},trashComplete:function(){this.destroy(),t(document).trigger("composer:image:deleted",{id:this.id})},hover:function(){},unhover:function(){},onMouseDown:function(t){Composer.ImageMenu.hide(this),this.usable&&(Composer.ImageMenu.visible()||2===t.button||(0===t.button&&(t.altKey||t.ctrlKey)?this.onContextMenu(t):this.startDrag(t)))},onContextMenu:function(t){t.preventDefault(),!this.isProcessing()&&this.usable&&Composer.ImageMenu.show(this)},onMouseEnter:function(){var t=this.width>this.height?"we":"ns";this.dom.$card.addClass("hover-"+t)},onMouseLeave:function(){this.dom.$card.removeClass("hover-we hover-ns")},startDrag:function(){},initDragging:function(){this.$element.find("img").draggable({start:_.bind(this.onDragStart,this),stop:_.bind(this.onDragEnd,this),helper:"clone",appendTo:"body",zIndex:1001,refreshPositions:!0})},onDragStart:function(e,i){this.fire("composer:image:drag:started"),i.helper.addClass("uploaded-image");var s=(t(e.target),this.width>this.height?this.width:"auto"),n=this.width>this.height?"auto":this.height;this.loadFullImage(),i.helper.css({listStyle:"none",width:s+"px",height:n+"px"}).attr("src",this.fullSrc()),t("body").addClass("dragging")},onDragEnd:function(){t("body").removeClass("dragging"),this.fire("composer:image:drag:ended")},onThumbnailSuccess:function(t,e){e.id===this.id&&(ImageLoader.load(this.dom.$image[0],e.thumbnail_url,_.bind(this.onThumbnailLoaded,this),_.bind(this.onThumbnailFailed,this)),this.src=e.thumbnail_url,this.width=e.width,this.height=e.height,this.calculateRatio(this.width,this.height),this.markAsProcessed(),this.fire("composer:image:processed"))},onThumbnailFailure:function(t,e,i){if(e.id===this.id){e.destroy&&this.$element.fadeOut(_.bind(this.destroy,this));var s=_.template(I18n.t("MimiFlash.composer.image.onThumbnailFailure")),n=_.last(this.src.split("/")),o=s({image_name:n});Widget.MimiFlash.error(o),console.log(i)}},onThumbnailLoaded:function(){this.setProcessing(!1)},onThumbnailFailed:function(){var t=_.template(I18n.t("MimiFlash.composer.image.onThumbnailFailed")),e=_.last(this.src.split("/")),i=t({image_name:e});Widget.MimiFlash.error(i)},setThumbnail:function(){var t="cover";(this.width<this.dom.$card.width()||this.height<this.dom.$card.height())&&(t=this.width+"px "+this.height+"px"),this.dom.$card.css({"background-image":"url('"+this.src+"')","background-position":"50% 50%","background-size":t,"background-repeat":"no-repeat"})},setProcessing:function(t){this.setThumbnail(),t?this.dom.$card.attr("class",t===!0?"processing":t):this.dom.$card.attr("class","")},isProcessing:function(){return this.dom.$card.hasClass("processing")},calculateDimensions:function(t){if(!this.width||!this.height){var e=t||this.dom.$image[0];this.width=e.width,this.height=e.height}this.calculateRatio(this.width,this.height)},calculateRatio:function(t,e){return this.ratio=Math.round(t/e*1e3)/1e3},destroy:function(){this.$element.remove(),this.stopObserving()},markAsProcessed:function(){this.processed=!0}});var i={image:"span > img",card:"span"},s=0,n=(_.template("position: absolute; top: #{top}px; left: #{left}px;"),_.template("<li id='composer_image_#{cid}'><span><img></span></li>")),o=_.template("<li id='composer_image_#{cid}' class='loading'><span><img></span></li>")}(jQuery),function(t){function e(t,e,i,s){function n(){t.src=a.src,i&&i(a,t)}function o(e){s&&s(a,t,e)}var a=new Image;return a.onload=n,a.onerror=o,a.src=e,a}function i(t){t.onload=t.onerror=t.src=null}t.ImageLoader={load:e,cancel:i}}(this),Composer.ImageResizer=function(){function t(t,e,i){var l=s(t),h=d-l,c=n(t,h),u=o(t,h,c);u>e&&(e=u),e>c&&(e=c);var m=a(t,l,e);if(i){var p=a(t,l,e+(m.width<i?1:-1));Math.abs(m.width-i)>Math.abs(p.width-i)&&(m=p)}return(e===c||m.imageWidth>h)&&r(m,h),m}function e(e,n){var o=i(e),a=Math.round((n-s(e))/o);return t(e,a,n)}function i(t){var e=_.inject(t,function(t,e){return t+c*e.ratio},0);return e/c}function s(t){return h*(t.length-1)}function n(t,e){for(var i=t.length,s=0,n=i;n--;)s+=t[n].ratio;return Math.round(e/s)}function o(t,e,i){var s=_.min(t,function(t){return t.ratio}).ratio,o=Math.ceil(l/s),a=_.inject(t,function(t,e){return t+e.ratio*o},0);return a>e?i||n(t):o}function a(t,e,i){var s={height:i,width:e};return s.widths=_.map(t,function(t){var e=Math.round(t.ratio*i);return s.width+=e,e}),s.imagesWidth=s.width-e,s}function r(t,e){var i=e-t.imagesWidth,s=0>i?-1:1,n=0;for(t.width+=i,t.imagesWidth+=i;0!==i;)t.widths[n]+=s,i-=s,n++,n===t.widths.length&&(n=0)}var l=80,d=530,h=20,c=1e3;return{MIN_IMAGE_WIDTH:l,MAX_TOTAL_WIDTH:d,SPACING:h,targetHeight:t,targetWidth:e}}(),function(t){Composer.ImageMenu=Class.create(Widget.Popup,Widget.Observer,{initialize:function($super){$super("#image-menu",{fixedPosition:!1,position:"center center",repositioning:!1,overlay:!1,allowNegatives:!0}),this.$element.on("click",_.bind(this.onClick,this)),t("body").on("click",_.bind(this.onDocClick,this))},show:function($super,t){this.image=t,this.setOptions({anchor:t.$element[0]}),$super()},hide:function($super,t){t!==this.image&&$super()},onClick:function(){return this.image.reprocess(90),this.hide(),!1},onDocClick:function(){this.hide()}}).singleton("show","hide","visible")}(jQuery),function(t){Composer.LogoUploader=Class.create(Widget.Observable,{initialize:function(t){this.$element=t,this.initializeDom()},reset:function(){this.initializeDom()},initializeDom:function(){this.dom=this.$element.getChildren(Composer.LogoUploader.DOM),this.clearFile(),this.initializeObservers()},initializeObservers:function(){this.dom.$fileInput.on("change",_.bind(this.onFileChanged,this)),this.$element.on("mousemove",_.bind(this.onMouseMoved,this));var e=t(window);e.on("dragover",_.bind(this.onDragOver,this)),e.on("dragleave",_.bind(this.onDragLeave,this)),e.on("drop",_.bind(this.onDrop,this))},clearFile:function(){this.dom.$fileInput.clearFile()},onFileChanged:function(){var t=this.dom.$fileInput[0];Mimi.supportsFileAPI()?this.loadLogoFrom(t.files[0]):this.fire("composer:logo-uploader:selected",{fileName:this.dom.$fileInput.val()})},onFileLoadStarted:function(){this.fire("composer:logo-uploader:loading")},onFileLoadCompleted:function(t,e){this.fire("composer:logo-uploader:loaded",{file:t,dataUrl:e})},onMouseMoved:function(t){var e=this.$element.offset(),i=this.dom.$fileInput.outerWidth(),s=this.dom.$fileInput.outerHeight();this.dom.$fileInput.css({left:t.pageX-e.left-i+20,top:t.pageY-e.top-s/2})},onDragOver:function(t){t.preventDefault&&t.preventDefault(),this.isInsideLogoUploader(t.target)&&this.fire("composer:logo-uploader:drag-over")},onDragLeave:function(t){t.preventDefault&&t.preventDefault(),this.isInsideLogoUploader(t.target)&&this.fire("composer:logo-uploader:drag-leave")},onDrop:function(t){if(t.preventDefault&&t.preventDefault(),this.isInsideLogoUploader(t.target)){this.fire("composer:logo-uploader:drop");var e=t.originalEvent,i=e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files[0];return this.loadLogoFrom(i),!1}},loadLogoFrom:function(t){if(t&&this.validateFile(t)){var e=new FileReader;e.onloadstart=_.bind(this.onFileLoadStarted,this),e.onload=_.bind(function(){this.onFileLoadCompleted(t,e.result)},this),e.readAsDataURL(t)}},validateFile:function(t){return 0!=t.size&&t.isImage()?!0:(Widget.MimiFlash.error(I18n.t("MimiFlash.composer.logo_uploader.invalid_file")),!1)},isInsideLogoUploader:function(e){return t.contains(this.$element[0],e)}}),Composer.LogoUploader.DOM={fileInput:"input[type=file]"}}(jQuery),function(t){Composer.ProductList=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#product_list_container"),this.dom=this.$element.getChildren(e),this.data={},this.pageDropdown=new Widget.Dropdown.getInstanceByName("product_page"),this.integrationDropdown=new Widget.Dropdown.getInstanceByName("e_commerce_itegration_name"),this.searchFor=new Widget.DelayedInput("#product_list_search_for"),this.isSearching=!1,this.grabInitialData(),this.initObservers()},initObservers:function(){this.integrationDropdown.observe("dropdown:item:selected",_.bind(this.onIntegrationDropdownSelected,this)),this.pageDropdown.observe("dropdown:item:selected",_.bind(this.onPageDropdownSelected,this)),this.dom.$nextPageButton.on("click",_.bind(this.onNextPageButton,this)),this.dom.$previousPageButton.on("click",_.bind(this.onPreviousPageButton,this)),this.dom.$refreshProductsButton.on("click",_.bind(this.onRefreshProducts,this)),this.searchFor.observe("delayedInput:elapsed",_.bind(this.onSearchForTrigger,this)),this.searchFor.$element.on("keyup",_.bind(this.onSearchForKeyUp,this)),t(document).on("mad_cart_product_import:complete",_.bind(this.grabInitialData,this))},onNextPageButton:function(t){t.die();var e=this.data.currentPage+1;e>this.data.maxPage||(this.startLoading(),this.grabData({page:e}))},onPreviousPageButton:function(t){t.die();var e=this.data.currentPage-1;1>e||(this.startLoading(),this.grabData({page:e}))},onPageDropdownSelected:function(){this.pageDropdown.getValue()!==this.data.currentPage&&(this.startLoading(),this.grabData({page:this.pageDropdown.getValue()}))},onSearchForTrigger:function(t,e){this.isSearching||(this.isSearching=!0,this.grabData({search_for:e.value}))},onSearchForKeyUp:function(t){this.isSearching||""!==t.target.value||(this.isSearching=!0,this.grabData({search_for:t.target.value}))},loadProducts:function(t){var e=t.integration.products;this.data.currentPage=t.integration.current_page,this.data.maxPage=t.integration.max_page,this.products=e?_.map(e,function(t){return new Composer.Product(this.dom.$list[0],t)},this):[]},grabInitialData:function(){t("#product_list_search_for").val(""),this.resetPager(),this.grabData()},onRefreshProducts:function(e){e.die(),this.data={},this.resetPager(),this.startLoading(),t.post("/e_commerce_integration/products/refresh",{integration:this.getCurrentIntegrationName()}).done(_.bind(this.onRefreshProductsSuccess,this)).fail(_.bind(this.onRefreshProductsFailure,this))},onRefreshProductsSuccess:function(){},onRefreshProductsFailure:function(t){Widget.MimiFlash.error(I18n.t("MimiFlash.composer.product_list.onRefreshProductsFailure")+"\n"+t)},clearList:function(){this.dom.$list.html("")},disablePagerControls:function(){this.pageDropdown.disable(),this.dom.$previousPageButton.addClass("disabled"),this.dom.$nextPageButton.addClass("disabled")},disableRefreshButton:function(){this.dom.$refreshProductsButton.addClass("disabled")},enableRefreshButton:function(){this.dom.$refreshProductsButton.removeClass("disabled")},startLoading:function(){this.clearList(),this.disablePagerControls(),this.disableRefreshButton(),this.dom.$container.addClass("loading")},stopLoading:function(){this.enableRefreshButton(),this.dom.$container.removeClass("loading")},onIntegrationDropdownSelected:function(){this.grabInitialData()},resetPager:function(t){if(t="undefined"!=typeof t?t:!0,this.pageDropdown.enable(),this.data.maxPage>1?this.dom.$pagingContainer.removeClass("hide"):this.dom.$pagingContainer.addClass("hide"),1===this.data.currentPage?this.dom.$previousPageButton.addClass("disabled"):this.dom.$previousPageButton.removeClass("disabled"),this.data.currentPage===this.data.maxPage?this.dom.$nextPageButton.addClass("disabled"):this.dom.$nextPageButton.removeClass("disabled"),t){for(var e=[],i=1;i<=this.data.maxPage;i++)e.push([i,i]);this.pageDropdown.setItems(e),this.pageDropdown.setSelection(this.data.currentPage)}},grabData:function(e,i){e=e||{},i=i||{},this.startLoading(),t.get(this.integrationDropdown.getValue(),e).done(_.bind(this.onGrabDataSuccess,this)).fail(_.bind(this.onGrabDataFailure,this))},onGrabDataSuccess:function(t){_.isArray(t.result.integration.products)&&(this.loadProducts(t.result),this.resetPager(),this.stopLoading(),this.isSearching=!1)},onGrabDataFailure:function(t){this.isSearching=!1,Widget.MimiFlash.error(I18n.t("MimiFlash.composer.product_list.onGrabDataFailure")+"\n"+t)},getCurrentIntegrationName:function(){return this.integrationDropdown.getValue().split("/").pop()}}).singleton("grabInitialData");var e={container:"#product_list",pagingContainer:"#product_paging",list:"#product_list ul",previousPageButton:"#previous_products_button",nextPageButton:"#next_products_button",refreshProductsButton:"#refresh_products_button"}}(jQuery),function(t){Composer.Product=Class.create(Widget.Observer,Widget.Observable,{initialize:function(i,s){this.template=Template.from("product_list_item_template"),s&&this.setData(s),this.usable=!1,this.$container=t(i),this.create(),this.dom=this.$element.getChildren(e),this.prefetchImage(),this.initObservers()},initObservers:function(){this.$element.on("mousedown",_.bind(this.onMouseDown,this))},prefetchImage:function(){this.full_image=new Image,this.full_image.src=this.image_url,this.full_image.complete?this.onImageLoaded():t(this.full_image).on("load",_.bind(this.onImageLoaded,this))},onImageLoaded:function(){this.usable=!0,this.dom.$content.removeClass("loading"),this.$element.css("display","list-item"),this.initDragging()},imageRatio:function(){return Math.round(this.full_image.width/this.full_image.height*1e3)/1e3},create:function(){var e=this.template(this);this.$container.append(e),this.$element=t("#composer_product_"+this.external_id),this.$element.css("display","none")},onMouseDown:function(){!this.usable},initDragging:function(){this.$element.draggable({start:_.bind(this.onDragStart,this),stop:_.bind(this.onDragEnd,this),helper:"clone",appendTo:"body"})},onDragStart:function(e,i){this.fire("composer:product:drag:started"),i.helper.addClass("dragged_product");var s=t(e.target).find("img"),n=s.width(),o=s.height();i.helper.css({listStyle:"none"}).find("img").css({width:n+"px",height:o+"px"}),t("body").addClass("dragging")},onDragEnd:function(){t("body").removeClass("dragging"),this.fire("composer:image:drag:ended")},setData:function(t){_.extend(this,t)}});var e={content:"div.product_content",li:"li",image_square:"img",name:"span.name"}}(jQuery),function(t){Composer.Loader=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#composer_loader"),this.$composer=t(".promotion_editor");var e=t("html")[0].className.split(" ");this.hasBrokenOpacity=_.any(e,function(t){return"ie"===t.slice(0,2)}),this.hasBrokenOpacity&&this.$composer.css({visibility:"hidden"}),this.$composer.css({opacity:0}).removeClass("invis"),t(document).on("promotion:created",_.bind(function(){this.hide(200,_.bind(this.showComposer,this))},this))},visible:function(){return this.$element.is(":visible")},show:function(){this.$element.fadeIn()},hide:function(t,e){this.$element.fadeOut(t,e)},showComposer:function(){this.$element.remove(),this.hasBrokenOpacity&&this.$composer.css({visibility:"visible",opacity:"1 !important"}),this.$composer.animate({opacity:1},_.bind(this.fire,this,"composer:shown"))},destroy:function(){this.stopObserving()}}).singleton()}(jQuery),function(t){Composer.ModuleAdder=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#module_adder"),t(document).on("promotion:loading",_.bind(this.disable,this)),t(document).on("promotion:created",_.bind(this.enable,this)),this.$element.on("click","button",_.bind(this.click,this))},disable:function(){this.$element.addClass("disabled"),this.disabled=!0},enable:function(){this.$element.removeClass("disabled"),this.disabled=!1},click:function(t){if(this.disabled)return!1;var e=t.currentTarget.id.substr(13);this.fire("composer:adder:add",{type:e})}}).singleton()}(jQuery),function(t){Composer.ModuleTypeSelect=Class.create(Widget.Popup,Widget.Observer,{initialize:function($super){this.$element=t("#module_type_select"),this.dom=this.$element.getChildren(Composer.ModuleTypeSelect.DOM),$super("#module_type_select",{position:"center farBottom",fixedPosition:!1,styles:{position:"absolute",zIndex:10000006,display:"none"}}),this.dom.$list.on("click","a",_.bind(this.click,this))},show:function($super,t){this.moduleToolbar=t,this.setOptions({anchor:t.dom.$typeButton[0]}),$super()},click:function(e){var i=t(e.currentTarget),s=i[0].className.split(" "),n=_.detect(s,function(t){return _.include(Composer.PromotionModule.TYPES,t)});return this.moduleToolbar.setType(n),this.moduleToolbar.module.setType(n),this.hide(),!1},getItem:function(e){return _.detect(this.dom.$items,function(i){return t(i).hasClass(e)})},getText:function(e){var i=this.getItem(e);return i?t(i).find("span").html():""},destroy:function($super){this.stopObserving(),$super()}}).singleton("getItem"),Composer.ModuleTypeSelect.DOM={list:"ul",items:["ul li a"]}}(jQuery),function(t){Composer.ImageResizing={initResizing:function(e){this.$handle=t(e),this.isDragging=!1,this.$handle.on("mousedown",_.bind(this.onmousedown,this)),t(document).on("mousemove",this.__onmousemove=_.bind(this.onmousemove,this)).on("mouseup",this.__onmouseup=_.bind(this.onmouseup,this))},destroyResizing:function(){this.handle&&this.handle.stopObserving()},getImageWidth:function(){return this.moduleType.startsWith("combo")?this.visibleImages[0].getWidth():_.inject(this.visibleImages,function(t,e){return t+e.getWidth()},0)+20*(this.visibleImages.length-1)},onmousedown:function(e){this.isDragging=!0,this.moduleType=this.getModuleType(),this.visibleImages=this.getVisibleImages(),this.startX=e.clientX,this.startWidth=this.getImageWidth(),this.$handle.closest(".madmimi-image-container, .madmimi-preview-container").addClass("dragging"),t("body").makeUnselectable().css({cursor:this.$handle.css("cursor")})},onmousemove:function(t){if(this.isDragging)switch(this.moduleType){case"combo-left":this.handleComboLeftDragging(t);break;case"combo-right":this.handleComboRightDragging(t);break;case"image":this.handleImageDragging(t)}},handleComboLeftDragging:function(t){var e=this.startWidth+t.clientX-this.startX;e<Composer.PromotionModule.MIN_IMAGE_WIDTH&&(e=Composer.PromotionModule.MIN_IMAGE_WIDTH),e>Composer.PromotionModule.MAX_COMBO_IMAGE_WIDTH&&(e=Composer.PromotionModule.MAX_COMBO_IMAGE_WIDTH),this.setImageWidth(e)},handleComboRightDragging:function(t){var e=this.startWidth+this.startX-t.clientX;e<Composer.PromotionModule.MIN_IMAGE_WIDTH&&(e=Composer.PromotionModule.MIN_IMAGE_WIDTH),e>Composer.PromotionModule.MAX_COMBO_IMAGE_WIDTH&&(e=Composer.PromotionModule.MAX_COMBO_IMAGE_WIDTH),this.setImageWidth(e)},handleImageDragging:function(t){this.setImageWidth(this.startWidth+2*(t.clientX-this.startX),this.visibleImages)},onmouseup:function(){this.isDragging&&(this.$handle.closest(".madmimi-image-container, .madmimi-preview-container").removeClass("dragging"),t("body").css({cursor:""}).makeSelectable(),this.isDragging=!1)}}}(jQuery),function(t){Composer.PromotionItemEditDialog=Class.create(Widget.Popup,Widget.Observer,{initialize:function($super,t){$super(t,{overlay:Widget.ModalOverlay,hideTrigger:".window_close, a.back",onHidden:_.bind(this.onHidden,this),styles:{position:"absolute",zIndex:10000005,display:"none"}}),Composer.PromotionItemEditDialog.DOM.form="form"+t+"_form",this.dom=this.$element.getChildren(Composer.PromotionItemEditDialog.DOM),this.dom.$chkLinkToList.closest("p").find("label").attr("for",this.dom.$chkLinkToList.identify()),this.listSelect=new Mimi.AudienceListSelect(this.dom.$listSelect[0],{itemTextTemplate:Mimi.AudienceListSelect.ITEM_TEXT_FORMAT_WITH_SPAN_TEMPLATE,fixedPosition:!0}),this.setObservers()},setObservers:function(){this.dom.$form.on("submit",_.bind(this.okClick,this)),this.dom.$ok.on("click",_.bind(this.okClick,this)),this.dom.$url.on("blur",_.bind(this.onUrlChange,this)),this.dom.$url.on("keyup",_.bind(this.onUrlChange,this)),this.dom.$chkLinkToList.on("click",_.bind(this.toggleLinkToList,this))},show:function($super,t,e,i,s){this.allowNamedAnchors=s,this.okCallback=e,this.hiddenCallback=i,this.originalText=t.text,this.setDomValues(t),this.setClickEid(),$super(),""===t.text?this.dom.$text.select():this.dom.$url.select(),this.onUrlChange(),Composer.LinkPopup.hide(),this.removeAudienceListIdFromUrl(),this.initializeListSelect()
},setDomValues:function(t){this.dom.$caption&&this.dom.$caption.val(t.caption||""),this.dom.$text&&this.dom.$text.val(t.text||""),this.dom.$altText&&this.dom.$altText.val(t.altText||""),this.dom.$url.val(this.decodeUrlParentheses(t.url)||"")},onUrlChange:function(){if(this.dom.$namedAnchorInfo){var t=this.validateNamedAnchor(this.dom.$url.val().trim());this.dom.$namedAnchorInfo.toggle(t)}},okClick:function(t){t.die();var e,i=(this.dom.$url.val()||"").trim();this.validateNamedAnchor(i)?(i=this.prepareUrl(i),e={url:null,text:null,hasTextChanged:!1,caption:null,name:i,altText:null},this.dom.$text&&(e.text=this.dom.$text.val(),e.hasTextChanged=e.text!==this.originalText),this.dom.$caption&&(e.caption=this.dom.$caption.val()),this.dom.$altText&&(e.altText=this.dom.$altText.val()),this.okCallback(e),this.hide()):(i=Link.getFullUrl(i),this.validateUrl(i)?(i=this.prepareUrl(i),e={url:i,text:null,hasTextChanged:!1,caption:null},this.dom.$text&&(e.text=this.dom.$text.val(),e.hasTextChanged=this.dom.$text.val()!==this.originalText),this.dom.$caption&&(e.caption=this.dom.$caption.val()),this.dom.$altText&&(e.altText=this.dom.$altText.val()),this.okCallback(e),this.hide()):this.showValidationErrors())},onHidden:function(){this.hiddenCallback&&this.hiddenCallback(),this.dom.$text.closest(".field").show(),this.listSelect.hide()},cancelEnter:function(t){return 13===t.keyCode?this.okClick():void 0},validateNamedAnchor:function(t){return this.allowNamedAnchors?!!t.match(/^[\w_]+$/):!1},validateUrl:function(t){return!t.startsWith("http://")&&!t.startsWith("https://")||Link.isValidHttp(t)?t.startsWith("mailto:")&&!Link.isValidEmail(t)?!1:t.startsWith("[[")&&t.endsWith("]]")&&!Link.isValidMacro(t)?!1:_.isEmpty(t)&&this.isLinkToListEnabled()&&!_.isEmpty(this.dom.$listIdInput.val())?!1:!0:!1},showValidationErrors:function(){this.dom.$url.errorFlash()},removeAudienceListIdFromUrl:function(){var t=Link.withoutParam(this.dom.$url.val(),this.LINK_LIST);t.param?(this.dom.$listIdInput.val(t.param),this.dom.$url.val(t.url)):this.dom.$listIdInput.val("")},decodeUrlParentheses:function(t){return t?t.replace(/%28/g,"(").replace(/%29/g,")"):null},encodeUrlParentheses:function(t){return t?t.replace(/\(/g,"%28").replace(/\)/g,"%29"):null},prepareUrl:function(t){return this.encodeUrlParentheses(this.addAudienceListId(t))},addAudienceListId:function(t){if(this.isLinkToListEnabled()){var e=this.dom.$listIdInput.val().trim();return e?Link.addParam(t,this.LINK_LIST,e):t.trim()}return t},initializeListSelect:function(){var t=this.dom.$listIdInput.val();t.trim()?(this.listSelect.setSelection(t),this.dom.$chkLinkToList.prop("checked",!0)):(this.listSelect.clearSelection(),this.dom.$chkLinkToList.prop("checked",!1)),this.toggleLinkToList()},toggleLinkToList:function(){this.dom.$chooseAudienceListContainer.toggle(this.isLinkToListEnabled())},isLinkToListEnabled:function(){return this.dom.$chkLinkToList.prop("checked")},setClickEid:function(){var t=e[this.$element.attr("id")];this.dom.$chkLinkToList.data("click-eid",t)},LINK_LIST:"link_list"}).singleton("show");var e={caption_image_link_dialog:"productivity.gem.composer.module_edit.image.link_list.checkbox.click",link_dialog:"productivity.gem.composer.module_edit.link.link_list.checkbox.click",call_to_action_dialog:"productivity.gem.composer.module_edit.button_configure.link_list.checkbox.click"};Composer.PromotionItemEditDialog.DOM={ok:"button.primary",text:'input[name="text"]',textField:"div.text_field",url:'input[name="url"]',caption:'input[name="caption"]',altText:'input[name="altText"]',namedAnchorInfo:"span.named_anchor",listSelect:"span.audience_list_select",listSelectButton:"span.audience_list_select button",listIdInput:"input[name=audience_list]",chooseList:".audience_list_select",chkLinkToList:"input[name=chk_link_to_list]",chooseAudienceListContainer:"div#audience_list_select_container"},Composer.PromotionItemEditDialog.DIALOGS={},Composer.PromotionItemEditDialog.Get=function(t){return Composer.PromotionItemEditDialog.DIALOGS.hasOwnProperty(t)||(Composer.PromotionItemEditDialog.DIALOGS[t]=new Composer.PromotionItemEditDialog(t)),Composer.PromotionItemEditDialog.DIALOGS[t]},Composer.LinkPopup=Class.create(Widget.Popup,Widget.Observable,{initialize:function($super){this.$element=t("<div>").attr({"class":"window inline_popup",style:Composer.LinkPopup.STYLES}).html(Composer.LinkPopup.MARKUP),$super(this.$element[0],{position:"top left",overlay:null,fixedPosition:!1}),this.dom=this.$element.getChildren(Composer.LinkPopup.DOM),this.dom.$edit.on("click",_.bind(this.edit,this)),this.dom.$remove.on("click",_.bind(this.remove,this))},show:function($super,t,e){this.owner=t,this.link=e,e&&(this.setOptions({anchor:t.element,offset:e.offsetLeft+" "+(e.offsetTop+e.offsetHeight)}),this.dom.$link.attr("href",e.href).html(e.href)),$super()},edit:function(){return this.owner.showLinkPopup(this.link),!1},remove:function(){return this.owner.removeLink(this.link),this.hide(),!1}}).singleton("show","hide"),Composer.LinkPopup.DOM={link:"a.link",edit:"button.edit",remove:"button.delete"},Composer.LinkPopup.MARKUP='<div class="window_contents link_editor"><span class="hide_overflow">Linked to <a href="#" class="link" target="_blank"></a></span> <span class="actions"><button class="btn edit subtle small icon"><span>Edit</span></button> <button class="btn delete subtle small icon"><span>Delete</span></button></span></div>'}(jQuery),function(t){Composer.CallToActionEditDialog=Class.create({defaultButtonText:I18n.t("js.promotions.promotion_module.button_text"),nufButtonText:I18n.t("js.promotions.promotion_module.nuf_button_text"),initialize:function(t){this.dialog=Composer.PromotionItemEditDialog.get(t),this.$element=this.dialog.$element,this.dom=this.$element.getChildren(Composer.CallToActionEditDialog.DOM),this.callback=function(){},this.initializeObservers()},initializeObservers:function(){this.dom.$alignmentBtns.on("click",_.bind(this.onAlignmentClick,this)),this.dom.$url.on("keyup",_.bind(this.onUrlKeyup,this)),this.dom.$text.on("blur",_.bind(this.toggleWarning,this))},show:function(e,i){this.callback=i,this.dialog.show(e,_.bind(this.addAlignmentToOptions,this)),_.each(this.dom.$alignmentBtns,function(i){var s=e.alignment==t(i).data("alignment");t(i).toggleClass("selected",s)}),(this.dom.$text.val()==this.defaultButtonText||this.dom.$text.val()==this.nufButtonText)&&this.dom.$text.val(""),this.dom.$text.select(),this.updateSubmitBtn()},onAlignmentClick:function(e){_.each(this.dom.$alignmentBtns,function(i){t(i).toggleClass("selected",i==e.currentTarget)})},onUrlKeyup:function(){this.updateSubmitBtn(),this.toggleWarning()},updateSubmitBtn:function(){this.dom.$ok.prop("disabled",!this.getUrlText())},toggleWarning:function(){var t=!this.getUrlText();this.dom.$warning.toggle(t).toggleClass("show",t)},addAlignmentToOptions:function(t){t.alignment=this.getAlignment(),this.callback&&this.callback(t)},getAlignment:function(){return this.dom.$alignmentBtns.filter(".selected").data("alignment")},getUrlText:function(){return this.dom.$url.val()}}).singleton("show"),Composer.CallToActionEditDialog.DOM=_.extend(Composer.PromotionItemEditDialog.DOM,{alignmentBtns:[".button_bar button"],warning:".warning"})}(jQuery),function(t){Composer.PromotionTutorialDialog=Class.create(Widget.Popup,{initialize:function($super){$super("#promotion_tutorial_dialog",{overlay:Widget.ModalOverlay,hideTrigger:".window_close, .actions button",styles:{position:"absolute",zIndex:10000005,display:"none"}}),this.initializeDom()},initializeDom:function(){this.dom=this.$element.getChildren(Composer.PromotionTutorialDialog.DOM)},buildUI:function(){this.dom.$fieldset.before(t("#promotion_tutorial")),this.$element.find(".tutorial_last_step").hide(),this.$element.find("a").on("click",_.bind(this.onLinkClicked,this))},revertUI:function(){t("#promotion_tutorial").appendTo(t("#promotion_tutorial_container")),t("#promotion_tutorial .tutorial_last_step").show()},onLinkClicked:function(){this.hide()},show:function($super){this.buildUI(),$super()},hide:function($super){this.revertUI(),$super()}}).singleton("show","hide"),Composer.PromotionTutorialDialog.DOM={fieldset:"fieldset"}}(jQuery),function(t){Composer.PromotionModuleEditor=Class.create(Widget.Observer,{initialize:function(t,e){this.module=t,this.dom=t.dom.$textModule.getChildren(Composer.PromotionModuleEditor.DOM),this.$element=this.dom.$textEditor,this.$cmdButtons=this.dom.$cmdButtons,this.$linkCmdButton=this.dom.$toolbar.find(".link"),this.heightData={hCheck:!window.opera,boxWidth:0,valLength:0,expandMin:148,expandMax:800,padding:12};try{this.initEditorWrapper(e)}catch(i){window.debug("Error initilizing editor: ",i)}this.setMode("edit"),this.initObservers(),this.initDroppables(),this.updateSelectionBound=_.bind(this.updateSelection,this),this.markedTransformer=new marked.Transformer(this.dom.$textEditor[0])},initObservers:function(){this.dom.$toolbar.on("mousedown",function(){return!1}),this.dom.$toolbar.on("click","button",_.bind(this.toolbarClick,this)),this.$element.on("focus",_.bind(this.onFocus,this)),this.$element.on("keydown",_.bind(this.onKeyDown,this)),this.$element.on("keyup",_.bind(this.onKeyUp,this)),this.$element.on("mousedown",_.bind(this.prepareUpdateSelection,this)),this.$element.on("mouseup",_.bind(this.prepareUpdateSelection,this)),this.$element.on("click",_.bind(this.onClick,this)),t(document).on("composer:theme:apply:editors",_.bind(this.applyStyles,this))},initDroppables:function(){this.$element.droppable({accept:".product",over:_.bind(this.enter,this),out:_.bind(this.leave,this),drop:_.bind(this.dropProduct,this),tolerance:"pointer"})},getSelection:function(){return new Selection(this.dom.$textEditor[0])},updateButtons:function(){this.markedTransformer.updateContext();var t=this.markedTransformer.context;this.$cmdButtons.removeClass("selected").removeClass("disabled"),this.setSelectedButtons(t),this.setDisabledButtons(t)},setSelectedButtons:function(t){for(var e in t)switch(e){case"bold":this.dom.buttons.$bold.addClass("selected");break;case"italic":this.dom.buttons.$italic.addClass("selected");break;case"link":this.dom.buttons.$link.addClass("selected");break;case"list":"unordered"===t[e]?this.dom.buttons.$unorderedList.addClass("selected"):this.dom.buttons.$orderedList.addClass("selected");break;case"heading":1===t[e]?this.dom.buttons.$heading.addClass("selected"):2===t[e]&&this.dom.buttons.$subheading.addClass("selected");break;case"center":this.dom.buttons.$center.addClass("selected")}this.setSelectedButtonsFromSelection()},setSelectedButtonsFromSelection:function(){var t=this.getSelection().toString(),e=t.length>4&&(t.startsWith("**")&&t.endsWith("**")||t.startsWith("__")&&t.endsWith("__")),i=t.length>2&&(t.startsWith("*")&&t.endsWith("*")||t.startsWith("_")&&t.endsWith("_"))&&!t.startsWith("**")&&!t.startsWith("__"),s=t.length>4&&t.startsWith("->")&&t.endsWith("<-"),n=t.length>4&&/^\s*\[[^\]]+\]\([^)]*\)\s*$/.test(t);e&&this.dom.buttons.$bold.addClass("selected"),i&&this.dom.buttons.$italic.addClass("selected"),s&&this.dom.buttons.$center.addClass("selected"),n&&this.dom.buttons.$link.addClass("selected")},setDisabledButtons:function(t){t.list&&(this.dom.buttons.$heading.addClass("disabled"),this.dom.buttons.$subheading.addClass("disabled"),this.dom.buttons.$center.addClass("disabled")),t.center&&(this.dom.buttons.$unorderedList.addClass("disabled"),this.dom.buttons.$orderedList.addClass("disabled"));var e=this.getSelection(),i=e.toString().indexOf("\n\n")>-1;i&&this.dom.buttons.$link.addClass("disabled")},onFocus:function(){this.module.promotion.deactivateAllModules(),this.focused=!0,this.module.$element.addClass("active"),this.module.showToolbars()},onClick:function(){_.delay(_.bind(this.updateButtons,this),100)},onKeyDown:function(t){if("html"!==this.mode&&(t.metaKey||t.ctrlKey)){var e=String.fromCharCode(t.keyCode).toLowerCase();switch(e){case"b":return this.execCmd("bold"),!1;case"i":return this.execCmd("italic"),!1}if(t.shiftKey)switch(e){case"c":return this.execCmd("text-align-center"),!1;case"l":return this.execCmd("link"),!1;case"u":return this.execCmd("unordered-list"),!1;case"o":return this.execCmd("ordered-list"),!1;case"1":return this.execCmd("heading"),!1;case"2":return this.execCmd("subheading"),!1}}},onKeyUp:function(){this.prepareUpdateSelection(),this.updateButtons()},enter:function(){this.$element.addClass("hover")},leave:function(){this.$element.removeClass("hover")},dropProduct:function(t,e){var i=_.detect(Composer.ProductList.get().products,function(t){return t.$element[0]===e.draggable[0]});this.setProduct(i),Mimi.TrackEvent.track("online_store/product_dropped"),this.module.isComboType()&&this.module.images[0].setProduct(i)},setProduct:function(t){var e,i=this.parseLinks(t.description);e=t.sales_price?"<strike>"+t.price+"</strike> "+t.sales_price:t.price;var s=Composer.PromotionModuleEditor.PRODUCT_TEMPLATE({name:t.name,url:t.url,price:e,description:i});this.setContent(s)},prepareUpdateSelection:function(){this.autoHeight(),this.updateSelectionTimeOut||(this.updateSelectionTimeout=_.delay(this.updateSelectionBound,500))},updateSelection:function(){this.updateSelectionTimeout=null,Composer.LinkPopup.hide()},initEditorWrapper:function(t){this.setContent(t||"")},focus:function(){this.$element.focus(),this.onFocus(),this.autoHeight(!0)},parseLinks:function(t){var e=this;return t.replace(Composer.PromotionModuleEditor.URL_PATTERN,function(t){return"["+e.chopUrlPrefix(t).truncate(45)+"]("+t+")"})},chopUrlPrefix:function(t){return t.replace(Composer.PromotionModuleEditor.URL_PREFIX_PATTERN,"")},setContent:function(t){var e=this.$element.val()!==t;return this.$element.val(t),e&&this.autoHeight(!0),this},getContent:function(){return this.$element.val()},getPrefix:function(t){return t.hasNewlineBefore()?"":"\n\n"},getSuffix:function(t){return t.hasNewlineAfter()?"":"\n\n"},toolbarClick:function(e){e.die();var i=t(e.currentTarget);if(!i.prop("disabled")){var s=i.detectClass.apply(i,_.keys(Composer.PromotionModuleEditor.COMMANDS));s&&this.execCmd(s)}},addHeading:function(t){var e=this.getPrefix(t),i=I18n.t("js.composer.promotion_module_markdown_editor.addHeading"),s=this.getSuffix(t);t.isEmpty()?t.set(e+i+"\n=========="+s).setSelection(i):t.wrap(e,"\n=========="+s)},addSubheading:function(t){var e=this.getPrefix(t),i=I18n.t("js.composer.promotion_module_markdown_editor.addSubheading"),s=this.getSuffix(t);t.isEmpty()?t.set(e+i+"\n----------"+s).setSelection(i):t.wrap(e,"\n----------"+s)},addCenter:function(t){var e=this.getPrefix(t),i=I18n.t("js.composer.promotion_module_markdown_editor.addCenter"),s=this.getSuffix(t);t.isEmpty()?t.set(e+"->"+i+"<-"+s).setSelection(i):(this.markedTransformer.removeCenterInSelection(),t=this.getSelection(),t[t.length?"wrapEach":"wrap"](e+"->","<-"+s))},addOrderedList:function(t){var e=this.getPrefix(t),i=this.getSuffix(t);if(t.isEmpty())t.wrap(e+"1. ",i).setSelection("1");else if(t.include("\n")){t.caretPositionModifier=3;var s=0;t.set(t.map(function(t,e){return/^\s*$/.test(t)?(s--,t):e+s+1+". "+t}).join("\n"))}else t.wrap(e+"1. ","\n2. ")},addUnorderedList:function(t){var e=this.getPrefix(t),i=this.getSuffix(t);t.isEmpty()?t.wrap(e+"* ",i):t.include("\n")?t.wrapEach("* ",""):t.wrap(e+"* ","\n* ")},execDelayed:function(t){setTimeout(_.bind(function(){this[t](this.getSelection()),this.updateButtons()},this),10)},execCmd:function(t){var e=Composer.PromotionModuleEditor.COMMANDS[t];if(e){e=_.clone(e);var i=e.shift(),s=this.getSelection();switch(this.markedTransformer.updateContext(),i){case"heading":this.execHeadingCmd(s);break;case"subheading":this.execSubheadingCmd(s);break;case"center":this.execCenterCmd(s);break;case"italic":this.execItalicCmd(s);break;case"bold":this.execBoldCmd(s);break;case"createLink":this.execCreateLinkCmd(s);break;case"orderedList":this.execOrderedListCmd(s);break;case"unorderedList":this.execUnorderedListCmd(s);break;case"insertSurveyMonkeyLink":this.fetchSurveys();break;case"insertEventBriteLink":this.fetchEvents();break;case"insertPersonalizationTag":this.fetchPersonalizationTags()}this.markupAdded(),setTimeout(_.bind(this.autoHeight,this,!0),100)}},execSubheadingCmd:function(t){if(this.markedTransformer.isInContext("heading")){var e=this.markedTransformer.context.heading;this.markedTransformer.removeHeading(),2!==e&&this.execDelayed("addSubheading")}else this.markedTransformer.isInContext("list")||(this.markedTransformer.isInContext("center")?(this.markedTransformer.selectCenter(),this.execDelayed("addSubheading")):!this.isCurrentLineEmpty()&&t.isEmpty()?(this.selectCurrentLine(),this.execDelayed("addSubheading")):this.addSubheading(t));this.updateButtons()},execHeadingCmd:function(t){if(this.markedTransformer.isInContext("heading")){var e=this.markedTransformer.context.heading;this.markedTransformer.removeHeading(),1!==e&&this.execDelayed("addHeading")}else this.markedTransformer.isInContext("list")||(this.markedTransformer.isInContext("center")?(this.markedTransformer.selectCenter(),this.execDelayed("addHeading")):!this.isCurrentLineEmpty()&&t.isEmpty()?(this.selectCurrentLine(),this.execDelayed("addHeading")):this.addHeading(t));this.updateButtons()},isCurrentLineEmpty:function(){var t=this.markedTransformer.getLineWithCursor();return/^\s*\u1234?\s*$/.test(t)},selectCurrentLine:function(){var t=this.markedTransformer.getLineWithCursor();this.dom.$textEditor[0].selectionStart-=t.split("\u1234")[0].length,this.dom.$textEditor[0].selectionEnd+=t.split("\u1234")[1].length},execCenterCmd:function(t){this.markedTransformer.isInContext("center")?this.markedTransformer.removeCenter():this.markedTransformer.isInContext("list")||(t.allParasSurroundedWithCenter()?this.markedTransformer.removeCenterInSelection():this.markedTransformer.isInContext("heading")&&t.isEmpty()?(this.markedTransformer.selectHeading(),this.execDelayed("addCenter")):!this.isCurrentLineEmpty()&&t.isEmpty()?(this.selectCurrentLine(),this.execDelayed("addCenter")):this.addCenter(t)),this.updateButtons()},execItalicCmd:function(t){if(this.markedTransformer.isInContext("italic"))this.markedTransformer.removeItalic();else{var e=/^\s*(?:\*([^*]*)\*|_([^_]*)_)\s*$/.exec(t);if(e){var i=this.dom.$textEditor[0].value.slice(this.dom.$textEditor[0].selectionEnd),s=i.length>0,n=s?1:0,o=e[2]||e[1];t.replace(o),this.dom.$textEditor[0].selectionStart-=o.length+n,this.dom.$textEditor[0].selectionEnd-=n}else t.allParasSurroundedWithItalic()?this.markedTransformer.removeItalicInSelection():(this.markedTransformer.removeItalicInSelection(),t=this.getSelection(),t[t.length?"wrapEach":"wrap"]("_","_"))}this.updateButtons()},execBoldCmd:function(t){this.markedTransformer.isInContext("bold")?this.markedTransformer.removeBold():t.allParasSurroundedWithBold()?this.markedTransformer.removeBoldInSelection():(this.markedTransformer.removeBoldInSelection(),t=this.getSelection(),t[t.length?"wrapEach":"wrap"]("**","**")),this.updateButtons()},execCreateLinkCmd:function(t){this.markedTransformer.isInContext("link")?this.editLink():this.createLink(t),this.updateButtons()},execOrderedListCmd:function(t){this.markedTransformer.isInContext("list")?"ordered"===this.markedTransformer.context.list?this.markedTransformer.removeList(!0):(this.markedTransformer.removeList(!1),this.execDelayed("addOrderedList")):this.markedTransformer.isInContext("center")||(this.markedTransformer.isInContext("heading")?(this.markedTransformer.removeHeading(),setTimeout(_.bind(function(){this.addOrderedList(this.getSelection()),this.dom.$textEditor[0].selectionStart--,this.dom.$textEditor[0].selectionEnd--,this.updateButtons()},this),10)):!this.isCurrentLineEmpty()&&t.isEmpty()?(this.selectCurrentLine(),this.execDelayed("addOrderedList")):this.addOrderedList(t)),this.updateButtons()},execUnorderedListCmd:function(t){this.markedTransformer.isInContext("list")?"unordered"===this.markedTransformer.context.list?this.markedTransformer.removeList(!1):(this.markedTransformer.removeList(!0),this.execDelayed("addUnorderedList")):this.markedTransformer.isInContext("center")||(this.markedTransformer.isInContext("heading")?(this.markedTransformer.removeHeading(),setTimeout(_.bind(function(){this.addUnorderedList(this.getSelection()),this.dom.$textEditor[0].selectionStart--,this.dom.$textEditor[0].selectionEnd--,this.updateButtons()},this),10)):!this.isCurrentLineEmpty()&&t.isEmpty()?(this.selectCurrentLine(),this.execDelayed("addUnorderedList")):this.addUnorderedList(t)),this.updateButtons()},fetchPersonalizationTags:function(){t.get("/personalization_tags.json").done(_.bind(this.onFetchTagsSuccess,this)).fail(_.bind(this.onFetchTagsFailure,this))},onFetchTagsSuccess:function(t){if(t.success){var e=t.result;if(0===e.length)Mimi.Addons.PersonalizationTags.show(this,this.dom.buttons.$personalization[0],e);else if(1===e.length)if(("First name"===e[0].tag||"Last name"===e[0].tag)&&(e[0].tag=e[0].tag.replace(" ","")),""===e[0].fallback)this.insertPersonalizationTag(e[0].tag);else{var i=e[0].tag+",fallback="+e[0].fallback;this.insertPersonalizationTag(i)}else Mimi.Addons.PersonalizationTags.show(this,this.dom.buttons.$personalization[0],e)}else Widget.MimiFlash.error(I18n.t("MimiFlash.composer.promotion_module_markdown_editor.onFetchTagsSuccess.problem")+"\n"+t.error)},onFetchTagsFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.composer.promotion_module_markdown_editor.onFetchTagsFailure"))},insertPersonalizationTag:function(t){var e=this.getSelection(),i="{{"+t+"}}";e.wrap(i,""),this.markupAdded(),this.dom.$textEditor.focus()},fetchSurveys:function(){this.surveySpinnerInterval||(this.startSurveySpinner(),t.get("/survey_monkey").done(_.bind(this.onFetchSurveysSuccess,this)).fail(_.bind(this.onFetchSurveysFailure,this)).always(_.bind(this.onFetchSurveysComplete,this)))},onFetchSurveysSuccess:function(t){var e;t.success?(e=t.result,0===e.length?Widget.MimiFlash.create(I18n.t("MimiFlash.composer.promotion_module_markdown_editor.onFetchSurveysSuccess.no_surveys")):1===e.length?this.insertSurveyMonkeyLink(e[0].title,e[0].url):Mimi.Addons.SurveyMonkeySurveys.show(this,this.dom.buttons.$surveymonkey[0],e)):Widget.MimiFlash.error(I18n.t("MimiFlash.composer.promotion_module_markdown_editor.onFetchSurveysSuccess.problem"))},onFetchSurveysFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.composer.promotion_module_markdown_editor.onFetchSurveysFailure"))},onFetchSurveysComplete:function(){this.stopSurveySpinner()},insertSurveyMonkeyLink:function(t,e){var i=this.getSelection();i.isEmpty()?i.wrap("["+t+"]","("+e+")").setSelection(t):i.wrap("[","]("+e+")"),this.markupAdded()},startSurveySpinner:function(){this.surveySpinnerPosition=0,this.dom.buttons.$surveymonkey.addClass("loading").find("span").css({backgroundPosition:"center 2px"}),this.surveySpinnerInterval=setInterval(_.bind(this.updateSurveySpinner,this),100)},updateSurveySpinner:function(){this.surveySpinnerPosition++,this.surveySpinnerPosition>=6&&(this.surveySpinnerPosition=0),this.dom.buttons.$surveymonkey.find("span").css({backgroundPosition:"center "+-20*this.surveySpinnerPosition+"px"})},stopSurveySpinner:function(){clearInterval(this.surveySpinnerInterval),this.surveySpinnerInterval=null,this.dom.buttons.$surveymonkey.removeClass("loading").find("span").attr("style","")},setTableOfContentsContent:function(t){var e=_.map(t,function(t){return"* "+this.buildTableOfContentsLink(t.sectionTitle)},this);this.setContent(e.join("\n"))},tableOfContentsContains:function(t){var e=_.map(this.getContent().split(/\n/),function(t){return t.replace(/\*|\n/,"").trim()});return _.contains(e,this.buildTableOfContentsLink(t))},buildTableOfContentsLink:function(t){var e=t.getText().trim(),i="#"+t.sanitize(e);return"["+e+"]("+i+")"},markupAdded:function(){this.dom.$textEditor.trigger("markup:added"),this.updateSelection()},fetchEvents:function(){this.eventSpinnerInterval||(this.startEventSpinner(),t.get("/event_brite").done(_.bind(this.onFetchEventsSuccess,this)).fail(_.bind(this.onFetchEventsFailure,this)).always(_.bind(this.onFetchEventsComplete,this)))},onFetchEventsSuccess:function(t){if(t.success){var e=t.result;0===e.length?Widget.MimiFlash.create(I18n.t("MimiFlash.composer.promotion_module_markdown_editor.onFetchEventsSuccess.no_events")):1===e.length?this.insertEventBriteLink(e[0].title,e[0].url):Mimi.Addons.EventBriteEvents.show(this,this.dom.buttons.$eventbrite[0],e)}else Widget.MimiFlash.error(I18n.t("MimiFlash.composer.promotion_module_markdown_editor.onFetchEventsFailure")+"\n"+t.error)},onFetchEventsFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.composer.promotion_module_markdown_editor.onFetchEventsFailure"))},onFetchEventsComplete:function(){this.stopEventSpinner()},insertEventBriteLink:function(t,e){var i=this.getSelection();i.isEmpty()?i.wrap("["+t+"]","("+e+")").setSelection(t):i.wrap("[","]("+e+")"),this.markupAdded()},startEventSpinner:function(){this.eventSpinnerPosition=0,this.dom.buttons.$eventbrite.addClass("loading").find("span").css({backgroundPosition:"center 2px"}),this.eventSpinnerInterval=setInterval(_.bind(this.updateEventSpinner,this),100)},updateEventSpinner:function(){this.eventSpinnerPosition++,this.eventSpinnerPosition>=6&&(this.eventSpinnerPosition=0),this.dom.buttons.$eventbrite.find("span").css({backgroundPosition:"center "+-20*this.eventSpinnerPosition+"px"})},stopEventSpinner:function(){clearInterval(this.eventSpinnerInterval),this.eventSpinnerInterval=null,this.dom.buttons.$eventbrite.removeClass("loading").find("span").attr("style","")},editLink:function(){var t=this.markedTransformer.removeLink(),e=this.getSelection(),i=e+"",s=!1,n=_.bind(this.removeLink,this);this.createLink(e,{url:t,selection:e,cancel:function(){s||e.replace("["+i+"]("+t+")")},ok:function(t){var i=t.url,o=t.text;s=!0,i?e.replace("["+o+"]("+i+")"):n()}})},createLink:function(e,i){i||(i={}),t("#text_to_display").on("keyup",_.bind(this.checkIfLink,this));var s=this.getUrlAndTextFromSelection(e,!0),n=_.bind(this.removeLink,this),o=function(t){t.url?s.selection.replace("["+t.text+"]("+t.url+")"):n()},a=function(){};Composer.PromotionItemEditDialog.get("#link_dialog").show({text:i.text||s.text,url:i.url||s.url},i.ok||o,i.cancel||a)},removeLink:function(){this.dom.$textEditor.focus()},checkIfLink:function(){var e=t("#text_to_display").val().match(/(https?:\/\/|www\.([-a-z0-9]+\.)*[-a-z0-9]+.*|[-a-z0-9]+.*\.(co|org|gov|uk|de|net|ca|jp|fr|au|us|ru|ch|it|nl|se|no|es|mil|edu|biz|ly|gl))/);t(".warning").toggleClass("show",!!e)},isMarkdownLink:function(t){return t.startsWith("[")&&t.endsWith(")")&&t.indexOf("](")>=0&&!t.indexOf("\n")>=0},getUrlAndTextFromSelection:function(t,e){t||(t=this.getSelection());var i,s=t.getSelection();if(this.isMarkdownLink(s))i=this.getMarkdownLinkTextAndUrl(s);else{var n=t.getValue(),o=n.lastIndexOf("[",t.start),a=n.indexOf(")",t.end),r=n.lastIndexOf("(",t.start),l=n.indexOf("(",t.end);earlyClosedBracketPosition=n.indexOf(")",o),(r>o&&a>l||a>earlyClosedBracketPosition)&&(o=-1,a=-1),-1===o||-1===a?i=this.getSelectionLinkTextAndUrl(t):(s=n.substring(o,a+1),this.isMarkdownLink(s)?(i=this.getMarkdownLinkTextAndUrl(s),e&&(t.setSelectionRange(o,a+1),t=this.getSelection())):i=this.getSelectionLinkTextAndUrl(t))}return _.extend(i,{selection:t})},getMarkdownLinkTextAndUrl:function(t){var e=t.split("](");return{text:e[0].substr(1),url:e[1].slice(0,-1)}},getSelectionLinkTextAndUrl:function(t){var e=t.getSelection();return Link.isValidHttp(e)?{text:"",url:e}:Link.isValidEmail(e)?{text:e,url:e}:{text:e,url:""}},switchToEditMode:function(){this.$cmdButtons.enable();try{this.focus()}catch(t){}},switchToPreviewMode:function(){this.$cmdButtons.disable(),this.$element.animate({height:this.$element[0].scrollHeight+this.LINE_HEIGHT+"px"},300)},setMode:function(t){switch(t){case"edit":this.switchToEditMode();break;case"preview":this.switchToPreviewMode()}return this.mode=t,this.$element.addRemoveClassNames(["edit","preview"],t),""!==this.$element.val()&&this.autoHeight(!0),this},setWidth:function(t){this.module.dom.$textModule.css({width:t.px()}),this.autoHeight(!0)},clearWidth:function(){this.dom.$textEditor.css({width:""}),this.dom.$toolbar.css({width:""}),this.module.dom.$textModule.css({width:""}),this.autoHeight(!0)},applyStyles:function(){_.defer(_.bind(this.autoHeight,this),!0)},autoHeight:function(e){if(""!==this.$element.val()||e){var i=this.dom.$textEditor,s=this.heightData,n=i.val().length,o=i.width(),a={left:t(window).scrollLeft(),top:t(window).scrollTop()};if(n!==s.valLength||o!==s.boxWidth||e){s.hCheck&&(n<s.valLength||o!==s.boxWidth||e)?i.css("height","0px"):i.css("height",(i.parseIntStyle("height")-s.padding).px());var r=Math.max(s.expandMin,i[0].scrollHeight);i[0].style.overflow=i[0].scrollHeight>r?"auto":"hidden",i[0].style.height=(r+s.padding).px(),s.valLength=n,s.boxWidth=o,window.scrollTo(a.left,a.top)}}},destroy:function(){this.stopObserving()}}),Composer.PromotionModuleEditor.URL_PATTERN=/(?:https?\:\/\/|www\.)[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(:[a-zA-Z0-9]*)?\/?([a-zA-Z0-9\-\._\?\,\'\/\\\+&amp;%\$#\=~])*[^\.\,\)\(\s]/gi,Composer.PromotionModuleEditor.URL_PREFIX_PATTERN=/^(?:https?\:\/\/www\.|https?\:\/\/|www\.)?/,Composer.PromotionModuleEditor.LINK_PATTERN=/\[(.+)\]\(([^)]+)\)/,Composer.PromotionModuleEditor.PRODUCT_TEMPLATE=_.template("[#{name}](#{url})\n  ----------\n  **#{price}**\n  \n  #{description}"),Composer.PromotionModuleEditor.DOM={textEditor:"textarea.editor",toolbar:".text-edit-toolbar",cmdButtons:[".text-edit-toolbar button.command"],buttons:{heading:"button.heading",subheading:"button.subheading",unorderedList:"button.unordered-list",orderedList:"button.ordered-list",link:"button.link",bold:"button.bold",italic:"button.italic",center:"button.text-align-center",surveymonkey:"button.surveymonkey",eventbrite:"button.eventbrite",personalization:"button.personalization"}},Composer.PromotionModuleEditor.COMMANDS={heading:["heading"],subheading:["subheading"],"unordered-list":["unorderedList"],"ordered-list":["orderedList"],link:["createLink"],"text-align-center":["center"],bold:["bold"],italic:["italic"],surveymonkey:["insertSurveyMonkeyLink"],eventbrite:["insertEventBriteLink"],personalization:["insertPersonalizationTag"]},Composer.PromotionModuleEditor.COMMANDS={heading:["heading"],subheading:["subheading"],"unordered-list":["unorderedList"],"ordered-list":["orderedList"],link:["createLink"],"text-align-center":["center"],bold:["bold"],italic:["italic"],surveymonkey:["insertSurveyMonkeyLink"],eventbrite:["insertEventBriteLink"],personalization:["insertPersonalizationTag"]}}(jQuery),function(t){var e='<div class="img-wrapper #{last}"><a href="#{url}" target="_blank"><img src="#{src}" width="#{width}" height="#{height}"></a><p class="caption #{hasCaptionContent}" style="width:#{width}px;height:auto;">#{caption}</p></div>',i=e.replace('<span class="handle"></span>',"");Composer.PromotionModuleImage=Class.create(Widget.Observable,Widget.Observer,{toHTMLTemplate:_.template(e),toHTMLTemplateWithoutHandle:_.template(i),initialize:function(e,i,s){this.ordinal=e,this.module=s,this.$element=t(s.dom.$images[e]),this.dom=this.$element.getChildren(Composer.PromotionModuleImage.DOM),this.data=_.clone(this.getDefaults()),this.$element.data("instance",this),this.setInitialImage(i),this.initDroppables(),t(document).on("image:thumbnail:success",_.bind(this.onThumbnailSuccess,this)),t(document).on("image:thumbnail:failure",_.bind(this.onThumbnailFailure,this)),t(document).on("image:full:success",_.bind(this.onFullImageSuccess,this)),_.defer(_.bind(this.initObservers,this))},initDroppables:function(){this.dom.$image.droppable({over:_.bind(this.enter,this),out:_.bind(this.leave,this),drop:_.bind(this.dropImage,this),tolerance:"pointer"})},initObservers:function(){this.dom.$toolbar.on("click","button",_.bind(this.toolbarClick,this)),this.dom.$image.on("click",_.bind(this.imageClick,this)),t(document).on("promotion:module:image:added",_.bind(this.updateTools,this)),t(document).on("promotion:module:image:deleted",_.bind(this.updateTools,this)),this.updateTools()},imageClick:function(){this.data.url&&window.open(this.data.url)},toolbarClick:function(e){var i=t(e.currentTarget);i.hasClass("edit")?this.editOptions():i.hasClass("add")?this.module.addImage():i.hasClass("delete")?this.module.deleteImage():i.hasClass("resize")&&this.resizeImageToActualSize()},editOptions:function(){Composer.PromotionItemEditDialog.get("#caption_image_link_dialog").show(this.data,_.bind(this.optionsEdited,this))},optionsEdited:function(t){var e=t.url,i=t.caption,s=t.altText;this.setCaption(i),this.data.altText=s,this.data.url=e,this.dom.$image.toggleClass("linked",e)},setCaption:function(t){this.data.caption=t,this.dom.$caption.html(t),this.dom.$caption.toggleClass("has-content",!!t)},shouldShowAddbtn:function(){return!(!(this.module.visibleImages().length===this.ordinal+1&&this.ordinal+1<Composer.PromotionModuleImage.DEFAULTS.max)||this.module.isComboType())
},shouldShowRemovebtn:function(){return!!(this.module.visibleImages().length===this.ordinal+1&&this.ordinal>0||this.module.isComboType())},shouldShowResizebtn:function(){return!(1!==this.module.visibleImages().length||!this.data.image.processed)},updateTools:function(){this.dom.$add.toggle(this.shouldShowAddbtn()),this.dom.$remove.toggle(this.shouldShowRemovebtn()),this.dom.$resize.toggle(this.shouldShowResizebtn())},deleteImage:function(){if(!this.isImageEmpty()){var t=Composer.PromotionModuleImage.DEFAULTS.src,e=this.getDefaults();this.data.width=e.width,this.data.height=e.height,this.data.image=e,this.module.setImageWidth(e.width,this.module.visibleImages()),this.dom.$image.prop("src",this.data.src=t)}},isImageEmpty:function(){return this.$element.find("img").prop("src").endsWith(Composer.PromotionModuleImage.DEFAULTS.src)},isImageVisible:function(t){var e="none"!==this.$element.css("display");return t?e&&!this.isImageEmpty():e},setInitialImage:function(t){this.setDataFromImage(t)},setDataFromImage:function(e){e&&(e.imageId?(e.image=Composer.ImageList.findImage(e.imageId),e.image?e.image.loadFullImage():e.image=this.getDefaults()):e.src?(e.image=new Image,e.image.ratio=this.calculateRatio(e.width,e.height),_.extend(e.image,e)):e.image=this.getDefaults(),e.src=e.image.src,t(e.image).on("composer:image:processed",_.bind(this.onImageProcessed,this)),_.extend(this.data,e),this.setDimensions(this.data.width,this.data.height),this.setSrc(this.data.src||Composer.PromotionModuleImage.DEFAULTS.src),this.setCaption(this.data.caption),this.module.initEmptyImages())},setDataFromProduct:function(e){e.image=e.full_image,e.image.ratio=e.imageRatio(),t(e.image).on("composer:image:processed",_.bind(this.onImageProcessed,this)),_.extend(this.data,e),this.data.imageId=null,this.setDimensions(e.width,e.height),this.setSrc(e.full_image.src),this.setCaption(e.sales_price?e.name+" - <strike>"+e.price+"</strike> "+e.sales_price:e.name+" - "+e.price),this.module.initEmptyImages()},getData:function(){return this.data},enter:function(){this.$element.addClass("hover")},leave:function(){this.$element.removeClass("hover")},onThumbnailSuccess:function(t,e){if(e.id===this.data.imageId)try{var i=this.calculateRatio(e.width,e.height),s=this.getWidth(),n=Math.round(s/i);this.setDimensions(s,n),ImageLoader.load(this.dom.$image[0],e.image_url,_.bind(this.onFullImageLoaded,this),_.bind(this.onFullImageFailed,this)),this.module.resetImageSizes()}catch(o){window.console.log("error",o)}},onThumbnailFailure:function(t,e){if(e.id===this.data.imageId){e.destroy&&this.$element.fadeOut(_.bind(this.destroy,this));var i=_.template(I18n.t("MimiFlash.composer.promotion_module_image.onThumbnailFailure")),s=_.last(this.src.split("/")),n=i({file_name:s});Widget.MimiFlash.error(n)}},onFullImageSuccess:function(t,e){e.id===this.data.imageId&&this.fullImageLoaded(e.src)},onFullImageLoaded:function(t){this.fullImageLoaded(t.src)},onFullImageFailed:function(){var t=_.template(I18n.t("MimiFlash.composer.promotion_module_image.onFullImageFailed")),e=_.last(this.src.split("/")),i=t({image_name:e});Widget.MimiFlash.error(i)},fullImageLoaded:function(t){this.setSrc(t),this.module.resetImageSizes()},dropImage:function(t,e){if(e.helper.hasClass("dragged_product"))return void this.dropProduct(t,e);var i=_.detect(Composer.ImageList.get().images,function(t){return t.$element.find("img")[0]===e.draggable[0]});this.processImage(i)},processImage:function(t){var e;t&&(e=_.extend(_.clone(t),{imageId:t.id,width:this.data.width,height:Math.round(this.data.width/t.ratio)})),this.setDataFromImage(e),this.module.imageDropped(this),this.updateTools()},dropProduct:function(t,e){var i=_.detect(Composer.ProductList.get().products,function(t){return t.$element[0]===e.draggable[0]});Mimi.TrackEvent.track("online_store/product_dropped"),this.setProduct(i)},setProduct:function(t){var e=_.extend(_.clone(t),{productId:t.external_id,width:this.data.width,height:Math.round(this.data.width/t.imageRatio()),ratio:t.imageRatio()});this.setDataFromProduct(e),this.module.imageDropped(this)},calculateRatio:function(t,e){return Math.round(t/e*1e3)/1e3},getDefaults:function(){return _.clone(this.module.getType().startsWith("combo")?Composer.PromotionModuleImage.DEFAULTS.combo:Composer.PromotionModuleImage.DEFAULTS.image)},getId:function(){return this.data.imageId},getWidth:function(){return this.data.width},getHeight:function(){return this.data.height},getRatio:function(){return this.calculateRatio(this.data.width,this.data.height)},setDimensions:function(t,e){var i=this.dom.$image;this.data.width=t,this.data.height=e,i[0].style.width=t?t+"px":"",i[0].style.height=e?e+"px":"";var s=!0;window.navigator.userAgent.indexOf("MSIE")>-1&&s&&(i[0].parentNode.style.width=t?t+"px":"",i[0].parentNode.style.height=e?e+"px":"")},getDimensions:function(){return{width:this.dom.$image.width(),height:this.dom.$image.height()}},getSrc:function(){return this.data.src||Composer.PromotionModuleImage.DEFAULTS.src},setSrc:function(t,e){this.data.src=t||null,e&&this.dom.$image.on("load",e),this.dom.$image.prop("src",t||Composer.PromotionModuleImage.DEFAULTS.src)},toJSON:function(){return{id:this.data.imageId,width:this.data.width,height:this.data.height,url:this.data.url,src:this.dom.$image.prop("src").endsWith(Composer.PromotionModuleImage.DEFAULTS.src)||this.data.imageId?null:this.dom.$image.prop("src"),caption:this.data.caption,altText:this.data.altText}},getHTMLTemplate:function(){return"image"===this.module.data.type?this.toHTMLTemplateWithoutHandle:this.toHTMLTemplate},toHTML:function(t,e){return this.getHTMLTemplate()({align:t||"none",src:this.getSrc(),width:this.getWidth(),height:this.getHeight(),last:e?"last":"",caption:this.data.caption,hasCaptionContent:this.data.caption?"has-content":"",url:this.data.url||"#"})},destroy:function(){},resizeImageToActualSize:function(){var t=this.data.image.width,e=this.data.image.height,i=this.data.image.src,s=this.detectScale(i),n=Math.min(this.getDefaults().maxWidth,Composer.ImageResizer.MAX_TOTAL_WIDTH);t/=s,e/=s,t>n&&(e=Math.round(n/this.calculateRatio(t,e)),t=n),this.setDimensions(t,e),this.module.imageControls.updateDisplay(t,e),this.module.updateTextModuleWidth()},detectScale:function(t){var e=t.match(/_(\d+)x\..+?(?:\?.+)?$/);return parseInt(e&&e[1]||1)},onImageProcessed:function(){this.updateTools()}}),Composer.PromotionModuleImage.DOM={image:"img",caption:"p.caption",toolbar:"div.image-edit-toolbar",add:"button.add",remove:"button.delete",resize:"button.resize"},Composer.PromotionModuleImage.DEFAULTS={image:{width:400,height:400,ratio:1,minHeight:80,imageId:null,caption:null,id:null,url:null,maxWidth:554},combo:{width:150,height:150,ratio:1,minHeight:80,imageId:null,caption:null,id:null,url:null,maxWidth:360},src:"https://d2vnkn0bfhsarv.cloudfront.net/assets/img/placeholder.svg",max:4}}(jQuery),Composer.PromotionModuleImageControls=Class.create(Widget.Observer,Composer.ImageResizing,{initialize:function(t){this.module=t,this.$element=t.dom.$imageControls,this.dom=this.$element.getChildren(Composer.PromotionModuleImageControls.DOM),this.initResizing(this.dom.$handle[0])},updateDisplay:function(t,e){this.dom.$size.html(t+" &times; "+e)},setImageWidth:function(t,e){this.module.setImageWidth(t,e)},getModuleType:function(){return this.module.getType()},getVisibleImages:function(){return this.module.visibleImages()},destroy:function(){}}),Composer.PromotionModuleImageControls.DOM={handle:"span.handle",size:"span.size"},function(t){Composer.PromotionModuleStyles=Class.create(Widget.Styles,Widget.Observer,{initialize:function($super,e){$super(e),this.currentStyles={},t(document).on("composer:theme:apply:editors",_.bind(this.applyEditorStyles,this)),t(document).on("composer:theme:apply:titles",_.bind(this.applyTitleStyles,this)),t(document).on("composer:theme:apply:buttons",_.bind(this.applyButtonStyles,this))},applyEditorStyles:function(t,e){var i=e.styles,s=e.selector,n=e.previewSelector,o="#madmimi_outer_wrapper div.madmimi-preview-container "+n;""===s&&(o+=", #madmimi_outer_wrapper textarea.edit.editor, #madmimi_outer_wrapper textarea.editor.edit, #madmimi_outer_wrapper div.madmimi-preview-container li, #madmimi_outer_wrapper div.madmimi-preview-container td"),this.applyStyles(o,i)},applyTitleStyles:function(t,e){var i=e.styles,s="#madmimi_outer_wrapper div.madmimi-preview-container h2.section_title, #madmimi_outer_wrapper div.madmimi-header-container input";this.applyStyles(s,i)},applyButtonStyles:function(t,e){var i=e.styles,s="#madmimi_outer_wrapper div.madmimi-call-to-action-container a";this.applyStyles(s,i,!0)},applyStyles:function(t,e,i){var s;e.background&&!i&&delete e.background,s=Widget.Styles.makeStyleString(e),this.currentStyles[t]&&this.currentStyles[t].string===s||(this.updateRule(t,e),this.currentStyles[t]={styles:e,string:s})}})}(jQuery),function(t){Composer.PromotionModuleToolbar=Class.create(Widget.Observer,{initialize:function(t){this.module=t,this.$element=t.dom.$moduleTools,this.dom=this.$element.getChildren(Composer.PromotionModuleToolbar.DOM),this.dom.$container.on("click","li",_.bind(this.click,this)),Mimi.ABtest.isTestGroup()&&this.$element.prev(".edit_module").on("click",_.bind(this.editModule,this))},click:function(t){var e=t.currentTarget;switch(e.className){case"lock":this.lockModule();break;case"preview":this.module.setMode("preview"),this.setVisibility(!0);break;case"edit":this.module.onEdit();break;case"type":this.showTypeSelect();break;case"delete":this.module.deleteModule()}},editModule:function(){this.module.onEdit()},lockModule:function(){this.setLocked(!this.dom.$lockButton.hasClass("selected"))},showTypeSelect:function(){this.dom.$typeButton.hasClass("disabled")||Composer.ModuleTypeSelect.get().show(this)},setType:function(t){this.setTypeText(t),"blog-post"===t&&(this.dom.$editItem.hide(),this.dom.$typeButton.disable(),this.dom.$deleteItem.hide())},setLocked:function(t){if(this.module.setLocked(t),t?(this.dom.$editItem.hide(),this.dom.$typeButton.disable(),this.dom.$deleteItem.hide(),this.module.setMode("preview")):"blog-post"!==this.module.getType()&&(this.dom.$editItem.show(),this.dom.$typeButton.enable(),this.dom.$deleteItem.show()),this.dom.$lockItem[0]){var e=I18n.t(t?"js.promotions.promotion_module.unlock":"js.promotions.promotion_module.lock");this.dom.$lockItem.find("span").html(e),this.dom.$lockButton[(t?"add":"remove")+"Class"]("selected")}},setTypeText:function(e){var i=Composer.ModuleTypeSelect.getItem(e);this.dom.$typeButton.html("blog-post"===e?I18n.t("js.promotions.promotion_module.blog_post"):t(i).html())},setVisibility:function(t){this.$element.css({visibility:t?"visible":"hidden"})},destroy:function(){this.stopObserving()},hideEditAndPreviewButtons:function(){this.dom.$editItem.hide(),this.dom.$previewItem.hide()}}),Composer.PromotionModuleToolbar.DOM={container:"ul",dragItem:"li.drag",lockItem:"li.lock",lockButton:"li.lock button",previewItem:"li.preview",editItem:"li.edit",typeItem:"li.type",typeButton:"li.type button",typeText:"li.type button span",deleteItem:"li.delete"}}(jQuery),function(t){Composer.PromotionModulePreview=Class.create(Widget.Observable,Widget.Observer,Composer.ImageResizing,{initialize:function(t){this.module=t,this.$element=this.module.dom.$preview,this.dom=this.$element.getChildren(Composer.PromotionModulePreview.DOM),this.initObservers()},initObservers:function(){this.dom.$content.on("click",_.bind(function(t){return"a"===t.target.tagName.toLowerCase()||this.module.isBlogPost()||this.module.isTableOfContents()?void 0:(this.module.setMode("edit"),!1)},this)),this.dom.$images.on("click",_.bind(function(){return this.justResized?(this.justResized=!1,!1):(this.module.setMode("edit"),!1)},this))},initDroppables:function(){_.each(this.$images,function(e,i){t(e).droppable({over:_.bind(this.enter,this),out:_.bind(this.leave,this),drop:_.bind(function(t,e){this.dropImage(t,e,this.module.images[i])},this),tolerance:"pointer"})},this),"image"!==this.getModuleType()&&this.$element.droppable({accept:".product",over:_.bind(this.enter,this),out:_.bind(this.leave,this),drop:_.bind(this.dropProductOnEditor,this),tolerance:"pointer"})},enter:function(e,i){t(i).addClass("hover"),e.uploadedImage&&e.uploadedImage.hover("image")},leave:function(e,i){t(i).removeClass("hover"),e.updloadedImage&&e.uploadedImage.unhover("image")},getImageIndex:function(t){return _.indexOf(this.$images,t)},dropImage:function(t,e,i){i.dropImage(t,e),this.update()},dropProductOnImage:function(t,e){var i=this.module.images[this.getImageIndex(e)];i.dropProduct(t,e),this.update()},dropProductOnEditor:function(t,e){this.module.editor.dropProduct(t,e),this.update()},update:function(){var t=this.getModuleType(),e=this.module.getHTML(),i=this.getVisibleImages(!0),s=!1;switch(this.justResized=!1,this.destroyResizing(),t){case"blog-post":case"text":case"table-of-contents":this.destroyImages(),this.dom.$content.html(e),s=""===e.trim(),s&&this.setEmptyText();break;case"header":this.destroyImages(),this.dom.$content.html("<h2 class='section_title'>"+e+"</h2>"),s=""===this.module.sectionTitle.getValue(),s&&this.setEmptyText();break;case"combo-left":this.updateCombo(e,i,"left"),noText=""===e.trim(),noText&&this.setEmptyText(),s=noText&&0===i.length;break;case"combo-right":this.updateCombo(e,i,"right"),noText=""===e.trim(),noText&&this.setEmptyText(),s=noText&&0===i.length;break;case"image":this.updateMultiImage(e,i),s=0===i.length;break;case"divider":this.destroyImages(),this.$element.css({textAlign:"center"}),this.dom.$content.html("<img src='https://d1lggihq2bt4jo.cloudfront.net/assets/divider.png' alt='***'>")}this.$images=this.dom.$images.find("img"),this.dom.$images[this.$images.length?"show":"hide"](),this.$element[(s?"add":"remove")+"Class"]("empty"),this.initDroppables();var n=this.dom.$images.find(".handle");n[0]&&this.initResizing(n[0]),window.navigator.userAgent.indexOf("MSIE")>-1&&(this.dom.$content.hide(),_.defer(_.bind(this.dom.$content.show,this.dom.$content)))},updateCombo:function(t,e,i){if(this.dom.$images.css({cssFloat:i}),this.dom.$content.html(t),e=this.handleEmptyImages(e),e&&0!==e.length){var s=Composer.PromotionModulePreview.CONTROLS+e[0].toHTML();this.previousMarkup!==s&&(this.destroyImages(),this.dom.$images.append(s),this.previousMarkup=s,this.setSize(e[0].getWidth(),e[0].getHeight()))}},updateMultiImage:function(t,e){this.dom.$images.css({cssFloat:"none"}),this.$element.css({textAlign:"center"}),this.dom.$content.html("");var i=0;if(e=this.handleEmptyImages(e),e&&0!==e.length){var s=Composer.PromotionModulePreview.CONTROLS+_.map(e,function(t,s){return i+=t.getWidth(),t.toHTML(!1,s===e.length-1)}).join("");this.previousMarkup!==s&&(this.destroyImages(),this.dom.$images.append(s),this.previousMarkup=s,this.setSize(i+20*(e.length-1),e[0].getHeight()))}},handleEmptyImages:function(t){if(0===t.length){if(t=this.module.visibleImages(!1),0===t.length)return;this.$element.addClass("placeholder-image")}else this.$element.removeClass("placeholder-image");return t},setEmptyText:function(){this.dom.$content.html(Composer.PromotionModulePreview.TEXT_PLACEHOLDER)},destroyImages:function(){this.$images&&_.each(this.$images,function(e){t(e).droppable("destroy").closest("div.img-wrapper").remove()}),this.dom.$images.find(".controls").remove()},setImageWidth:function(t,e){this.module.setImageWidth(t,e),this.moduleType.startsWith("combo")?this.setComboImageWidth(t,e):"image"===this.moduleType&&this.setMultiImageWidth(t,e),this.justResized=!0},setComboImageWidth:function(e){if(all_images=this.getVisibleImages(!1)){var i=Math.round(e/all_images[0].getRatio());t(this.$images[0]).css({width:e.px(),height:i.px()}),t(this.$images[0]).closest("div.img-wrapper").find("p.caption").css({width:e.px()}),this.setSize(e,i)}},setMultiImageWidth:function(){if(all_images=this.getVisibleImages(!1)){var e=0,i=0;_.each(all_images,function(s,n){var o=s.getWidth(),a=s.getHeight();i=a,e+=o,t(this.$images[n]).css({width:o.px(),height:a.px()}),t(this.$images[n]).closest("div.img-wrapper").find("p.caption").css({width:o.px()})},this),this.setSize(e+20*(this.$images.length-1),i)}},setSize:function(t,e){this.dom.$images.find("span.size").html(t+" x "+e),this.dom.$images.find(".controls").css({top:(e-32).px()})},getModuleType:function(){return this.module.getType()},getVisibleImages:function(t){return this.module.visibleImages(t)}}),Composer.PromotionModulePreview.DOM={content:".content",images:".images"},Composer.PromotionModulePreview.TEXT_PLACEHOLDER='<span class="placeholder-text"></span>',Composer.PromotionModulePreview.CONTROLS='<div class="controls"><span class="handle"></span><span class="size">100 x 100</span></div>'}(jQuery),function(t){Composer.PromotionModule=Class.create(Widget.Observable,Widget.Observer,{TEXTAREA_WIDTH:530,IMAGE_SPACING:20,initialize:function(e,i,s){i=this.prepareData(i),this.$element=t(e),this.dom=this.$element.getChildren(Composer.PromotionModule.DOM),this.promotion=s,this.toolbar=new Composer.PromotionModuleToolbar(this),this.editor=new Composer.PromotionModuleEditor(this,i.text),this.sectionTitle=new Composer.PromotionModuleSectionTitle(this,i.header),this.callToAction=new Composer.PromotionModuleCallToAction(this,i.button),this.imageControls=new Composer.PromotionModuleImageControls(this),this.preview=new Composer.PromotionModulePreview(this),this.initObservers(),Mimi.ABtest.isTestGroup()&&(this.initDroppable(),this.initDragDrop()),this.setData(i),this.toolbar.setTypeText(this.getType()),this.setType(this.getType()),this.setEditability(),this.initEmptyImages()},initDragDrop:function(){this.originalOnDragOver=window.ondragover,this.originalOnDrop=window.ondrop,window.ondragover=_.bind(this.onDragOver,this),window.ondrop=_.bind(this.onDrop,this)},onDragOver:function(e){if(e.preventDefault&&e.preventDefault(),this.originalOnDragOver&&this.originalOnDragOver(e),this.isImageType()||this.isComboType()){var i=t(e.target).closest(".module");i[0]==this.dom.$moduleDiv[0]?(clearTimeout(this.dragTimer),this.timerStarted=!1,"preview"==this.mode&&this.setMode("edit")):this.timerStarted||(this.dragTimer=setTimeout(_.bind(function(){"edit"==this.mode&&this.setMode("preview"),this.timerStarted=!1},this),10),this.timerStarted=!0)}},onDrop:function(e){if(e.preventDefault&&e.preventDefault(),this.originalOnDrop&&this.originalOnDrop(e),this.isImageType()||this.isComboType()){var i=t(e.target).closest(".module");i[0]==this.dom.$moduleDiv[0]&&"edit"==this.mode&&setTimeout(_.bind(function(){0==this.dom.$imageContainer.find(".processing").length&&this.setMode("preview")},this),10)}},initDroppable:function(){this.$element.droppable({over:_.bind(function(){(this.isImageType()||this.isComboType())&&(this.initialMode=this.initialMode||this.mode,"preview"==this.initialMode&&this.setMode("edit"))},this),out:_.bind(function(){(this.isImageType()||this.isComboType())&&("preview"==this.initialMode&&this.setMode("preview"),this.initialMode=null)},this),drop:_.bind(function(){(this.isImageType()||this.isComboType())&&("preview"==this.initialMode&&this.setMode("preview"),this.initialMode=null)},this),tolerance:"pointer"})},initObservers:function(){t(document).on("promotion:module:sorted",_.bind(this.updateTableOfContents,this)),Mimi.ABtest.isControlGroup()&&(t(document).on("mouseenter",_.bind(this.enter,this)),t(document).on("mouseleave",_.bind(this.leave,this)),this.$element.on("mouseenter",_.bind(this.showToolbars,this)),this.$element.on("mouseleave",_.bind(function(){this.isActive()||this.hideToolbars()},this))),this.dom.$insertionPoint.on("click",_.bind(this.insertionClick,this)),this.$element.on("click",_.bind(function(){this.isImageType()&&(this.promotion.deactivateAllModules(),this.showToolbars(),this.active=!0)},this))},isActive:function(){return this.hasTextarea()&&this.isFocused()||this.active},deactivate:function(){this.active=!1,this.editor.focused=!1,this.sectionTitle.focused=!1,this.$element.removeClass("active"),this.hideToolbars()},isFocused:function(){return this.editor.focused||this.sectionTitle.focused},hideToolbars:function(){this.$element.removeClass("toolbar-visible")},showToolbars:function(){this.$element.addClass("toolbar-visible")},initEmptyImages:function(){this.dom.$images.each(function(e,i){var s=t(i).find("img");s.prop("src").endsWith("placeholder.svg")?t(i).addClass("empty-image"):t(i).removeClass("empty-image")})},setData:function(t){if(!t.images){t.images=[];for(var e=0;4>e;++e){var i=t.type.startsWith("combo")?Composer.PromotionModuleImage.DEFAULTS.combo:Composer.PromotionModuleImage.DEFAULTS.image;t.images.push(_.clone(i))}}t.id||(t.id=--Composer.PromotionModule.lastId),this.data=t,this.setupImages(),this.toolbar.setType(t.type),this.toolbar.setLocked(t.locked),this.isBlogPost()?(this.setMode("preview"),this.dom.$insertionPoint.hide()):this.setMode(t.mode?t.mode:"edit");var s=_.last(this.visibleImages());s&&s.$element.addClass("last")},getData:function(){return this.data},show:function(e,i){if(this.data.deleted=!1,e){t(document).trigger("promotion:module:shown"),this.$element.show();try{this.editor.focus()}catch(s){}}else this.fxShow(i)},fxShow:function(e){this.$element.css({opacity:1}).show();var i=this.$element.height();this.$element.css({height:"0",overflow:"hidden"});var s,n=!1,o=this.$element.offset().top;window.requestAnimFrame&&window.cancelRequestAnimFrame&&!function l(){return n||e?void cancelRequestAnimFrame(s):(window.scrollTo(0,o),void(s=requestAnimFrame(l)))}();for(var a=this.promotion.getModulesAboveScroll(),r=a.length;r--;)a[r].$element[0].style.visibility="hidden";this.$element.animate({height:i+"px"},350,_.bind(function(){_.each(a,function(t){t.$element[0].style.visibility=""}),n=!0,e||window.scrollTo(0,this.$element.offset().top),this.$element.css("height",""),this.$element.css("overflow","visible"),this.editor.focus(),t(document).trigger("promotion:module:shown")},this))},hide:function(){this.$element.animate({opacity:.3},300,_.bind(function(){setTimeout(_.bind(function(){this.$element.slideUp(500,_.bind(function(){this.fire("promotion:module:hidden")},this))},this),100)},this))},getType:function(){return this.data.type},setType:function(t){this.hasText()&&(this.data.originalText=this.getText()),this.data.type=Composer.PromotionModule.TYPES.indexOf(t)>-1?t:"text",this.dom.$moduleDiv.addRemoveClassNames(Composer.PromotionModule.TYPES,this.data.type),this.setText(this.data.originalText),_.each(this.images,function(t){t.$element.hide()}),(_.isUndefined(this.data.imageCount)||this.data.imageCount<=0)&&(this.data.imageCount=1),this.isComboType()?this.setComboType():this.isImageType()?this.setImageType():this.editor.clearWidth(),this.preview&&this.preview.update(),this.initImages(),this.fire("promotion:module:changed")},setEditability:function(){Mimi.ABtest.isControlGroup()&&this.isTableOfContents()&&this.toolbar.hideEditAndPreviewButtons()},isComboType:function(){return this.getType().startsWith("combo")},isImageType:function(){return"image"===this.getType()},isBlogPost:function(){return this.getType().startsWith("blog")},isTableOfContents:function(){return"table-of-contents"===this.getType()},isText:function(){return"text"===this.getType()},isHeader:function(){return"header"===this.getType()},isCallToAction:function(){return"call-to-action"===this.getType()},setComboType:function(){var t=Composer.PromotionModuleImage.DEFAULTS.combo.maxWidth;if(this.images[0].getId()||this.images[0].getSrc())if(this.images[0].getWidth()>t){var e=this.images[0].getSrc();this.setImageWidth(e&&e!==Composer.PromotionModuleImage.DEFAULTS.src?t:Composer.PromotionModuleImage.DEFAULTS.combo.width)}else this.setImageWidth(this.images[0].getWidth());else this.setImageWidth(Composer.PromotionModuleImage.DEFAULTS.combo.width);this.images[0].$element.show(),this.dom.$textModule.css({width:this.TEXTAREA_WIDTH-this.getImageWidth()+"px"})},updateTableOfContents:function(){if(this.isTableOfContents()){var t=this.promotion.findTableOfContentsHeaderModules();t.length?(this.editor.setTableOfContentsContent(t),this.preview.update()):this.deleteModule()}},setImageType:function(){for(var t=0;t<this.data.imageCount;++t)this.images[t].$element.show();this.resetImageSizes()},hasImages:function(){return this.isImageType()||this.isComboType()},hasTextarea:function(){return this.isText()||this.isTableOfContents()||this.isHeader()||this.isComboType()},getMode:function(){return this.dom.$moduleDiv.hasClass("edit")?"edit":"preview"},setLocked:function(t){this.data.locked=t},getLocked:function(){return this.data.locked},onEdit:function(){Mimi.ABtest.isControlGroup()&&this.isCallToAction()?this.callToAction.showConfiguration():this.setMode("edit")},setMode:function(t){this.dom.$moduleDiv.addRemoveClassNames(["edit","preview"],t),this.mode=t,this.editor.setMode(t),this.fire("module:mode",{mode:t}),"preview"===t&&this.preview.update()},setupImages:function(){this.images=_.map(this.data.images,function(t,e){return new Composer.PromotionModuleImage(e,t,this)},this)},initImages:function(){_.invoke(this.images,"updateTools"),_.each(this.visibleImages(),function(t){t.$element.removeClass("last")});var t=_.last(this.visibleImages());t&&t.$element.addClass("last")},addImage:function(){if(this.isImageType()){var t=this.visibleImages().length;t<Composer.PromotionModuleImage.DEFAULTS.max&&(this.images[t].$element.show().addClass("last"),this.images[t-1].$element.removeClass("last"),this.resetImageSizes(),this.fire("promotion:module:image:added"),this.data.imageCount++)}},deleteImage:function(){if(this.isComboType())this.toolbar.setType("text"),this.setType("text");else{var t=this.visibleImages();t.length>1&&(_.last(t).$element.hide().removeClass("last"),t[t.length-2].$element.addClass("last"),this.fire("promotion:module:image:deleted"),this.data.imageCount--)}},imageDropped:function(){this.resetImageSizes()},firstImageHeight:function(){return this.images[0].getHeight()},visibleImages:function(t){return this.isImageType()?_.select(this.images,function(e){return e.isImageVisible(t)}):t&&this.images[0].isImageEmpty()?[]:[this.images[0]]},getImageWidth:function(t){if(this.getType().startsWith("combo"))return this.images[0].getWidth()+(t?0:this.IMAGE_SPACING);var e=this.visibleImages();return _.inject(e,function(t,e){return t+e.getWidth()},0)+(e.length-1)*this.IMAGE_SPACING},setImageWidth:function(t,e){if(this.isImageType())this.applyImageSizes(Composer.ImageResizer.targetWidth(this.getImageData(e),t),e);else{var i=Math.round(t/this.images[0].getRatio());this.images[0].setDimensions(t,i),this.imageControls.updateDisplay(t,i),this.updateTextModuleWidth()}},getImageData:function(t){return _.map(t,function(t){return t.data.image})},resetImageSizes:function(){if(this.isImageType()){var t=this.visibleImages();this.applyImageSizes(Composer.ImageResizer.targetHeight(this.getImageData(t),this.firstImageHeight()),t)}else{var e=this.images[0].getWidth(),i=Math.round(e/this.images[0].getRatio());this.images[0].setDimensions(e,i),this.imageControls.updateDisplay(e,i),this.updateTextModuleWidth()}this.preview&&this.preview.update()},applyImageSizes:function(t,e){var i=t.widths,s=t.height;_.each(e,function(t,e){t.setDimensions(i[e],s)}),this.imageControls.updateDisplay(t.width,s)},updateTextModuleWidth:function(){this.editor.setWidth(this.TEXTAREA_WIDTH-this.images[0].data.width-this.IMAGE_SPACING)},deleteModule:function(){this.data.deleted=!0,this.hide(),this.fire("promotion:module:deleted")},isDeleted:function(){return this.data.deleted},enter:function(){"preview"===this.getMode()&&this.toolbar.setVisibility(!0)},leave:function(){"preview"===this.getMode()&&this.toolbar.setVisibility(!1)},insertionClick:function(){this.fire("composer:adder:add",{type:this.getType(),after:this.$element[0]})},getId:function(){return this.data.id},setId:function(t){this.data.id=t},getHTML:function(){switch(this.data.type){case"blog-post":return this.getText();case"text":case"table-of-contents":case"combo-left":case"combo-right":return MadDown.convert(this.editor.getContent());case"header":return this.sectionTitle.getContent();default:return""}},hasText:function(){switch(this.data.type){case"blog-post":case"text":case"combo-left":case"combo-right":case"table-of-contents":case"header":case"call-to-action":return!0;default:return!1}},getText:function(){switch(this.data.type){case"blog-post":case"text":case"combo-left":case"combo-right":case"table-of-contents":return this.editor.getContent();case"header":return this.sectionTitle.getContent();case"call-to-action":return this.callToAction.getContent();default:return""}},setText:function(t){switch(this.data.type){case"blog-post":case"text":case"combo-left":case"combo-right":case"table-of-contents":this.editor.setContent(t);break;case"header":this.sectionTitle.interpret(t);break;case"call-to-action":this.callToAction.interpret(t)}},toJSON:function(){var t={id:this.getId(),type:this.data.type,locked:this.data.locked,text:this.getText()};return this.hasImages()&&(t.images=this.visibleImages()),t},destroy:function(){this.editor.destroy(),this.toolbar.destroy(),this.imageControls.destroy(),_.invoke(this.images,"destroy"),this.stopObserving()},prepareData:function(t){return"call-to-action"==t.type&&(t.button=t.text,delete t.text),t}}),Composer.PromotionModule.DOM={moduleDiv:".module",moduleTools:".module-tools",preview:".madmimi-preview-container",textModule:".madmimi-text-container",textEditor:".madmimi-text-container textarea.editor",imageContainer:".madmimi-image-container",imageControls:".madmimi-image-container > div.controls",images:[".madmimi-image-container-body"],sectionTitle:".madmimi-header-container",insertionPoint:"div.module-insertion",editImageToolbars:[".image-edit-toolbar"],editTextToolbars:[".text-edit-toolbar"],editCallToActionToolbars:[".call-to-action-edit-toolbar"],ctaButton:".madmimi-call-to-action-container"},Composer.PromotionModule.TYPES="combo-left combo-right text image divider header table-of-contents blog-post call-to-action".split(" "),Composer.PromotionModule.MIN_IMAGE_WIDTH=80,Composer.PromotionModule.MAX_IMAGE_WIDTH=554,Composer.PromotionModule.MAX_COMBO_IMAGE_WIDTH=360,Composer.PromotionModule.lastId=0}(jQuery),function(t){Composer.Promotion=Class.create(Widget.Observable,Widget.Observer,{initialize:function(e){this.data=e,this.saveFailedCount=0,this.$element=t("#madmimi_outer_wrapper"),this.dom=this.$element.getChildren(Composer.Promotion.DOM),this.logoUploader=new Composer.LogoUploader(this.dom.$logoContainer),this.modules=[],this.initObservers(),this.initDroppable(),this.setData()},initObservers:function(){var e=t(document);e.on("composer:adder:add",_.bind(this.addModule,this)),e.on("promotion:created",_.bind(this.onPromotionCreated,this)),e.on("composer:image:deleted",_.bind(this.onImageDeleted,this)),e.on("promotion:module:deleted promotion:module:undeleted",_.bind(this.updateTableOfContents,this)),e.on("composer:theme:saved",_.bind(this.onThemeSaved,this));var i=t(this.logoUploader);i.on("composer:logo-uploader:loaded",_.bind(this.onLogoFileLoadCompleted,this)),i.on("composer:logo-uploader:selected",_.bind(this.onLogoFileSelected,this)),i.on("composer:logo-uploader:drag-over",_.bind(this.onLogoUploaderDragOver,this)),i.on("composer:logo-uploader:drag-leave",_.bind(this.onLogoUploaderDragLeave,this)),i.on("composer:logo-uploader:drop",_.bind(this.onLogoUploaderDrop,this)),this.dom.$editLogoLink.on("click",_.bind(this.onLogoEditLinkClicked,this)),window.onbeforeunload=_.bind(this.onbeforeunload,this)},initDroppable:function(){this.dom.$logoContainer.droppable({over:_.bind(this.onLogoContainerEnter,this),out:_.bind(this.onLogoContainerLeave,this),drop:_.bind(this.onLogoContainerDrop,this),tolerance:"pointer"})},onLogoContainerEnter:function(){this.dom.$logoContainer.parent().addClass("over")},onLogoContainerLeave:function(){this.dom.$logoContainer.parent().removeClass("over")},onLogoContainerDrop:function(t,e){this.dom.$logoContainer.parent().removeClass("over");var i=_.detect(Composer.ImageList.get().images,function(t){return t.$element.find("img")[0]===e.draggable[0]});if(i){var s=Composer.ThemeList.getCurrentTheme();s.setRemoteImageUrl(i.src.replace("/composer_thumb/","/original/")),s.setImageDataUrl(i.src),s.showProcessingIndicator(),s.apply(),s.save()}},onLogoEditLinkClicked:function(t){t.preventDefault&&t.preventDefault();var e=Composer.ThemeList.getCurrentTheme();Composer.Sidebar.switchToThemesTab(),Composer.ThemeEditor.show(e,_.bind(e.edited,e)),Composer.ThemeEditor.switchToLogoTab()},onLogoFileSelected:function(){var t=Composer.ThemeList.getCurrentTheme();t.markImageAsSelected(),t.setImageFileElement(this.dom.$logoContainer.find("input[type=file]")),t.apply(),t.save(_.bind(this.afterThemeSavedCallback,this))},afterThemeSavedCallback:function(){this.logoUploader.reset()
},onLogoFileLoadCompleted:function(t,e){var i=Composer.ThemeList.getCurrentTheme();i.setImage(e.file),i.setImageDataUrl(e.dataUrl),i.apply(),i.save()},onLogoUploaderDragOver:function(){this.dom.$logoContainer.parent().addClass("over")},onLogoUploaderDragLeave:function(){this.dom.$logoContainer.parent().removeClass("over")},onLogoUploaderDrop:function(){this.dom.$logoContainer.parent().removeClass("over")},onPromotionCreated:function(){this.savedState=this.toJSON()},setData:function(){this.shouldLoadFromLocalStorage()?this.loadFromLocalStorage():this.loadFromServer()},onbeforeunload:function(){return this.needsSaving()?I18n.t("js.composer.promotion.onbeforeunload"):void 0},needsSaving:function(){return this.savedState!==this.toJSON()},onImageDeleted:function(t,e){var i=this.findModulesByImageId(e.id);_.each(i,function(t){_.each(t.images,function(i){i.data.imageId===e.id&&(i.deleteImage(),t.preview.update())})}),Composer.Banner.get().data.id===e.id&&Composer.Banner.get().deleteBanner()},getId:function(){return this.data.promotion.id},findModulesByImageId:function(t){return _.filter(this.modules,function(e){return _.some(e.images,function(e){return e.data.imageId===t})})},findModuleById:function(t){return _.detect(this.modules,function(e){return e.$element.identify()===t})},createModules:function(e){e?(this.moduleData=e,this.moduleIndex=-1,t(document).on("promotion:module:shown.promotion",_.bind(this.deferCreateNextModule,this)),this.createNextModule()):t(document).trigger("promotion:created")},deferCreateNextModule:function(){_.defer(_.bind(this.createNextModule,this))},createNextModule:function(){this.moduleIndex+=1,this.moduleIndex<this.moduleData.length?this.addModule(null,this.moduleData[this.moduleIndex],!0):(t(document).off("promotion:module:shown.promotion"),t(document).trigger("promotion:created"))},addModule:function(e,i,s){var n,o;s=s||"call-to-action"==i.type,i.memo&&(i=i.memo),i.type||(i.type="text"),t(document).trigger("promotion:module:adding"),this.preparedModule||this.prepareModule(),n=this.preparedModule,this.preparedModule=null,i.after&&t(i.after).after(n),i.mode=s?"preview":"edit",o=new Composer.PromotionModule(n,i,this),this.modules.push(o);var a=1===this.modules.length;o.show(s,a),this.makeSortable(),this.fire("promotion:module:added")},prepareModule:function(){for(var t,e="",i=0;4>i;++i)e+=Composer.IMAGE_TEMPLATE({module_index:this.modules.length,image_index:i});t=Composer.MODULE_TEMPLATE({module_index:this.modules.length,images:e}),this.dom.$body.append(t),this.preparedModule=this.dom.$body.find("> *").last()[0]},hasBanner:function(){return Composer.Banner.get().hasImage()},hasModules:function(){return _.any(this.modules,function(t){return!t.isDeleted()})},isContentPresent:function(){return this.hasBanner()||this.hasModules()},makeSortable:function(){t("#madmimi_body").sortable({items:".module-container",handle:".drag",axis:"y",stop:function(){t(document).trigger("promotion:module:sorted")}}),t("#madmimi_body .drag").on("mousedown",function(){t("#madmimi_body").height(t("#madmimi_body").height())}),t("body").on("mouseup",function(){t("#madmimi_body").height("")})},updateTableOfContents:function(){var t=this.findTableOfContentsModule(),e=this.findHeaderModules();_.each(e,function(t){t.sectionTitle.resetTableOfContents()}),t&&t.updateTableOfContents()},findOrCreateTableOfContentsModule:function(){var e=this.findTableOfContentsModule();if(!e){var i={after:t("#promotion_tutorial_container"),type:"table-of-contents"};this.addModule(null,i,!0),e=_.last(this.modules)}return e},findTableOfContentsModule:function(){return _.find(this.getCurrentModules(),function(t){return t.isTableOfContents()})},findTableOfContentsHeaderModules:function(){return _.filter(this.findHeaderModules(),function(t){return t.sectionTitle.inTableOfContents})},findHeaderModules:function(){return _.filter(this.getCurrentModules(),function(t){return t.isHeader()})},getCurrentModules:function(){var t=this.dom.$body.find("div.module-container").toArray(),e=_.reject(this.modules,function(t){return t.isDeleted()});return _.sortBy(e,function(e){return _.indexOf(t,e.$element[0])})},save:function(){t.ajaxQueue({url:"/promotions/"+this.getId()+"/async_save",type:"post",dataType:"json",data:{promotion:this.toJSON(),_method:"put"}}).done(_.bind(this.saved,this)).fail(_.bind(this.failed,this))},saved:function(e){var i=e.promotion,s=e.warning;s&&Widget.MimiFlash.create(s),_.each(i.modules,function(t){var e=_.detect(this.modules,function(e){return e.getId()===t.composerId},this);e&&e.setId(t.id)},this),this.data.promotion.themeId=i.themeId,this.data.saved_at=i.saved_at,this.savedState=this.toJSON(i),this.removeFromLocalStorage(),this.saveFailedCount=0;var n=i.name;t("#promotion_name").val(n);var o=_.template(I18n.t("js.composer.saved.title"));document.title=o({name:n}),this.fire("promotion:save:ok")},failed:function(t){if(t&&422==t.status)this.showError(t);else if(this.saveFailedCount<3)this.saveFailedCount++,this.save();else{this.saveFailedCount=0;var e=t?t.responseText:I18n.t("MimiFlash.composer.promotion.failed.default_errorMessage");Widget.MimiFlash.error(I18n.t("MimiFlash.composer.promotion.failed.error")+"\n"+e)}this.fire("promotion:save:failed")},showError:function(t){var e=void 0==t?I18n.t("MimiFlash.composer.promotion.failed.default_errorMessage"):t.responseText;Widget.MimiFlash.error(I18n.t("MimiFlash.composer.promotion.failed.error")+"\n"+e)},getLocalStorageId:function(){return"madmimi_promotion_"+this.getId()},saveToLocalStorage:function(){localStorage.setItem(this.getLocalStorageId(),this.toJSON())},removeFromLocalStorage:function(){localStorage.removeItem(this.getLocalStorageId())},shouldLoadFromLocalStorage:function(){return!1},loadFromLocalStorage:function(){var e=localStorage.getItem(this.getLocalStorageId());e=JSON.parse(e),e.name&&t("#promotion_name").val(e.name),Composer.ImageList.setData(this.data.promotion.images);var i=e.banner.url||this.data.promotion.headerUrl,s=e.banner.altText||this.data.promotion.headerAltText,n=e.banner.id||this.data.promotion.headerImageId;Composer.Banner.setData(_.extend({url:i,altText:s},Composer.ImageList.findImage(n)||{})),this.setThemeListData(e.themeId||this.data.themeId),this.createModules(e.modules)},loadFromServer:function(){Composer.ImageList.setData(this.data.promotion.images),Composer.Banner.setData(_.extend({url:this.data.promotion.headerUrl,altText:this.data.promotion.headerAltText},Composer.ImageList.findImage(this.data.promotion.headerImageId)||{})),this.setThemeListData(this.data.promotion.themeId),this.createModules(this.data?this.data.promotion.modules:null)},setThemeListData:function(t){Composer.ThemeList.setData(t,this.addPromotionIdToThemesData(this.data.themes),this.data.visualElements)},addPromotionIdToThemesData:function(t){for(var e=0;e<t.length;e++)t[e].promotionId=this.getId();return t},switchMode:function(){_.each(this.getCurrentModules(),function(t){t.setMode("preview")})},deactivateAllModules:function(){for(var t=this.modules.length;t--;)this.modules[t].deactivate()},toJSON:function(){return JSON.stringify({id:this.getId(),themeId:Composer.ThemeList.getCurrentTheme()&&Composer.ThemeList.getCurrentTheme().getId(),banner:Composer.Banner.get().toJSON(),name:t("#promotion_name").val(),modules:this.getCurrentModules()})},toData:function(){return{id:this.getId(),name:t("#promotion_name").val(),thumbnail_url:this.data.promotion.thumbnail_url,mimio_link:this.data.promotion.mimio_link,from_name:this.data.promotion.from_name,from_email:this.data.promotion.from_email,subject:this.data.promotion.subject,schedules:this.data.schedules,scheduled:_.bind(this.scheduled,this)}},destroy:function(){this.stopObserving()},getModulesAboveScroll:function(){return _.select(this.modules,function(t){return t.$element.offset().top+t.$element.height()<window.scrollY-200})},scheduled:function(t){this.data.schedules=t},onThemeSaved:function(t,e){e.theme==Composer.ThemeList.getCurrentTheme()&&this.save()},getCurrentThemeId:function(){return this.data.promotion.themeId}}),Composer.Promotion.DOM={logoContainer:"#madmimi_logo .madmimi-logo-container",editLogoLink:"#madmimi_logo > a",header:"#madmimi_header",body:"#madmimi_body",footer:"#madmimi_footer"}}(jQuery),function(t){Composer.Sidebar=Class.create(Widget.Tabs,Widget.Observer,{initialize:function($super){$super(t("#composer_nav ul.tabs")[0],{noState:!0}),this.$element=t("#composer_nav"),this.initObservers(),this.currentPosition=this.$element.css("position"),this.reposition(),this.resize(),this.sidebarTopOffset=t("#main").offset().top,this.startTime=new Date,this.previousTimeOffset=this.startTime},initObservers:function(){var e=_.bind(this.onScroll,this);this.isGEMStyling()?t(window).scrollStopped(_.bind(this.onScrollStopped,this)):(t(window).on("scroll",e).on("resize",e),t(document).on("promotion:module:hidden",e),t(document).on("promotion:module:shown",function(){i.ignoreScroll=!1,e()}));var i=this;t(document).on("promotion:module:adding",function(){i.ignoreScroll=!0}),t(document).on("tab:switched",function(t,e){"product_list_tab"==e.tab.id&&Mimi.TrackEvent.track("online_store/products_tab")})},isGEMStyling:function(){return"relative"===this.$element.css("position")},onScrollStopped:function(){if(this.isGEMStyling()){var t=this.calcTop(),e="transform 100ms ease 50ms",i=this.$element.closest("aside"),s=20;this.toggleGemPreviewButton(s>=t),t=s>=t?t-s:0;var n="translateY("+Math.abs(t).toString()+"px)";i.css("-webkit-transition","-webkit"+e),i.css("transition",e),i.css("-ms-transform",n),i.css("-webkit-transform",n),i.css("transform",n)}},toggleGemPreviewButton:function(t){var e=t?"inline-block":"none",i=this.$element.closest("aside").find("a.btn.view");i.css("display",e)},onScroll:function(){if(!this.isGEMStyling()){var t,e=new Date-this.startTime;e-this.previousTimeOffset<10&&(t=!0),this.previousTimeOffset=e,this.ignoreScroll||t||this.reposition()}},calcTop:function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;return this.sidebarTopOffset-t+20},reposition:function(){this.calcTop()<=20?"fixed"!==this.currentPosition&&(this.$element[0].style.position="fixed",this.$element[0].style.top="20px",this.currentPosition="fixed"):"absolute"!==this.currentPosition&&(this.$element[0].style.position="absolute",this.$element[0].style.top="",this.currentPosition="absolute")},resize:function(){if(!this.ignoreScroll){var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,i=Math.min(t("#main")[0].offsetHeight,t(window).height())-40,s=document.body.clientHeight;e<this.sidebarTopOffset&&(i-=this.sidebarTopOffset-e),e+i>s-100&&(i=s-e-100),Composer.ImageList.setHeight(i),Composer.ThemeList.setHeight(i)}},switchToThemesTab:function(){this.show(1)}}).singleton("switchToThemesTab")}(jQuery),Mimi.util.hexToRgb=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return"rgb("+parseInt(e[1],16)+","+parseInt(e[2],16)+","+parseInt(e[3],16)+")"},function(t){Composer.ThemeEditor=Class.create(Widget.Popup,Widget.Observable,Widget.Observer,{initialize:function($super){$super("#theme_editor",{styles:{position:"absolute",zIndex:10000006,display:"none"},offset:"-15 -79",onHiding:_.bind(this.onHiding,this)}),this.dom=this.$element.getChildren(i),this.panels=new Widget.MultiPanel(this.dom.$panels[0]),this.tabs=new Widget.Tabs(this.dom.$tabs[0],{noState:!0}),this.logoUploader=new Composer.LogoUploader(this.dom.logoTab.$well),this.colorPickerState={},this.events=[],this.initializeObservers(),this.initializeFontPicker(),this.initializeColorPicker(),this.initializeFontEdit(),this.initializeFontTab(),this.initializeBackgroundsTab(),this.initializeLogoTab()},initializeObservers:function(){this.dom.$discard.on("click",_.bind(this.discard,this)),this.dom.$deleteBtn.on("click",_.bind(this.onDeleteClick,this)),this.dom.$done.on("click",_.bind(this.done,this)),t(document).on("theme:usage:checking",_.bind(this.onThemeUsageChecking,this)),t(document).on("theme:usage:checked",_.bind(this.onThemeUsageChecked,this)),t(document).on("theme:removing",_.bind(this.onThemeRemoving,this))},initializeFontTab:function(){this.events.push(this.dom.fontTab.$list.on("click","li",_.bind(this.fontTabSelected,this)))},initializeBackgroundsTab:function(){this.events.push(this.dom.backgroundsTab.border.$button.on("click",_.bind(this.backgroundsTabSelected,this))),this.events.push(this.dom.backgroundsTab.border.$check.on("click",_.bind(this.borderStyleClicked,this))),this.events.push(this.dom.backgroundsTab.background.$button.on("click",_.bind(this.backgroundsTabSelected,this))),this.events.push(this.dom.backgroundsTab.outerBackground.$button.on("click",_.bind(this.backgroundsTabSelected,this))),this.events.push(this.dom.backgroundsTab.footerBackground.$button.on("click",_.bind(this.backgroundsTabSelected,this))),this.events.push(this.dom.backgroundsTab.footerBackground.$check.on("click",_.bind(this.footerStyleClicked,this))),this.events.push(this.dom.backgroundsTab.buttonBackground.$button.on("click",_.bind(this.backgroundsTabSelected,this))),this.events.push(this.dom.backgroundsTab.buttonStyle.$buttons.on("click",_.bind(this.buttonStyleClicked,this))),this.events.push(this.dom.backgroundsTab.$promotionName,"keyup",_.bind(this.updatePromotionName,this))},initializeLogoTab:function(){var e=t(this.logoUploader);this.events.push(e.on("composer:logo-uploader:loading",_.bind(this.onLogoFileLoadStarted,this))),this.events.push(e.on("composer:logo-uploader:loaded",_.bind(this.onLogoFileLoadCompleted,this))),this.events.push(e.on("composer:logo-uploader:selected",_.bind(this.onLogoFileSelected,this))),this.events.push(e.on("composer:logo-uploader:drag-over",_.bind(this.onLogoUploaderDragOver,this))),this.events.push(e.on("composer:logo-uploader:drag-leave",_.bind(this.onLogoUploaderDragLeave,this))),this.events.push(e.on("composer:logo-uploader:drop",_.bind(this.onLogoUploaderDrop,this))),this.events.push(this.dom.logoTab.$urlInput.on("keydown",_.bind(this.onUrlKeyDown,this))),this.events.push(this.dom.logoTab.$urlInput.on("keyup",_.bind(this.onUrlKeyUp,this))),this.events.push(this.dom.logoTab.$removeLink.on("click",_.bind(this.onLogoRemoveLinkClicked,this))),this.events.push(this.dom.logoTab.$alignmentButtons.on("click",_.bind(this.onLogoAlignmentButtonClicked,this)))},initializeFontEdit:function(){this.events.push(this.dom.fontEdit.$back.on("click",_.bind(this.fontEditBackClick,this))),this.events.push(this.dom.fontEdit.$font.on("click",_.bind(this.fontEditFontClick,this))),this.events.push(this.dom.fontEdit.$color.on("click",_.bind(this.fontEditColorClick,this))),this.events.push(this.dom.fontEdit.$textSmaller.on("click",_.bind(this.fontEditTextSmallerClick,this))),this.events.push(this.dom.fontEdit.$textLarger.on("click",_.bind(this.fontEditTextLargerClick,this))),this.events.push(this.dom.fontEdit.$alignmentLeft.on("click",_.bind(this.fontEditAlignLeftClick,this))),this.events.push(this.dom.fontEdit.$alignmentCenter.on("click",_.bind(this.fontEditAlignCenterClick,this))),this.events.push(this.dom.fontEdit.$alignmentRight.on("click",_.bind(this.fontEditAlignRightClick,this))),this.events.push(this.dom.fontEdit.$alignmentFull.on("click",_.bind(this.fontEditAlignFullClick,this)))},initializeFontPicker:function(){var t=_.map(Composer.Data.fonts,function(t){return"<li data-id='"+t.id+"'><a><span style='font-family:"+t.name+";'>"+t.name+"</span></a></li>"});this.dom.fontPicker.$list.html(t.join("")),this.events.push(this.dom.fontPicker.$list.on("mouseover",_.bind(this.fontPickerListMouseOver,this))),this.events.push(this.dom.fontPicker.$list.on("mouseout",_.bind(this.fontPickerListMouseOut,this))),this.events.push(this.dom.fontPicker.$list.on("click",_.bind(this.fontPickerListClick,this))),this.events.push(this.dom.fontPicker.$back.on("click",_.bind(this.fontPickerBackClick,this)))},initializeColorPicker:function(){this.events.push(this.dom.backgroundsTab.border.$input.on("focus",_.bind(this.setColorPickerState,this))),this.events.push(this.dom.backgroundsTab.background.$input.on("focus",_.bind(this.setColorPickerState,this))),this.events.push(this.dom.backgroundsTab.outerBackground.$input.on("focus",_.bind(this.setColorPickerState,this))),this.events.push(this.dom.backgroundsTab.footerBackground.$input.on("focus",_.bind(this.setColorPickerState,this))),this.events.push(this.dom.backgroundsTab.buttonBackground.$input.on("focus",_.bind(this.setColorPickerState,this))),this.events.push(this.dom.backgroundsTab.border.$input.on("keyup",_.bind(this.colorPickerKeyUp,this))),this.events.push(this.dom.backgroundsTab.background.$input.on("keyup",_.bind(this.colorPickerKeyUp,this))),this.events.push(this.dom.backgroundsTab.outerBackground.$input.on("keyup",_.bind(this.colorPickerKeyUp,this))),this.events.push(this.dom.backgroundsTab.footerBackground.$input.on("keyup",_.bind(this.colorPickerKeyUp,this))),this.events.push(this.dom.backgroundsTab.buttonBackground.$input.on("keyup",_.bind(this.colorPickerKeyUp,this))),this.events.push(this.dom.fontEdit.$colorInput.on("keyup",_.bind(this.colorPickerKeyUp,this))),this.events.push(this.dom.backgroundsTab.border.$input.on("blur",_.bind(this.colorPickerBlur,this))),this.events.push(this.dom.backgroundsTab.background.$input.on("blur",_.bind(this.colorPickerBlur,this))),this.events.push(this.dom.backgroundsTab.outerBackground.$input.on("blur",_.bind(this.colorPickerBlur,this))),this.events.push(this.dom.backgroundsTab.footerBackground.$input.on("blur",_.bind(this.colorPickerBlur,this))),this.events.push(this.dom.backgroundsTab.buttonBackground.$input.on("blur",_.bind(this.colorPickerBlur,this))),this.events.push(this.dom.fontEdit.$colorInput.on("blur",_.bind(this.colorPickerBlur,this))),this.events.push(this.dom.colorPicker.$back.on("click",_.bind(this.colorPickerBackClick,this))),this.events.push(this.dom.colorPicker.$list.on("mouseover",_.bind(this.colorPickerListMouseOver,this))),this.events.push(this.dom.colorPicker.$list.on("mouseleave",_.bind(this.colorPickerListMouseOut,this))),this.events.push(this.dom.colorPicker.$list.on("click",_.bind(this.colorPickerListClick,this)))},show:function($super,t,e){this.theme=t,this.originalThemeData=JSON.stringify(t.data),this.callback=e,this.prepareTabs(),this.setOptions({anchor:t.$element[0]}),this.updateActions(),$super()},prepareTabs:function(){var t=_.map(this.theme.getVisualElements(),function(t){return"<li data-id='"+t.id+"' style='"+this.theme.getStyleStringFor(t,this.getBackgroundStyle(t),!0)+"'><a><span class='right'>&raquo;</span><span style='"+this.theme.getStyleStringFor(t,{background:"transparent"},!0)+"'>"+t.label+"</span></a></li>"},this);this.dom.fontTab.$list.html(t.join("")),this.dom.backgroundsTab.border.$color.css({backgroundColor:"#"+this.theme.data.borderColor}),this.dom.backgroundsTab.background.$color.css({backgroundColor:"#"+this.theme.data.backgroundColor}),this.dom.backgroundsTab.outerBackground.$color.css({backgroundColor:"#"+this.theme.data.outerBackgroundColor}),this.dom.backgroundsTab.footerBackground.$color.css({backgroundColor:"#"+this.theme.data.footerBackgroundColor}),this.dom.backgroundsTab.buttonBackground.$color.css({backgroundColor:"#"+this.theme.data.buttonBackgroundColor}),this.dom.backgroundsTab.border.$check.prop("checked","borderless"!==this.theme.data.borderStyle),this.dom.backgroundsTab.$promotionName.val(this.theme.data.name),this.dom.backgroundsTab.border.$input.val("#"+this.theme.data.borderColor),this.dom.backgroundsTab.background.$input.val("#"+this.theme.data.backgroundColor),this.dom.backgroundsTab.outerBackground.$input.val("#"+this.theme.data.outerBackgroundColor),this.dom.backgroundsTab.footerBackground.$input.val("#"+this.theme.data.footerBackgroundColor),this.dom.backgroundsTab.footerBackground.$check.prop("checked",""===this.theme.data.footerStyle),this.dom.backgroundsTab.buttonBackground.$input.val("#"+this.theme.data.buttonBackgroundColor),this.logoUploader.reset(),this.dom.logoTab.$imageList.html(this.prepareImage()),this.dom.logoTab.$removeLink.toggle(!!this.theme.getImageUrl()),this.dom.logoTab.$urlInput.val(this.theme.getWebsiteUrl()).trigger("blur"),this.updateLogoAlignment(this.theme.data.logoAlignment),this.updateButtonStyle(this.theme.data.buttonStyle)},prepareFontEdit:function(){var t,e=this.theme.makeStyles(this.visualElement,this.getBackgroundStyle(),!0);t=this.visualElement.no_font?"hide":"show",this.dom.fontEdit.$fontField[t](),this.dom.fontEdit.$sizeField[t](),this.visualElement.nofont||this.dom.fontEdit.$fontSpan.html(e.fontFamily),t=this.visualElement.no_align?"hide":"show",this.dom.fontEdit.$alignmentField[t](),this.visualElement.no_align||this.fontEditSetAlign(e.textAlign,!0),this.dom.fontEdit.$colorField.show(),this.dom.fontEdit.$colorValue.css({backgroundColor:e.color}),this.dom.fontEdit.$colorInput.val(e.color),this.dom.fontEdit.$fontSizeText.html(e.fontSize),this.updateTitleAndPreview(this.dom.fontEdit,e)},prepareFontPicker:function(){this.updateTitleAndPreview(this.dom.fontPicker)},prepareColorPicker:function(){this.visualElement||(this.visualElement=this.theme.findVisualElement({"default":!0})),this.updateTitleAndPreview(this.dom.colorPicker)},updateTitleAndPreview:function(t,e){t.$title.html(this.colorPickerState.label||this.visualElement.label),t.$preview.html(this.visualElement.label),this.updatePreviewStyle(t,e)},updatePreviewStyle:function(t,e){t.$preview.css(e||this.theme.makeStyles(this.visualElement,this.getBackgroundStyle(),!0)),e&&e.color&&t.$preview.css({color:Mimi.util.hexToRgb(e.color)})},getBackgroundStyle:function(t){return t||(t=this.visualElement),"footer"===t.target?{background:"#"+this.theme.data.footerBackgroundColor}:{background:"#"+this.theme.data.backgroundColor}},updatePromotionName:function(){this.theme.data.name=this.dom.backgroundsTab.$promotionName.val()},fontTabSelected:function(e){var i=t(e.currentTarget).data("id");return i?(this.visualElement=this.theme.findVisualElement({id:i}),this.prepareFontEdit(this.visualElement),this.panels.show(this.dom.fontEdit.$pane[0]),this.colorPickerState={back:this.dom.fontEdit.$pane[0],call:"prepareFontEdit",update:this.visualElement,preview:"color"},!1):!1},backgroundsTabSelected:function(t){this.setColorPickerState(t),this.prepareColorPicker(),this.panels.show(this.dom.colorPicker.$pane[0])},borderStyleClicked:function(){this.theme.toggleBorderStyle()},footerStyleClicked:function(){this.theme.toggleFooterStyle(),this.prepareTabs()},buttonStyleClicked:function(e){var i=t(e.currentTarget),s=i.data("button-style");this.updateButtonStyle(s),this.theme.setButtonStyle(s)},fontEditBackClick:function(){return this.prepareTabs(),this.panels.show(0),!1},fontEditFontClick:function(){this.prepareFontPicker(),this.panels.show(this.dom.fontPicker.$pane[0])},fontEditColorClick:function(){this.prepareColorPicker(),this.panels.show(this.dom.colorPicker.$pane[0])},fontEditTextSmallerClick:function(){var t=this.theme.getSize(this.visualElement);t>10&&--t,this.updatePreviewStyle(this.dom.fontEdit,{fontSize:t.px()}),this.dom.fontEdit.$fontSizeText.html(t.px()),this.theme.setSize(this.visualElement,t)},fontEditTextLargerClick:function(){var t=this.theme.getSize(this.visualElement);48>t&&++t,this.updatePreviewStyle(this.dom.fontEdit,{fontSize:t.px()}),this.dom.fontEdit.$fontSizeText.html(t.px()),this.theme.setSize(this.visualElement,t)},fontEditAlignLeftClick:function(){this.fontEditSetAlign("left")},fontEditAlignCenterClick:function(){this.fontEditSetAlign("center")},fontEditAlignRightClick:function(){this.fontEditSetAlign("right")},fontEditAlignFullClick:function(){this.fontEditSetAlign("justify")},fontEditSetAlign:function(t,e){this.dom.fontEdit.$alignmentButtons.removeClass("selected");var i=_.capitalize("justify"===t?"full":t);this.dom.fontEdit["$alignment"+i].addClass("selected"),e||this.theme.setAlign(this.visualElement,t)},fontPickerBackClick:function(){return this.prepareFontEdit(),this.panels.show(this.dom.fontEdit.$pane[0]),!1},fontPickerListMouseOver:function(t){var e=this.fontPickerGetFont(t);e&&this.updatePreviewStyle(this.dom.fontPicker,{fontFamily:e})},fontPickerListMouseOut:function(){this.updatePreviewStyle(this.dom.fontPicker)},fontPickerListClick:function(t){var e=this.fontPickerGetFont(t);e&&(this.theme.setFont(this.visualElement,e),this.fontPickerBackClick())},fontPickerGetFont:function(e){var i=t(e.target).closest("li"),s=i.find("span");return i[0]&&s[0]?s.css("font-family").replace(/^['"]|['"]$/g,""):!1},colorPickerBackClick:function(){return this[this.colorPickerState.call](),this.panels.show(this.colorPickerState.back),!1},colorPickerListMouseOver:function(t){var e,i={};(e=this.colorPickerGetColor(t))&&(i[this.colorPickerState.preview]=e,this.updatePreviewStyle(this.dom.colorPicker,i))},colorPickerListMouseOut:function(t){var e;(e=this.colorPickerGetColor(t))&&this.updatePreviewStyle(this.dom.colorPicker)},colorPickerListClick:function(t){var e;if(e=this.colorPickerGetColor(t))return this.theme.setColor(this.colorPickerState.update,e),this.colorPickerBackClick()},colorPickerGetColor:function(e){var i=t(e.target).closest("li"),s=i.find("a");return i[0]&&s[0]?s.css("backgroundColor").toHtmlColor():!1},colorPickerKeyUp:function(e){var i=t(e.target),s=Color.from(i.val()),n=i.next().find("span");n.css({backgroundColor:s})},colorPickerBlur:function(e){var i=t(e.target),s=Color.from(i.val()),n=i.next().find("span");i.val(s),n.css({backgroundColor:s}),this.theme.setColor(this.colorPickerState.update,s)},setColorPickerState:function(e){var i,s,n,o=t(e.currentTarget).closest(".field"),a=o.prop("id").split("_");a.shift(),i=a.join("-").camelize(),s=t(o).children("label").text().trim(),n="border"===i?"borderColor":"backgroundColor",this.visualElement=this.theme.findVisualElement("footerBackground"===i?{label:"Footer Text"}:{label:"Text"}),this.colorPickerState={back:0,call:"prepareTabs",label:s,update:i+"Color",preview:n}},discard:function(){return this.hide(),!1},done:function(){return this.hide({action:"update"}),!1},onHiding:function(t,e){return this.performHideActions(e),this.tabs.show(0),this.colorPickerState={},this.panels.home(!0),this.callback(),!0},performHideActions:function(e){var i=e&&e.action,s=i&&"update"==e.action,n=this.theme.isPersisted();if(i||!n){if(s||!n)return void this.theme.setName(this.dom.backgroundsTab.$promotionName.val())}else this.theme.data=JSON.parse(this.originalThemeData),t(document).trigger("theme:discarded",{theme:this.theme})},onDeleteClick:function(t){t.preventDefault(),this.theme.destroyTheme()},onThemeUsageChecking:function(){this.dom.$deleteBtn.disable()},onThemeUsageChecked:function(){this.dom.$deleteBtn.enable(),this.hide({action:"removing"})},onThemeRemoving:function(){this.hide({action:"delete"})},destroy:function($super){$super(),_.invoke(this.events,"off")},updateButtonStyle:function(t){this.dom.backgroundsTab.buttonStyle.$buttons.removeClass("selected").filter("[data-button-style="+t+"]").addClass("selected")},updateLogoAlignment:function(t){this.dom.logoTab.$alignmentButtons.removeClass("selected").filter("[data-alignment="+t+"]").addClass("selected")},onLogoFileSelected:function(t,e){this.dom.logoTab.$imageList.html(this.prepareFileName(e.fileName)),this.dom.logoTab.$removeLink.show(),this.theme.markImageAsSelected(),this.theme.setImageFileElement(this.dom.logoTab.$fileInput),this.theme.apply()},onLogoFileLoadStarted:function(){var t="theme_"+this.theme.data.id,i=e({cid:t});this.dom.logoTab.$imageList.html(i)},onLogoFileLoadCompleted:function(t,e){var i=this.dom.logoTab.$imageList.find("li"),s=i.find("img");s.attr("src",e.dataUrl),i.removeClass("loading"),this.dom.logoTab.$removeLink.show(),this.theme.setImage(e.file),this.theme.setImageDataUrl(e.dataUrl),this.theme.apply()},prepareImage:function(){if(this.theme.getImageUrl()){var i=e({cid:"theme_"+this.theme.data.id}),s=t(i),n=s.find("img");return s.removeClass("loading"),n.attr("src",this.theme.getImageUrl()),s}return""},prepareFileName:function(t){return'<li><span class="text">'+t+"</span></li>"},onLogoRemoveLinkClicked:function(t){t.preventDefault(),this.dom.logoTab.$imageList.html(""),this.dom.logoTab.$removeLink.hide(),this.logoUploader.clearFile(),this.theme.removeImage()},onLogoUploaderDragOver:function(){this.dom.logoTab.$imageList.parent().addClass("over")},onLogoUploaderDragLeave:function(){this.dom.logoTab.$imageList.parent().removeClass("over")},onLogoUploaderDrop:function(){this.dom.logoTab.$imageList.parent().removeClass("over")},onUrlKeyDown:function(t){return t.isKey("tab")?!1:void 0},onUrlKeyUp:function(){if(this.validateUrl()){var t=this.ensureIncludesProtocol(this.dom.logoTab.$urlInput.val().trim());this.theme.setWebsiteUrl(t),clearTimeout(this.timeout),this.timeout=setTimeout(_.bind(this.theme.apply,this.theme),500)}},ensureIncludesProtocol:function(t){if(_.isEmpty(t))return t;var e=/^https?:\/\//.test(t);return(e?"":"http://")+t},validateUrl:function(){var t=this.dom.logoTab.$urlInput.val(),e=this.dom.logoTab.$urlInput.attr("placeholder"),i=_.isEmpty(t)||t==e||t.isUrl();return this.dom.logoTab.$urlInput[i?"removeClass":"addClass"]("error"),i},switchToLogoTab:function(){this.tabs.show(2)},updateActions:function(){var t=Composer.ThemeList.getThemes().length>1;this.dom.$deleteBtn.toggle(!!t)},onLogoAlignmentButtonClicked:function(e){var i=t(e.currentTarget);this.dom.logoTab.$alignmentButtons.removeClass("selected"),i.addClass("selected"),this.theme.setLogoAlignment(i.data("alignment"))}}).singleton("show","switchToLogoTab");var e=_.template("<li id='composer_image_#{cid}' class='loading'><span><img></span></li>"),i={panels:".popover_container",tabs:"#theme_editor_tabs",discard:"a.popover_close",deleteBtn:"button.delete",done:"footer div.actions button[type='submit']",fontTab:{pane:"#theme_editor_fonts",list:"#theme_editor_fonts menu > ul"},backgroundsTab:{pane:"#theme_editor_backgrounds",promotionName:"#promotion-name",border:{group:"#theme_border",button:"#theme_border button",color:"#theme_border button span",input:"#theme_border input[type=text]",check:"#theme_border input[type='checkbox']"},background:{group:"#theme_background",button:"#theme_background button",color:"#theme_background button span",input:"#theme_background input"},outerBackground:{group:"#theme_outer_background",button:"#theme_outer_background button",color:"#theme_outer_background button span",input:"#theme_outer_background input"},footerBackground:{group:"#theme_footer_background",button:"#theme_footer_background button",color:"#theme_footer_background button span",input:"#theme_footer_background input[type=text]",check:"#theme_footer_background input[type='checkbox']"},buttonBackground:{group:"#theme_button_background",button:"#theme_button_background button",color:"#theme_button_background button span",input:"#theme_button_background input[type=text]"},buttonStyle:{group:"#theme_button_style",buttons:["#theme_button_style button"]}},logoTab:{container:"#theme_editor_logo",well:"#theme_editor_logo .well",imageList:"#theme_editor_logo ul",form:"#logo_image form",fileInput:"#theme_editor_logo #logo",removeLink:"#theme_editor_logo .remove",urlInput:"#theme_editor_url input",alignmentButtons:["#theme_editor_logo_alignment .btn"]},fontEdit:{pane:"#theme_editor_font_edit",title:"#theme_editor_font_edit header > h1 > span",preview:"#theme_editor_font_edit div.preview_well",back:"#theme_editor_font_edit header span.previous",fontField:"#theme_editor_font_field",font:"#theme_editor_font_edit #text_editor_font",fontSpan:"#theme_editor_font_edit #text_editor_font>span",colorField:"#theme_editor_color_field",color:"#theme_editor_font_edit .color_picker button",colorValue:"#theme_editor_font_edit .color_picker button span",colorInput:"#theme_editor_font_edit .color_picker input",textSmaller:"#theme_editor_font_edit button.text_smaller",textLarger:"#theme_editor_font_edit button.text_larger",sizeField:"#theme_editor_size_field",fontSizeText:"#font_size_text",alignmentField:"#theme_editor_alignment_field",alignmentButtons:["#theme_editor_alignment_field button"],alignmentLeft:"#theme_editor_alignment_field button.text-align-left",alignmentCenter:"#theme_editor_alignment_field button.text-align-center",alignmentRight:"#theme_editor_alignment_field button.text-align-right",alignmentFull:"#theme_editor_alignment_field button.text-align-full"},fontPicker:{pane:"#theme_editor_font_picker",title:"#theme_editor_font_picker header > h1 > span",preview:"#theme_editor_font_picker div.preview_well",back:"#theme_editor_font_picker header span.previous",list:"#theme_editor_font_picker ul"},colorPicker:{pane:"#theme_editor_color_picker",title:"#theme_editor_color_picker header > h1 > span",preview:"#theme_editor_color_picker div.preview_well",back:"#theme_editor_color_picker header span.previous",list:"#theme_editor_color_picker ul"}}
}(jQuery),function(t){Composer.ThemeList=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#themes_list_container"),this.dom=this.$element.getChildren(Composer.ThemeList.DOM),this.setHeight(),this.initializeEvents(),this.data={}},setData:function(t,e,i){this.clearThemes(),this.visualElementData=i,this.initializeThemes(t,e)},initializeThemes:function(t,e){this.themes=_.map(e,function(t){return this.initializeTheme(t)},this),this.currentTheme=this.findTheme(t)||_.first(this.themes),this.currentTheme&&this.currentTheme.select()},initializeTheme:function(t,e){var i,s,n=Composer.THEME_TEMPLATE(t);return i=e?"prepend":"append",this.dom.$list[i](n),i=e?"first":"last",s=_[i](this.dom.$list.find("> *")),new Composer.Theme(s,t,this.visualElementData)},findTheme:function(t){return _.detect(this.themes,function(e){return e.data.id==t})},removeThemeFromList:function(t){this.themes=_.without(this.themes,t)},removeTheme:function(t){this.themes=_.without(this.themes,t),t.removeTheme()},selectTheme:function(t){this.previousTheme=this.currentTheme==t?null:this.currentTheme,this.dom.$list.find("li").removeClass("selected"),t.select(),this.currentTheme=t,this.scrollToCurrentTheme()},selectFirstTheme:function(){return this.selectTheme(_.first(this.themes))},selectPreviousTheme:function(){return this.previousTheme?(this.selectTheme(this.findTheme(this.previousTheme.getId())),!0):!1},scrollToCurrentTheme:function(){var t=this.dom.$list.scrollTop(),e=this.dom.$list.height(),i=t+this.currentTheme.$element.position().top;(t>i||i>t+e)&&this.dom.$list.scrollTop(i-30)},clearThemes:function(){this.themes&&this.themes.invoke("removeTheme")},getCurrentTheme:function(){return this.currentTheme},getThemes:function(){return this.themes},initializeEvents:function(){this.dom.$list.on("click","li.theme",_.bind(this.click,this)),this.dom.$create.on("click",_.bind(this.createTheme,this)),t(document).on("promotion:created",_.bind(this.promotionCreated,this)),t(document).on("tab:switched",_.bind(this.tabSwitched,this)),t(document).on("theme:discarded",_.bind(this.onThemeDiscarded,this)),t(document).on("theme:removed",_.bind(this.onThemeRemoved,this)),t(document).on("theme:destroyed",_.bind(this.onThemeDestroyed,this))},click:function(e){e.die();var i=t(e.currentTarget).attr("data-theme-id"),s=this.findTheme(i),n=t(e.target).closest("button"),o=n.hasClass("edit");this.selectTheme(s),o&&s.edit()},createTheme:function(t){t.die(),Composer.ThemeCreateDialog.show(this.currentTheme,_.bind(this.themeCreated,this),this.themes)},themeCreated:function(t,e){e=e||this.currentTheme.cloneData(t),e.promotionId=Composer.getPromotion().getId();var i=this.initializeTheme(e,!0);this.themes.unshift(i),this.selectTheme(i),i.edit()},setHeight:function(){},promotionCreated:function(){this.currentTheme&&this.currentTheme.apply(),this.setHeight()},tabSwitched:function(e,i){t(i.tab).is("#themes_list_tab")&&this.scrollToCurrentTheme()},moduleAdded:function(){this.currentTheme&&this.currentTheme.apply()},destroy:function(){this.stopObserving()},onThemeDiscarded:function(t,e){e.theme.isPersisted()||this.removeTheme(e.theme),this.selectPreviousTheme()},onThemeRemoved:function(t,e){this.removeTheme(e.theme),this.selectPreviousTheme()},onThemeDestroyed:function(e,i){var s=i.id,n=this.dom.$list.find("li").filter(function(){return t(this).data("theme-id")==s});n.hide(),this.removeThemeFromList(this.findTheme(s)),this.selectPreviousTheme()||this.selectFirstTheme()}}).singleton("setData","getCurrentTheme","getThemes","setHeight"),Composer.ThemeList.DOM={list:"menu.theme_list ul",create:"a#themes_list_create"}}(jQuery),function(t){var e={section_title:{target:"titles"},heading:{target:"editors",selector:"h1"},subheading:{target:"editors",selector:"h2"},text:{target:"editors",selector:"",previewSelector:"p",defaultFont:!0},link:{target:"editors",selector:"a"},button:{target:"buttons",selector:".madmimi-call-to-action-container a"},footer_text:{target:"footer"}},i=0;Composer.Theme=Class.create(Widget.Observable,{initialize:function(i,s,n){this.$element=t(i),this.data=s,this.visualElements=_.map(n,function(t){return _.extend(t,e[t.key]||{})}),this.footerElement=this.findVisualElement({target:"footer"}),this.footerStyle=this.findStyle(this.footerElement.id),this.titleElement=this.findVisualElement({target:"titles"}),this.titleStyle=this.findStyle(this.titleElement.id),this.buttonElement=this.findVisualElement({target:"buttons"}),this.applyButtonStyles(),this.editorElements=this.findVisualElements(),this.defaultFontElement=this.findVisualElement({defaultFont:!0}),this.defaultFontStyle=this.findStyle(this.defaultFontElement.id),this.logoElement=t("#madmimi_logo"),this.logoContainerElement=this.logoElement.find(".madmimi-logo-container"),this.logoImageElement=this.logoContainerElement.find("img"),this.logoSpanElement=this.logoContainerElement.find(".image_span"),this.initializeObservers(),this.destroyWarningDialog=new Widget.ConfirmDialog(I18n.t("MimiFlash.composer.theme_list.confirm.delete_theme_header"),"",{onOk:_.bind(this.onDestroyConfirmed,this)},I18n.t("MimiFlash.composer.theme_list.confirm.delete"))},initializeObservers:function(){t(document).on("promotion:module:added",_.bind(this.onPromotionModuleAdded,this)),this.logoImageElement.on("load",_.bind(this.onLogoLoaded,this))},onPromotionModuleAdded:function(){Composer.ThemeList.getCurrentTheme()===this&&this.applyCallToActionButtonStyles()},onLogoLoaded:function(){this.logoSpanElement.removeClass("loading")},setData:function(t){this.data=t,this.$element.attr("data-theme-id",t.id),Composer.ThemeList.getCurrentTheme()===this?this.apply():this.applyButtonStyles()},select:function(){this.$element.find("input[type=radio]").prop("checked",!0),this.$element.addClass("selected"),this.apply()},apply:function(){t("#madmimi_header, #madmimi_body").toggleBrightness(this.data.backgroundColor,"ui_dark","ui_light"),t("#madmimi_outer_wrapper, #module_adder").toggleBrightness(this.data.outerBackgroundColor,"ui_dark","ui_light"),t("#madmimi_outer_wrapper").css(null==this.data.outerBackgroundImage||""===this.data.outerBackgroundImage.trim()?{backgroundColor:"#"+this.data.outerBackgroundColor,backgroundImage:"none",backgroundRepeat:"repeat",backgroundPosition:"center center"}:{backgroundColor:"#"+this.data.outerBackgroundColor,backgroundImage:"url("+this.data.outerBackgroundImage+")",backgroundRepeat:this.data.outerBackgroundRepeat||"repeat",backgroundPosition:this.data.outerBackgroundPosition||"center center"}),t("#madmimi_inner_wrapper").removeClass("borderless borders").addClass(this.data.borderStyle),t("#madmimi_header").css({backgroundColor:"#"+this.data.backgroundColor,"border-color":"#"+this.data.borderColor}),t("#madmimi_body").css({backgroundColor:"#"+this.data.backgroundColor,"border-color":"#"+this.data.borderColor}),t("#madmimi_footer").css({backgroundColor:"#"+this.data.backgroundColor,"border-color":"#"+this.data.borderColor});var e=this.getImageDataUrl()||this.getImageUrl()||this.getImage();this.logoContainerElement.toggleClass("logo_added",!!e),this.logoElement.removeClass("left center right").addClass(this.getLogoAlignment()),this.logoSpanElement.toggle(!!e);var i=this.getImageDataUrl()||this.getImageUrl();i!=this.logoImageElement.attr("src")&&(this.logoSpanElement.addClass("loading"),this.logoImageElement.attr("src",i));var s=this.getWebsiteUrl(),n=this.logoContainerElement.find("a");switch(s&&s.length>0?(0==n.length&&(n=this.logoImageElement.wrap('<a target="_blank">').parent()),n.attr("href",s)):n.length>0&&this.logoImageElement.unwrap(),_.each(this.editorElements,function(e){t(document).trigger("composer:theme:apply:editors",{selector:e.selector,previewSelector:e.previewSelector||e.selector,styles:this.makeStyles(e)})},this),_.each(t("#madmimi_inner_wrapper").attr("class").split(/\s+/),function(e){e.match(/^footer\-/)&&t("#madmimi_inner_wrapper").removeClass(e)}),this.data.footerStyle){case"subtle":t("#madmimi_inner_wrapper").addClass("footer-subtle"),t("#madmimi_footer").css({backgroundColor:"transparent","border-color":"#"+this.data.borderColor}),t("#madmimi_footer .footer").css(this.makeStyles(this.footerElement,{backgroundColor:"transparent"})),t("#madmimi_footer").toggleBrightness(this.data.outerBackgroundColor,"ui_dark","ui_light");break;default:t("#madmimi_footer").css({backgroundColor:"#"+this.data.footerBackgroundColor,"border-color":"#"+this.data.borderColor}),t("#madmimi_footer .footer").css(this.makeStyles(this.footerElement,{backgroundColor:"#"+this.data.footerBackgroundColor})),t("#madmimi_footer").toggleBrightness(this.data.footerBackgroundColor,"ui_dark","ui_light")}t(document).trigger("composer:theme:apply:titles",{styles:this.makeStyles(this.titleElement)}),this.applyButtonStyles(),this.applyCallToActionButtonStyles()},applyCallToActionButtonStyles:function(){t(document).trigger("composer:theme:apply:buttons",{styles:this.makeStyles(this.buttonElement,{background:"#"+this.data.buttonBackgroundColor},!0)}),t("#madmimi_outer_wrapper div.madmimi-call-to-action-container a").removeClasses("flat","pill","chunky").addClass(this.data.buttonStyle).toggleBrightness(this.data.buttonBackgroundColor,"ui_dark","ui_light")},applyButtonStyles:function(){var e=["#"+this.data.outerBackgroundColor,"#"+this.data.backgroundColor,"#"+this.data.buttonBackgroundColor,"#"+this.data.borderColor,"#"+this.data.footerBackgroundColor];this.$element.find("span.theme_colors span").each(function(i,s){t(s).css({backgroundColor:e[i]})})},findVisualElements:function(t){return _.select(this.visualElements,function(e){var i=!0;for(var s in t)i&=e[s]===t[s];return i})},findVisualElement:function(t){var e=this.findVisualElements(t);return e&&e.length>0?e[0]:{id:-1,"default":{font:"Verdana",value:"000000",size:12}}},findStyle:function(t){return _.detect(this.data.styles,function(e){return e.visualElementId===t})||{font:null,color:null,size:null}},getVisualElements:function(t){var e=this.visualElements;return t&&(e=_.select(this.visualElements,function(e){return null==e[t]||e[t]===!0})),_.sortBy(e,function(t){return t.position})},makeStyles:function(t,e,i){var s=this.findStyle(t.id),n={};return t.no_font?i&&(n.fontFamily=this.getFont(this.defaultFontElement,this.defaultFontStyle),n.fontSize=this.getSize(this.defaultFontElement,this.defaultFontStyle).px()):(n.fontFamily=this.getFont(t,s),n.fontSize=this.getSize(t,s).px()),t.no_align||(n.textAlign=this.getAlign(t,s)),n.color=this.getColor(t,s),_.extend(n,_.extend(t.additionalStyles||{},e||{})),n},getStyleStringFor:function(t,e,i){return Widget.Styles.makeStyleString(this.makeStyles(t,e,i))},getId:function(){return this.data.id},getName:function(){return this.data.name},setName:function(t){this.data.name=t,this.$element.find(".theme_name").html(t)},getPromotionId:function(){return this.data.promotionId},setFont:function(t,e){var i=this.findStyle(t.id);i.font=e,this.apply()},getFont:function(t,e){return e=e||this.findStyle(t.id),e.font||t["default"].font||"Sans-serif"},setColor:function(t,e){if(e=e.replace("#",""),_.isString(t))this.data[t]=e;else{var i=this.findStyle(t.id);i.color=e}this.apply()},getColor:function(t,e){return e=e||this.findStyle(t.id),Color.from(e.color||t["default"].value||"0")},setSize:function(t,e){var i=this.findStyle(t.id);i.size=e,this.apply()},getSize:function(t,e){return e=e||this.findStyle(t.id),e.size||t["default"].size||12},setAlign:function(t,e){var i=this.findStyle(t.id);i.alignment="full"===e?"justify":e,this.apply()},getAlign:function(t,e){var i=Composer.Data.languageStyle.indexOf("right")>-1?"right":"left";return e=e||this.findStyle(t.id),e.alignment||t["default"].alignment||i},setImage:function(t){this.data.image=t},getImage:function(){return this.data.image},setImageDataUrl:function(t){this.data.imageDataUrl=t},getImageDataUrl:function(){return this.data.imageDataUrl},setImageUrl:function(t){this.data.logoUrl=t},getImageUrl:function(){return this.data.logoUrl},setRemoteImageUrl:function(t){this.data.remoteLogoUrl=t},getRemoteImageUrl:function(){return this.data.remoteLogoUrl},setWebsiteUrl:function(t){this.data.url=t},getWebsiteUrl:function(){return this.data.url||""},showProcessingIndicator:function(){this.logoContainerElement.addClass("processing")},hideProcessingIndicator:function(){this.logoContainerElement.removeClass("processing")},removeImage:function(){this.setImage(null),this.setImageUrl(null),this.setImageDataUrl(null),this.markImageForRemoval(),this.apply()},markImageForRemoval:function(){this.data.removeImage=!0},isImageMarkedForRemoval:function(){return this.data.removeImage},markImageAsSelected:function(){this.data.imageSelected=!0},isImageSelected:function(){return this.data.imageSelected},getImageFileElement:function(){return this.data.logoFileElement},setImageFileElement:function(t){this.data.logoFileElement=t},toggleBorderStyle:function(){this.data.borderStyle="borderless"===this.data.borderStyle?"borders":"borderless",this.apply()},toggleFooterStyle:function(){this.data.footerStyle="subtle"===this.data.footerStyle?"":"subtle",this.apply()},setButtonStyle:function(t){this.data.buttonStyle=t,this.apply()},setLogoAlignment:function(t){this.data.logoAlignment=t,this.apply()},getLogoAlignment:function(){return this.data.logoAlignment},getSourceUrl:function(){return this.data.sourceUrl},cloneData:function(t){var e=_.clone(this.data);return e.name=t,e.id=--i,e.promotionId=Composer.getPromotion().getId(),e.styles=_.map(e.styles,function(t){return _.clone(t)}),e},setToDefault:function(){this.data.backgroundColor="FFFFFF",this.data.borderColor="000000",this.data.footerBackgroundColor="000000",this.data.outerBackgroundColor="FFFFFF",this.data.buttonBackgroundColor="000000",this.data.buttonStyle="chunky",_.each(this.data.styles,function(t){t.color=t.size=null,t.font="Sans-serif"},this),this.applyButtonStyles()},edit:function(){this.currentJSON=this.toJSON(),Composer.ThemeEditor.show(this,_.bind(this.edited,this))},edited:function(){(this.toJSON()!==this.currentJSON||this.getId()<1)&&this.save()},toJSON:function(){var t={id:this.getId(),name:this.getName(),promotion_id:this.getPromotionId(),source_url:this.getSourceUrl()},e={};_.each("borderColor borderStyle backgroundColor footerBackgroundColor footerStyle outerBackgroundColor buttonBackgroundColor buttonStyle".split(" "),function(e){t[e]=this.data[e]},this),_.each(this.visualElements,function(t){e[t.id]=this.makeStyles(t)},this),t.styles=e;var i=this.buildLogoJSON();return i&&(t.logo=i),t},buildLogoJSON:function(){var t={};return this.isImageMarkedForRemoval()?t.destroy=!0:this.getImage()||this.isImageSelected()?t.logo=Mimi.supportsFileAPI()?this.getImage():this.getImageFileElement():this.getRemoteImageUrl()&&(t.remote_url=this.getRemoteImageUrl()),t.url=this.getWebsiteUrl(),t.alignment=this.getLogoAlignment(),t},isLogoChanged:function(t){var e=t.logo;return e?e.logo||e.remote_url:!1},save:function(e){var i=this.getId(),s=i>0?"/themes/"+i:"/themes",n=i>0?"put":"post",o=this.toJSON();this.isLogoChanged(o)&&this.showProcessingIndicator(),Mimi.supportsFileAPI()?t.ajaxQueue({url:s,type:n,data:t.serializeFormData({theme:o}),processData:!1,contentType:!1}).done(_.bind(this.saved,this)):t.iframeAjax({url:s,method:n,data:{theme:o},complete:_.bind(function(i){i&&(this.saved(t.parseJSON(i)),e&&e())},this)})},saved:function(t){this.hideProcessingIndicator(),this.setData(t),this.fireSavedEvent(t)},fireSavedEvent:function(e){t(document).trigger("composer:theme:saved",{theme:this,data:e})},removeTheme:function(){this.$element.remove()},destroyTheme:function(){if(this.isPersisted())this.initDestroyWarning();else{t(document).trigger("theme:removing");var e=this.getDestroyWarningMessage("not used");this.destroyWarningDialog.show(null,e)}},isPersisted:function(){return this.getId()>0},initDestroyWarning:function(){var e=t("#composer").prop("action").match(/\d+$/),i=this.getId();t(document).trigger("theme:usage:checking"),t.get("/themes/"+i+"/usage_status",{promotion_id:e[0]}).fail(_.bind(this.onUsageStatusFail,this)).done(_.bind(this.onUsageStatusDone,this)).always(function(){t(document).trigger("theme:usage:checked")})},onUsageStatusFail:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.composer.theme_list.check_theme.on_failure"))},onUsageStatusDone:function(t){var e=t.usage,i=this.getDestroyWarningMessage(e);this.destroyWarningDialog.show(null,i)},getDestroyWarningMessage:function(t){var e;return e="other promotions"==t?I18n.t("MimiFlash.composer.theme_list.confirm.other_promotions.you_sure")+'<p class="info">'+I18n.t("MimiFlash.composer.theme_list.confirm.other_promotions.info")+"</p>":_.include(["not used","this promotion"],t)?_.template(I18n.t("MimiFlash.composer.theme_list.confirm.not_used.you_sure"))({theme_name:this.getName()}):""},onDestroyConfirmed:function(){var e=this.getId(),i=this.isPersisted();i?t.ajax({url:"/themes/"+e,type:"DELETE"}).fail(_.bind(this.onDestroyFail,this)).done(_.bind(this.onDestroyDone,this)):t(document).trigger("theme:removed",{theme:this})},onDestroyFail:function(t){var e=I18n.t("MimiFlash.composer.theme_list.delete_theme.on_failure");t.responseText&&(e=t.responseText),Widget.MimiFlash.error(e)},onDestroyDone:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.composer.theme_list.delete_theme.on_success")),t(document).trigger("theme:destroyed",[{id:this.getId()}])}})}(jQuery),function(t){var e=502,i={BASED_ON_WEBSITE:"based-on-website",CLONE:"clone"};Composer.ThemeCreateDialog=Class.create(Widget.Dialog,{initialize:function($super){var e=t("#theme_create_dialog_body_template").html();$super(I18n.t("js.composer.theme_create_dialog.initialize"),e,{hideTrigger:"a.back",clickEids:{"header a.window_close":"productivity.gem.composer.sidebar.styles.create_custom.close_x.button"}}),this.dom=this.$element.getChildren(Composer.ThemeCreateDialog.DOM),this.dom.$name.on("input",_.bind(this.onInput,this)),this.dom.$url.on("input",_.bind(this.onInput,this)),this.dom.$form.on("submit",_.bind(this.onFormSubmit,this)),this.dom.$tiles.on("click",_.bind(this.onTileClick,this))},show:function($super,t,e,s){this.mode=i.BASED_ON_WEBSITE,this.themes=s,this.dom.$name.val(""),this.dom.$url.val(""),this.dom.$themeName.text(t.getName()+":"),this.updateTiles(),this.updateColors(t),this.updateButtons(),this.updateFields(),this.callback=e,$super(),this.dom.$name.select()},onTileClick:function(e){this.mode=t(e.currentTarget).data("mode"),this.updateTiles(),this.updateButtons(),this.updateFields()},onInput:function(){this.updateButtons()},onFormSubmit:function(){var s=this.dom.$name.val(),n=this.dom.$url.val();return this.themeNameExists(s)?(Widget.MimiFlash.error(I18n.t("MimiFlash.composer.theme_create_dialog.duplicate_name")),!1):this.mode==i.BASED_ON_WEBSITE&&this.themeUrlInvalid(n)?(Widget.MimiFlash.error(I18n.t("MimiFlash.composer.theme_create_dialog.invalid_url")),!1):(this.hide(),this.mode==i.BASED_ON_WEBSITE?(Composer.ThemeCreateProgressDialog.show(),t.ajax({url:"/themes/build_from_url",type:"POST",data:{url:n,name:s},complete:Composer.ThemeCreateProgressDialog.hide,success:_.bind(function(t){t.sourceUrl=n,this.callback(s,t)},this),error:function(t){var i=t.responseText;t.status==e&&(i=I18n.t("MimiFlash.composer.theme_create_dialog.proxy_error")),Widget.MimiFlash.error(i)}})):this.callback(s),!1)},themeNameExists:function(t){var e=!1;return _.each(this.themes,function(i){i.data.name.toLowerCase()===t.toLowerCase()&&(e=!0)}),e},themeUrlInvalid:function(t){return!t||!Link.isValid(t,{validProtocols:["http","https"]})},updateTiles:function(){this.dom.$tiles.removeClass("current");var t=this.dom.$tiles.filter("[data-mode="+this.mode+"]");t.addClass("current")},updateButtons:function(){var t=this.dom.$name.val(),e=!t,s=this.dom.$url.val(),n=this.mode==i.BASED_ON_WEBSITE,o=this.themeUrlInvalid(s);this.dom.$create.prop("disabled",e||n&&o)},updateFields:function(){var t=this.mode==i.BASED_ON_WEBSITE;this.dom.$urlField.toggle(t);var e=this.mode==i.CLONE;this.dom.$colorsField.toggle(e)},updateColors:function(t){for(var e in this.dom.colors){var i=e.replace(/^\$/,""),s=this.dom.colors[e],n=t.data[i+"Color"];this.applyColor(s,n)}},applyColor:function(t,e){t.css({backgroundColor:"#"+e})}}).singleton("show"),Composer.ThemeCreateDialog.DOM={form:"form",tiles:[".tiles li"],create:"button",name:"input[name=name]",url:"input[name=url]",urlField:".field.url",themeName:".theme-name",colorsField:".field.colors",colors:{outerBackground:".outer-background-color",background:".background-color",buttonBackground:".button-background-color",border:".border-color",footerBackground:".footer-background-color"}}}(jQuery),function(){Composer.ThemeCreateProgressDialog=Class.create(Widget.Dialog,{initialize:function($super){$super(I18n.t("js.composer.theme_create_progress_dialog.initialize"),Composer.ThemeCreateProgressDialog.BODY)}}).singleton("show","hide"),Composer.ThemeCreateProgressDialog.BODY="<form class='theme_create_progress_dialog'><fieldset class='input_group'><svg class='iconsvg svg_action' viewBox='0 0 16 16' aria-hidden='true'>    <path d=\"M7.093 11.982l-.333.728c-.211.433-.474.49-.851.281l-.975-.54c-.377-.209-.433-.472-.19-.858l.445-.691c-.481-.489-.821-1.089-1-1.733l-.977.069c-.455.037-.662-.164-.643-.617l.036-1.109c.019-.453.174-.627.649-.596l.944.07c.082-.283.196-.56.345-.829.128-.232.277-.446.441-.641l-.539-.749c-.278-.386-.234-.622.162-.866l.91-.596c.396-.244.654-.188.864.218l.415.774c.676-.222 1.41-.264 2.123-.104l.382-.817c.211-.433.44-.48.839-.259l.952.528c.399.221.468.462.225.848l-.486.734c.52.505.884 1.136 1.07 1.816l.749-.045c.477-.025.662.164.655.595l-.036 1.109c-.007.43-.174.627-.649.596l-.746-.049c-.081.268-.191.532-.333.787-.161.291-.353.553-.57.786l.458.625c.3.398.2.632-.162.866l-.934.64c-.361.234-.642.165-.851-.24l-.412-.752c-.637.169-1.316.183-1.975.022zm-.021-2.137c.966.536 2.183.186 2.719-.78s.186-2.183-.78-2.719-2.183-.186-2.719.78-.186 2.183.78 2.719z\" fill-rule=\"evenodd\"></path>\n</svg></form></fieldset>"}(jQuery),function(t){Composer.Tutorial=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#promotion_tutorial_container"),t(document).on("promotion:loading",_.bind(this.hide,this)),t(document).on("promotion:module:adding",_.bind(this.hide,this))},visible:function(){return this.$element.is(":visible")},show:function(){this.hidden=!1,this.$element.show()},hide:function(){this.hidden||(this.hidden=!0,this.$element.slideUp(250,_.bind(this.$element.hide,this.$element)))},destroy:function(){this.stopObserving()}}).singleton()}(jQuery),function(t){Composer.Banner=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#madmimi_header"),this.dom=this.$element.getChildren(e),this.data={},this.dropImageSrc="",this.firstDrop=!0,this.dom.$edit.hide(),this.initObservers(),this.initDroppable()},initObservers:function(){this.dom.$edit.on("click",_.bind(this.editUrl,this)),this.dom.$delete.on("click",_.bind(this.collapseBanner,this)),this.$element.on("click",_.bind(this.bannerClicked,this))},initDroppable:function(){this.dom.$container.droppable({over:_.bind(this.enter,this),out:_.bind(this.leave,this),drop:_.bind(this.drop,this),tolerance:"pointer"})},setData:function(t){this.data=_.extend(this.data||{},t),this.dom.$image.prop("src",this.data.src?this.data.src.replace("/composer_thumb/","/original/"):this.dropImageSrc),this.data.src?(this.dom.$container.removeClass("empty-image"),this.dom.$headerTextDiv.hide(),this.dom.$image.show(),this.dom.$edit.show()):(this.dom.$container.addClass("empty-image"),this.dom.$headerTextDiv.show(),this.dom.$image.hide(),this.dom.$edit.hide()),this.urlUpdated(this.data)},bannerClicked:function(){this.dom.$container.hasClass("activated")&&!this.dom.$container.hasClass("empty-image")?this.editUrl():this.initialExpand()},initialExpand:function(){this.dom.$container.addClass("activated").removeClass("collapsed"),this.$element.data("click-eid","productivity.gem.composer.banner.banner_expand.button.click")},editUrl:function(){return Composer.PromotionItemEditDialog.get("#image_link_dialog").show({url:this.data.url,altText:this.data.altText},_.bind(this.urlUpdated,this)),!1},deleteBanner:function(){return this.data={},this.dom.$image.animate({height:"140px",opacity:"0"},300,_.bind(this.afterBannerMorphed,this)),this.dom.$edit.hide(),t(document).trigger("composer:banner:imageChanged"),!1},afterBannerMorphed:function(){this.dom.$headerTextDiv.show(),this.dom.$image.hide(),this.dom.$image.prop("src",""),this.dom.$container.addClass("empty-image"),setTimeout(_.bind(function(){this.dom.$image[0].style.height="",this.dom.$image.css("opacity",1)},this),100)},urlUpdated:function(t){this.data.url=t.url,this.data.altText=t.altText,this.dom.$container.toggleClass("linked",this.data.url),this.setUrlInfoTip()},enter:function(){this.$element.addClass("hover")},leave:function(){this.$element.removeClass("hover")},drop:function(t,e){var i=_.detect(Composer.ImageList.get().images,function(t){return t.$element.find("img")[0]===e.draggable[0]});this.setImage(i),this.dom.$container.addClass("activated").removeClass("collapsed"),!this.data.url&&Mimi.User.organization_url&&(this.data.url=Mimi.User.organization_url,this.urlUpdated(this.data),this.showUrlInfotip())},getElement:function(){return this.$element},setImage:function(e){e&&this.setData(e),!Mimi.User.approved&&this.firstDrop&&setTimeout(_.bind(function(){this.firstDrop=!1,this.editUrl()},this),750),t(document).trigger("composer:banner:imageChanged")},hasImage:function(){return!!this.data.src},toJSON:function(){return{id:this.data.id,url:this.data.url,altText:this.data.altText}},collapseBanner:function(t){this.dom.$container.hasClass("collapsed")||(this.dom.$delete.data("click-eid","productivity.gem.composer.banner.banner_collapse.button.click"),t.die(),this.dom.$container.removeClass("activated").addClass("collapsed"),this.deleteBanner())},setUrlInfoTip:function(){var t;t=!this.data.url||this.data.url.blank()?I18n.t("js.composer.banner.url_infotip_empty"):I18n.t("js.composer.banner.url_infotip",{url:this.data.url}),this.dom.$urlInfotipContent.html(t)},showUrlInfotip:function(){var t=this.dom.$edit,e=this.dom.$toolbar;t.addClass("show_title"),e.addClass("visible"),setTimeout(function(){t.removeClass("show_title"),e.removeClass("visible")},5e3)}}).singleton("setData","setImage","getElement","initialExpand");var e={image:"img",headerTextDiv:".promotion_banner_placeholder",toolbar:".image-edit-toolbar",edit:".button_bar .edit",urlInfotip:".button_bar .edit .title",urlInfotipContent:".button_bar .edit .title span","delete":".button_bar .delete",container:".header"}}(jQuery),function(t){Composer.PromotionModuleSectionTitle=Class.create(Widget.Observer,{initialize:function(e,i){this.module=e,this.promotion=e.promotion,this.$element=e.dom.$sectionTitle,this.dom=this.$element.getChildren(Composer.PromotionModuleSectionTitle.DOM),this.$usefulThing=t("<div>"),this.interpret(i),this.initObservers(),this.focusWithDelay()},initObservers:function(){t(document).on("module:mode",_.bind(this.modeChange,this)),t(document).on("promotion:created",_.bind(this.setTableOfContents,this)),this.dom.$toolbar.on("click","button",_.bind(this.toolbarClick,this)),this.dom.$input.on("keydown",_.bind(this.keyHandler,this)),this.dom.$input.on("focus",_.bind(this.module.editor.onFocus,this))},keyHandler:function(t){var e=String.fromCharCode(t.keyCode).toLowerCase();if(t.metaKey||t.ctrlKey)return/[ib]/.test(e)?("i"===e&&this.toggleItalic(),"b"===e&&this.toggleBold(),this.applyStyles(),!1):void 0},focusWithDelay:function(){var t=this.dom.$input;setTimeout(function(){try{t.focus()}catch(e){}},1e3)},interpret:function(e){this.data=this.defaultStyles(),e||(e="");var i,s=this.$usefulThing.html(e),n=t(s.children()[0]),o=s.find("a");if(n[0]){var a=n.css("fontWeight");this.data.fontWeight="bold"==a||"700"==a?"bold":"normal",this.data.fontStyle="italic"===n.css("fontStyle")?"italic":null}o[0]?(this.data.url=o.attr("href")||"",this.data.name=o.attr("name")||"",i=o.html(),""===i&&(i=s.text())):i=n[0]?n.html():e,this.dom.$input.val(i),this.applyStyles()},applyStyles:function(t){t||(t=this.getStyles()),this.dom.$input.css(t),this.dom.$preview.css(t),this.dom.$preview.html(this.getContent()),this.dom.buttons.$link.toggleClass("selected",!!this.data.url||!!this.data.name),this.dom.buttons.$bold.toggleClass("selected","bold"==this.data.fontWeight),this.dom.buttons.$italic.toggleClass("selected",!!this.data.fontStyle),this.dom.buttons.$tableOfContents.toggleClass("selected",!!this.inTableOfContents)},getStyles:function(){return{fontWeight:this.data.fontWeight||"bold",fontStyle:this.data.fontStyle||"normal"}},defaultStyles:function(){return{fontWeight:"bold",fontStyle:null,tagName:"span",url:null}},modeChange:function(t,e){e.source===this.module&&(this.dom.$preview.html(this.getContent()),this.applyStyles())},toolbarClick:function(e){var i=t(e.currentTarget);i.hasClass("link")?Composer.PromotionItemEditDialog.get("#link_dialog").show({text:this.getText(),url:this.data.url||this.data.name},_.bind(this.linkOk,this),null,!0):(i.hasClass("bold")&&this.toggleBold(),i.hasClass("italic")&&this.toggleItalic(),i.hasClass("remove-formatting")&&(this.removeFormatting(),this.removeFromTableOfContents()),i.hasClass("table-of-contents")&&this.toggleTableOfContentsItem(),this.applyStyles(),this.dom.$input.focus())},linkOk:function(t){this.dom.$input.val(t.text),this.data.url=t.url,this.data.name=t.name,this.applyStyles()},toggleBold:function(){this.data.fontWeight="normal"==this.data.fontWeight?"bold":"normal"},toggleItalic:function(){this.data.fontStyle=this.data.fontStyle?null:"italic"},removeFormatting:function(){this.data=this.defaultStyles()},removeFromTableOfContents:function(){this.toggleTableOfContentsItem(!0)},toggleTableOfContentsItem:function(t){this.inTableOfContents=t?!1:!this.inTableOfContents;var e=this.tableOfContentsLinkParams(),i=this.promotion.findOrCreateTableOfContentsModule();this.linkOk(e),i.updateTableOfContents()},tableOfContentsLinkParams:function(){return{text:this.getText(),name:this.inTableOfContents?this.sanitize(this.getText().trim()):null,url:this.inTableOfContents?null:this.data.url}},getText:function(){return this.$usefulThing.html(this.getValue()).html()},getValue:function(){return this.dom.$input.val()},getContent:function(){var e=t("<"+this.data.tagName+">");if(e.css({fontWeight:this.data.fontWeight,fontStyle:this.data.fontStyle}),e.html(this.getText()),this.data.url&&this.data.url.isUrl()||this.data.name){var i=t("<a>");this.data.url?(i.attr("href",this.data.url),this.data.url.startsWith("#")||i.attr("target","_blank")):i.attr("name",this.data.name),e.wrapInner(i)}return t("<div>").append(e).html()},setTableOfContents:function(){this.inTableOfContents=this.isInTableOfContents()},resetTableOfContents:function(){this.setTableOfContents();var t=this.tableOfContentsLinkParams();this.linkOk(t),this.module.preview.update()},isInTableOfContents:function(){var t=this.promotion.findTableOfContentsModule();return t?t.editor.tableOfContentsContains(this):!1},sanitize:function(t){return t.toLowerCase().replace(/[-,\s'?*+#=!@$%^&(){}\[\]:;"\/<>.\\|-]/g,"_").replace(/\s{2,}/,"_").replace(/\s$/,"")}}),Composer.PromotionModuleSectionTitle.DOM={input:"input.header",preview:"h2",toolbar:"div.module-toolbar",buttons:{link:"div.module-toolbar button.link",bold:"div.module-toolbar button.bold",italic:"div.module-toolbar button.italic",tableOfContents:"div.module-toolbar button.table-of-contents"}}}(jQuery),function(t){var e="center";Composer.PromotionModuleCallToAction=Class.create(Widget.Observer,{initialize:function(t,e){this.module=t,this.data={},this.$element=t.dom.$ctaButton,this.dom=this.$element.getChildren(i),this.interpret(e),this.initializeObservers(),this.initDroppables()},initDroppables:function(){this.$element.droppable({over:_.bind(this.enter,this),out:_.bind(this.leave,this),drop:_.bind(this.dropProduct,this),tolerance:"pointer"})},enter:function(){this.$element.addClass("hover")},leave:function(){this.$element.removeClass("hover")},dropProduct:function(t,e){if(e.helper.hasClass("dragged_product")){var i=_.detect(Composer.ProductList.get().products,function(t){return t.$element[0]===e.draggable[0]});Mimi.TrackEvent.track("online_store/product_dropped"),this.update({url:i.url,text:i.name+" - "+(i.sales_price||i.price)})}this.showConfiguration()},initializeObservers:function(){this.dom.$link.on("click",_.bind(this.onClicked,this)),this.dom.toolbar.$buttons.on("click",_.bind(this.onToolbarButtonClicked,this))},update:function(e){_.has(e,"url")&&(this.data.url=e.url||"",this.dom.$link.attr("href",this.data.url).toggleClass("inactive",!this.data.url)),_.has(e,"text")&&(this.data.text=e.text,this.dom.$span.text(this.data.text)),_.has(e,"alignment")&&(this.data.alignment=e.alignment,t([this.dom.$link[0],this.dom.$editor[0]]).removeClass("left center right").addClass(this.data.alignment),this.dom.toolbar.$buttons.removeClass("chosen").filter("[data-alignment="+this.data.alignment+"]").addClass("chosen"))
},interpret:function(i){i=i||"<a>"+I18n.t("js.promotions.promotion_module.button_text")+"</a>";var s,n,o,a=t("<div>").html(i),r=a.find("a");r.length?(s=r.attr("href"),n=r.text(),o=this.guessAlignment(r)):(s=null,n=a.text(),o=e),this.update({url:s||"",text:n||"",alignment:o||""})},showConfiguration:function(){Composer.CallToActionEditDialog.get("#call_to_action_dialog").show({text:this.getText(),url:this.getUrl(),alignment:this.getAlignment()},_.bind(this.update,this))},getUrl:function(){return this.data.url},getText:function(){return this.data.text},getAlignment:function(){return this.data.alignment},getContent:function(){var e=t("<a>").text(this.data.text);return this.data.url&&e.attr("href",this.data.url),this.data.alignment&&e.addClass(this.data.alignment),t("<div>").append(e).html()},onClicked:function(t){t.preventDefault(),this.showConfiguration()},onToolbarButtonClicked:function(e){e.preventDefault();var i=t(e.currentTarget);this.update({alignment:i.data("alignment")})},guessAlignment:function(t){switch(!0){case t.hasClass("left"):return"left";case t.hasClass("right"):return"right";default:return e}}});var i={editor:".call-to-action-editor",link:"a",span:"span",toolbar:{buttons:[".call-to-action-edit-toolbar button"]}}}(jQuery),function(t){Composer.DeletedModule=Class.create(Widget.Observer,{initialize:function(t){this.module=t,this.makeUndelete(),this.$element.on("click",_.bind(this.onClick,this));var e=this;setTimeout(function(){e.$element.fadeIn(function(){e.showGuide()})},1500)},makeUndelete:function(){this.$element=t("<span class=undelete>").html('<svg class=\'iconsvg svg_undo_delete\' viewBox=\'0 0 16 16\' aria-hidden=\'true\'>    <path id="undo_delete" fill-rule="evenodd" fill="#000" d="M8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12zM4.76 7.546A3.273 3.273 0 1 1 8 11.273a.545.545 0 0 1 0-1.09A2.182 2.182 0 1 0 5.844 7.66l.378-.337a.545.545 0 1 1 .728.813l-1.23 1.1-.365.328-.365-.332-1.295-1.18a.545.545 0 0 1 .734-.806l.33.3z"/>\n</svg>').hide();for(var e=this.module.$element.prev();e.hasClass("module-container")&&!e.is(":visible");)e=e.prev();e.hasClass("module-container")||(e=t("#madmimi_header"),this.$element.addClass("in_header")),e.append(this.$element)},onClick:function(){return this.module.show(),this.$element.fadeOut(),Widget.GuideTip.hide("#undelete_guide"),t(document).trigger("promotion:module:undeleted"),!1},showGuide:function(){Widget.GuideTip.show("#undelete_guide",this.$element[0],{autohide:15e3})}})}(jQuery),function(t){Composer.PromotionTutorial=Class.create({GEM_VIDEO_LINK:".watch_promotion_tutorial_video_gem",MIMI_VIDEO_LINK:".watch_promotion_tutorial_video",initialize:function(t){if(this.hasGemVideo())new Composer.PromotionTutorial.GEM(t);else{if(!this.hasMimiVideo())return;new Composer.PromotionTutorial.Mimi}},hasGemVideo:function(){return t(this.GEM_VIDEO_LINK).length>0},hasMimiVideo:function(){return t(this.MIMI_VIDEO_LINK).length>0}})}(jQuery),function(t){Composer.PromotionTutorial.Mimi=Class.create({initialize:function(){this.dom=t("body").getChildren(Composer.PromotionTutorial.Mimi.DOM),this.videoPopup=new Widget.Popup(this.dom.$videoPopup,{hideTrigger:".window_close, .back, .save",overlay:Widget.ModalOverlay,onHidden:_.bind(this.onPopupHidden,this)}),this.initializeObservers()},initializeObservers:function(){this.dom.$watchVideo.on("click",_.bind(this.onVideoClick,this))},onPopupHidden:function(){var t=this.dom.$videoPopup.find("iframe");t[0].contentWindow.postMessage(JSON.stringify({method:"pause"}),t[0].src.split("?")[0])},onVideoClick:function(t){t.preventDefault(),this.videoPopup.show(t)}}),Composer.PromotionTutorial.Mimi.DOM={watchVideo:".watch_promotion_tutorial_video",videoPopup:"#promotion_tutorial_video"}}(jQuery),function(t){Composer.PromotionTutorial.GEM=Class.create({initialize:function(e){this.dom=t("body").getChildren(Composer.PromotionTutorial.GEM.DOM),this.data=_.extend({initialOverlayVisible:!1,YouTubeStates:[],analytics:{}},e),this.videoPopup=new Widget.Popup(this.dom.$videoPopup,{hideTrigger:".window_close, .back, .save",overlay:Widget.ModalOverlay,onHidden:_.bind(this.onPopupHidden,this),onShown:_.bind(this.onPopupShown,this)}),this.appendYouTubeIframeScript(),this.initializeObservers(),this.applyFirstTimeOverlay()},appendYouTubeIframeScript:function(){var e=t('<script src="https://www.youtube.com/iframe_api">');t("head").append(e)},initializeObservers:function(){window.onYouTubeIframeAPIReady=_.bind(this.onYouTubeIframeAPIReady,this),this.dom.$watchVideo.on("click",_.bind(this.onVideoClick,this)),this.dom.$firstTimeOverlayClose.on("click",_.bind(this.onOverlayClosing,this))},applyFirstTimeOverlay:function(){var e=!this.data.userHasSentMailings&&!this.data.userHasSeenTutorial;this.dom.$promotionEditor.toggleClass("video-layer_active",e),this.dom.$firstTimeOverlay.toggle(e),this.data.initialOverlayVisible=e,e&&t(document).on("keyup",_.bind(function(t){27==t.which&&this.onOverlayClosing(t)},this))},onOverlayClosing:function(t){t.preventDefault(),this.closeFirstTimeOverlay(),this.data.analytics.closedOverlayImmediately=!0,this.recordPromotionTutorialAnalytics()},closeFirstTimeOverlay:function(t){this.dom.$promotionEditor.removeClass("video-layer_active"),t?this.dom.$firstTimeOverlay.hide():(this.dom.$promotionEditor.addClass("video-layer_hide"),this.dom.$videoSideBarLink.addClass("highlight-zoom")),this.data.initialOverlayVisible=!1},onYouTubeIframeAPIReady:function(){this.player=new YT.Player("tutorial_video",{}),this.player.addEventListener("onStateChange",_.bind(this.onYouTubeStateChanged,this))},onYouTubeStateChanged:function(t){this.data.YouTubeStates.push(t.data),t.data==YT.PlayerState.PAUSED?this.data.analytics.secondsWatched=t.target.getCurrentTime():t.data==YT.PlayerState.ENDED&&this.videoPopup.hide()},onPopupHidden:function(){this.player&&(this.player.pauseVideo(),setTimeout(_.bind(this.recordPromotionTutorialAnalytics,this),200))},onPopupShown:function(){this.player&&this.player.playVideo()},recordPromotionTutorialAnalytics:function(){var e=_.contains(this.data.YouTubeStates,YT.PlayerState.PLAYING),i=_.contains(this.data.YouTubeStates,YT.PlayerState.ENDED);t.ajax({url:this.data.tutorialAnalyticsPath,type:"POST",data:{clicked_play:e,seconds_watched:this.data.analytics.secondsWatched||0,reached_end:i,viewed_from:this.data.analytics.viewedFrom,closed_overlay_immediately:!!this.data.analytics.closedOverlayImmediately}})},onVideoClick:function(t){t.preventDefault(),this.data.YouTubeStates=[],this.data.analytics={},this.data.analytics.viewedFrom=this.data.initialOverlayVisible?"initial overlay":"sidebar help",this.closeFirstTimeOverlay("withoutAnimation"),this.videoPopup.show(t)}}),Composer.PromotionTutorial.GEM.DOM={promotionEditor:".promotion_editor",firstTimeOverlay:"#first_time_video_popup",firstTimeOverlayClose:"#first_time_video_popup a.close",watchVideo:[".watch_promotion_tutorial_video_gem"],videoPopup:"#promotion_tutorial_video_gem",videoSideBarLink:".watch_promotion_tutorial_video_gem"}}(jQuery),function(){Composer.GettingStartedDialog=Class.create(Widget.Popup,{initialize:function($super){$super("#getting_started_dialog",{overlay:Widget.ModalOverlay,styles:{position:"absolute",zIndex:10000005,display:"none"},hideTrigger:"a.close",onHidden:_.bind(this.onNUFHidden,this)}),this.initializeDom()},initializeDom:function(){this.dom=this.$element.getChildren(Composer.GettingStartedDialog.DOM)},show:function($super){$super(),Mimi.Dashboard.GettingStarted.get(),Mimi.Dashboard.GettingStarted.Step1.enableDragDrop()},hide:function($super){$super(),Mimi.Dashboard.GettingStarted.Step1.disableDragDrop()},onNUFHidden:function(){Mimi.Dashboard.GettingStarted.get().trackEvent("closed_by_user")}}).singleton("show","hide"),Composer.GettingStartedDialog.DOM={}}(jQuery),function(t){Composer.SidebarHelp=Class.create({initialize:function(){this.$element=t("#gem_help"),this.dom=this.$element.getChildren(Composer.SidebarHelp.DOM),this.initializeObservers()},initializeObservers:function(){this.dom.$headerLink.on("click",_.bind(this.onHeaderLinkClicked,this))},onHeaderLinkClicked:function(t){t.preventDefault&&t.preventDefault(),this.$element.toggleClass("minimized"),this.dom.$headerLink.data("click-eid",this.getClickEid())},getClickEid:function(){var t=this.$element.hasClass("minimized")?"collapse":"expand";return"productivity.gem.composer.sidebar.useful_stuff.section_"+t+".button.click"}}).singleton(),Composer.SidebarHelp.DOM={headerLink:"h4 > a"}}(jQuery),Mimi.RssFeeds={},function(t){Mimi.RssFeeds.Dashboard=Class.create(Widget.Observer,{initialize:function(){this.confirmDeleteDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onDeleteOk,this)}),this.confirmDuplicateCreate=new Widget.ConfirmDialog({onOk:_.bind(this.submitNewFeed,this)}),this.newFeedDialog=new Widget.Popup("#new_feed_dialog",{overlay:Widget.ModalOverlay,hideTrigger:".window_close, .back"}),this.importText=t("#import_feed").html(),new Mimi.RssFeeds.ScheduleDialog,new Mimi.RssFeeds.FeedHistoryDialog,this.resumeFeedDialog=new Widget.Popup("#resume_feed_dialog",{overlay:Widget.ModalOverlay,hideTrigger:".window_close, .back"}),t("#feeds_table").on("click",_.bind(this.onDeleteClick,this)),t("#new_feed_action").on("click",_.bind(this.onNewFeed,this)),t("#import_feed").on("click",_.bind(this.onImportFeed,this)),t("#feed_resume").on("click",_.bind(this.resumeFeed,this)),t("#resume_window_close").on("click",_.bind(this.removePosts,this)),t("#resume_back").on("click",_.bind(this.removePosts))},prepare:function(t,e){this.feeds=t,this.audience_size=e},onNewFeed:function(){return t("#import_feed").html(this.importText),this.newFeedDialog.show(),this.updateSubmitButton(),t("#feed_url").on("keyup",_.bind(this.updateSubmitButton)),!1},updateSubmitButton:function(){_.blank(t("#feed_url").val())?t("#import_feed").disable():t("#import_feed").enable()},onImportFeed:function(){return setTimeout(function(){t("#import_feed").html("<span>"+I18n.t("js.rss_feeds.dashboard.onImportFeed")+"</span>").disable()},1),this.allow_duplicate_url=!1,this.submitNewFeed(),!1},submitNewFeed:function(){var e=t("#feed_url").val(),i={feed_url:e,allow_duplicate_url:this.allow_duplicate_url};t.ajax({url:"/rss_feeds.json",data:i,type:"post"}).done(_.bind(this.onsubmitNewFeedSuccess,this)).fail(_.bind(this.onsubmitNewFeedFailure,this)).always(_.bind(this.handleSubmit,this))},handleSubmit:function(){t("#new_feed_dialog").hide()},onsubmitNewFeedSuccess:function(t){1==t.already_exists?this.confirmDuplicate():window.location=t.new_path},onsubmitNewFeedFailure:function(e){t("#feed_url").val(""),t("#import_feed").disable(),this.newFeedDialog.hide();var i=e.responseText;Widget.MimiFlash.error(i)},confirmDuplicate:function(){this.allow_duplicate_url=!0,this.newFeedDialog.hide(),this.confirmDuplicateCreate.show(I18n.t("MimiFlash.rss_feeds.dashboard.confirm_feed.title"),I18n.t("MimiFlash.rss_feeds.dashboard.confirm_feed.note")+"</p>")},onDeleteClick:function(e){var i=t(e.target).findElement("li.feed-item"),s=i.attr("data-value"),n=t(e.target).findElement("a");if(i[0]&&n[0]){var o=i.attr("data-feed-url"),a=n.detectClass("delete","schedule","pause","resume","history"),r=this.feeds[s];switch(a){case"delete":return this.onDeleteOk.data={id:s,$row:i},this.confirmDeleteDialog.show(I18n.t("MimiFlash.rss_feeds.dashboard.onDeleteClick.title"),I18n.t("MimiFlash.rss_feeds.dashboard.onDeleteClick.body")+' <a target="_blank" href="'+o+'">'+o+"</a>?"),!1;case"schedule":return Mimi.RssFeeds.ScheduleDialog.show(r,this.audience_size),!1;case"history":return Mimi.RssFeeds.FeedHistoryDialog.show(r),!1;case"pause":return this.pauseFeed(s),!1;case"resume":return this.fetchRecentPosts(s),t("#resume_feed_dialog").addClass("loading").css({backgroundPosition:"center center"}),this.resumeFeedDialog.show(),!1}}},fetchRecentPosts:function(e){this.feed_id=e,t.ajax({url:"/rss_feeds/"+e+"/recent_posts.json",type:"GET"}).done(_.bind(this.onFetchSuccess,this)).fail(_.bind(this.onFetchFailure,this))},onFetchSuccess:function(e){var i=e;t("#resume_feed_dialog").removeClass("loading"),_.each(i,function(e){t("#recent_entries").append("<li class='recent_post'><a href='#'><span class='bold entry_date'>"+e.published_at+"</span> <span class='entry_title'>"+e.title+"</span></a></li>")}),new Widget.Dropdown(t("#past_posts"),{keepStartText:!0,onItemClick:this.selectResumeFeed.bind(this)},this)},onFetchFailure:function(){this.resumeFeedDialog.hide(),Widget.MimiFlash.error(I18n.t("MimiFlash.rss_feeds.dashboard.onResumeFailure"))},onDeleteOk:function(){var e=this.onDeleteOk.data.$row,i=e.find("a.delete").attr("href")+".json",s=t.ajax({url:i,dataType:"html",type:"DELETE"}).done(_.bind(this.onDeleteSuccess,this)).fail(_.bind(this.onDeleteFailure,this));s.data=this.onDeleteOk.data},onDeleteSuccess:function(e,i,s){var n=this.is_last_feed();s.data.$row.fadeSlide(),n&&(t("#feeds_not_empty").hide(),t("#feeds_empty").show(),t("#jump_in").show())},onDeleteFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.rss_feeds.dashboard.onDeleteFailure"))},pauseFeed:function(e){t.ajax({url:"/rss_feeds/"+e+"/pause.json",dataType:"json",data:{id:e},type:"PUT"}).done(_.bind(this.onPauseSuccess,this)).fail(_.bind(this.onPauseFailure,this))},onPauseSuccess:function(e){e.success?(t("#resume_"+e.id).show(),t("#pause_"+e.id).hide(),t('#feeds_table li[data-value="'+e.id+'"] .status').first().html(e.status_blurb),Widget.MimiFlash.create(I18n.t("MimiFlash.rss_feeds.dashboard.onPauseSuccess"))):Widget.MimiFlash.error(I18n.t("MimiFlash.rss_feeds.dashboard.onPauseFailure")+e.error)},onPauseFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.rss_feeds.dashboard.onPauseFailure"))},selectResumeFeed:function(e){var i;if(t(e).find(".entry_title")){i=t(e).find(".entry_date").html();var s=t(e).find(".entry_title").html();t("#resume_from").first().html(i+(void 0===s?"":" - "+s))}else i="From now";t("#resume_from_input").val(i)},resumeFeed:function(){var e=t("#resume_from_input").val();t.ajax({url:"/rss_feeds/"+this.feed_id+"/resume.json",dataType:"json",data:{id:this.feed_id,time:e},type:"PUT"}).done(_.bind(this.onResumeSuccess,this)).fail(_.bind(this.onResumeFailure,this))},onResumeSuccess:function(t){this.removePosts(),this.resumeFeedDialog.hide(),this.updateDashboard(t),Widget.MimiFlash.create(I18n.t("MimiFlash.rss_feeds.dashboard.onResumeSuccess"))},removePosts:function(){t(".recent_post").remove(),t("#resume_from").first().html("From now"),t("#resume_from_input").val("From now")},updateDashboard:function(e){t("#resume_"+e.id).hide(),t("#pause_"+e.id).show(),t('#feeds_table li[data-value="'+e.id+'"] .status').first().html(e.status_blurb)},onResumeFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.rss_feeds.dashboard.onResumeFailure"))},is_last_feed:function(){return 2===t("#feeds_table tr:visible").size()}}).singleton()}(jQuery),function(t){Mimi.RssFeeds.ScheduleDialog=Class.create(Widget.Observable,Widget.Observer,{SLIDE_DURATION:.25,NUM_MONTHS_AHEAD:6,initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(this.constructor.DOM),this.createUI(),this.default_feed={},this.updateLocalVersionOfFeed(this.default_feed,this.collectDataForSubmission()),t(document).on("dropdown:initialized",_.bind(this.initializeDropdownEvents,this)),t(".days_to_send").on("click",_.bind(this.checkIfDayWarningApplies,this))},initializeDropdownEvents:function(){var t=Widget.Dropdown.getInstanceByName("rss_promotion[frequency]");t.observe("dropdown:item:selected",_.bind(this.onFrequencyChange,this));var e=Widget.Dropdown.getInstanceByName("rss_promotion[period]");e.observe("dropdown:item:selected",_.bind(this.onPeriodChange,this))},createUI:function(){this.createScheduleDialog(),this.createScheduleDialog2(),this.createScheduleDialog3(),this.purchaseCreditsDialog=new Widget.Popup("#purchase_credits_dialog",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1}),this.newSenderDialog=Mimi.RssFeeds.NewSenderDialog.get(),this.upgradeAccountDialog=Mimi.RssFeeds.UpgradeAccountDialog.get()},show:function(e,i){this.populateData(this.default_feed,i),e.clean?t("#custom_clean").show():t("#custom_clean").hide(),!e.clean||1!=e.clean_with_links&&1e3==e.clean_snippet_size?(t("#clean_options").hide(),t("#custom_clean").text(" "+I18n.t("js.rss_feeds.schedule_dialog.customize"))):(t("#clean_options").show(),t("#custom_clean").text(" "+I18n.t("js.rss_feeds.schedule_dialog.hide_options"))),this.feed=e,t(".feed_schedule_url").html(e.url),"Hour Interval"===e.frequency&&this.addExtraHourlyOptions(),this.populateData(e,i),this.warnBouncyFrom(),0==e.days_to_send.length||7==e.days_to_send.length?(this.dom.$onAnyDay.show(),this.dom.$daysToSendArea.hide(),_.each(this.dom.$rssDaysToSend,function(e){t(e).prop("checked",!0)})):this.showDaysToSend(),"Week Interval"==e.frequency&&this.dom.$dayPickingOptions.hide(),this.scheduleDialog.show()},createScheduleDialog:function(){this.scheduleDialog=new Widget.Popup("#schedule-dialog",{hideTrigger:".window_close, .back",overlay:Widget.ModalOverlay,fixedPosition:!1}),this.dom.$onAnyDayButton.on("click",_.bind(this.showDaysToSend,this)),this.scheduleDialog.$element.find("[type=submit]").on("click",_.bind(this.submit,this))},showDaysToSend:function(){this.dom.$onAnyDay.hide(),this.dom.$daysToSendArea.show()},submit:function(){return this.scheduleDialog.hide(),this.scheduleDialog2.show(),this.validateAudienceSelection(),!1},createScheduleDialog2:function(){this.scheduleDialog2=new Widget.Popup("#schedule-dialog-step-2",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1}),this.scheduleDialog2.$element.find("form").on("submit",_.bind(this.submit2,this)),this.scheduleDialog2.$element.find(".back").on("click",_.bind(this.back2,this)),this.scheduleDialog2.$element.on("click","button",_.bind(function(){t(this).parent("button")||this.audienceListSelect.dom.$menu.hide()},this)),this.initAudienceSelection(),this.initAudienceSelectValidation()},onFrequencyChange:function(e,i){this.hideDropdowns(),this.frequencyChange(t(i.element).data("value")),this.checkIfDayWarningApplies()},onPeriodChange:function(e,i){this.hideDropdowns();var s=t("input[name='rss_promotion[frequency]']");this.checkIfDayWarningApplies(),t(i.element).data("value")%7==0&&"Day Interval"==s.val()?(this.checkAllRssDaysToSend(),this.dom.$dayPickingOptions.hide()):"Week Interval"!=s.val()&&this.updateDaysToSendDisplay()},frequencyChange:function(e){switch(e){case"Hour Interval":t("#day_of_week").hide(),t("#day_of_month").hide(),t("#hour_of_day").hide(),this.addExtraHourlyOptions(),this.updateDaysToSendDisplay();break;case"Day Interval":t("#day_of_week").hide(),t("#day_of_month").hide(),t("#hour_of_day").show();var i=t("input[name='rss_promotion[period]']");this.removeExtraHourlyOptions(),7==i.val()?(this.dom.$dayPickingOptions.hide(),this.checkAllRssDaysToSend()):this.updateDaysToSendDisplay();break;case"Week Interval":t("#day_of_week").show(),t("#day_of_month").hide(),t("#hour_of_day").show(),this.removeExtraHourlyOptions(),this.checkAllRssDaysToSend(),this.dom.$dayPickingOptions.hide();break;case"Month Interval":t("#day_of_week").hide(),t("#day_of_month").show(),t("#hour_of_day").show(),this.removeExtraHourlyOptions(),this.updateDaysToSendDisplay()}},updateDaysToSendDisplay:function(){var e=t(".days_to_send:checked").length;7>e?this.dom.$daysToSendArea.show():(this.dom.$daysToSendArea.hide(),t("#on_any_day").show())},checkIfDayWarningApplies:function(){var e=this.daysToSendSelected()&&this.problemFrequency(),i=t(".warning");i.toggleClass("show",e),e?(i.slideDown(),t("#next-interval-number").text(String(this.daysToNextSend()))):i.slideUp()},problemFrequency:function(){var e=t("input[name='rss_promotion[period]']").val();return this.monthFrequencySelected()||this.dayFrequencySelected&&this.daysToNextSend()>Number(e)},daysToNextSend:function(){var e=t("input[name='rss_promotion[period]']").val(),i=new Date,s=this.incrementToNextSend(i.toString(),e),n=864e5;return Math.round((s.getTime()-i.getTime())/n)},incrementToNextSend:function(e,i){var s=this.daysSelected(),n=new Date(Date.parse(e));return this.dayFrequencySelected()?n.setDate(n.getDate()+Number(i)):this.monthFrequencySelected()&&n.setMonth(n.getMonth()+Number(i)),t.inArray(n.getDay(),s)>-1?n:this.incrementToNextSend(n.toString(),i)},dayFrequencySelected:function(){var e=t("input[name='rss_promotion[frequency]']").val();return"Day Interval"==e},monthFrequencySelected:function(){var e=t("input[name='rss_promotion[frequency]']").val();return"Month Interval"==e},daysSelected:function(){var e=[];return _.each(t(".days_to_send:checked"),function(t){var i=this.dayOfWeekAsInt(t.id);e.push(i)},this),e},dayOfWeekAsInt:function(t){switch(t){case"sunday":return 0;case"monday":return 1;case"tuesday":return 2;case"wednesday":return 3;case"thursday":return 4;case"friday":return 5;case"saturday":return 6}},daysToSendSelected:function(){var e=t(".days_to_send:checked").length;return e>0&&4>e},uncheckAllRssDaysToSend:function(){_.each(this.dom.$rssDaysToSend,function(e){t(e).prop("checked",!1)})},checkAllRssDaysToSend:function(){_.each(this.dom.$rssDaysToSend,function(e){t(e).prop("checked",!0)})},addExtraHourlyOptions:function(){if(!this.extraOptionsAdded){var e=Widget.Dropdown.getInstanceByName("rss_promotion[period]"),i=e.$element.find("ul:eq(0)"),s=t("<li>");s.html('<a rip-style-borderwidth-backup="" rip-style-borderstyle-backup="" style="" rip-style-bordercolor-backup="" href="#" data-value="0.5">&#189;</a>'),i.prepend(s,i.find("li:eq(0)")),s=t("<li>"),s.html('<a rip-style-borderwidth-backup="" rip-style-borderstyle-backup="" style="" rip-style-bordercolor-backup="" href="#" data-value="0.25">&#188;</a>'),i.prepend(s,i.find("li:eq(0)"))}this.extraOptionsAdded=!0},removeExtraHourlyOptions:function(){if(this.extraOptionsAdded){var t=Widget.Dropdown.getInstanceByName("rss_promotion[period]"),e=t.$element.find("ul:eq(0)");e.find("li:eq(0)").remove(),e.find("li:eq(0)").remove();var i=this.dom.$rssPeriod.value;1>i&&(this.dom.$rssPeriod.val(1),t.dom.button.down("span").text(1)),this.extraOptionsAdded=!1}},initAudienceSelection:function(){this.scheduleDialog2.$element.on("click","ul.items a.remove",_.bind(this.onAudienceListItemRemoved,this)),this.audienceListSelect=new Mimi.AudienceListSelect(this.scheduleDialog2.$element.find(".audience_list_select")[0],{onItemClick:_.bind(this.onAudienceListItemAdded,this),fixedPosition:!0}),this.dom.$audienceSelectbtn.html("<span>"+I18n.t("js.rss_feeds.schedule_dialog.initAudienceSelection")).on("click",_.bind(this.audienceListSelect.show,this.audienceListSelect))},getListData:function(t){return{id:t.attr("data-value"),name:t.find(".name, .title").text().trim(),count:parseInt(t.find(".count, .info").text().trim().split(" ")[0],10)}},removeList:function(t){var e=this.getListData(t);t.remove(),"all"!==e.id&&this.audienceListSelect.addItem(e.id,e.name,e.count)},removeAllLists:function(){_.each(this.dom.$audienceList.find("li"),function(e){this.removeList(t(e))},this),this.audienceListSelect.enable()},addAudienceList:function(t){var e=Mimi.RssFeeds.ScheduleDialog.AUDIENCE_LIST_ITEM_TEMPLATE(t);this.dom.$audienceList.append(e)},onAudienceListItemAdded:function(e){var i=t(e),s=i.attr("data-value"),n=Mimi.RssFeeds.ScheduleDialog.AUDIENCE_LIST_ITEM_TEMPLATE(this.getListData(i));"all"===s?(this.removeAllLists(),this.audienceListSelect.disable()):this.audienceListSelect.removeItem(e),this.dom.$audienceList.append(n),setTimeout(_.bind(function(){this.dom.$audienceSelectbtn.html("<span>"+I18n.t("js.rss_feeds.schedule_dialog.onAudienceListItemAdded")+"</span>")},this),10),this.fire("audience:item:added")},onAudienceListItemRemoved:function(e){var i=t(e.currentTarget).closest("li");return"all"===i.attr("data-value")&&this.audienceListSelect.enable(),this.removeList(i),this.fire("audience:item:removed"),!1},initAudienceSelectValidation:function(){t(document).on("audience:item:added",_.bind(this.validateAudienceSelection,this)),t(document).on("audience:item:removed",_.bind(this.validateAudienceSelection,this)),this.dom.$audienceMembersField.on("keyup",_.bind(this.validateAudienceSelection,this))},validateAudienceSelection:function(){0===this.dom.$audienceList.children().size()&&""===this.dom.$audienceMembersField.val()?this.dom.$submitbtn2.disable():this.dom.$submitbtn2.enable()},submit2:function(){return this.scheduleDialog2.hide(),this.scheduleDialog3.show(),this.validateScheduleDialog3(),!1},back2:function(){return this.scheduleDialog2.hide(),this.scheduleDialog.show(),!1},createScheduleDialog3:function(){this.scheduleDialog3=new Widget.Popup("#schedule-dialog-step-3",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1}),this.scheduleDialog3.$element.find(".back").on("click",_.bind(this.back3,this)),this.scheduleDialog3.$element.find("form").on("submit",_.bind(this.submit3,this)),this.dom.$scheduleFromName.on("keyup",_.bind(this.validateScheduleDialog3,this)),this.dom.$scheduleFromEmail.on("keyup",_.bind(this.validateScheduleDialog3,this)),this.dom.$scheduleFromEmail.on("keyup",_.bind(this.warnBouncyFrom,this)),this.dom.$scheduleSubject.on("keyup",_.bind(this.validateScheduleDialog3,this)),t("#custom_clean").on("click",_.bind(this.showCleanOptions,this)),t("#clean").on("click",_.bind(function(){t("#custom_clean").toggle(),t("#custom_clean").text(" "+I18n.t("js.rss_feeds.schedule_dialog.customize")),t("#clean_options").hide(),this.dom.$clean_links.attr("checked",!1),t("#mediumSnippet").prop("checked",!0)},this)),this.dom.$clean.prop("checked")&&t("#custom_clean").show()},showCleanOptions:function(){return t("#clean_options").toggle(),t("#custom_clean").text(t("#custom_clean").text()==" "+I18n.t("js.rss_feeds.schedule_dialog.customize")?" "+I18n.t("js.rss_feeds.schedule_dialog.hide_options"):" "+I18n.t("js.rss_feeds.schedule_dialog.customize")),!1},validateScheduleDialog3:function(){var t=this.dom.$scheduleFromName.valPlaceholderSafe().trim()&&this.dom.$scheduleSubject.valPlaceholderSafe().trim()&&this.dom.$scheduleFromEmail.valPlaceholderSafe().isEmail();this.dom.$submitbtn3[t?"enable":"disable"]()},warnBouncyFrom:function(){var t=this.dom.$scheduleFromEmail.val();Mimi.DmarcAddress.isMatch(t)?this.dom.$scheduleFromEmail.addClass("bad-sender"):this.dom.$scheduleFromEmail.removeClass("bad-sender")},back3:function(){return this.scheduleDialog3.hide(),this.scheduleDialog2.show(),!1},submit3:function(){return this.finalizeSave(),!1},populateAudience:function(e,i){this.removeAllLists(),e.all_audience?(this.audienceListSelect.disable(),this.addAudienceList({id:"all",count:i,name:"All"})):_.each(e.lists,function(e){t('#audience_lists_menu li[data-value="'+e.id+'"]').remove(),this.addAudienceList(e)},this),this.dom.$audienceMembersField.val(e.audience_members)},populateCleanSnippetSize:function(e){"1500"==e?t("#longSnippet").prop("checked",!0):"500"==e?t("#shortSnippet").prop("checked",!0):"11111"==e?t("#paragraphSnippet").prop("checked",!0):t("#mediumSnippet").prop("checked",!0)},populateData:function(t,e){_.each(["period","frequency","hours","day_of_week","day_of_month"],function(e){Widget.Dropdown.getInstanceByName("rss_promotion["+e+"]").setSelection(String(t[e]))},this),this.frequencyChange(t.frequency),this.dom.$scheduleFromName.val(t.from_name),this.dom.$scheduleFromEmail.val(t.from_email),this.dom.$scheduleSubject.val(t.subject),this.dom.$linkTracking.val(t.track_links),this.dom.$clean.prop("checked",t.clean),this.dom.$clean_links.prop("checked",t.clean_with_links),this.populateCleanSnippetSize(t.clean_snippet_size),this.dom.$facebookShare.prop("checked",t.facebook_share),this.dom.$twitterShare.prop("checked",t.twitter_share),this.dom.$plusoneShare.prop("checked",t.plusone_share),this.dom.$pinterestShare.prop("checked",t.pinterest_share),this.dom.$linkedInShare.prop("checked",t.linked_in_share),this.populateAudience(t,e),this.populateDaysToSend(t.days_to_send)},populateDaysToSend:function(e){this.uncheckAllRssDaysToSend(),_.each(e,function(e){var i=t("#"+e.day);i.prop("checked",!0)})},hideDropdowns:function(){_.each(["period","frequency","hours","day_of_week","day_of_month"],function(t){Widget.Dropdown.getInstanceByName("rss_promotion["+t+"]").hide()},this)},collectDataForSubmission:function(){var e=_.map(this.dom.$audienceList.find("li"),function(e){return t(e).data("value")}).join(","),i={from_name:this.dom.$scheduleFromName.val(),from_email:this.dom.$scheduleFromEmail.val(),"mailing[subject]":this.dom.$scheduleSubject.val(),audience_members:this.dom.$audienceMembersField.val(),"rss_promotion[period]":this.dom.$rssPeriod.val(),"rss_promotion[frequency]":this.dom.$rssFrequency.val(),"rss_promotion[hours]":this.dom.$rssSendTime.val(),"rss_promotion[day_of_week]":this.dom.$rssDayOfWeek.val(),"rss_promotion[day_of_month]":this.dom.$rssDayOfMonth.val(),"rss_promotion[clean]":this.dom.$clean.prop("checked"),"rss_promotion[clean_with_links]":this.dom.$clean_links.prop("checked"),"rss_promotion[clean_snippet_size]":t("input[name=snippetSize]:checked").attr("data-value")};return _.each(this.dom.$rssDaysToSend,function(e){var s="days_to_send["+t(e).attr("id")+"]";i[s]=t(e).prop("checked")}),this.dom.$linkTracking.prop("checked")&&(i.track_links=!0),i["promotion[facebook_share]"]=this.dom.$facebookShare.prop("checked"),i["promotion[twitter_share]"]=this.dom.$twitterShare.prop("checked"),i["promotion[plusone_share]"]=this.dom.$plusoneShare.prop("checked"),i["promotion[pinterest_share]"]=this.dom.$pinterestShare.prop("checked"),i["promotion[linked_in_share]"]=this.dom.$linkedInShare.prop("checked"),"all"===e?i["mailing[all_audience]"]=!0:(e.length>0&&(i.audience_lists=e),i["mailing[all_audience]"]=!1),i},updateLocalVersionOfFeed:function(e,i){e.from_name=i.from_name,e.from_email=i.from_email,e.subject=i["mailing[subject]"],e.audience_members=i.audience_members,e.period=i["rss_promotion[period]"],e.frequency=i["rss_promotion[frequency]"],e.hours=i["rss_promotion[hours]"],e.day_of_week=i["rss_promotion[day_of_week]"],e.day_of_month=i["rss_promotion[day_of_month]"],e.track_links=i.track_links,e.clean=i["rss_promotion[clean]"],e.clean_with_links=i["rss_promotion[clean_with_links]"],e.clean_snippet_size=i["rss_promotion[clean_snippet_size]"],e.facebook_share=i["promotion[facebook_share]"],e.twitter_share=i["promotion[twitter_share]"],e.plusone_share=i["promotion[plusone_share]"],e.pinterest_share=i["promotion[pinterest_share]"],e.linked_in_share=i["promotion[linked_in_share]"],e.all_audience=i["mailing[all_audience]"];var s=_.map(this.dom.$audienceList.find("li"),function(e){return this.getListData(t(e))},this);e.lists=_.reject(s,function(t){return"all"===t.id});var n=[],o=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];_.each(o,function(t){var e="days_to_send["+t+"]";i[e]&&n.push({day:t})}),e.days_to_send=n},finalizeSave:function(){var e=this.collectDataForSubmission();this.updateLocalVersionOfFeed(this.feed,e),t.ajax({url:"/rss_feeds/"+this.feed.id+"/schedule.json",type:"PUT",data:e}).done(_.bind(this.onResponse,this)).fail(_.bind(function(t){this.onFailure(t)},this)),this.dom.$submitbtn3.disable()},onResponse:function(t){this.dom.$submitbtn3.enable(),t.success?this.approvalNotRequired(t)?this.creditCheckPassed(t)?this.finishSuccessfully(t):this.handleCreditCheckFailure(t):this.showApprovalRequired():this.onFailure(t.error)},handleCreditCheckFailure:function(t){this.freeAccount(t)?this.showUpgradeAccount(t):this.scheduledAfterNextPaymentDate(t)?this.finishSuccessfully(t):this.showPurchaseCredits(t)},approvalNotRequired:function(t){return!t.needs_approval},showApprovalRequired:function(){this.scheduleDialog3.hide(),this.newSenderDialog.show()},creditCheckPassed:function(t){return t.credit_check&&t.credit_check.passed},showPurchaseCredits:function(e){this.scheduleDialog3.hide(),t("#credit_shortage").html(e.credit_check.credit_shortage.formatThousands()),this.purchaseCreditsDialog.show()},freeAccount:function(t){return t.free_account},showUpgradeAccount:function(t){this.scheduleDialog3.hide(),this.upgradeAccountDialog.setCreditsRequired(t.credit_check.credits_required),this.upgradeAccountDialog.setCreditsAvailable(t.credit_check.credits_available),this.upgradeAccountDialog.show(),Mimi.TrackEvent.track("upgrade_dialog_shown","mailing_credits")},scheduledAfterNextPaymentDate:function(t){return t.scheduled_after_next_payment_date},finishSuccessfully:function(e){this.scheduleDialog3.hide(),t('#feeds_table li[data-value="'+e.id+'"] .status').html(e.status_blurb),t("#resume_"+this.feed.id).hide(),t("#pause_"+this.feed.id).show(),Widget.MimiFlash.create(I18n.t("js.rss_feeds.schedule_dialog.finishSuccessfully"))},onFailure:function(t){this.dom.$submitbtn3.enable();var e=this.dom.$sendError;e.html(t||I18n.t("MimiFlash.rss_feeds.schedule_dialog.onFailure")).show(),e.hideTimeout&&clearTimeout(e.hideTimeout),e.hideTimeout=setTimeout(function(){e.animate({opacity:0},400,function(){e.hide().css({opacity:1})
})},12e3)}}).singleton("show"),Mimi.RssFeeds.ScheduleDialog.DOM={scheduleInputEl:"#schedule_when",submitbtn:'#schedule-dialog button[type="submit"]',rssPeriod:"input[name='rss_promotion[period]']",rssFrequency:"input[name='rss_promotion[frequency]']",rssSendTime:"input[name='rss_promotion[hours]']",rssDayOfWeek:"input[name='rss_promotion[day_of_week]']",rssDayOfMonth:"input[name='rss_promotion[day_of_month]']",rssDaysToSend:[".days_to_send"],daysToSendArea:"#days_to_send",onAnyDayButton:"#on_any_day_button",onAnyDay:"#on_any_day",dayPickingOptions:[".day_picking_options"],audienceList:"#schedule-dialog-step-2 ul.items",audienceSelectbtn:"#schedule-dialog-step-2 .audience_list_select button",submitbtn2:'#schedule-dialog-step-2 p.actions button[type="submit"]',audienceMembersField:"#schedule-dialog-step-2 #audience_members",scheduleFromName:"#schedule-dialog-step-3 #schedule_from_name",scheduleFromEmail:"#schedule-dialog-step-3 #schedule_from_email",scheduleSubject:"#schedule-dialog-step-3 #schedule_subject",linkTracking:"#schedule-dialog-step-3 #link_tracking",clean:"#schedule-dialog-step-3 #clean",clean_links:"#schedule-dialog-step-3 #clean_with_links_input",facebookShare:"#schedule-dialog-step-3 #facebook_share",twitterShare:"#schedule-dialog-step-3 #twitter_share",plusoneShare:"#schedule-dialog-step-3 #plusone_share",pinterestShare:"#schedule-dialog-step-3 #pinterest_share",linkedInShare:"#schedule-dialog-step-3 #linked_in_share",submitbtn3:'#schedule-dialog-step-3 button[type="submit"]',sendError:"#schedule-dialog-step-3 .send-error"},_.extend(Mimi.RssFeeds.ScheduleDialog,{AUDIENCE_LIST_ITEM_TEMPLATE:_.template('<li data-value="#{id}"><span class="name_wrapper"><span class="title hide_overflow"><strong>#{name}</strong></span><span class="info">'+I18n.t("js.rss_feeds.schedule_dialog.people_count")+'</span></span><a href="#" title="'+I18n.t("js.rss_feeds.schedule_dialog.removeTitle")+'" class="remove delete btn icon small subtle"><svg class=\'iconsvg svg_trash\' viewBox=\'0 0 16 16\' aria-hidden=\'true\'>    <path fill-rule="evenodd" id="bin" d="M3.5,6 L2.5,6 L13.5,6 L12.5,6 L12.5,13 L11.5,14 L4.5,14 L3.5,13 L3.5,6 Z M10.5,6 L10.5,12 L5.5,12 L5.5,6 L10.5,6 Z M6.5,11 L7.5,11 L7.5,7 L6.5,7 L6.5,11 Z M8.5,11 L9.5,11 L9.5,7 L8.5,7 L8.5,11 Z"></path> <path id="lid" fill-rule="evenodd" d="M3.5,6 L2.5,6 L2.5,4 L5.5,4 L5.5,3.00311137 L6.5,2 L9.5090429,2 L10.5,2.97052148 L10.5,4 L13.5,4 L13.5,6 L12.5,6 L3.5,6 Z M9.5,4 L6.5,4 L6.5,2.93637592 L6.5,3 L9.5,3 L9.5,4 Z"></path>\n</svg><span>'+I18n.t("MimiFlash.rss_feeds.schedule_dialog.delete")+'</span></a><a href="#" title="'+I18n.t("MimiFlash.rss_feeds.schedule_dialog.delete")+'"></span></a></li>'),EXISTING_LIST_ITEM_TEMPLATE:_.template('<li data-value="#{id}"><a href="#" data-value="#{id}"><span class="count">#{count}</span><span class="name hide_overflow">#{name}</span></a></li>')})}(jQuery),function(t){Mimi.RssFeeds.NewSenderDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("#new_sender_dialog"),this.initDialog(),this.initObservers()},initObservers:function(){this.$element.on("click",".sending-dailog-action",_.bind(this.onClick,this))},initDialog:function(){this.dialog=new Widget.Popup("#new_sender_dialog",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1})},onClick:function(e){var i=t(e.currentTarget),s=i.attr("data-action");return"close"===s?(i.find("span").html("Going..."),i.addClass("disabled"),window.location="/rss_feeds",!1):void 0},show:function(){this.dialog.show()}}).singleton()}(jQuery),function(t){Mimi.RssFeeds.UpgradeAccountDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("#upgrade_account_dialog"),this.dom=this.$element.getChildren(Mimi.RssFeeds.UpgradeAccountDialog.DOM),this.initDialog()},initDialog:function(){this.dialog=new Widget.Popup("#upgrade_account_dialog",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1})},setCreditsRequired:function(t){this.dom.$creditsRequired.html(t)},setCreditsAvailable:function(t){this.dom.$creditsAvailable.html(t)},show:function(){this.dialog.show()}}).singleton(),Mimi.RssFeeds.UpgradeAccountDialog.DOM={creditsRequired:"#credits_required",creditsAvailable:"#credits_available"}}(jQuery),function(t){Mimi.RssFeeds.FeedHistoryDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.feedHistoryDialog=new Widget.Popup("#feed_history",{hideTrigger:".window_close, .close",overlay:Widget.ModalOverlay,fixedPosition:!0}),this.$element=t("#feed_history"),this.dom=this.$element.getChildren(Mimi.RssFeeds.FeedHistoryDialog.DOM),this.dom.$force_send_button.on("click",_.bind(this.forceSend,this)),this.dom.$results_tab.on("click",_.bind(this.showSendResults,this)),this.dom.$unsent_tab.on("click",_.bind(this.showUnsent,this)),this.dom.$reload_button.on("click",_.bind(this.loadUnsentPosts,this)),this.dom.$forceShowLink.on("click",_.bind(this.displayForceSendAction,this)),this.tabs=new Widget.Tabs(t("#feed_tabs")[0],{noState:!0})},show:function(t){this.feed=t,this.feedHistoryDialog.show(),this.showSendResults(),this.initiateResultsData(this.feed.rss_send_results),this.hideForceSendAction(),this.unsentPosts=[]},showSendResults:function(){this.tabs.show(RESULTS_TAB),this.tabs.hide(UNSENT_TAB),this.dom.$reload_button.hide()},initiateResultsData:function(e){var i=Template.from("result_row_template");t(".result-row").remove(),0==e.length?(this.dom.$no_results.show(),this.dom.$table_global.hide()):(this.dom.$no_results.hide(),this.dom.$table_global.show(),_.each(e,function(t){this.addNewResultRow(i,t)},this))},addNewResultRow:function(t,e){var i=this.translateResult(e.key,e.description),s=t({created_at:e.created_at,result:i});this.dom.$send_results_table.append(s)},translateResult:function(t,e){switch(t){case"general_error":return I18n.t("js.rss_feeds.send_results.general_error");case"no_new_entries":return I18n.t("js.rss_feeds.send_results.no_new_entries");case"sent":return I18n.t("js.rss_feeds.send_results.sent");case"payfail_susended_canceled":return I18n.t("js.rss_feeds.send_results.payfail_susended_canceled");case"unauthorized_hidden_frequency":return I18n.t("js.rss_feeds.send_results.unauthorized_hidden_frequency");case"needs_approval":return I18n.t("js.rss_feeds.send_results.needs_approval");case"mailing_credits_skip":return I18n.t("js.rss_feeds.send_results.mailing_credits_skip");case"mailing_credits_unschedule":return I18n.t("js.rss_feeds.send_results.mailing_credits_unschedule");default:return e}},showUnsent:function(){this.tabs.show(UNSENT_TAB),this.tabs.hide(RESULTS_TAB),this.dom.$reload_button.show(),this.dom.$no_unsent.hide(),this.unsentPosts.length<1&&this.loadUnsentPosts()},loadUnsentPosts:function(){this.hideForceSendAction(),this.dom.$no_unsent.hide(),t(".unsent-row").remove(),this.dom.$unsent_entries.addClass("loading"),this.fetchUnsentPosts()},fetchUnsentPosts:function(){t.get("/rss_feeds/"+this.feed.id+"/find_unsent_entries/",{id:this.feed.id}).done(_.bind(this.onFindSuccess,this)).fail(_.bind(this.onFindFailure,this)).always(_.bind(function(){this.dom.$unsent_entries.removeClass("loading")},this))},onFindSuccess:function(t){this.unsentPosts=t,0==t.length?(this.dom.$no_unsent.show(),this.disableForceSending()):this.displayUnsentPosts(),this.initiateUnsentTableData(t)},disableForceSending:function(){this.dom.$forceShowLink.hide(),this.dom.$unsent_entries_table.hide(),this.dom.$no_unsent.show()},displayUnsentPosts:function(){this.dom.$no_unsent.hide(),this.dom.$unsent_entries_table.show(),null==this.feed.frequency?this.dom.$forceShowLink.hide():this.dom.$forceShowLink.show()},initiateUnsentTableData:function(t){var e=Template.from("unsent_row_template");_.each(t,function(t){var i=e({published_at:t.published_at,url:t.url,title:t.title});this.dom.$unsent_entries_table_body.append(i)},this)},onFindFailure:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.rss_feeds.feed_history_dialog.onFindUnsentFailure"))},hideForceSendAction:function(){this.dom.$forceShowLink.show(),t(".warning").removeClass("show"),this.dom.$forceSendWarning.hide(),t("button.close_unsent").show()},displayForceSendAction:function(){t("button.close_unsent").hide(),this.dom.$forceShowLink.hide(),t(".warning").addClass("show"),this.dom.$forceSendWarning.show()},forceSend:function(){this.dom.$force_send_button.disable(),null==this.feed.frequency?(this.feedHistoryDialog.hide(),Widget.MimiFlash.create(I18n.t("MimiFlash.rss_feeds.feed_history_dialog.onForceSend.unScheduled"))):t.ajax({url:"/rss_feeds/"+this.feed.id+"/rss_force_send/",type:"put",data:{id:this.feed.id}}).done(_.bind(this.onForceSuccess,this)).fail(_.bind(this.onForceFailure,this)).always(_.bind(this.enableForceSendButton,this))},onForceSuccess:function(t){this.feed.rss_send_results.unshift(t),this.feedHistoryDialog.hide(),Widget.MimiFlash.create(I18n.t("MimiFlash.rss_feeds.feed_history_dialog.onForceSend.onSuccess"))},onForceFailure:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.rss_feeds.feed_history_dialog.onForceSend.onFailure"))},enableForceSendButton:function(){this.dom.$force_send_button.enable()}}).singleton("show"),Mimi.RssFeeds.FeedHistoryDialog.DOM={force_send_button:"#force_send_button",results_tab:"#results_tab",unsent_tab:"#unsent_tab",send_results_table:"#send_results_table",no_results:"#no-results",table_global:"#send_results table.global",send_results_table:"#send_results_table",unsent_entries:"#unsent_entries",unsent_entries_table:"#unsent_entries_table",no_unsent:"#no-unsent",unsent_entries_table_body:"#unsent_entries_table_body",reload_button:"#reload_button",forceShowLink:"#force-show",forceSendWarning:"#force-send-warning"},RESULTS_TAB=0,UNSENT_TAB=1}(jQuery),Mimi.Audience={},function(t){Mimi.Audience.Dashboard=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("#main"),this.dom=this.$element.getChildren(Mimi.Audience.Dashboard.DOM),this.data={overlay:new Widget.BlockOverlay({cover:this.dom.$audienceMembersTBody[0]}),previousRowCount:0,listId:"all",suppressedReason:"",group:""},this.templates={audienceMember:Template.from("audience_member_template"),signedUpAudienceMember:Template.from("signed_up_audience_member_template"),suppressedAudienceMember:Template.from("suppressed_audience_member_template"),unconfirmedAudienceMember:Template.from("unconfirmed_audience_member_template"),specialListAudienceMember:Template.from("special_list_audience_member_template"),groupFilters:Template.from("group_filters_template"),listGroup:Template.from("list_group_template"),listGroupItem:Template.from("list_group_item_template")},this.initObservers(),this.initDisplay(),this.updateSearchEmptyContext(this.data.listId)},initDisplay:function(){this.clearSearch(),this.toggleFiltersDisplay(!1),this.checkForMissingAllList()},initObservers:function(){Widget.Overlay.hide(),t(document).on("audience_loader:loading",_.bind(this.onAudienceLoading,this)),t(document).on("audience_loader:interrupted",_.bind(this.onAudienceLoadingInterrupted,this)),t(document).on("audience_loader:complete",_.bind(this.onAudienceLoaded,this)),t(document).on("audience_loader:success",_.bind(this.onAudienceLoaderSuccess,this)),t(document).on("audience_loader:after_complete",_.bind(this.onAudienceLoaderAfterComplete,this)),t(document).on("audience_list:context_changed",_.bind(this.onListContextChanged,this)),t(document).on("audience:list_count:bulk_updated",_.bind(this.onBulkListCountUpdated,this)),t(document).on("suppression_reason:selected",_.bind(this.onSuppressionReasonSelected,this)),t(document).on("suppression_reason:unselected",_.bind(this.onSuppressionReasonUnselected,this)),t(document).on("window:scrolled",_.bind(this.onWindowScrolled,this)),t(document).on("group:selected",_.bind(this.onGroupSelected,this)),t(document).on("group:unselected",_.bind(this.onGroupUnselected,this)),this.dom.$audienceSearchForm.on("submit",_.bind(this.onSearch,this)),this.dom.$audienceSearchButton.on("click",_.bind(this.onSearch,this)),this.dom.$audienceAddList.on("click",_.bind(this.onAudienceAddListClicked,this)),this.dom.$audienceAddContacts.on("click",_.bind(this.onAudienceAddContacts,this)),this.dom.$normalListsContainer.on("mouseenter",_.bind(this.onMouseEnterNormalLists,this))},onSuppressionReasonSelected:function(t,e){this.onFilterChange(),this.setSuppressionReason(e.reason)},onSuppressionReasonUnselected:function(){this.onFilterChange(),this.setSuppressionReason("")},setSuppressionReason:function(t){this.data.suppressedReason=t},hasSuppressionReason:function(){return this.data.suppressedReason.length>0},onGroupSelected:function(t,e){this.onFilterChange(),this.setGroup(e.group)},onGroupUnselected:function(){this.onFilterChange(),this.setGroup("")},onMouseEnterNormalLists:function(){t("#normal_audience_lists").css({height:"356px"}).addClass("alt").css({height:t("#normal_audience_lists")[0].scrollHeight.px()})},checkForMissingAllList:function(){var e=this.dom.$audienceLists.find("a[data-value=all]");e[0]||t(document).trigger("audience_list:force_selection:first")},onAudienceAddListClicked:function(){t("#audience_new_list").css({display:"block"}),t("#audience_list_name").focus()},onFilterChange:function(){this.clearSearch()},onListContextChanged:function(t,e){this.data.listId=e.listId,this.clearSearch(),this.toggleSearchDisplay(e.count),this.resetPreviousRowCount(),this.resetAudienceListHeight(),this.setAudienceSectionTitle(e.listId),this.toggleEmptyListMessage(e.listId,e.count),this.setEntireListSelected(""),this.updateSearchEmptyContext(this.data.listId)},updateSearchEmptyContext:function(t){var e=this.dom.$audienceLists.find("a[data-value="+t+"]");if(e[0]){var i=e.find("span.list_name"),s=i.html().trim()||"",n=this.dom.emptyMsg.$search.find("span.search_context");n.html(s)}},toggleSearchDisplay:function(t){0===t&&this.searchInputIsEmpty()?(this.dom.$audienceSearchInput.hide(),this.dom.$audienceSearchButton.hide()):(this.dom.$audienceSearchInput.show(),this.dom.$audienceSearchButton.show())},searchInputIsEmpty:function(){return 0===this.dom.$audienceSearchInput.val().trim().length},toggleEmptyListMessage:function(t,e){this.hideEmptyMessages(),e=parseInt(e,10),0===e?(this.dom.$audienceResultList.hide(),this.searchInputIsEmpty()?"signups"===t?this.dom.emptyMsg.$signups.show():"suppressed"===t?this.dom.emptyMsg.$suppressed.show():"all"===t?this.dom.emptyMsg.$all.show():this.dom.emptyMsg.$audience.show():this.dom.emptyMsg.$search.show()):this.dom.$audienceResultList.show()},hasAudienceFilterSelected:function(){var t=this.dom.$audienceFilters.find("a.filter.selected:visible");return t[0]?!0:!1},hideEmptyMessages:function(){t(".empty_list_container").hide()},setAudienceSectionTitle:function(t){var e=this.findListName(t);"all"==e&&(e=I18n.t("js.audience_members.index.all_contacts")),this.dom.$audienceResults.find("h2").html(e)},setGroup:function(t){this.data.group=t},hasGroup:function(){return this.data.group.length>0},findListName:function(t){if("all"===t)return t;try{var e=this.dom.$audienceLists.find("a[data-value="+t+"]");return e.find("span.list_name").html().trim()}catch(i){return""}},resetPreviousRowCount:function(){this.data.previousRowCount=0},onBulkListCountUpdated:function(t,e){var i=e.listId;if(i){var s=_.detect(e.lists,function(t){return t.id===i?t:void 0});e.count=s.size,this.updateSelectAllCount(t,e),this.updateSelectAllText(t,e)}},onAudienceLoading:function(t,e){if(1===e.page){var i=this.dom.$audienceResults.find("> div:visible")[0];this.data.overlay.show(i)}else this.dom.$audienceSearchContent.addClass("infinite_scroll_loading")},onAudienceLoaded:function(){this.data.overlay.hide(),this.dom.$audienceSearchContent.removeClass("infinite_scroll_loading")},onAudienceLoadingInterrupted:function(t){this.onAudienceLoaded(t)},onAudienceLoaderSuccess:function(t,e){this.insertAudienceMembers(t,e),this.updateRowControls(t,e),this.updateSelectAllCount(t,e),this.updateSelectAllText(t,e),this.toggleEmptyListMessage(this.data.listId,e.count),this.toggleSearchDisplay(e.count)},onAudienceLoaderAfterComplete:function(){this.onWindowScrolled()},controlsToRemoveBasedOnPermissions:function(t){var e=[],i=Mimi.Audience.Dashboard.DOM.audienceMembersTBody;return this.canDelete(t)||(e.push(i+" a.delete"),e.push(i+" a.suppress")),this.canEdit(t)||(e.push(i+" a.list-remove"),e.push(i+" a.add"),e.push(i+" a.edit"),e.push(i+" td.bulk")),"all"===t&&e.push(i+" a.list-remove"),e.join(", ")},hideOrShowControlsBasedOnPermissions:function(t){var e=this.dom.$audienceResultList,i=e.find("th.bulk");this.canEdit(t)?i.show():i.hide()},updateRowControls:function(e,i){var s=this.controlsToRemoveBasedOnPermissions(i.listId);s.length>0&&t(s).remove(),this.hideOrShowControlsBasedOnPermissions(i.listId)},canDelete:function(t){return this.canPermission(t,"can_delete")},canExport:function(t){return this.canPermission(t,"can_export")},canEdit:function(t){return this.canPermission(t,"can_edit")},canPermission:function(t,e){var i=Mimi.AudienceList.permissions[t];return"undefined"==typeof i?!0:i[e]},clearSearch:function(){this.dom.$audienceSearchForm.reset()},updateSelectAllCount:function(t,e){this.dom.bulkControls.$audienceListSize.val(e.count)},updateSelectAllText:function(t,e){var i=e.count,s=_.template(I18n.t("js.audience.new_dashboard.bulk_select.other")),n=s({count:i});"1"===i&&(n=I18n.t("js.audience.new_dashboard.bulk_select.one")),this.dom.bulkControls.$selectConfirmation.html(n)},onAudienceAddContacts:function(){t(document).trigger("dashboard:add_contacts")},onSearchKeyUp:function(){return this.data.timeout&&clearTimeout(this.data.timeout),this.data.timeout=_.delay(_.bind(this.onSearch,this),500),!1},onSearch:function(){var e=this.dom.$audienceSearchForm.find("#audience_search").val().trim();return this.setSelectAllInfo(e),this.setEntireListSelected(e),t(document).trigger("dashboard:search",{searchTerm:e}),!1},setSelectAllInfo:function(t){var e="";t.length>0&&(e="from your search"),this.dom.$audienceSelectAllInfo.html(e)},setEntireListSelected:function(t){var e;e=I18n.t(t.length>0?"js.audience_members.bulk_controls.all_search_selected":"js.audience_members.bulk_controls.all_list_selected"),this.dom.$entireListSelected.html(e)},resetAudienceListHeight:function(){var t=this.dom.$audienceResultList.find(".audience_results .listing");t.data("bottom",null)},onWindowScrolled:function(){var e=this.dom.$audienceResultList.find(".audience_results .listing"),i=e.data("bottom")||e.offset().top+e.height(),s=t(window).height()+t(window).scrollTop();if(e.data("bottom",i),s>=i){var n=this.audienceRowCount();n!==this.data.previousRowCount&&(t(document).trigger("dashboard:scrolled"),this.data.previousRowCount=n,e.data("bottom",null))}},audienceRowCount:function(){var e=t("tbody#audience_member_rows tr").size();return e},insertAudienceMembers:function(e,i){var s=i.audience,n=i.count,o=i.listId,a=i.search,r=i.groups,l=[],d=this,h=_.map(s,function(t){d.isSignupsList(o)&&!t.suppressed&&l.push(t.id),t.email=t.email.truncate(55),a&&(t.count=t.count+" matches");var e=d.chooseTemplate(o,t);return e(t)}).join("");if(!this.dom.$groupFilters.is(":visible"))if(r){var c=_.map(r,_.bind(function(t){var e=_.map(t.events,_.bind(function(t){return this.templates.listGroupItem(t)},this)).join("");return this.templates.listGroup({title:t.title,html:e})},this)).join(""),u=this.templates.groupFilters({html:c});this.dom.$groupFilters.html(u)}else this.dom.$groupFilters.html("");i.page>1?(this.dom.$audienceMembersTBody.append(h),t(document).trigger("dashboard:audience:appended")):(this.dom.$audienceMembersTBody.html(h),t(document).trigger("dashboard:audience:inserted")),this.showRecentSignupLabels(o),this.removeConfirmButtons(l),this.toggleFiltersDisplay(o,n,r)},showRecentSignupLabels:function(e){this.isSignupsList(e)&&t("span.new_signup_label[data-recent=true]").each(function(){t(this).parents(".notify").show()})},removeConfirmButtons:function(e){_.each(e,function(e){var i=t("#audience_member_row_"+e);if(i[0]){var s=i.find(".confirm_action"),n=i.find(".unconfirmed");s.hide(),n.hide()}})},isSignupsList:function(t){return"signups"===t},isSuppressedList:function(t){return"suppressed"===t},isGroupedList:function(t){return t&&t.length>0},isSpecialList:function(t){var e=parseInt(t,10);return _.include(Mimi.AudienceList.special_lists,e)},toggleFiltersDisplay:function(t,e,i){this.isSuppressedList(t)?void 0!==e&&0===e?(this.toggleEmptyListMessage(t,e),this.dom.$groupFilters.hide()):(this.dom.$audienceFilters.show(),this.dom.$groupFilters.hide()):this.isGroupedList(i)?void 0!==e&&0===e?this.toggleEmptyListMessage(t,e):(this.dom.$audienceFilters.hide(),this.dom.$groupFilters.show()):(this.dom.$audienceFilters.hide(),this.dom.$groupFilters.hide())},chooseTemplate:function(t,e){return this.isSpecialList(t)?this.templates.specialListAudienceMember:this.isSignupsList(t)?this.templates.signedUpAudienceMember:this.isSuppressedList(t)?this.chosseSuppressedTemplate(e.suppression_reason):e&&e.special_list_member?this.templates.specialListAudienceMember:e.suppressed?this.chosseSuppressedTemplate(e.suppression_reason):this.templates.audienceMember},chosseSuppressedTemplate:function(t){return"Unconfirmed"==t?this.templates.unconfirmedAudienceMember:this.templates.suppressedAudienceMember}}).singleton("canExport"),Mimi.Audience.Dashboard.DOM={audienceMembersTBody:"tbody#audience_member_rows",audienceLists:"#audience_lists",audienceResults:"#audience_results.col",audienceResultList:"#audience_result_list",audienceFilters:"#audience_filters.col",audienceSearchForm:"#audience_search_form",audienceSearchInput:"#audience_search",audienceSearchButton:"button.search",audienceAddContacts:"#audience_add_contacts",audienceAddList:"#audience_add_list",audienceSearchContent:"#audience_result_list",audienceSelectAllInfo:"#audience_select_all_info",entireListSelected:"#entire_list_selected",groupFilters:"#group_filters",normalListsContainer:"#normal_audience_lists",checkAll:"#contacts_check_all",bulkControls:{selectAllText:"#audience_select_all_size",selectAll:"#select_whole_list",selectVisible:"#contacts_check_all",selectConfirmation:"#audience_select_confirmation",audienceListSize:"#audience_list_size"},emptyMsg:{search:"#empty_search_container",all:"#empty_all_list_container",audience:"#empty_audience_list_container",signups:"#empty_signups_list_container",suppressed:"#empty_suppressed_list_container",childWelcome:"#child_welcome_container"}}}(jQuery),function(t){Mimi.Audience.SuppressionReason=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("#audience_filters"),this.initObservers()},initObservers:function(){this.$element.on("click",".filter",_.bind(this.onFilterClicked,this)),t(document).on("audience_list:selected:automatic_list",_.bind(this.onSuppressedSelected,this))},onSuppressedSelected:function(t,e){e.suppressionReason||this.clearSelected()},onFilterClicked:function(e){var i=t(e.currentTarget);if("filter"===i.attr("data-action"))return i.hasClass("selected")?this.unselectFilter(i.attr("data-value")):this.selectFilter(i.attr("data-value")),!1},selectFilter:function(t,e){this.clearSelected(),this.$element.find('.filters li a[data-value="'+t+'"]').addClass("selected"),this.fire("suppression_reason:selected",{reason:t,silent:e&&e.silent})},unselectFilter:function(t,e){this.clearSelected(),this.fire("suppression_reason:unselected",{reason:t,silent:e&&e.silent})},clearSelected:function(){this.$element.find(".selected").removeClass("selected")}}).singleton()}(jQuery),function(t){Mimi.Audience.GroupedList=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("#group_filters"),this.initObservers()},initObservers:function(){this.$element.on("click",_.bind(this.onFilterClicked,this)),t(document).on("audience_list:selected:automatic_list",_.bind(this.onGroupSelected,this))},onGroupSelected:function(t,e){e.group||this.clearSelected()},onFilterClicked:function(e){e.preventDefault();var i=t(e.target);if("filter"===i.data("action"))return i.hasClass("selected")?this.unselectFilter(i.data("value")):this.selectFilter(i.data("value")),!1},selectFilter:function(t,e){this.clearSelected();var i=this.$element.find('.filters li a[data-value="'+t+'"]');i.addClass("selected"),this.fire("group:selected",{group:t,silent:e&&e.silent})},unselectFilter:function(t,e){this.clearSelected(),this.fire("group:unselected",{group:t,silent:e&&e.silent})},clearSelected:function(){this.$element.find(".selected").removeClass("selected")}}).singleton()}(jQuery),function(t){Mimi.Audience.Upload=Class.create(Widget.Dialog,Widget.Observable,{initialize:function($super){$super(I18n.t("js.audience.upload.initialize"),Template.from("audience_upload_template")(),{hideTrigger:"a.back",narrow:!0,fixedPosition:!1}),this.data={context:{add_one:"",add_many:""}},this.initObservers()},initObservers:function(){t(document).on("audience:member:added",_.bind(this.onMemberAdded,this)),t(document).on("audience:members:added",_.bind(this.hide,this)),t(document).on("audience:member:suppressed",_.bind(this.hide,this)),t(document).on("audience:overage",_.bind(this.hide,this)),t(document).on("audience:enqueued",_.bind(this.hide,this)),t(document).on("dashboard:add_contacts",_.bind(this.initAndShow,this)),t(document).on("dropdown:item:selected",_.bind(this.onListSelected,this))},onListSelected:function(e,i){var s=t(i.element);if(s[0]){var n=s.attr("data-value"),o=s.attr("data-context");n&&o&&(this.data.context[o]=n,this.setHeadingText("suppression list"===n?I18n.t("js.audience.upload.onListSelected.suppression_list"):I18n.t("js.audience.upload.onListSelected.add_contacts")))}},setHeadingText:function(e){t("h3.upload_template_heading").html(e)},initAndShow:function(){this.updateSingleButtonText(I18n.t("js.audience.upload.initAndShow")),this.show()},updateSingleButtonText:function(e){t("#add_contacts_one").find("button.primary span").html(e)},onMemberAdded:function(){this.updateSingleButtonText(I18n.t("js.audience.upload.onMemberAdded"))}}).singleton()}(jQuery),function(t){Mimi.Audience.Loader=Class.create({initialize:function(){this.initObservers(),this.data={lastLoadedId:"all",lastPageLoaded:1,lastSearchTerm:"",lastSuppressionReason:"",lastResultCount:0,lastTotalLoadedCount:0},this.busy=!1,this.search=!1},initObservers:function(){t(document).on("audience_loader:interrupted",_.bind(this.onInterrupted,this)),t(document).on("audience_list:selected",_.bind(this.onListSelected,this)),t(document).on("audience_list:selected:automatic_list",_.bind(this.loadMembers,this)),t(document).on("audience:list_count:updated",_.bind(this.onListCountUpdated,this)),t(document).on("dashboard:scrolled",_.bind(this.onDashboardScrolled,this)),t(document).on("dashboard:search",_.bind(this.onSearch,this)),t(document).on("suppression_reason:selected",_.bind(this.onSuppressionReasonSelected,this)),t(document).on("suppression_reason:unselected",_.bind(this.onSuppressionReasonUnselected,this)),t(document).on("group:selected",_.bind(this.onGroupSelected,this)),t(document).on("group:unselected",_.bind(this.onGroupUnselected,this)),t(document).on("audience_list:force_reload",_.bind(this.onForceReload,this)),t(document).on("audience:member:added",_.bind(this.onForceReload,this)),t(document).on("audience:members:added",_.bind(this.onForceReload,this))},onListCountUpdated:function(e,i){var s=i.list;if(s.id===this.data.lastLoadedId){var n={id:this.data.lastLoadedId,page:this.data.lastPageLoaded};t(document).trigger("audience_list:selected:automatic_list",n)}},onSuppressionReasonUnselected:function(){var e={id:"suppressed",page:1};t(document).trigger("audience_list:selected:automatic_list",e)},onGroupSelected:function(e,i){var s={id:this.data.lastLoadedId,page:1,suppressionReason:this.data.lastSuppressionReason,group:i.group,searchTerm:""};t(document).trigger("audience_list:selected:automatic_list",s)},onGroupUnselected:function(){var e={id:this.data.lastLoadedId,page:1};t(document).trigger("audience_list:selected:automatic_list",e)},onForceReload:function(){var e={id:this.data.lastLoadedId,page:this.data.lastPageLoaded,suppressionReason:this.data.lastSuppressionReason,group:this.data.lastGroup,searchTerm:this.data.lastSearchTerm};t(document).trigger("audience_list:selected:automatic_list",e)},onSearch:function(e,i){this.search=i.searchTerm.trim().length>0;var s={id:this.data.lastLoadedId,page:1,suppressionReason:this.data.lastSuppressionReason,group:this.data.lastGroup,searchTerm:i.searchTerm};t(document).trigger("audience_loader:interrupted"),t(document).trigger("audience_list:selected:automatic_list",s)},onSuppressionReasonSelected:function(e,i){var s={id:this.data.lastLoadedId,page:1,suppressionReason:i.reason,group:this.data.lastGroup,searchTerm:""};t(document).trigger("audience_list:selected:automatic_list",s)},onListSelected:function(e,i){var s={id:i.id,page:1};t(document).trigger("audience_list:selected:automatic_list",s)},onDashboardScrolled:function(){if(0===this.data.lastTotalLoadedCount||this.data.lastTotalLoadedCount<this.data.lastResultCount){var e={id:this.data.lastLoadedId,page:this.data.lastPageLoaded+1,searchTerm:this.data.lastSearchTerm,suppressionReason:this.data.lastSuppressionReason,group:this.data.lastGroup};t(document).trigger("audience_list:selected:automatic_list",e)}},onInterrupted:function(){this.pendingRequest&&this.pendingRequest.abort(),this.busy=!1},loadMembers:function(e,i){if(!this.busy){this.busy=!0;var s=i.searchTerm,n=i.page,o=i.id,a=i.suppressionReason,r=i.group;this.data.lastLoadedId=o,this.data.lastPageLoaded=n,this.data.lastSearchTerm=s,this.data.lastSuppressionReason=a,this.data.lastGroup=r,1===n&&(this.data.lastResultCount=0,this.data.lastTotalLoadedCount=0);var l={query:s,page:n,suppression_reason:a,group:r};"all"!==o?l.list_id=o:null!=s&&""!=s&&(l.raw=!0),t(document).trigger("audience_loader:loading",l),this.pendingRequest=t.get(this.determinePath(),l).done(_.bind(this.onLoadListMembersSuccess,this)).fail(_.bind(this.onLoadListMembersFailure,this))}},determinePath:function(){var t="",e=this.data.lastLoadedId,i=this.data.lastSearchTerm||"";return t="suppressed"===e?"/suppressed_audience_members.json":"signups"===e?"/audience_members/signups":"all"===e||i.length>1?"/audience_members/search.json":"/audience_lists/"+e},onLoadListMembersFailure:function(e){t(document).trigger("audience_loader:failure",{error:e.error}),t(document).trigger("audience_loader:complete"),this.busy=!1,this.search=!1,t(".audience").css({visibility:""})},onLoadListMembersSuccess:function(e){if(e.success){var i=e.result;i.listId=this.data.lastLoadedId,i.page=this.data.lastPageLoaded,i.group=this.data.lastGroup,i.search=this.search,this.data.lastResultCount=i.count,this.data.lastTotalLoadedCount+=i.audience.length,t(document).trigger("audience_loader:success",i)}else t(document).trigger("audience_loader:failure",{error:e.error});t(document).trigger("audience_loader:complete"),this.busy=!1,this.search=!1,t(document).trigger("audience_loader:after_complete"),t(".audience").css({visibility:""})}}).singleton()}(jQuery),function(t){Mimi.Audience.Dashboard.Add=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#audience_add_tabs").parents("section"),this.$element[0]&&(this.dom=this.$element.getChildren(Mimi.Audience.Dashboard.Add.DOM),this.data={invalidEmails:[]},this.invalidEmailsDialog=null,"undefined"!=typeof this.dom.$tabs[0]&&(this.tabs=new Widget.Tabs(this.dom.$tabs[0],{noState:!0})),"undefined"!=typeof this.dom.addOne.$form[0]&&(this.addOneListSelect=new Mimi.AudienceListSelect(this.dom.addOne.$listSelect[0],{itemTextTemplate:Mimi.AudienceListSelect.ITEM_TEXT_FORMAT_WITH_SPAN_TEMPLATE}),this.dom.addOne.$submit.disable(),this.dom.addOne.$email.on("keyup",_.bind(this.onAddOneEmailKeyUp,this)),this.dom.addOne.$email.on("change",_.bind(this.onAddOneEmailKeyUp,this)),this.dom.addOne.$form.on("submit",_.bind(this.onAddOneSubmit,this))),this.addManyListSelect=new Mimi.AudienceListSelect(this.dom.addMany.$listSelect[0],{itemTextTemplate:Mimi.AudienceListSelect.ITEM_TEXT_FORMAT_WITH_SPAN_TEMPLATE}),this.isSuppressionList=!1,this.dom.addMany.$submit.disable(),this.dom.addMany.$paste.on("keyup",_.bind(this.onAddManyPasteKeyUp,this)),this.dom.addMany.$paste.on("change",_.bind(this.onAddManyPasteKeyUp,this)),this.$element.on("click",_.bind(this.tryDisplayInvalidEmails,this)),this.isSuppressionList?this.setupSuppressionUploadConfirmation():this.dom.addMany.$form.on("submit",_.bind(this.onAddManySubmit,this)),this.initObservers())},initObservers:function(){t(document).on("audience:upload:explained",_.bind(this.onUploadExplained,this))},setupSuppressionUploadConfirmation:function(){this.confirmSuppressionUploadDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onAddManySubmit,this)}),this.dom.addMany.$form.on("submit",_.bind(this.confirmSuppressionUpload,this))
},confirmSuppressionUpload:function(){var t=I18n.t("MimiFlash.audience.dashboard_add.confirmSuppressionUpload.heading"),e=I18n.t("MimiFlash.audience.dashboard_add.confirmSuppressionUpload.msg");return this.confirmSuppressionUploadDialog.show(t,e),!1},onAddOneEmailKeyUp:function(){this.dom.addOne.$email.val().trim().isEmail()?(this.dom.addOne.$submit.find("span").html(I18n.t("js.audience_members.audience_upload_template.add_contact")),this.dom.addOne.$submit.enable()):this.dom.addOne.$submit.disable()},onAddOneSubmit:function(){var e=this.dom.addOne.$email.val().trim();this.dom.addOne.$email.val(e);var i=t.post(this.dom.addOne.$form.attr("action"),this.dom.addOne.$form.serialize()).done(_.bind(this.onAddOneSuccess,this)).fail(_.bind(this.onAddOneFailure,this));return i.data=this.dom.addOne.$form.serialize(),this.dom.addOne.$form.get(0).reset(),this.dom.addOne.$submit.disable(),this.dom.addOne.$submit.addClass("submitting"),!1},onAddOneSuccess:function(e,i,s){if(this.dom.addOne.$submit.removeClass("submitting"),e.success){switch(e.result.state){case"processed":this.setupFlashMessage(e.result),this.newMembersCreated(e.result)&&this.fire("audience:member:added");break;case"overage":this.fire("audience:overage");var n=e.result.overage,o=It.it("MimiFlash.audience.dashboard_add.onAddOneSuccess.overage.upgrade_by",{click:It.link(n)});Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_add.onAddOneSuccess.overage.exceeded_limit")+"\n"+o);break;case"enqueued":this.fire("audience:enqueued"),Widget.MimiFlash.create(I18n.t("MimiFlash.audience.dashboard_add.addSuccess.enqueued"))}e.result.list&&t(document).trigger("audience_list:updated",e.result.list)}else{var a=_.template(I18n.t("MimiFlash.audience.dashboard_add.onAddOneSuccess.overage.error.start")),r=s.request.data["email[]"]||I18n.t("MimiFlash.audience.dashboard_add.onAddOneSuccess.overage.error.that_member"),l=a({member:r});Widget.MimiFlash.error(l+e.error)}},onAddOneFailure:function(){this.dom.addOne.$submit.removeClass("submitting"),Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_add.onAddOneFailure"))},setupFlashMessage:function(t){var e=t.email;if(1===t.new_members){var i=_.template(I18n.t("MimiFlash.audience.dashboard_add.setupFlashMessage.been_created")),s=i({email:e});Widget.MimiFlash.create(s)}else if(1===t.suppressed_members)if(t.child_account){var n=_.template(I18n.t("MimiFlash.audience.dashboard_add.setupFlashMessage.belongs_to_parent")),o=n({email:e});Widget.MimiFlash.create(o)}else this.showUnsuppressPopup(e,t.suppression_reason,t.list);else if(1===t.existing_members){var a=_.template(I18n.t("MimiFlash.audience.dashboard_add.setupFlashMessage.been_updated")),r=a({email:e});Widget.MimiFlash.create(r)}else if(1===t.invalid_members){var l=_.template(I18n.t("MimiFlash.audience.dashboard_add.setupFlashMessage.not_valid")),d=l({email:e});Widget.MimiFlash.create(d)}},newMembersCreated:function(t){return 0===t.suppressed_members&&0===t.invalid_members?!0:!1},showUnsuppressPopup:function(t,e,i){this.fire("audience:member:suppressed"),this.emailAddress=t,this.audienceList=i;var s=_.template(I18n.t("MimiFlash.audience.dashboard_add.showUnsuppressPopup.is_suppressed")),n=s({email:t}),o=new Widget.ConfirmDialog(I18n.t("MimiFlash.audience.dashboard_add.showUnsuppressPopup.unsuppress_q"),n+'<p class="info">'+this.suppressionReasonSentence(e)+"</p>",{onOk:_.bind(this.onUnsuppressOk,this),onHide:_.bind(this.onCancelUnsuppress,this)},I18n.t("MimiFlash.audience.dashboard_add.showUnsuppressPopup.yes_unsuppress"));o.show()},suppressionReasonSentence:function(t){var e,i=I18n.t("js_url_overrides.suppression_reason_helpdoc");return e="Hard bounce"===t||"Soft bounce"===t||"General bounce"===t||"Transient bounce"===t?It.it("MimiFlash.audience.dashboard_add.suppressionReasonSentence.bounce",{click:It.link(i,{target:"_blank"})}):"Unconfirmed"===t?It.it("MimiFlash.audience.dashboard_add.suppressionReasonSentence.unconfirmed",{click:It.link(i,{target:"_blank"})}):"Mail block"===t?It.it("MimiFlash.audience.dashboard_add.suppressionReasonSentence.mailblock",{click:It.link(i,{target:"_blank"})}):"Suppressed by me"===t?It.it("MimiFlash.audience.dashboard_add.suppressionReasonSentence.manually_suppressed",{click:It.link(i,{target:"_blank"})}):"Unsubscribed"===t?It.it("MimiFlash.audience.dashboard_add.suppressionReasonSentence.unsubscribed",{click:It.link(i,{target:"_blank"})}):"Marked as spam"===t?It.it("MimiFlash.audience.dashboard_add.suppressionReasonSentence.spam",{click:It.link(i,{target:"_blank"})}):"Auto reply"===t?It.it("MimiFlash.audience.dashboard_add.suppressionReasonSentence.manually_suppressed",{click:It.link(i,{target:"_blank"})}):"",e+" "+I18n.t("MimiFlash.audience.dashboard_add.suppressionReasonSentence.unsuppress_q")},onUnsuppressOk:function(){var e=this.emailAddress;t.ajax({url:"/suppressed_audience_members/"+e,type:"DELETE"}).done(_.bind(this.onUnsuppressSuccess,this)).fail(_.bind(this.onUnsuppressFailure,this))},onUnsuppressSuccess:function(t){var e=this.emailAddress;if(t.success){var i=_.template(I18n.t("MimiFlash.audience.dashboard_add.onUnsuppressSuccess.success")),s=i({email:e});Widget.MimiFlash.create(s)}else{var n=_.template(I18n.t("MimiFlash.audience.dashboard_add.onUnsuppressSuccess.fail")),o=n({email:e});Widget.MimiFlash.error(o)}(new Mimi.listUpdater).updateAudienceLists()},onUnsuppressFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_add.onUnsuppressFailure")),this.fire("dashboard:add_contacts")},onCancelUnsuppress:function(){this.fire("dashboard:add_contacts")},onAddManyPasteKeyUp:function(){var t=this.dom.addMany.$paste.val().trim();this.dom.addMany.$submit[t.hasEmail()||t.startsWith("https://")?"enable":"disable"]()},fileSelected:function(){this.dom.addMany.$submit.enable()},onUploadExplained:function(t,e){this.dom.addMany.$form.find("#source").val(e.source),this.getUploadDialog().setSource(e.source),this.submitAddManyForm()},submitAddManyForm:function(){var e=this.dom.addMany.$paste.val().trim();e.hasEmail()&&t.post(this.dom.addMany.$form.attr("action"),this.dom.addMany.$form.serialize()).done(_.bind(this.onAddManySuccess,this)).fail(_.bind(this.onAddManyFailure,this)),this.submitAddManyFileUpload(),this.afterAddManySubmit()},getUploadDialog:function(){return this.dom.addMany.$iframe[0].contentWindow.Mimi.Audience.Dashboard.Upload.get()},submitAddManyFileUpload:function(){this.getUploadDialog().submit(this.addManyListSelect.getAudienceList(),this.addManyListSelect.getAddList())},validFileUpload:function(){var t=this.getUploadDialog();if(t.fileExists()){if(0==t.getFileInputSize())return Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_add.emptyFile")),!1;var e=t.getFileExtension();if(!_.include(Mimi.Audience.Data.validFileTypes,"."+e))return Widget.MimiFlash.error(_.template(I18n.t("MimiFlash.audience.dashboard_add.invalidFileType"))({file_types:Mimi.Audience.Data.validFileTypes.join(", ")})),!1}return!0},afterAddManySubmit:function(){this.markAddManyAsBusy(!0),this.dom.addMany.$form.reset(),this.dom.addMany.$paste.val(""),null===Mimi.Audience.Data.listId&&this.addManyListSelect.clearSelection(),this.dom.addMany.$submit.disable()},onAddManySubmit:function(){var t=this.dom.addMany.$paste.val().trim();return this.validFileUpload()&&(t.isUrl()&&t.startsWith("https://")?this.submitGoogleDoc(t):this.showExplanationDialog()),!1},showExplanationDialog:function(){Mimi.Audience.Upload.get().hide(),Mimi.Audience.DashboardAddExplanationDialog.get().show()},submitGoogleDoc:function(t){var e=new Uri(t),i=e.getQueryParamValue("key");if(i||(i=this.extractGoogleDocKey(t)),i){var s=Base64.encodeURI(i)+":"+this.addManyListSelect.getAudienceList()+":"+Base64.encodeURI(this.addManyListSelect.getAddList()),n=Mimi.Audience.Data.googleRedirectURL+"&state="+s;this.dom.addMany.$submit.find("span").html(I18n.t("MimiFlash.audience.dashboard_add.onAddManySubmit.contacting_google")),this.dom.addMany.$submit.disable(),window.location=n}else Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_add.onAddManySubmit.err"))},extractGoogleDocKey:function(t){t=t.replace("https://docs.google.com/spreadsheets/d/","");var e=t.indexOf("/");return-1!==e&&(t=t.substring(0,e)),t},markAddManyAsBusy:function(t){this.dom.addMany.$submit.find("span").html(I18n.t(t?"MimiFlash.audience.dashboard_add.markAddManyAsBusy.uploading":"MimiFlash.audience.dashboard_add.markAddManyAsBusy.add_contacts"))},onAddManySuccess:function(t){this.addSuccess(t)},onAddManyFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_add.onAddManyFailure"))},onGoogleSuccess:function(){window.location=Mimi.Audience.Data.googleRedirectURL},onGoogleFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_add.onGoogleFailure"))},addSuccess:function(t){if(this.markAddManyAsBusy(!1),t.success)switch(t.result.state){case"processed":this.voiceUploadSuccessDetails(t.result),this.initInvalidEmailsPopup(t.result),this.fire("audience:members:added",t.result),this.fire("audience:list_count:updated",{new_members:t.result.new_members,list:t.result.list});break;case"overage":this.fire("audience:overage"),Widget.MimiFlash.stickyError(I18n.t("MimiFlash.audience.dashboard_add.addSuccess.overage.exceeded")+"\n"+It.it("MimiFlash.audience.dashboard_add.addSuccess.overage.upgrade_by",{click:It.link(t.result.overage)}));break;case"enqueued":this.fire("audience:enqueued"),Widget.MimiFlash.create(I18n.t("MimiFlash.audience.dashboard_add.addSuccess.enqueued"))}else Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_add.addSuccess.fail")),t.error&&console.log(t.error)},initInvalidEmailsPopup:function(t){this.data.invalidEmails=t.invalid_member_emails;var e=t.invalid_members,i=t.invalid_import_url,s=_.findAll(this.data.invalidEmails,function(t){return 0===t.trim().length}).length;this.data.invalidEmails=_.uniq(this.data.invalidEmails);var n=1===s?"email":"emails";if(e>0){var o=_.inject(this.data.invalidEmails,function(t,e){var i=0===e.trim().length?"<span class='subtle'>"+s+" empty "+n+"</span>":e;return t+=Mimi.Audience.Dashboard.Add.INVALID_EMAIL_ITEM_TEMPLATE({email:i})},""),a=Mimi.Audience.Dashboard.Add.INVALID_EMAILS_TEMPLATE({items:o}),r=null;r=e>=25&&i.trim().length>0?Mimi.Audience.Dashboard.Add.INVALID_EMAIL_CONTAINER_WITH_DOWNLOAD({invalid_emails:a,url:i}):Mimi.Audience.Dashboard.Add.INVALID_EMAIL_CONTAINER({invalid_emails:a}),this.invalidEmailsDialog=new Widget.Dialog(I18n.t("MimiFlash.audience.dashboard_add.initInvalidEmailsPopup"),r)}},tryDisplayInvalidEmails:function(){return"invalidImportLink"===t(this).data("value")?(this.invalidEmailsDialog.show(),!1):void 0},voiceUploadSuccessDetails:function(t){var e=t.new_members,i=t.existing_members,s=t.invalid_members,n=t.invalid_import_url,o=e+i,a="I added "+o+" "+this.pluralizePerson(o,"")+"; ";if(a+=e+" "+this.pluralizePerson(e,"")+" "+this.wasWere(e)+" new;",i>0&&(a+=" and "+i+" "+this.pluralizePerson(i,"")+" existed and "+this.wasWere(i)+" updated."),s>0){var r=1===s?"email address":"email addresses",l="<br>There "+this.wasWere(s)+" ";a+=l+'<a href="'+n+'" data-value="invalidImportLink"> '+s+" invalid</a> "+r+"."}Widget.MimiFlash.sticky(a)},pluralizePerson:function(t,e){return 1===t?e+" person":e+" people"},wasWere:function(t){return 1===t?"was":"were"}}).singleton("fileSelected","addSuccess"),_.extend(Mimi.Audience.Dashboard.Add,{INVALID_EMAILS_TEMPLATE:_.template("<ul class='items'>#{items}</ul>"),INVALID_EMAIL_ITEM_TEMPLATE:_.template('<li><span class="email">#{email}</span></li>'),INVALID_EMAIL_CONTAINER:_.template("<div>#{invalid_emails}</div>"),INVALID_EMAIL_CONTAINER_WITH_DOWNLOAD:_.template('<div>#{invalid_emails}</div><p class="actions"><span class="align-center"><a href="#{url}" class="btn back">Download</a></span></p>')}),Mimi.Audience.Dashboard.Add.DOM={tabs:"#audience_add_tabs",addMany:{form:"#add_contacts_many form",iframe:"#add_contacts_many iframe",paste:"#add_contact_paste",listSelect:"#add_contacts_many .audience_list_select",submit:"#add_contacts_many .actions button.primary"},addOne:{form:"#add_contacts_one form",name:"#add_contact_name",email:"#add_contact_email",listSelect:"#add_contacts_one .audience_list_select",submit:"#add_contacts_one .actions button.primary"}}}(jQuery),function(t){Mimi.Audience.DashboardAddExplanationDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("#dashboard_add_explanation_dialog"),this.dom=this.$element.getChildren(Mimi.Audience.DashboardAddExplanationDialog.DOM),this.initDialog(),this.initObservers()},initObservers:function(){this.$element.on("click","a.submit",_.bind(this.onSubmitClick,this)),t("input:checkbox.source").on("click",_.bind(this.onCheckboxClick,this)),t(".stack_input").on("keyup",function(e){t(e.target).removeClass("error")})},initDialog:function(){this.dialog=new Widget.Popup("#dashboard_add_explanation_dialog",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1})},onCheckboxClick:function(e){var i=t(e.target).data("value");if("webform"==i||"other"==i){this.removeErrors();var s=t("#"+i+"_input");t(e.target).is(":checked")?(s.slideDown(),s.children(".stack_input").focus()):s.slideUp()}t(".source:checkbox:checked").length>0?this.dom.$submitButton.removeClass("disabled"):this.dom.$submitButton.addClass("disabled")},onSubmitClick:function(){return this.formValidation()&&(this.fire("audience:upload:explained",{source:this.getCompleteSource()}),this.dialog.hide(),t("input:checkbox.source").prop("checked",!1),this.dom.$submitButton.addClass("disabled"),this.removeErrors()),!1},formValidation:function(){var t=this.validateInput("webform"),e=this.validateInput("other");return t&&e},validateInput:function(e){if(t("#"+e+":checkbox").is(":checked")){var i=t("#"+e+"_input").children(".stack_input");if(""==i.val().trim())return i.addClass("error"),!1}return!0},removeErrors:function(){this.dom.$webformInput.children(".stack_input").removeClass("error"),this.dom.$otherInput.children(".stack_input").removeClass("error")},getCompleteSource:function(){var e=t(".source:checkbox:checked"),i=[];return _.each(e,function(e){var s=t(e).data("support-value");"webform"==t(e).data("value")?s+=" "+this.dom.$webformInput.children(".stack_input").val():"other"==t(e).data("value")&&(s=this.dom.$otherInput.children(".stack_input").val()),i.push(s)},this),i},show:function(){this.dialog.show()}}).singleton(),Mimi.Audience.DashboardAddExplanationDialog.DOM={webformInput:"#webform_input",otherInput:"#other_input",submitButton:"a.submit"}}(jQuery),function(t){Mimi.Audience.Dashboard.List=Class.create({initialize:function(){this.$element=t("#audience_result_list"),this.dom=this.$element.getChildren(Mimi.Audience.Dashboard.List.DOM),this.initData(),this.initObservers(),this.initDialogs()},initData:function(){this.previousCheckedCount=0,this.rowListSelect=new Mimi.AudienceListSelect(this.dom.$rowListSelect[0],{itemTextTemplate:Mimi.AudienceListSelect.ITEM_TEXT_FORMAT_WITH_SPAN_TEMPLATE,keepStartText:!0}),this.data={addToList:{id:null,email:null,listName:null}},this.group=null},initObservers:function(){this.dom.$memberRows.on("click",_.bind(this.onMemberRowClick,this)),this.dom.$checkAll.on("click",_.bind(this.onCheckAllClick,this)),this.rowListSelect.observe("dropdown:item:selected",_.bind(this.onListSelected,this)),this.rowListSelect.observe("audience_list:list_created",_.bind(this.onListCreated,this)),t(document).on("audience:search:loading",_.bind(this.onSearchLoading,this)),t(document).on("audience:getAudienceMembers:loaded",_.bind(this.onSearchLoaded,this)),t(document).on("group:selected",_.bind(this.onGroupSelected,this)),t(document).on("group:unselected",_.bind(this.onGroupUnselected,this))},initDialogs:function(){this.confirmDeleteDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onDeleteMemberOk,this)}),this.confirmRemoveDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onRemoveFromListOk,this)}),this.confirmUnconfirmedDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onConfirmUnconfirmedOk,this)}),this.confirmSuppressDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onSuppressOk,this)}),this.confirmUnsuppressDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onUnsuppressOk,this)}),this.confirmAddToListDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onAddToListOk,this)})},onMemberRowClick:function(e){var i=t(e.target).findElement("a");return i[0]?this.triggerRowAction(i,e):this.possibleCheckCountChanged()},onCheckAllClick:function(){this.checkAll(this.dom.$checkAll.prop("checked"))},onListCreated:function(t,e){return this.data.addToList.listName=e.name,this.showConfirmAddToList(),!1},onListSelected:function(e,i){var s=t(i.element),n=s.find("span.name");this.data.addToList.listName=n.html().trim(),this.showConfirmAddToList()},showConfirmAddToList:function(){var t=_.template(I18n.t("MimiFlash.audience.dashboard_list.showConfirmAddToList.title")),e=_.template(I18n.t("MimiFlash.audience.dashboard_list.showConfirmAddToList.body")),i=t({email:this.data.addToList.email}),s=e({email:this.data.addToList.email});this.confirmAddToListDialog.show(i,s)},onAddToListOk:function(){this.data.addToList.listName&&this.addToList([this.data.addToList.id],this.data.addToList.listName)},addToList:function(e,i){if(e&&i){var s={"members[]":e,add_list:i,whole_list:!1};this.hideControls(),t.post(Mimi.Audience.Dashboard.Bulk.PATHS.addPath,s).done(_.bind(this.onAddToListSuccess,this)).fail(_.bind(this.onAddToListFailed,this)).always(_.bind(this.showControls,this))}},onAddToListSuccess:function(e){if(e.success){t(document).trigger("audience:list_count:updated",e.result);var i=_.template(I18n.t("MimiFlash.audience.dashboard_list.showConfirmAddToList.onAddToListSuccess.success")),s=i({email:this.data.addToList.email,list:this.data.addToList.listName});Widget.MimiFlash.create(s),Mimi.AudienceListSelect.addOrUpdateItem(e.result.list)}else{var n=_.template(I18n.t("MimiFlash.audience.dashboard_list.showConfirmAddToList.onAddToListFailed")),o=n({email:this.data.addToList.email,list:this.data.addToList.listName});Widget.MimiFlash.error(o+"\n"+e.error)}},onAddToListFailed:function(){var t=_.template(I18n.t("MimiFlash.audience.dashboard_list.showConfirmAddToList.onAddToListFailed")),e=t({email:this.data.addToList.email,list:this.data.addToList.listName});Widget.MimiFlash.error(e)},showRowListSelect:function(){this.rowListSelect.clearSelection(),this.rowListSelect.show()},hideRowListSelect:function(){this.rowListSelect.hide()},hideControls:function(){this.hideRowListSelect(),Mimi.Audience.Dashboard.Bulk.hideControls()},showControls:function(){this.hideRowListSelect(),Mimi.Audience.Dashboard.Bulk.showControls()},triggerRowAction:function(e,i){var s=e.detectClass("add","delete","edit","list-remove","unsuppress","accepted","suppress"),n=e.data("value"),o=e.data("email");switch(s){case"delete":return this.deleteMember(n,o),!1;case"suppress":return this.suppressMember(n,o),!1;case"list-remove":return this.removeFromList(n,o),!1;case"unsuppress":return this.unsuppress(n,o),!1;case"add":var a=t(i.target).findElement("a")[0];return this.showAddToList(n,o,a),!1;case"accepted":return this.confirmUnconfirmed(n,o),!1}},showAddToList:function(t,e,i){this.data.addToList.id=t,this.data.addToList.email=e,this.rowListSelect.options.anchor=i,this.showRowListSelect()},deleteMember:function(t,e){this.deleteMember.data={id:t,email:e};var i=_.template(I18n.t("MimiFlash.audience.dashboard_list.deleteMember.title")),s=i({email:e}),n=_.template(I18n.t("MimiFlash.audience.dashboard_list.deleteMember.confirm")),o=n({email:e});this.confirmDeleteDialog.show(s,o+"<p class='info'>"+I18n.t("MimiFlash.audience.dashboard_list.deleteMember.info")+"</p>")},onDeleteMemberOk:function(){var e=t("#audience_member_row_"+this.deleteMember.data.id),i=e.find("a.delete").attr("href")+".json";e.fadeSlide();var s=t.ajax({url:i,type:"DELETE"}).done(_.bind(this.onDeleteSuccess,this)).fail(_.bind(this.onDeleteFailure,this));s.data=this.deleteMember.data},onDeleteSuccess:function(e,i,s){var n=t("#audience_member_row_"+s.data.id);if(e.success)n.remove(),this.possibleCheckCountChanged(),t(document).trigger("audience:list_count:bulk_updated",{lists:e.result.lists});else{var o=_.template(I18n.t("MimiFlash.audience.dashboard_list.onDeleteSuccess")+"\n"),a=o({email:s.request.data.email});Widget.MimiFlash.error(a+e.error),n.appearSlide()}},onDeleteFailure:function(e){t("#audience_member_row_"+e.data.id).appearSlide(),Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_list.onDeleteFailure"))},removeFromList:function(t,e){this.removeFromList.data={id:t,email:e};var i=_.template(I18n.t("MimiFlash.audience.dashboard_list.removeFromList.title")),s=i({email:e}),n=_.template(I18n.t("MimiFlash.audience.dashboard_list.removeFromList.confirm")),o=n({email:e});this.confirmRemoveDialog.show(s,o+"<p class='info'>"+I18n.t("MimiFlash.audience.dashboard_list.removeFromList.info")+"</p>")},confirmUnconfirmed:function(t,e){this.removeFromList.data={id:t,email:e};var i=_.template(I18n.t("MimiFlash.audience.dashboard_list.confirmUnconfirmed.title")),s=i({email:e}),n=_.template(I18n.t("MimiFlash.audience.dashboard_list.confirmUnconfirmed.confirm")),o=n({email:e});this.confirmUnconfirmedDialog.show(s,o+"<br><br>"+I18n.t("MimiFlash.audience.dashboard_list.confirmUnconfirmed.info"))},unsuppress:function(t,e){this.removeFromList.data={id:t,email:e};var i=_.template(I18n.t("MimiFlash.audience.dashboard_list.unsuppress.title")),s=i({email:e}),n=_.template(I18n.t("MimiFlash.audience.dashboard_list.unsuppress.confirm")),o=n({email:e});this.confirmUnsuppressDialog.show(s,o+"<br><br>"+I18n.t("MimiFlash.audience.dashboard_list.unsuppress.info"))},suppressMember:function(t,e){this.suppressMember.data={id:t,email:e};var i=_.template(I18n.t("MimiFlash.audience.dashboard_list.suppressMember.title")),s=i({email:e}),n=_.template(I18n.t("MimiFlash.audience.dashboard_list.suppressMember.confirm")),o=n({email:e});this.confirmSuppressDialog.show(s,o)},onSuppressOk:function(){var e=t("#audience_member_row_"+this.suppressMember.data.id),i=e.find("a.suppress").attr("href");e.fadeSlide();var s=t.post(i,{audience_list:Mimi.Audience.Data.listId}).done(_.bind(this.onSuppressSuccess,this)).fail(_.bind(this.onSuppressFailure,this));s.data=this.suppressMember.data},onSuppressSuccess:function(e,i,s){var n=t("#audience_member_row_"+s.data.id);if(e.success)n.remove(),this.possibleCheckCountChanged(),t(document).trigger("audience:list_count:bulk_updated",{lists:e.result.lists});else{var o=_.template(I18n.t("MimiFlash.audience.dashboard_list.onSuppressSuccess.fail")),a=o({email:s.request.data.email});Widget.MimiFlash.error(a+"\n"+s.responseJSON.error),n.appearSlide()}},onSuppressFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_list.onSuppressFailure"))},isSignupsList:function(){return"signups"===Mimi.Audience.Data.listId?!0:!1},toggleConfirmUI:function(t,e){e?(t.find("a.accepted").show(),t.find("span.unconfirmed").show()):(t.find("a.accepted").hide(),t.find("span.unconfirmed").hide())},onUnsuppressOk:function(){var e=t("#audience_member_row_"+this.removeFromList.data.id),i=e.find("a.unsuppress").attr("href");e.fadeSlide();var s=t.ajax({url:i,type:"delete",data:{audience_list:Mimi.Audience.Data.listId}}).done(_.bind(this.onUnsuppressSuccess,this)).fail(_.bind(this.onUnsuppressFailure,this));s.data=this.removeFromList.data},onUnsuppressSuccess:function(e,i,s){var n=t("#audience_member_row_"+s.data.id),o=_.template(I18n.t("MimiFlash.audience.dashboard_list.onUnsuppressSuccess.fail")),a=o({email:s.request.data.email});e.success?(n.remove(),this.possibleCheckCountChanged()):(Widget.MimiFlash.error(a+"\n"+e.error),n.appearSlide())},onUnsuppressFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_list.onUnsuppressFailure"))},onRemoveFromListOk:function(){var e=t("#audience_member_row_"+this.removeFromList.data.id),i="";this.isSignupsList()?(i=e.find("a.accepted").attr("href"),this.toggleConfirmUI(e,!1)):(i=e.find("a.list-remove").attr("href"),e.fadeSlide());var s={list_context:Mimi.Audience.Data.listId,remove_type:"remove",whole_list:!1,"members[]":this.removeFromList.data.id,query:""};this.group&&(s.group=this.group);var n=t.post(Mimi.Audience.Dashboard.Bulk.PATHS.bulkRemovePath,s).done(_.bind(this.onRemoveFromListSuccess,this)).fail(_.bind(this.onRemoveFromListFailure,this));n.data=this.removeFromList.data},onConfirmUnconfirmedOk:function(){var e=t("#audience_member_row_"+this.removeFromList.data.id),i="";i=e.find("a.accepted").attr("href"),this.toggleConfirmUI(e,!1);var s=t.ajax({url:i,type:"delete",data:{audience_list:Mimi.Audience.Data.listId}}).done(_.bind(this.onConfirmUnconfirmedSuccess,this)).fail(_.bind(this.onConfirmUnconfirmedFailure,this));s.data=this.removeFromList.data},onConfirmUnconfirmedSuccess:function(e,i,s){var n=t("#audience_member_row_"+s.data.id);if(e.success)this.possibleCheckCountChanged();else{var o=_.template(I18n.t("MimiFlash.audience.dashboard_list.onConfirmUnconfirmedSuccess")),a=o({email:s.request.data.email,error:"\n"+e.error});Widget.MimiFlash.error(a),n[0]&&(this.toggleConfirmUI(n,!0),n.appearSlide())}},onConfirmUnconfirmedFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_list.onConfirmUnconfirmedFailure"))},onRemoveFromListSuccess:function(e,i,s){var n=t("#audience_member_row_"+s.data.id);if(e.success)this.isSignupsList()||n.remove(),t(document).trigger("audience:list_count:updated",e.result),this.possibleCheckCountChanged();else{var o=_.template(I18n.t("MimiFlash.audience.dashboard_list.onRemoveFromListSuccess")),a=o({email:s.request.data.email,listName:e.error});Widget.MimiFlash.error(a),n[0]&&(this.isSignupsList()?this.toggleConfirmUI(n,!0):n.appearSlide())}},onRemoveFromListFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_list.onRemoveFromListFailure"))},onSearchLoading:function(){this.dom.$mimiVoice.is(":visible")&&(this.dom.$mimiVoice.hide(),t(".jump_in").hide())},onSearchLoaded:function(e,i){if(this.isSignupsList()){var s=i.audience_members,n=this;_.each(s,function(e){if(!e.suppressed){var i=t("#audience_member_row_"+e.id);n.toggleConfirmUI(i,!1)}})}},checkAll:function(e){this.dom.$checkAll.prop("checked",e),this.dom.$memberRows.find("input[type=checkbox]").prop("checked",e),this.previousCheckedCount=this.countChecked(),t(document).trigger("audience_list:itemChecked",{checkedCount:this.previousCheckedCount})},countChecked:function(){return t("#audience_member_rows input[type=checkbox]:checked").size()},possibleCheckCountChanged:function(){var e=this.countChecked();e!==this.previousCheckedCount&&(this.previousCheckedCount=e,t(document).trigger("audience_list:itemChecked",{checkedCount:this.previousCheckedCount})),this.dom.$checkAll.prop("checked",e===this.dom.$memberRows.find("input[type=checkbox]").length&&0!==e)},onGroupSelected:function(t,e){this.group=e.group},onGroupUnselected:function(){this.group=null}}).singleton("checkAll"),Mimi.Audience.Dashboard.List.DOM={checkAll:"#contacts_check_all",memberRows:"#audience_member_rows",mimiVoice:"section.mimi_voice_main",rowListSelect:"#row_list_select"}}(jQuery),function(t){Mimi.Audience.Dashboard.Bulk=Class.create({initialize:function(){this.$element=t("#main"),this.dom=this.$element.getChildren(Mimi.Audience.Dashboard.Bulk.DOM),this.data={listId:null,addList:{listName:null,listId:null}},this.wholeList=!1,this.suppressionReason="",this.audiencePage=1,this.lastDeletedAudienceMember=null,this.bulkRemoveType="remove",this.group=null,this.loadingBlock=new Widget.BlockOverlay({cover:this.dom.$memberRows[0]}),this.dom.$chooseList[0]&&(this.listChooser=new Mimi.AudienceListSelect(this.dom.$chooseList[0],{keepStartText:!0})),this.confirmAddDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onAddToListConfirmed,this)}),this.bulkRemoveConfirmDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onBulkRemoveConfirmed,this)}),this.bulkConfirmConfirmDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onBulkConfirmConfirmed,this)}),this.bulkDeleteConfirmDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onBulkDeleteConfirmed,this)}),this.bulkUnsuppressDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onBulkUnsuppressConfirmed,this)}),this.confirmExportDialog=new Mimi.ExportFormatDialog,this.initializeObservers()},initializeObservers:function(){this.dom.$selectAll.on("click",_.bind(this.toggleWholeList,this)),t(document).on("suppression_reason:selected",_.bind(this.onSuppressionReasonSelected,this)),t(document).on("suppression_reason:unselected",_.bind(this.onSuppressionReasonUnselected,this)),t(document).on("audience_list:unchecked",_.bind(this.forceNotWholeList,this)),t(document).on("audience_list:itemChecked",_.bind(this.toggleBulkControls,this)),t(document).on("dashboard:audience:inserted",_.bind(this.forceNotWholeList,this)),t(document).on("dashboard:audience:appended",_.bind(this.updateChecked,this)),t(document).on("audience_list:context_changed",_.bind(this.onListContextChanged,this)),t(document).on("suppression_reason:selected",_.bind(this.onListContextChanged,this)),t(document).on("suppression_reason:unselected",_.bind(this.onListContextChanged,this)),t(document).on("audience_list:selected",_.bind(this.updateListId,this)),t(document).on("audience_list:selected:automatic_list",_.bind(this.updateListId,this)),t(document).on("group:selected",_.bind(this.onGroupSelected,this)),t(document).on("group:unselected",_.bind(this.onGroupUnselected,this)),this.listChooser&&(this.listChooser.observe("audience_list:list_created",_.bind(this.onAddToCreatedList,this)),this.listChooser.observe("dropdown:item:selected",_.bind(this.onAddToExistingList,this))),t(document).on("audience:getAudienceMembers:loaded",_.bind(this.respondMembersLoaded,this)),this.dom.$exportContactsBtn.on("click",_.bind(this.confirmExport,this)),this.dom.$primaryExportContacts.on("click",_.bind(this.confirmedExport,this)),this.dom.$deleteContacts.on("click",_.bind(this.confirmBulkDelete,this)),this.dom.$confirmContacts.on("click",_.bind(this.confirmBulkConfirm,this)),this.dom.$removeContacts.on("click",_.bind(this.confirmBulkRemove,this)),this.dom.$unsuppressContacts.on("click",_.bind(this.confirmBulkUnsuppress,this)),this.dom.$memberRows.on("click",_.bind(this.onMemberRowClick,this)),this.dom.$dialog.find(".actions").on("click",_.bind(this.onActionClick,this))},onActionClick:function(e){var i=t(e.currentTarget).closest(".back");return i[0]?(this.confirmExportDialog.hide(),!1):void 0},getSearchString:function(){return this.dom.$audienceSearch.val().trim()},onMemberRowClick:function(){this.dom.$memberRows.find('input[type="checkbox"]').each(_.bind(function(t,e){return e.checked?void 0:(this.dom.$selectAll.prop("checked",!1),this.wholeList=!1,void this.dom.$wholeListSelected.hide())},this))},onListContextChanged:function(t,e){this.dom.$audienceSearch.val(""),this.forceNotWholeList(),this.hideOrShowBulkControls(0),this.hideOrShowExportbtn(parseInt(e.listId,10))},onSuppressionReasonSelected:function(t,e){this.suppressionReason=e.reason},onSuppressionReasonUnselected:function(){this.suppressionReason=""},getSuppressionReason:function(){return this.isSuppressionList()?this.suppressionReason:""},updateListId:function(t,e){this.data.listId=e.id},updateChecked:function(){(this.dom.$selectAll.prop("checked")||this.dom.$checkAll.prop("checked"))&&Mimi.Audience.Dashboard.List.checkAll(!0)},toggleBulkControls:function(t,e){var i=e.checkedCount;this.hideOrShowBulkControls(i)},hideOrShowExportbtn:function(t){var e=Mimi.Audience.Dashboard.canExport(t);e?this.dom.$exportContactsBtn.show():this.dom.$exportContactsBtn.hide()},hideOrShowBulkControls:function(e){var i=this.dom.$bulkControls.is(":visible");e>0&&!i?(t("#audience_results .controls").hide(),this.dom.$bulkControls.show()):0===e&&i&&(t("#audience_results .controls").show(),this.forceNotWholeList(),this.dom.$bulkControls.hide(),this.dom.$audienceSearch.show())},respondMembersLoaded:function(){this.wholeList&&Mimi.Audience.Dashboard.List.checkAll(this.wholeList)},forceNotWholeList:function(){this.wholeList=!1,this.dom.$wholeListInput.val(this.wholeList),this.toggleWholeListSelectionMessage(),this.dom.$checkAll.prop("checked",!1),this.dom.$selectAll.prop("checked",!1)},toggleWholeList:function(){this.wholeList=this.wholeList?!1:!0,this.wholeList&&Mimi.Audience.Dashboard.List.checkAll(this.wholeList),this.toggleWholeListSelectionMessage(),this.dom.$wholeListInput.val(this.wholeList)},toggleWholeListSelectionMessage:function(){this.dom.$wholeListSelected[this.wholeList?"show":"hide"]()},onAddToCreatedList:function(t,e){return this.checkSelectedAudienceMembers()!==!1?(this.data.addList.listName=e.name,this.data.addList.listId=null,this.confirmAddToList(),!1):void 0},onAddToExistingList:function(e,i){if(this.checkSelectedAudienceMembers()!==!1){var s=t(i.element),n=s.data("value"),o=s.find("span.name");
return i.source.$element[0]!==this.listChooser.$element[0]?!1:(this.data.addList.listName=o.html().trim(),this.data.addList.listId=n,this.confirmAddToList(),!1)}},confirmAddToList:function(){var t=_.template(I18n.t("MimiFlash.audience.dashboard_bulk.confirmAddToList.title")),e=t({list_name:this.data.addList.listName}),i=_.template(I18n.t("MimiFlash.audience.dashboard_bulk.confirmAddToList.body")),s=i({list_name:this.data.addList.listName});this.confirmAddDialog.show(e,s)},onAddToListConfirmed:function(){var t=this.checkSelectedAudienceMembers();this.addToList(t)},checkSelectedAudienceMembers:function(t){var e=this.selectedAudienceMembers();return t||this.wholeList||0!==_.size(e)?e:(Widget.MimiFlash.create(I18n.t("MimiFlash.audience.dashboard_bulk.checkSelectedAudienceMembers")),!1)},addToList:function(e){if(e!==!1&&null!==this.data.addList.listName){var i={"members[]":e,whole_list:this.wholeList,query:this.getSearchString()};this.data.addList.listId?i.audience_list=this.data.addList.listId:i.add_list=this.data.addList.listName,null!==this.data.listId&&(i.list_context=this.data.listId),this.group&&(i.group=this.group),this.hideControls(),t.post(Mimi.Audience.Dashboard.Bulk.PATHS.addPath,i).done(_.bind(this.onAddToListSuccess,this)).fail(_.bind(this.onAddToListFailed,this)).always(_.bind(this.showControls,this))}},onAddToListSuccess:function(e){if(e.success){var i=e.result,s=I18n.t(1===i.number_members_added?"MimiFlash.audience.dashboard_bulk.onAddToListSuccess.audience_member":"MimiFlash.audience.dashboard_bulk.onAddToListSuccess.audience_members");t(document).trigger("audience:list_count:updated",i);var n=_.template(I18n.t("MimiFlash.audience.dashboard_bulk.onAddToListSuccess.message")),o=i.number_members_added+" "+s,a=this.data.addList.listName,r=n({addition:o,list:a});Widget.MimiFlash.create(r),Mimi.AudienceListSelect.addOrUpdateItem(e.result.list)}else{var l=_.template(I18n.t("MimiFlash.audience.dashboard_bulk.onAddToListSuccess.fail")),d=l({list:this.data.addList.listName});Widget.MimiFlash.error(d+"\n"+e.error)}},onAddToListFailed:function(){var t=_.template(I18n.t("MimiFlash.audience.dashboard_bulk.onAddToListFailed")),e=t({list:this.data.addList.listName});Widget.MimiFlash.error(e)},confirmBulkRemove:function(){var t=this.humanizedNumberOfSelectedAudienceMembers(),e=_.template(I18n.t("MimiFlash.audience.dashboard_bulk.confirmBulkRemove.confirm_q")),i=e({message:t});return this.bulkRemoveConfirmDialog.show(I18n.t("MimiFlash.audience.dashboard_bulk.confirmBulkRemove.remove"),i+'<p class="info">'+I18n.t("MimiFlash.audience.dashboard_bulk.confirmBulkRemove.info")+"</p>"),!1},confirmBulkUnsuppress:function(){return this.bulkUnsuppressDialog.show(I18n.t("MimiFlash.audience.dashboard_bulk.confirmBulkUnsuppress.unsuppress"),I18n.t("MimiFlash.audience.dashboard_bulk.confirmBulkUnsuppress.confirm")),!1},onBulkRemoveConfirmed:function(){if(null!==this.data.listId){var e=this.checkSelectedAudienceMembers();if(e!==!1){_.each(e,function(e){t("#audience_member_row_"+e).hide()});var i={whole_list:this.wholeList,remove_type:this.bulkRemoveType,list_context:this.data.listId,"members[]":e,query:this.getSearchString()};this.group&&(i.group=this.group);var s=Mimi.Audience.Dashboard.Bulk.PATHS.bulkRemovePath;this.isSuppressionList()&&(s=Mimi.Audience.Dashboard.Bulk.PATHS.bulkSoftBounceRemovePath),t.post(s,i).done(_.bind(this.onBulkRemoveSuccess,this)).fail(_.bind(this.onBulkRemoveFailure,this)),Mimi.Audience.Dashboard.List.checkAll(!1)}}},isSuppressionList:function(){return"suppressed"===this.data.listId},isSignupsList:function(){return"signups"===this.data.listId},onBulkRemoveFailure:function(){this.unhideMembers(),Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_bulk.onBulkRemoveFailure"))},onBulkRemoveSuccess:function(e){e.success?(this.hideOrShowBulkControls(0),t(document).trigger("audience:list_count:updated",e.result),t(document).trigger("audience_list:force_reload")):(this.unhideMembers(),Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_bulk.onBulkRemoveSuccess")+"\n"+e.error))},confirmBulkConfirm:function(){return this.bulkConfirmConfirmDialog.show(I18n.t("MimiFlash.audience.dashboard_bulk.confirmBulkConfirm.title"),I18n.t("MimiFlash.audience.dashboard_bulk.confirmBulkConfirm.body")),!1},confirmBulkDelete:function(){var t=this.humanizedNumberOfSelectedAudienceMembers(),e=_.template(I18n.t("MimiFlash.audience.dashboard_bulk.confirmBulkDelete.confirm_q")),i=e({message:t});return this.bulkDeleteConfirmDialog.show(I18n.t("MimiFlash.audience.dashboard_bulk.confirmBulkDelete.title"),i+"<p class='info'>"+I18n.t("MimiFlash.audience.dashboard_bulk.confirmBulkDelete.info")+"</p>"),!1},onBulkUnsuppressConfirmed:function(){var e=this.checkSelectedAudienceMembers();if(e!==!1){_.each(e,function(e){var i=t("#audience_member_row_"+e);i.hide()});var i={whole_list:this.wholeList,list_context:this.data.listId,"members[]":e,query:this.getSearchString(),suppression_reason:this.suppressionReason};this.group&&(i.group=this.group),t.ajax({url:Mimi.Audience.Dashboard.Bulk.PATHS.bulkConfirmPath,data:i,type:"put"}).done(_.bind(this.onBulkUnsuppressSuccess,this)).fail(_.bind(this.onBulkUnsuppressFailure,this))}},onBulkUnsuppressFailure:function(){this.unhideMembers(),Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_bulk.onBulkUnsuppressFailure"))},onBulkUnsuppressSuccess:function(e){if(e.success){var i="";if(1===e.result)i=I18n.t("MimiFlash.audience.dashboard_bulk.onBulkUnsuppressSuccess.member");else{var s=_.template(I18n.t("MimiFlash.audience.dashboard_bulk.onBulkUnsuppressSuccess.members"));i=s({number:e.result})}Widget.MimiFlash.create(i),this.hideOrShowBulkControls(0),t(document).trigger("audience_list:force_reload")}else this.unhideMembers(),Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_bulk.onBulkUnsuppressSuccess.fail")+"\n"+e.error)},onBulkConfirmConfirmed:function(){var e=this.checkSelectedAudienceMembers();if(e!==!1){_.each(e,function(e){var i=t("#audience_member_row_"+e);i.hide()});var i={whole_list:this.wholeList,list_context:this.data.listId,"members[]":e,suppression_reason:this.suppressionReason,query:this.getSearchString()};this.group&&(i.group=this.group),t.ajax({url:Mimi.Audience.Dashboard.Bulk.PATHS.bulkConfirmPath,data:i,type:"put"}).done(_.bind(this.onBulkConfirmSuccess,this)).fail(_.bind(this.onBulkConfirmFailure,this))}},onBulkConfirmFailure:function(){this.unhideMembers(),Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_bulk.onBulkConfirmFailure"))},onBulkConfirmSuccess:function(e){if(e.success){var i="";if(1===e.result)i=I18n.t("MimiFlash.audience.dashboard_bulk.onBulkConfirmSuccess.member");else{var s=_.template(I18n.t("MimiFlash.audience.dashboard_bulk.onBulkConfirmSuccess.members"));i=s({number:e.result})}Widget.MimiFlash.create(i),this.hideOrShowBulkControls(0),t(document).trigger("audience_list:force_reload")}else this.unhideMembers(),Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_bulk.onBulkConfirmSuccess.fail")+"\n"+e.error)},onBulkDeleteConfirmed:function(){var e=this.checkSelectedAudienceMembers();if(e!==!1){_.each(e,function(e){t("#audience_member_row_"+e).hide()});var i=this.data.listId;"all"===i&&(i=null);var s={whole_list:this.wholeList,list_context:i,"members[]":e,query:this.getSearchString()};this.group&&(s.group=this.group),t.post(Mimi.Audience.Dashboard.Bulk.PATHS.bulkDeletePath,s).done(_.bind(this.onBulkDeleteSuccess,this)).fail(_.bind(this.onBulkDeleteFailure,this)),Mimi.Audience.Dashboard.List.checkAll(this.wholeList)}},onBulkDeleteFailure:function(){this.unhideMembers(),Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_bulk.onBulkDeleteFailure"))},onBulkDeleteSuccess:function(e){if(e.success){var i=e.result.members_deleted;if(1===e.result.members_deleted)i=I18n.t("MimiFlash.audience.dashboard_bulk.onBulkDeleteSuccess.member");else{var s=_.template(I18n.t("MimiFlash.audience.dashboard_bulk.onBulkDeleteSuccess.members"));i=s({number:e.result.members_deleted})}Widget.MimiFlash.create(i);var n=e.result;n.listId=this.data.listId||"all",t(document).trigger("audience_list:force_reload"),t(document).trigger("audience:list_count:bulk_updated",n),_.each(e.result.lists,function(t){Mimi.AudienceListSelect.addOrUpdateItem(t)}),this.hideOrShowBulkControls(0)}else this.unhideMembers(),Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_bulk.onBulkDeleteSuccess.fail")+"\n"+e.error)},confirmExport:function(){return this.confirmExportDialog.show(),!1},confirmedExport:function(){var e=!0,i=this.checkSelectedAudienceMembers(e);i===!1&&(i="");var s=this.wholeList;this.wholeList===!1&&""===i&&(s=!0);var n=null===this.data.listId?"all":this.data.listId,o=_.template(Mimi.Audience.Dashboard.Bulk.PATHS.exportPath)({id:n}),a=this.confirmExportDialog.selectedFormat(),r={whole_list:s,"audience_member_ids[]":i,query:this.getSearchString(),suppression_reason:this.getSuppressionReason(),exportType:a};this.group&&(r.group=this.group),this.confirmExportDialog.hide(),t.post(o,r).done(function(){Widget.MimiFlash.create(I18n.t("MimiFlash.audience.dashboard_bulk.confirmedExport.onSuccess.start")+"\n"+I18n.t("MimiFlash.audience.dashboard_bulk.confirmedExport.onSuccess.end"))}).fail(function(){Widget.MimiFlash.error(I18n.t("MimiFlash.audience.dashboard_bulk.confirmedExport.onFailure"))})},hideControls:function(){this.loadingBlock.show()},showControls:function(){this.loadingBlock.hide()},selectedAudienceMembers:function(e){var i="undefined"==typeof e?":visible":e;return _.map(this.dom.$memberRows.find("input.audience_member_row[type=checkbox]:checked"+i),function(e){return t(e).data("value")})},showSelectionBar:function(){this.$element.show()},hideSelectionBar:function(){this.$element.hide()},unhideMembers:function(){_.each(this.selectedAudienceMembers(":hidden"),function(e){t("#audience_member_row_"+e).show()})},getNumberOfSelectedContacts:function(){return this.wholeList?parseInt(this.dom.$audienceListSize.val(),10):this.checkSelectedAudienceMembers().length},humanizedNumberOfSelectedAudienceMembers:function(){var t,e=this.getNumberOfSelectedContacts();return t=1===e?I18n.t("MimiFlash.audience.dashboard_bulk.humanizedNumberOfSelectedAudienceMembers.one"):e+" "+I18n.t("MimiFlash.audience.dashboard_bulk.humanizedNumberOfSelectedAudienceMembers.more")},onGroupSelected:function(t,e){this.group=e.group},onGroupUnselected:function(){this.group=null}}).singleton("hideControls","showControls"),Mimi.Audience.Dashboard.Bulk.DOM={memberRows:"#audience_member_rows",chooseList:"#list_audience_selection_actions .audience_list_select",selectAll:"#select_whole_list",selectionBar:"section.select_whole_list.actions",bulkControls:"#bulk_controls",wholeListSelected:"#entire_list_selected",wholeListInput:"#whole_list",audienceSearch:"#audience_search",deleteContacts:"#delete_contacts",removeContacts:"#remove_contacts",confirmContacts:"#confirm_contacts",unsuppressContacts:"#unsuppress_contacts",checkAll:"#contacts_check_all",audienceListSize:"#audience_list_size",exportContactsBtn:"#export_contacts_button",primaryExportContacts:"#primary_export_contacts",dialog:"#export_format_dialog"},Mimi.Audience.Dashboard.Bulk.PATHS={addPath:"/audience_members/list_add.json",exportPath:"/exports/audience/#{id}.json",bulkRemovePath:"/audience_members/remove_list",bulkDeletePath:"/audience_members/bulk_delete",bulkSoftBounceRemovePath:"/suppressed_audience_members/bulk_unsuppress",bulkConfirmPath:"/suppressed_audience_members/bulk_unsuppress"}}(jQuery),function(t){Mimi.Audience.Dashboard.Upload=Class.create(Widget.Observer,{initialize:function(){this.$element=t("form:eq(0)"),this.dom=this.$element.getChildren(Mimi.Audience.Dashboard.Upload.DOM),this.dom.$file.on("change",_.bind(this.onFileChange,this)),Mimi.Audience.Dashboard.Upload.result&&window.parent.Mimi.Audience.Dashboard.Add.addSuccess(Mimi.Audience.Dashboard.Upload.result)},onFileChange:function(){this.dom.$input.val(this.dom.$file.val()),window.parent.Mimi.Audience.Dashboard.Add.fileSelected()},submit:function(t,e){""!==this.dom.$file.val()&&(this.dom.$audienceList.val(t),this.dom.$addList.val(e),this.$element.submit())},getFileInputSize:function(){var t=this.dom.$file[0].files;return t?t[0].size:-1},getFileExtension:function(){return this.dom.$file.val().split(".").pop().toLowerCase()},fileExists:function(){return""!=this.dom.$file.val()},setSource:function(t){this.dom.$source.val(t)}}).singleton("submit"),Mimi.Audience.Dashboard.Upload.DOM={file:"input[type=file]",input:".combo_input input",audienceList:"input[name=audience_list]",addList:"input[name=add_list]",source:"input[name=source]"}}(jQuery),function(t){Mimi.Audience.Dashboard.ListSelect=Class.create(Widget.Observer,{initialize:function(){this.list=Widget.Select.instances.audience_upload_template,t(document).on("audience_list:add_or_update",_.bind(this.onAddOrUpdateList,this)),this.dom={$buttonText:t(this.list.dom.textSpan),$allItemCount:t(this.list.dom.list).find("a[href=/audience_members] span.count"),$buttonCount:t(this.list.dom.textSpan).find(".count"),$listItems:t(this.list.dom.list)}},onAddOrUpdateList:function(t,e){var i=e.id,s=e.name,n=(e.size||e.count||0).formatThousands(),o=this.getListItemName(i),a=this.getListItemCount(i);o[0]&&a[0]?(o.html(s),a.html(n)):this.dom.$listItems.append(Mimi.Audience.Dashboard.ListSelect.NEW_LIST_TEMPLATE({id:i,name:s,count:n})),Mimi.Audience.Data.listId===i&&this.dom.$buttonText.html(s+"<span class='count'>"+n+"</span>")},incrementAllList:function(t){if(this.dom.$allItemCount[0]){var e=(this.dom.$allItemCount.html().parseInt()+t).formatThousands();this.dom.$allItemCount.html(e),Mimi.Audience.Data.listId||this.dom.$buttonCount.html(e)}},getListItemName:function(t){return this.dom.$listItems.find("a[href=/audience_lists/"+t+"] span.name")},getListItemCount:function(t){return this.dom.$listItems.find("a[href=/audience_lists/"+t+"] span.count")}}).singleton("incrementAllList"),Mimi.Audience.Dashboard.ListSelect.NEW_LIST_TEMPLATE=_.template('<li><a href="/audience_lists/#{id}"><span class="count">#{count}</span> <span class="name hide_overflow">#{name}</span></a></li>')}(jQuery),function(t){t.fn.observeFormChange=function(e,i){return this.each(function(){var s=this,n=!1;t(s.elements).on("keyup",function(){n=!0}),setInterval(function(){n&&i.call(s),n=!1},1e3*e)})},Mimi.Audience.Edit=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#main"),this.dom=this.$element.getChildren(Mimi.Audience.Edit.DOM),this.listSelect=new Mimi.AudienceListSelect(this.dom.$listSelect[0],{keepStartText:!0}),Mimi.Audience.Edit.FieldSelect.get(),this.tabs=new Widget.Tabs(this.dom.$tabs[0],{noState:!0}),this.listItemTemplate=Template.from("list_item_template"),this.fieldTemplate=Template.from("field_template"),this.mailingsLoaded=!1,this.dom.$audienceMemberMailings[0]&&(this.loadingBlock=new Widget.BlockOverlay({cover:this.dom.$audienceMemberMailings[0]}),this.getMailingsTable()),this.initializeObservers()},initializeObservers:function(){this.listSelect.observe("audience_list:list_created",_.bind(this.onAddToNewList,this)),this.listSelect.observe("dropdown:item:selected",_.bind(this.onAddToExistingList,this)),this.dom.$listsList.on("click",_.bind(this.onRemoveFromList,this)),this.dom.$addToList.on("click",_.bind(this.onRemoveFromAddToList,this)),t("#audience_member_suppression_lists_target")[0]&&this.dom.$suppressionLists.on("click",_.bind(this.onUnsuppressFromList,this)),t(document).on("field:selected",_.bind(this.onAddExistingField,this)),t(document).on("field:created",_.bind(this.onAddNewField,this)),this.initializeFormObserver(),this.dom.$submitButton.on("click",_.bind(this.onSubmit,this)),t(Mimi.Audience.Edit.DOM.audienceMemberDetails).on("keydown",_.bind(this.onSubmitKeydown,this)),this.dom.$deleteButton.on("click",_.bind(this.onDelete,this)),this.dom.$suppressButton.on("click",_.bind(this.onSuppress,this)),this.dom.$unsuppressButton.on("click",_.bind(this.onUnsuppress,this)),t(document).on("tab:switched",_.bind(this.onTabSwitched,this)),this.dom.$audienceMemberMailings.on("click",_.bind(this.onPageMailings,this)),t(document).on("audience_list:updated",_.bind(this.onListUpdated,this)),t(document).on("audience_list:destroyed",_.bind(this.onListDestroyed,this))},initializeFormObserver:function(){this.dom.$memberForm.observeFormChange(.5,_.bind(this.onFormChanged,this))},disableFormObserver:function(){this.dom.$memberForm.off("change")},onTabSwitched:function(){this.mailingsLoaded||this.loadingBlock.show()},onPageMailings:function(e){var i=t(e.target).findElement("a"),s=t(e.target).findElement("div.pagination");return i[0]&&s[0]?(this.getMailingsTable(i.attr("href")),!1):void 0},getMailingsTable:function(e){e=e||"/audience_members/"+Mimi.Audience.Data.audienceMemberId+"/mailings_table",t.post(e).done(_.bind(this.onGetMailingsTableSuccess,this)).fail(_.bind(this.onGetMailingsTableFailure,this)).always(_.bind(this.onGetMailingsTableComplete,this)),this.loadingBlock.show()},onGetMailingsTableSuccess:function(t){this.dom.$audienceMemberMailings.html(t)},onGetMailingsTableFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.audience.edit.onGetMailingsTableFailure"))},onGetMailingsTableComplete:function(){this.mailingsLoaded=!0,this.loadingBlock.hide()},onUnsuppress:function(){var t=Mimi.Audience.Data.suppressionReason,e=Mimi.Audience.Dashboard.Add.get().suppressionReasonSentence(t),i=this.suppressionMessage(e);return this.unsuppressConfirmDialog||(this.unsuppressConfirmDialog=new Widget.ConfirmDialog(I18n.t("MimiFlash.audience.edit.onUnsuppress.title"),I18n.t("MimiFlash.audience.edit.onUnsuppress.confirm")+"<p class='info'>"+i+"</p>",{onOk:_.bind(this.onUnuppressOk,this)},I18n.t("MimiFlash.audience.edit.onUnsuppress.button"))),this.unsuppressConfirmDialog.show(),!1},suppressionMessage:function(t){var e=Mimi.Audience.Data.suppressionReason;return e.length>0?t:I18n.t("MimiFlash.audience.edit.suppressionMessage")},onUnuppressOk:function(){this.showSuppress(),t.ajax({url:"/suppressed_audience_members/"+Mimi.Audience.Data.audienceMemberId,type:"DELETE"}).fail(_.bind(this.onUnsuppressFailed,this)).always(_.bind(this.onUnsuppressComplete,this))},onUnsuppressFailed:function(t){Widget.MimiFlash.error(I18n.t("MimiFlash.audience.edit.onUnsuppressFailed")+" "+t),this.showUnsuppress()},onUnsuppressComplete:function(t){t.success===!0?(Widget.MimiFlash.create(t.result.email+" "+I18n.t("MimiFlash.audience.edit.onUnsuppressComplete.success")),this.shuffleAudienceLists(t.result)):(Widget.MimiFlash.error(I18n.t("MimiFlash.audience.edit.onUnsuppressComplete.fail")),this.showUnsuppress())},shuffleAudienceLists:function(e){var i=e.list_unsuppressions;if(i&&i.length){_.each(i,function(e){var i=t("#signup_list_"+e.id).closest("li");i.remove(),t("#audience_member_lists_target").append(i)});var s=t("#audience_member_suppression_lists_target");0===s.children().length&&t("#suppressed_from_label").remove()}},onSuppress:function(){return this.suppressConfirmDialog||(this.suppressConfirmDialog=new Widget.ConfirmDialog(I18n.t("MimiFlash.audience.edit.onSuppress.title"),I18n.t("MimiFlash.audience.edit.onSuppress.info")+"</p>",{onOk:_.bind(this.onSuppressOk,this)})),this.suppressConfirmDialog.show(),!1},onSuppressOk:function(){this.showUnsuppress(),t.post("/suppressed_audience_members",{audience_member_id:Mimi.Audience.Data.audienceMemberId}).fail(_.bind(this.onSuppressFailed,this)).always(_.bind(this.onSuppressComplete,this))},onSuppressComplete:function(t){if(t.success===!0){var e=_.template(I18n.t("MimiFlash.audience.edit.onSuppressComplete.suppressed")),i=e({email:t.result.email});Widget.MimiFlash.create(i)}else{var s=_.template(I18n.t("MimiFlash.audience.edit.onSuppressComplete.fail")),n=s({email:t.result.email});Widget.MimiFlash.error(n),this.showUnsuppress()}},onSuppressFailed:function(t){Widget.MimiFlash.error(I18n.t("MimiFlash.audience.edit.onSuppressFailed")+" "+t),this.showSuppress()},showSuppress:function(){this.dom.$suppressButton.show(),this.dom.$unsuppressButton.hide(),this.dom.$suppressedBanner.hide()},showUnsuppress:function(){this.dom.$suppressButton.hide(),this.dom.$unsuppressButton.show(),this.dom.$suppressedBanner.show()},onAddToExistingList:function(t,e){var i=e.element,s=this.listSelect.getItemData(i);s.id&&(this.listSelect.removeItem(i),this.addToList(s))},onAddToNewList:function(t,e){var i=e.listName;return this.addToList(i),!1},addToList:function(e){this.dom.$addToList.append(this.listItemTemplate(e)),this.dom.$addToListContainer.is(":visible")||this.dom.$addToListContainer.show();var i={type:"hidden",id:"add_list_input_"+e.id,name:"lists[add][]",value:e.id},s=t("<input>").attr(i);this.dom.$memberForm.append(s),this.onFormChanged()},onRemoveFromAddToList:function(e){var i=t(e.target),s=i.parents("li"),n=this.getCurrentListItemData(s),o=t("#add_list_input_"+n.id),a=i.parents("a.remove");if(a[0])return s.remove(),o.remove(),this.listSelect.addOrUpdateItem(n),this.dom.$addToList.children().length||this.dom.$addToListContainer.hide(),!1},onRemoveFromList:function(e){var i=t(e.target),s=i.parents("li"),n=this.getCurrentListItemData(s),o=i.parents("a.remove");if(o[0]){var a;if(s.hasClass("removing"))a=t("#remove_list_input_"+n.id),a.remove(),s.removeClass("removing");else{s.addClass("removing");var r={type:"hidden",id:"remove_list_input_"+n.id,name:"lists[remove][]",value:n.id};a=t("<input>").attr(r),this.dom.$memberForm.append(a)}return this.onFormChanged(),!1}},onUnsuppressFromList:function(e){var i=t(e.target),s=i.parents("li"),n=this.getCurrentListItemData(s),o=i.parents("a.remove");if(o[0]){var a;if(s.hasClass("removing"))a=t("#unsuppress_list_input_"+n.id),a.remove(),s.removeClass("removing");else{s.addClass("removing");var r={type:"hidden",id:"unsuppress_list_input_"+n.id,name:"lists[unsuppress][]",value:n.id};a=t("<input>").attr(r),this.dom.$memberForm.append(a)}return this.onFormChanged(),!1}},onAddExistingField:function(t,e){this.addField(e)},onAddNewField:function(t,e){this.addField(e)},addField:function(e){var i="#audience_field_"+e.id,s=t(i);s[0]||(this.dom.$addField.before(this.fieldTemplate(e)),s=t(i)),s.parents("span").removeClass("hidden"),s.parents("div:eq(0)").show(),s.parents("div:eq(0)").scrollToCenter(),_.delay(_.bind(this.focusField,s),100)},focusField:function(){this.select()},onFormChanged:function(){this.dom.$submitButton.enable()},onSubmitKeydown:function(t){return 13===t.keyCode?this.onSubmit():void 0},onSubmit:function(){var e="/audience_members/update/"+Mimi.Audience.Data.audienceMemberId+".json";return t.post(e,this.dom.$memberForm.serialize()).done(_.bind(this.onSubmitSuccess,this)).fail(_.bind(this.onSubmitFailure,this)),this.dom.$submitButton.disable().html(I18n.t("MimiFlash.audience.edit.onSubmit")),!1},onSubmitSuccess:function(e){if(e.success){this.disableFormObserver();var i=e.result.list_additions,s=e.result.list_removals,n=e.result.list_unsuppressions;if(i&&i.length&&(_.each(i,function(e){var i=t("#list_"+e.id).parents("li"),s=t("#add_list_input_"+e.id);i.remove(),s.remove(),this.dom.$listsList.append(this.listItemTemplate(e))},this),this.dom.$addToListContainer.hide()),s&&s.length&&_.each(s,function(e){var i=t("#signup_list_"+e.id).parents("li"),s=t("#remove_list_input_"+e.id);s.remove(),i.remove(),this.listSelect.addOrUpdateItem(e)},this),n&&n.length){_.each(n,function(e){var i=t("#list_"+e.id).parents("li"),s=t("#unsuppress_list_input_"+e.id);s.remove(),i.removeClass("removing"),t("#audience_member_lists_target").append(i)});var o=t("#audience_member_suppression_lists_target");0===o.children().length&&t("#suppressed_from_label").remove()}this.initializeFormObserver(),Widget.MimiFlash.create(I18n.t("MimiFlash.audience.edit.onSubmitSuccess.notice"))}else Widget.MimiFlash.error(I18n.t("MimiFlash.audience.edit.onSubmitSuccess.error")+"\n"+e.error),this.dom.$submitButton.enable();this.dom.$submitButton.html(I18n.t("MimiFlash.audience.edit.onSubmitSuccess.button"))},onSubmitFailure:function(){this.dom.$submitButton.enable().html(I18n.t("MimiFlash.audience.edit.onSubmitFailure.button")),Widget.MimiFlash.error(I18n.t("MimiFlash.audience.edit.onSubmitFailure.error"))},onDelete:function(){return this.deleteConfirmDialog||(this.deleteConfirmDialog=new Widget.ConfirmDialog(I18n.t("MimiFlash.audience.edit.onDelete.title"),I18n.t("MimiFlash.audience.edit.onDelete.confirm")+"<br><br>"+I18n.t("MimiFlash.audience.edit.onDelete.note"),{onOk:_.bind(this.onDeleteOk,this)})),this.deleteConfirmDialog.show(),!1},onDeleteOk:function(){new Widget.PostRoute("/audience_members/"+Mimi.Audience.Data.audienceMemberId,{method:"delete"})},onListUpdated:function(t,e){var i=this.findList(e.id);i&&(i.find("span.name").html(e.name).attr("title",e.name),i.find("span.count").html(e.size))},onListDestroyed:function(t,e){var i=this.findList(e.id);i&&i.is(":visible")&&i.slideUp({duration:.3,after:_.bind(i.remove,i)})},findList:function(e){return t("#signup_list_"+e).closest("li")},getCurrentListItem:function(e){return t("#signup_list_"+e).closest("li")},getCurrentListItemData:function(t){return{id:t.find("span.name").data("value"),name:t.find("span.name").text(),size:t.find("span.count").text().parseInt()}}}).singleton(),Mimi.Audience.Edit.DOM={listSelect:"#choose_list",listsList:"#audience_member_lists_target",suppressionLists:"#audience_member_suppression_lists_target",addToList:"#audience_member_add_to_lists_target",addToListContainer:"#add_to_lists_container",tabs:"#audience_member_tabs",addField:"#field_adder",submitButton:".actions.field button.primary",memberForm:"#audience_member_view form",deleteButton:"#action_nav button.delete",suppressButton:"#action_nav button.suppress",unsuppressButton:"#action_nav button.unsuppress",audienceMemberDetails:"audience_member_details",audienceMemberMailings:"#audience_member_mailings",suppressedBanner:".suppressed_member"}}(jQuery),function(t){Mimi.Audience.Edit.FieldSelect=Class.create(Widget.Dropdown,{initialize:function($super){this.options={itemTextTemplate:Mimi.Audience.Edit.FieldSelect.ITEM_TEXT_FORMAT,keepStartText:!0},$super("#field_select",this.options),this.dom=_.extend(this.dom,this.dom.$menu.getChildren(Mimi.Audience.Edit.FieldSelect.MENU_DOM)),this.initializeCreateField(),this.originalText=this.getText(),this.observe("dropdown:item:selected",_.bind(this.onItemSelected,this))},initializeCreateField:function(){this.dom.$addButton.on("click",_.bind(this.onAdd,this)),this.dom.$fieldName.on("keydown",_.bind(this.onAddKeydown,this))},onItemSelected:function(e,i){this.fire("field:selected",this.getItemData(i.element)),t(i.element).parent().remove()},onAdd:function(){var t=this.normalizeFieldName(this.dom.$fieldName.val()),e=this.humanizeFieldId(t);return this.setText(this.options.itemTextTemplate({name:e})),this.fire("field:created",{id:t,name:e}),this.hide(),!1},onAddKeydown:function(t){return 13===t.keyCode?this.onAdd():void 0},getItemText:function(t){return this.options.itemTextTemplate(this.getItemData(t))},getItemData:function(e){var i=t(e).find("a")[0]?t(e).find("a"):t(e);return{id:i.data("value"),name:i.data("name")||i.text()}},normalizeFieldName:function(t){return t.toLowerCase().trim().match(/[\u00BF-\u1FFF\u2C00-\uD7FF\w]+/g).join("_")},humanizeFieldId:function(t){var e=t.split("_");return e[0]=_.capitalize(_.first(e)),e.join(" ")},disable:function(){this.dom.$button.disable().addClass("disabled")},enable:function(){this.dom.$button.enable().removeClass("disabled")}}).singleton(),_.extend(Mimi.Audience.Edit.FieldSelect,{MENU_DOM:{addField:".actions .combo_input",fieldName:".actions .combo_input input",addButton:".actions .combo_input button"},NEW_FIELD_TEMPLATE:_.template('<li><a href="#" data-value="#{id}"><span class="name hide_overflow">#{name}</span></a></li>'),ITEM_TEXT_FORMAT:_.template("#{name}")})}(jQuery),function(t){Mimi.Audience.Dashboard.BulkControls=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#bulk_controls"),this.dom=this.$element.getChildren(Mimi.Audience.Dashboard.BulkControls.DOM),this.data={},this.initObservers()},initObservers:function(){t(document).on("dashboard:reset",_.bind(this.onDashboardReset,this)),t(document).on("audience_list:context_changed",_.bind(this.onListContextChanged,this)),t(document).on("suppression_reason:selected",_.bind(this.onSupressionReasonSelected,this)),t(document).on("suppression_reason:unselected",_.bind(this.onSupressionReasonUnselected,this))},onDashboardReset:function(t){this.allView(t)},onListContextChanged:function(t,e){var i=e.listId||e.id;"all"===i?this.allView():"signups"===i?this.signupsView():"suppressed"===i?this.suppressedView():this.isSpecialList(i)?this.specialListView():this.listView()},onSupressionReasonUnselected:function(){this.suppressedView()},isSpecialList:function(t){var e=parseInt(t,10);return _.include(Mimi.AudienceList.special_lists,e)},onSupressionReasonSelected:function(t,e){var i=e.reason;"Unsubscribed"===i?this.unsubscribedView():"Suppressed by me"===i?this.manuallyView():"Unconfirmed"===i?this.unconfirmedView():"Marked as spam"===i?this.markedAsSpamView():"Hard bounce"===i?this.hardBounceView():"Soft bounce"===i?this.softBounceView():"General bounce"===i?this.generalBounceView():"Transient bounce"===i?this.transientBounce():"Mail block"===i?this.mailBlock():"Auto reply"===i&&this.autoReplyView()},allView:function(){this.dom.controls.$deletebtn.enable(),this.dom.controls.$removebtn.hide(),this.dom.controls.$confirmbtn.hide(),this.dom.controls.$unsuppressbtn.hide(),this.dom.controls.$addToListbtn.find("button").enable()},signupsView:function(){this.dom.controls.$deletebtn.enable(),this.dom.controls.$removebtn.hide(),this.dom.controls.$confirmbtn.show(),this.dom.controls.$unsuppressbtn.hide(),this.dom.controls.$addToListbtn.find("button").enable()},listView:function(){this.dom.controls.$deletebtn.enable(),this.dom.controls.$removebtn.show(),this.dom.controls.$confirmbtn.hide(),this.dom.controls.$unsuppressbtn.hide(),this.dom.controls.$addToListbtn.find("button").enable()},specialListView:function(){this.dom.controls.$deletebtn.disable(),this.dom.controls.$removebtn.show(),this.dom.controls.$confirmbtn.hide(),this.dom.controls.$unsuppressbtn.hide(),this.dom.controls.$addToListbtn.find("button").enable()},suppressedView:function(){this.dom.controls.$deletebtn.disable(),this.dom.controls.$removebtn.hide(),this.dom.controls.$confirmbtn.hide(),this.dom.controls.$unsuppressbtn.hide(),this.dom.controls.$addToListbtn.find("button").disable()},unsubscribedView:function(){this.dom.controls.$deletebtn.disable(),this.dom.controls.$removebtn.hide(),this.dom.controls.$confirmbtn.hide(),this.dom.controls.$unsuppressbtn.hide(),this.dom.controls.$addToListbtn.find("button").disable()},unconfirmedView:function(){this.dom.controls.$deletebtn.disable(),this.dom.controls.$removebtn.hide(),this.dom.controls.$confirmbtn.show(),this.dom.controls.$unsuppressbtn.hide(),this.dom.controls.$addToListbtn.find("button").disable()},manuallyView:function(){this.dom.controls.$deletebtn.disable(),this.dom.controls.$removebtn.hide(),this.dom.controls.$confirmbtn.hide(),this.dom.controls.$unsuppressbtn.show(),this.dom.controls.$addToListbtn.find("button").disable()},markedAsSpamView:function(){this.dom.controls.$deletebtn.disable(),this.dom.controls.$removebtn.hide(),this.dom.controls.$confirmbtn.hide(),this.dom.controls.$unsuppressbtn.hide(),this.dom.controls.$addToListbtn.find("button").disable()},hardBounceView:function(){this.dom.controls.$deletebtn.disable(),this.dom.controls.$removebtn.hide(),this.dom.controls.$confirmbtn.hide(),this.dom.controls.$unsuppressbtn.hide(),this.dom.controls.$addToListbtn.find("button").disable()},softBounceView:function(){this.dom.controls.$deletebtn.enable(),this.dom.controls.$removebtn.hide(),this.dom.controls.$confirmbtn.hide(),this.dom.controls.$unsuppressbtn.show(),this.dom.controls.$addToListbtn.find("button").disable()},generalBounceView:function(){this.dom.controls.$deletebtn.disable(),this.dom.controls.$removebtn.hide(),this.dom.controls.$confirmbtn.hide(),this.dom.controls.$unsuppressbtn.hide(),this.dom.controls.$addToListbtn.find("button").disable()},transientBounce:function(){this.dom.controls.$deletebtn.disable(),this.dom.controls.$removebtn.hide(),this.dom.controls.$confirmbtn.hide(),this.dom.controls.$unsuppressbtn.show(),this.dom.controls.$addToListbtn.find("button").disable()},mailBlock:function(){this.dom.controls.$deletebtn.disable(),this.dom.controls.$removebtn.hide(),this.dom.controls.$confirmbtn.hide(),this.dom.controls.$unsuppressbtn.show(),this.dom.controls.$addToListbtn.find("button").disable()},autoReplyView:function(){this.dom.controls.$deletebtn.disable(),this.dom.controls.$removebtn.hide(),this.dom.controls.$confirmbtn.hide(),this.dom.controls.$unsuppressbtn.show(),this.dom.controls.$addToListbtn.find("button").disable()
}}).singleton(),Mimi.Audience.Dashboard.BulkControls.DOM={controls:{deletebtn:"#delete_contacts",removebtn:"#remove_contacts",confirmbtn:"#confirm_contacts",unsuppressbtn:"#unsuppress_contacts",exportbtn:"#export_contacts",addToListbtn:"#bulk_add_list_control"}}}(jQuery),function(t){Mimi.Audience.AutoComplete=Class.create(Widget.Observer,Widget.Observable,{initialize:function(t,e,i){this.initOptions(i),this.initData(),this.initDOM(t,e),this.initDropDown(),this.initObservers(),this.initPaths()},initData:function(){this.data={timeout:null,dropdown:null,busy:!1,previousSearch:"",displayAutoComplete:!0}},initOptions:function(t){this.options=_.extend({zIndex:10000006,limit:10},t)},initDropDown:function(){var t=this.options.width||this.dom.$input.outerWidth()-2+"px";this.data.dropdown=new Widget.Dropdown(this.dom.$dropdown[0],{anchor:this.dom.$dropdown[0],keepStartText:!0,styles:{position:"absolute",width:t,zIndex:this.options.zIndex},cssClass:"input_menu square_top"}),this.data.dropdown.hide()},initPaths:function(){this.paths={get:"/audience_members/auto_complete"}},initDOM:function(e,i){this.dom={$input:t(e),$output:t(i),$dropdown:t("#auto_complete_results")}},initObservers:function(){this.dom.$input.on("keyup",_.bind(this.onInputKeyUp,this)),this.data.dropdown.observe("dropdown:item:selected",_.bind(this.onItemSelected,this)),this.data.dropdown.observe("dropdown:hidden",_.bind(this.onHidden,this)),this.data.dropdown.observe("dropdown:shown",_.bind(this.onShown,this))},onItemSelected:function(e,i){var s=t(i.element);if(s[0]){var n=s.data("value");this.insertEmail(n),this.dom.$input.focus()}},onShown:function(){this.dom.$input.addClass("square_bottom")},onHidden:function(){this.data.previousSearch="",this.dom.$input.removeClass("square_bottom")},setDisplayAutoComplete:function(t){this.data.displayAutoComplete=t},insertEmail:function(t){var e=this.dom.$output.val().trim();if(0===e.length)this.dom.$output.val(t);else{var i=e.split(/ *, */);i[i.length-1]=t,this.dom.$output.val(i.join(", ").trim()+", ")}this.dom.$output.trigger("input")},onInputKeyUp:function(t){var e=t.keyCode;return!e||188!==e&&32!==e?(this.data.timeout&&clearTimeout(this.data.timeout),this.data.timeout=_.delay(_.bind(this.onAutoComplete,this),500),!1):(this.displayDropdown([]),!1)},grabParams:function(){return{emails:this.lastEmail(),limit:this.options.limit}},lastEmail:function(){return _.last(this.dom.$input.val().split(",")).trim()},displayDropdown:function(t){if(this.data.displayAutoComplete&&t&&_.size(t)>0){this.data.dropdown.setItems(t),this.data.dropdown.show();var e=this.dom.$input.offset();this.data.dropdown.$element.css({left:e.left+1+"px",top:e.top+this.dom.$input.outerHeight()+1+"px"})}else this.data.dropdown.hide()},onAutoComplete:function(){if(!this.data.busy){var e=this.grabParams();e.emails!==this.data.previousSearch&&0!==e.emails.length&&(this.data.previousSearch=e.emails,this.data.busy=!0,this.fire("auto_complete:started"),t.get(this.paths.get,e).done(_.bind(this.onAutoCompleteSuccess,this)).fail(_.bind(this.onAutoCompleteFailure,this)).always(_.bind(this.onComplete,this)))}},onAutoCompleteSuccess:function(t){t&&t.success?(this.displayDropdown(t.result),this.fire("auto_complete:successful",{results:t.result})):this.fire("auto_complete:failure")},onAutoCompleteFailure:function(){this.fire("auto_complete:error")},onComplete:function(){this.data.busy=!1,this.fire("auto_complete:completed")}})}(jQuery),function(t){t(".subtab.audience_imports").on("click",function(){return Mimi.Audience.ImportHistoryDialog.show(),!1}),Mimi.Audience.ImportHistoryDialog=Class.create(Widget.Dialog,{initialize:function($super){$super(I18n.t("js.audience.import_history_dialog.import_history"),this.LOADING,{autoHide:!0,hideTrigger:".window_close, .close",fixedPosition:!1})},show:function($super){t(".subtab.audience_imports").addClass("selected"),this.setBody(this.LOADING),$super();var e=this;t.get("/audience_imports").fail(function(t){Widget.MimiFlash.error(t)}).always(function(t){e.dom.$body.html(t),e.position()})},hide:function($super){t(".subtab.audience_imports").removeClass("selected"),$super()},LOADING:'<p class="loading">&nbsp;</p>'}).singleton("show")}(jQuery),function(t){t(function(){t("#audience_member_mailings").on("click",".faux_table",function(e){if(!t(e.target).parents(".mailing_links")[0]){var i=t(this).find("a.attempt");i.toggleClass("active"),i.next().toggleClass("active")}})})}(jQuery),function(t){function e(e,s){t.get(e).done(function(t){i(t),s||history.pushState&&history.pushState({},"",e)})}function i(e){var i=e.match(/<body[^>]*>([\s\S]*)<\/body>/)[1],s=t("<div>");s.html(i),t("#main .main").animate({opacity:0},250,function(){t("#main").html(s.find("#main").html()),t("#main .main").css("opacity",0).animate({opacity:1},250)})}t("body").hasClass("features")&&(t("#main").css("min-height","1000px"),t(document).on("click",".tertiary_nav li a",function(){return e(t(this).attr("href")),!1}),window.onload=function(){setTimeout(function(){window.onpopstate=function(){e(document.URL,!0)}},500)})}(jQuery),function(t){function e(t){return 100>=t?0:500>=t?10:1e3>=t?12:2500>=t?16:5e3>=t?27:1e4>=t?42:15e3>=t?59:25e3>=t?89:35e3>=t?139:5e4>=t?199:75e3>=t?279:1e5>=t?369:15e4>=t?549:25e4>=t?749:35e4>=t?1049:void 0}function i(t){return 5e4>=t?-1:5*t}function s(t){return 1e4>t?"Basic Plan":5e4>t?"Pro Plan":35e4>t?"Silver Plan":"Gold Plan"}function n(t){return 36>t?"basic":189>t?"pro":699>t?"silver":"gold"}function o(){return["free","basic","pro","silver","gold"]}function a(t){var e=t.trim().match(/^[\d,]+/);return e?parseInt(e[0].replace(",",""),10):null}function r(e,s){if(t(s.source.dom.$button).closest(".plan_create_choice").length){var n=a(t(s.element).html());if(null===n)return;var o=i(n);d(n),l(o)}}function l(e){var i=t("summary .feature_list li.emails span span"),s="";s=e>0?e.formatThousands():"Unlimited",i.html(s+" emails")}function d(i){var s=t("#upgrade_downgrade_options .totals .cost");return s[0]?void s.html("$"+e(i)):(s=t(".total .cost .amt"),void s.html(e(i)))}function h(){var t=Widget.Dropdown.getInstanceByName("service_level_id");if(t){var e=a(t.getText());d(e)}}t("body").detectClass("choose-plan","change-plan")&&(t(document).on("dropdown:item:selected",r),t(document).on("dom:loaded",h),Mimi.getPriceForNumContacts=e,Mimi.getEmailsForNumContacts=i,Mimi.parseNumContacts=a,Mimi.getPlanNameForNumContacts=s,Mimi.getServiceLevelTypeForPrice=n,Mimi.getServiceLevelTypes=o)}(jQuery),Mimi.Signups={},function(t){Mimi.Signups.Base=Class.create(Widget.Observer,{prepare:function(t,e){this.displayFields=t,this.standardFields=e},myFieldNamesContains:function(t){return _.include(this.myFieldNames(),t)},myFieldNames:function(){return _.map(t("#signup_fields .name"),function(e){return t(e).data("value")})},addFieldToSidebar:function(e){"name"===e.field_name?t("#signup_fields").prepend(this.templates.fieldItem(e)):t("#signup_fields").append(this.templates.fieldItem(e))},addFieldToPreview:function(e){this.transmitForElementAboutToBeCreated(e.field_name),this.savingChanges();var i="/signups/add_signup_field/"+Mimi.Signups.DATA.id;t.ajax({url:i,type:"PUT",data:e}).done(_.bind(this.addFieldToPreviewSuccess,this)).fail(_.bind(this.addFieldToPreviewFailure,this))},addFieldToPreviewSuccess:function(e){this.afterAddFieldRemoveTransmit(),e.success?(this.insertToPreview(e.result),this.changesSaved()):(this.saveChanges(),t("#signup_fields li").last().remove(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.base.addFieldToPreviewSuccess")+"\n"+e.error))},insertToPreview:function(e){"name"===e.name?t("#signup_field_preview").prepend(this.templates.signupFieldPreview(e)):e.is_custom_field?(t("#signup_field_preview").append(e.html),this.typeSpecificDetails(e),this.customFieldEditObserver(e.id)):t("#signup_field_preview").append(this.templates.signupFieldPreview(e))},addFieldToPreviewFailure:function(){this.afterAddFieldRemoveTransmit(),this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.base.addFieldToPreviewFailure"))},confirmDeleteField:function(e){return this.$el=t(e.target).closest("a.remove"),this.$el[0]?(this.confirmDeleteFieldDialog.show(),!1):void 0},onRemoveField:function(){var e=this.$el.attr("data-value"),i=t(".mimi_field .actions span[data-field-name='"+e+"']").closest(".mimi_field");this.$el.closest("li").remove(),this.updateFieldDropdownOptions(),this.transmitForExistingElement(i),this.removeFieldFromPreview(e),this.isCustomField(e)&&this.checkForDropdownField(i),this.savingChanges()},isCustomField:function(t){return!_.include(this.standardFields,t)},checkForDropdownField:function(t){var e=Mimi.Signups.CustomField.get();"dropdown"===e.getFieldType(t)&&e.removeDropdown(t)},removeFieldFromPreview:function(e){var i="/signups/"+Mimi.Signups.DATA.id+"/remove_signup_field.json";t.ajax({url:i,type:"DELETE",data:{field:e}}).done(_.bind(this.removeFieldFromPreviewSuccess,this)).fail(_.bind(this.removeFieldFromPreviewFailure,this))},removeFieldFromPreviewSuccess:function(e){var i="checkbox_parent_node_"+e.result.id;e.success?(t("#"+i).closest("div").remove(),this.changesSaved()):(this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.base.removeFieldFromPreviewSuccess")+"\n"+e.error)),this.removeTransmit()},removeFieldFromPreviewFailure:function(){this.removeTransmit(),this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.base.removeFieldFromPreviewFailure"))},updateFieldDropdownOptions:function(){var t=this.dropdownExcludedFields(),e=_.reject(this.displayFields,function(e){return _.include(t,_.last(e))}),i=Widget.Dropdown.instances.add_field,s=i.dom.$container.data("no-selection");i.setItems(e),i.setText(s)},dropdownExcludedFields:function(){var t=this.myFieldNames();return _.include(t,"name")?t.push("first_name","last_name"):(_.include(t,"first_name")||_.include(t,"last_name"))&&t.push("name"),t},transmitForElementAboutToBeCreated:function(e){var i=t("<div>").addClass("mimi_field").css({height:"40px"});"name"===e?t("#signup_field_preview").prepend(i):t("#signup_field_preview").append(i),this.loadingBlock=new Widget.BlockOverlay({cover:i}),this.loadingBlock.show()},transmitForExistingElement:function(e){this.loadingBlock=new Widget.BlockOverlay({cover:t(e)}),this.loadingBlock.show()},removeTransmit:function(){this.loadingBlock&&this.loadingBlock.visible()&&this.loadingBlock.destroy()},afterAddFieldRemoveTransmit:function(){this.loadingBlock.options.cover.remove(),this.loadingBlock.destroy(),t("#field_transmit_border")[0]&&t("#field_transmit_border").remove()},saveChanges:function(){this.dom.$saveButton.enable(),this.dom.$saveButtonText.html(I18n.t("js.signups.base.saveChanges"))},savingChanges:function(){this.dom.$saveButton.disable(),this.dom.$saveButtonText.html(I18n.t("js.signups.base.savingChanges"))},changesSaved:function(){this.dom.$saveButton.disable(),this.dom.$saveButtonText.html(I18n.t("js.signups.base.changesSaved"))}}).singleton()}(jQuery),function(t){Mimi.Signups.ActivationMessageDialog=Class.create(Widget.Dialog,Widget.Observable,{initialize:function($super){$super(I18n.t("js.signups.activation_message_dialog.header"),Template.from("activation_message_template")(),{hideTrigger:"a.back"}),this.$element.on("click","button.primary",_.bind(this.okClick,this)),t("#clear_custom_message").on("click",_.bind(this.clearClick,this)),this.changesSaved=!1,this.data={},this.rememberFormValues()},show:function($super,t){this.callback=t;var e=this.dom.$body;e.find("#signup_from_email").val(this.data.from_email),e.find("#signup_from_name").val(this.data.from_name),e.find("#signup_subject").val(this.data.subject),e.find("#signup_message").val(this.data.body),$super()},rememberFormValues:function(){var t=this.dom.$body;this.data={from_email:t.find("#signup_from_email").val(),from_name:(t.find("#signup_from_name").val()||"").replace(/^"|"$/g,""),subject:t.find("#signup_subject").val(),body:t.find("#signup_message").val()}},okClick:function(){var t=this.dom.$body,e={from_email:t.find("#signup_from_email").val(),from_name:t.find("#signup_from_name").val(),subject:t.find("#signup_subject").val(),body:t.find("#signup_message").val()};return this.toggleButtons(!1),this.submitChanges(),this.callback(e),!1},toggleButtons:function(t){var e=this.dom.$body,i=e.find(".btn[type=button]"),s=e.find(".btn[type=submit]");t?(i.enable(),s.enable().html("<span>"+I18n.t("js.signups.activation_message_dialog.toggleButtons.save")+"</span>")):(i.disable(),s.disable().html("<span>"+I18n.t("js.signups.activation_message_dialog.toggleButtons.saving")+"</span>"))},submitChanges:function(){var e=this.dom.$body.find("form");t.ajax({url:e.attr("action"),type:e.attr("method"),data:e.serialize()}).done(_.bind(this.onSubmitSuccess,this)).fail(_.bind(this.onSubmitFailure,this))},onSubmitFailure:function(){this.toggleButtons(!0),this.changesSaved=!1,Widget.MimiFlash.error(I18n.t("MimiFlash.signups.activation_message_dialog.onSubmitFailure"))},onSubmitSuccess:function(t){this.toggleButtons(!0),t.success?(Widget.MimiFlash.create(I18n.t("MimiFlash.signups.activation_message_dialog.onSubmitSuccess.success")),this.rememberFormValues(),this.hide()):(Widget.MimiFlash.error(I18n.t("MimiFlash.signups.activation_message_dialog.onSubmitSuccess.fail")+"\n"+t.error),this.dom.$body.find(".btn[type=submit]").enable())},clearClick:function(){return this.dom.$body.find("#signup_from_name").val(""),this.dom.$body.find("#signup_from_email").val(""),this.dom.$body.find("#signup_subject").val(""),this.dom.$body.find("#signup_message").val(""),!1}}).singleton("show")}(jQuery),function(t){Mimi.Signups.Edit=Class.create(Mimi.Signups.Base,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.Signups.Edit.DOM),this.setLogoClass(),this.templates=Mimi.Signups.Templates.get(),this.initializeWidgets(),this.initializeObservers(),this.initializeDisplayNames(),this.bouncyWarning()},initializeWidgets:function(){this.addListSelect=new Mimi.AudienceListSelect(t("#lists_button_section .audience_list_select"),{ajaxCreateLists:!0,keepStartText:!0,onListAdded:_.bind(this.onListAdded,this)}),new Widget.Tabs("#webform_tabs",{noState:!0}),new Widget.ColorPicker("#webform_theme_logo_bg_color",{popupElement:"#logo_background_color_picker_grid",onColorHover:_.bind(this.logoColorHover,this),onColorLeave:_.bind(this.logoColorLeave,this),onColorSelected:_.bind(this.logoColorSelected,this)}),new Widget.ColorPicker("#webform_theme_bg_color",{popupElement:"#background_color_picker_grid",onColorHover:_.bind(this.backgroundColorHover,this),onColorLeave:_.bind(this.backgroundColorLeave,this),onColorSelected:_.bind(this.backgroundColorSelected,this)}),this.confirmDeleteDialog=new Widget.ConfirmDialog(I18n.t("MimiFlash.signups.edit.confirmDeleteDialog.title"),I18n.t("MimiFlash.signups.edit.confirmDeleteDialog.body"),{onOk:_.bind(this.onDeleteOk,this)},I18n.t("MimiFlash.signups.edit.confirmDeleteDialog.button")),this.confirmDeleteFieldDialog=new Widget.ConfirmDialog(I18n.t("MimiFlash.signups.edit.confirmDeleteFieldDialog.title"),I18n.t("MimiFlash.signups.edit.confirmDeleteFieldDialog.body"),{onOk:_.bind(this.onRemoveField,this)},I18n.t("MimiFlash.signups.edit.confirmDeleteFieldDialog.button")),this.logoImageUploader=new Widget.ImageUploader("#logo_image"),t("#logo_image").on("upload:started",_.bind(this.logoUploading,this)),t("#logo_image").on("upload:succeeded",_.bind(this.logoUploaded,this)),t("#logo_image").on("upload:failed",_.bind(this.logoFailed,this)),this.dom.$logoImageDelete.on("click",_.bind(this.logoDelete,this)),this.backgroundImageUploader=new Widget.ImageUploader("#background_image"),t("#background_image").on("upload:started",_.bind(this.backgroundUploading,this)),t("#background_image").on("upload:succeeded",_.bind(this.backgroundUploaded,this)),t("#background_image").on("upload:failed",_.bind(this.backgroundFailed,this)),this.dom.$backgroundImageDelete.on("click",_.bind(this.backgroundDelete,this)),Mimi.Stats.ShareDialog.setTitle(I18n.t("MimiFlash.signups.edit.ShareDialog.title")),Mimi.Stats.ShareDialog.setInfo(I18n.t("MimiFlash.signups.edit.ShareDialog.info")),this.dom.$sharebtn.on("click",_.bind(this.onShareClick,this)),this.dom.$embedbtn.on("click",_.bind(this.onEmbedClick,this)),this.dom.$editTitle.on("click",_.bind(this.onEditTitleClick,this))},initializeObservers:function(){t(document).on("dropdown:item:selected",_.bind(this.onDropdownItemSelect,this)),t(document).on("audience_list:updated",_.bind(this.onListUpdated,this)),t("#webform_customize_activation").on("click",_.bind(this.onCustomizeActivation,this)),this.dom.$signupForm.on("click",_.bind(this.onToggleRequired,this)),t("#checkbox_parent_node_email").on("mouseover",function(){t("#checkbox_parent_node_email > *").css({cursor:"auto"})}),t("#delete_webform").on("click",_.bind(this.onDeleteClick,this)),t("#signup_lists").on("click",_.bind(this.onRemoveList,this)),t("#signup_fields").on("click",_.bind(this.confirmDeleteField,this)),t("#webform_title").on("change",_.bind(this.onSubmitWebformTitle,this)),this.dom.$submit.on("click",_.bind(this.onSubmit,this)),this.dom.$form.observe(.5,_.bind(this.onFormChanged,this)),this.$element.on("keydown",_.bind(this.onKeyDown,this)),t("#create_field_item .btn").on("click",_.bind(this.createFieldItemClick,this)),t(window).on("beforeunload",_.bind(this.onBeforeUnload,this)),t("#signup_from_email").on("keyup",_.bind(this.onFromAddressChange,this)),t("#signup_from_name").on("keyup",_.bind(this.onFormChanged,this))},initializeDisplayNames:function(){this.displayNames={name:I18n.t("helpers.signups_helper.fields.name"),first_name:I18n.t("helpers.signups_helper.fields.first_name"),last_name:I18n.t("helpers.signups_helper.fields.last_name"),city:I18n.t("helpers.signups_helper.fields.city"),phone:I18n.t("helpers.signups_helper.fields.phone"),company:I18n.t("helpers.signups_helper.fields.company"),title:I18n.t("helpers.signups_helper.fields.title"),address:I18n.t("helpers.signups_helper.fields.address"),state:I18n.t("helpers.signups_helper.fields.state"),zip:I18n.t("helpers.signups_helper.fields.zip"),country:I18n.t("helpers.signups_helper.fields.country")}},prepare:function($super,t,e){$super(t,e)},onDropdownItemSelect:function(e,i){var s=t(i.element).data("value");i.source.$element===this.addListSelect.$element?this.selectList(e,i):_.include(this.standardFields,s)?this.selectField(e,i):t("#signup_promotion_language_id").val()==s&&this.onFormChanged()},selectList:function(t,e){var i=e.element,s=this.addListSelect.getItemData(i);this.addListToSidebar(s),this.addListSelect.removeItem(i),this.savingChanges(),this.addListToPreview(s.id)},addListToSidebar:function(e){t("#signup_lists").append(this.templates.listItem(e))},addCustomList:function(e){this.customListName=e;var i="/signups/"+Mimi.Signups.DATA.id+"/add_custom_list.json";t.ajax({url:i,type:"PUT",data:{name:e}}).done(_.bind(this.addCustomListSuccess,this)).fail(_.bind(this.addCustomListFailure,this)),t('#create_list input[type="text"]').val("")},addCustomListSuccess:function(e){if(e.success){var i=e.result.list,s={id:i.id,name:i.name,size:i.list_size};t("#signup_lists").append(this.templates.listItem(s)),this.savingChanges(),this.addListToPreview(e.result.id)}else this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.addCustomListSuccess")+"\n"+e.error)},addCustomListFailure:function(){this.saveChanges(),this.removeTransmit(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.addCustomListFailure"))},onListAdded:function(t,e){e.name!=this.customListName&&this.addListSelect.onListUpdated(t,e)},transmitForListSelected:function(){var e=t("#signup_lists li");2===e.length?this.transmitForElementAboutToBeCreated():e.length>2&&this.transmitForExistingElement(t("#signup_audience_lists"))},addListToPreview:function(e){this.transmitForListSelected();var i="/signups/"+Mimi.Signups.DATA.id+"/add_audience_list.json";t.ajax({url:i,type:"PUT",data:{list_id:e}}).done(_.bind(this.addListToPreviewSuccess,this)).fail(_.bind(this.addListToPreviewFailure,this))},addListToPreviewSuccess:function(t){this.removeTransmitAfterListAdded(),t.success?(this.addList(t),this.changesSaved()):(this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.addListToPreviewSuccess")+"\n"+t.error))},removeTransmitAfterListAdded:function(){var e=t("#signup_lists li");2==e.length?this.afterAddFieldRemoveTransmit():e.length>2&&this.removeTransmit()},addList:function(e){var i=e.result.new_list_data,s=e.result.first_list_data,n=e.result.lists_required_message,o=e.result.lists_count;o>1&&(t("#signup_audience_lists")[0]||this.buildAudienceListsDiv(s,n),this.insertListInPreview(i))},buildAudienceListsDiv:function(e,i){t("#signup_list_preview").append(t('<div class="mimi_field checkgroup" id="signup_audience_lists">')),this.addRequiredListsCheckbox(),this.addMimiFeedback(i),this.insertListInPreview(e)},addMimiFeedback:function(e){t("#signup_audience_lists").append(t('<div class="mimi_field_feedback" data-lists-required="'+e+'">'))},addRequiredListsCheckbox:function(){t("#signup_audience_lists").append(t('<div class="check" id="lists_required">')),t("#lists_required").append(t('<span class="webform_checkbox" title="'+I18n.t("MimiFlash.signups.edit.addRequiredListsCheckbox")+'"></span>'))},insertListInPreview:function(e){var i=t("#signup_audience_lists div.mimi_field_feedback");i.before(this.templates.signupListPreview(e))},addListToPreviewFailure:function(){this.saveChanges(),this.removeTransmit(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.addListToPreviewFailure"))},onRemoveList:function(e){var i=t(e.target).closest("a.remove");if(i[0]){t("#signup_audience_lists")[0]&&this.transmitForExistingElement(t("#signup_audience_lists"));var s=i.closest("li"),n=s.find("span.name").attr("data-value");return this.removeListFromSidebar(s),this.removeListFromPreview(s,n),this.savingChanges(),!1}},removeListFromSidebar:function(t){var e=t.find("input").val(),i=t.find("span.name").html();this.addListSelect.addItem(e,i),t.remove()},removeListFromPreview:function(e,i){var s="/signups/"+Mimi.Signups.DATA.id+"/remove_audience_list.json";t.ajax({url:s,type:"DELETE",data:{list_id:i}}).done(_.bind(this.removeListFromPreviewSuccess,this)).fail(_.bind(this.removeListFromPreviewFailure,this))},removeListFromPreviewSuccess:function(t){if(this.removeTransmit(),t.success){var e="#list_"+t.result.id,i=t.result.lists_count;this.changesSaved(),this.removeList(e,i)}else this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.removeListFromPreviewSuccess")+"\n"+t.error)},removeList:function(e,i){0!==i&&(1==i?t("#signup_audience_lists").remove():t(e).closest("div.check").remove())},removeListFromPreviewFailure:function(){this.removeTransmit(),this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.removeListFromPreviewFailure"))},onListUpdated:function(t,e){var i=this.findList(e.id);i[0]&&(i.find("span.name").html(e.name).attr("title",e.name),i.find("span.count").html(e.size))},findList:function(e){var i=t("#signup_list_"+e);return i.closest("li")},selectField:function(e,i){var s=t(i.element).data("value");this.addFieldToSidebar({field_name:s,display_name:this.displayNames[s]}),this.updateFieldDropdownOptions(),this.addFieldToPreview({field_name:s})},toggleRequiredListsSuccess:function(e){var i=t("#lists_required span");this.removeTransmit(),e.success?(e.result.required?this.updateUiForRequiredLists(i,e.result.required_message):this.updateUiForNonRequiredLists(i),this.changesSaved()):(this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.toggleRequiredListsSuccess")+"\n"+e.error))},updateUiForRequiredLists:function(e,i){var s=t("#signup_audience_lists");e.replaceWith('<span class="webform_required" title="'+I18n.t("MimiFlash.signups.edit.updateUiForRequiredLists")+'"></span>'),s.addClass("required"),s.attr("data-lists-required")||s.attr("data-lists-required",i)},updateUiForNonRequiredLists:function(e){e.replaceWith('<span class="webform_checkbox" title="'+I18n.t("MimiFlash.signups.edit.updateUiForNonRequiredLists")+'"></span>'),t("#signup_audience_lists").removeClass("required")},toggleRequiredListsFailure:function(){this.removeTransmit(),this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.toggleRequiredListsFailure"))},onToggleRequired:function(e){var i=t(e.target).closest(".check");if(i[0]&&!this.isForAudienceList(i)&&!this.isCustomCheckboxField(i)){var s=this.getFieldName(i);"email"!==s&&(this.savingChanges(),this.transmitForExistingElement(i.closest("div")),"lists_required"===i.prop("id")?this.toggleRequiredLists():this.toggleRequiredField(s))}},isForAudienceList:function(t){return!!t.closest(".mimi_field.checkgroup")[0]&&"lists_required"!==t.prop("id")},isCustomCheckboxField:function(t){return!!t.next('label[data-option="option"]')[0]},toggleRequiredLists:function(){var e="/signups/"+Mimi.Signups.DATA.id+"/make_lists_required.json";t.ajax({url:e,type:"PUT"}).done(_.bind(this.toggleRequiredListsSuccess,this)).fail(_.bind(this.toggleRequiredListsFailure,this))},toggleRequiredField:function(e){var i="/signups/"+Mimi.Signups.DATA.id+"/make_field_required.json",s={name:e};t.ajax({url:i,type:"PUT",data:s}).done(_.bind(this.toggleRequiredFieldSuccess,this)).fail(_.bind(this.toggleRequiredFieldFailure,this))},toggleRequiredFieldSuccess:function(e){var i=t("#checkbox_parent_node_"+e.result.field_id).find("span"),s=e.result.required_message;this.removeTransmit(),e.success?(e.result.required?this.updateUiForRequiredField(i,s):this.updateUiForNonRequiredField(i),this.changesSaved()):(this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.toggleRequiredFieldSuccess")+"\n"+e.error))},updateUiForRequiredField:function(e,i){var s=t(e).closest(".mimi_field");s.toggleClass("required"),t(e).replaceWith('<span class="webform_required" title='+I18n.t("MimiFlash.signups.edit.updateUiForRequiredField")+'"></span>'),this.addErrorMessage(s,i)},addErrorMessage:function(e,i){var s=t(e).find(".mimi_field_feedback");s.attr("data-required-field",i)},updateUiForNonRequiredField:function(e){var i=t(e).closest(".mimi_field");i.toggleClass("required"),i.find(".mimi_field_feedback").html(""),t(e).replaceWith('<span class="webform_checkbox" title='+I18n.t("MimiFlash.signups.edit.updateUiForNonRequiredField")+'"></span>')},toggleRequiredFieldFailure:function(){this.removeTransmit(),this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.toggleRequiredFieldFailure"))},onSubmitWebformTitle:function(){this.savingChanges(),t("#webform_name").css({opacity:.5});var e="/signups/"+Mimi.Signups.DATA.id+"/submit_webform_title.json",i=t("#webform_title").val();t.ajax({url:e,type:"PUT",data:{name:i}}).done(_.bind(this.onSubmitWebformTitleSuccess,this)).fail(_.bind(this.onSubmitWebformTitleFailure,this))},onSubmitWebformTitleSuccess:function(e){t("#webform_name").css({opacity:1}),e.success?(t("#webform_name").html(e.result.name),this.changesSaved()):(this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.onSubmitWebformTitleSuccess")+"\n"+e.error))},onSubmitWebformTitleFailure:function(){t("#webform_name").css({opacity:1}),this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.onSubmitWebformTitleFailure"))},getFieldName:function(t){return t.attr("data-field-name")},onCustomizeActivation:function(){Mimi.Signups.ActivationMessageDialog.show(this.setActivationMessage)},setActivationMessage:function(e){t("#signup_subject").val(e.subject),t("#signup_message").val(e.body)},onDeleteClick:function(){return this.confirmDeleteDialog.show(),!1},onDeleteOk:function(){this.dom.$submit.disable(),this.dom.$deleteForm.submit()},logoUploading:function(){this.dom.$noLogoImageForm.hide(),this.dom.$hasLogoImageForm.show(),this.dom.$logoImageDelete.hide(),this.dom.$logoImage.prop("src","https://d1lggihq2bt4jo.cloudfront.net/assets/img/transmit.gif"),this.savingChanges()},logoUploaded:function(t,e){this.dom.$noLogoImageHeader.hide(),this.dom.$hasLogoImageHeader.show(),this.dom.$logoImage.prop("src",e.src),this.dom.$hasLogoImageImage.prop("src",e.src),this.dom.$logoImageDelete.show(),this.changesSaved(),this.updateLogoBgIfTransparent()},logoFailed:function(t,e){Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.logoFailed")+"\n"+e.message),this.dom.$noLogoImageHeader.show(),this.dom.$hasLogoImageHeader.hide(),this.saveChanges()},logoDelete:function(){return t.ajax({url:"/signup_logos/"+Mimi.Signups.DATA.id,type:"DELETE"}).done(_.bind(this.savedSuccess,this)),this.savingChanges(),this.dom.$noLogoImageForm.show(),this.dom.$hasLogoImageForm.hide(),this.dom.$noLogoImageHeader.show(),this.dom.$hasLogoImageHeader.hide(),this.logoImageUploader.clear(),!1},updateLogoBgIfTransparent:function(){var e=t(".mimi_webform_container .mimi_webform");if(!e.hasClass("with_bg")){var i=t("#webform_theme_bg_color").val(),s="transparent"!==i?i:"#DCDCDC";this.updateLogoInput(s),this.updateLogoColor(s)}},updateLogoInput:function(e){var i=t("#webform_theme_logo_bg_color"),s=i.parent().find("button span");s.css({backgroundColor:Mimi.util.hexToRgb(e)}),i.val(e)},logoColorSelected:function(e){this.updateLogoColor(e),t.ajax({url:"/signup_logos/"+Mimi.Signups.DATA.id,type:"PUT",data:"color="+e}).done(_.bind(this.savedSuccess,this)),this.savingChanges()},savedSuccess:function(){this.changesSaved()},logoColorHover:function(t){this.updateLogoColor(t)},logoColorLeave:function(t){this.updateLogoColor(t)},updateLogoColor:function(t){this.dom.$noLogoImageHeader.css({backgroundColor:"transparent"===t?"":Mimi.util.hexToRgb(t)}),this.dom.$hasLogoImageHeader.css({backgroundColor:"transparent"===t?"":Mimi.util.hexToRgb(t)}),this.dom.$container[("transparent"===t?"remove":"add")+"Class"]("with_bg"),this.setLogoClass()},setLogoClass:function(){var e=t("#webform_theme_logo_bg_color").val();"transparent"===e?this.setLogoClassRelativeToBackgroundColor():(this.dom.$noLogoImageHeader.toggleBrightness(e,"ui_dark","ui_light"),this.dom.$hasLogoImageHeader.toggleBrightness(e,"ui_dark","ui_light"))},setLogoClassRelativeToBackgroundColor:function(){var e=t("#webform_theme_bg_color").val();"transparent"===e?_.each([this.dom.$noLogoImageHeader,this.dom.$hasLogoImageHeader],function(t){t.removeClass("ui_dark"),t.addClass("ui_light")}):(this.dom.$noLogoImageHeader.toggleBrightness(e,"ui_dark","ui_light"),this.dom.$hasLogoImageHeader.toggleBrightness(e,"ui_dark","ui_light"))},hasTransparentLogo:function(){var e=t("#webform_theme_logo_bg_color").val();return"transparent"===e},backgroundUploading:function(){this.dom.$noBackgroundImageForm.hide(),this.dom.$hasBackgroundImageForm.show(),this.dom.$backgroundImageDelete.hide(),this.dom.$backgroundImage.prop("src","https://d1lggihq2bt4jo.cloudfront.net/assets/img/transmit.gif"),this.savingChanges()},backgroundUploaded:function(t,e){this.dom.$preview.css({backgroundImage:"url("+e.src+")",backgroundRepeat:"repeat"}),this.dom.$backgroundImage.prop("src",e.src),this.dom.$backgroundImageDelete.show(),this.changesSaved()},backgroundFailed:function(t,e){Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.backgroundFailed")+"\n"+e.message),this.dom.$preview.css({backgroundImage:""}),this.saveChanges()},backgroundDelete:function(){return t.ajax({url:"/signup_backgrounds/"+Mimi.Signups.DATA.id,type:"DELETE"}).done(_.bind(this.savedSuccess,this)),this.savingChanges(),this.dom.$noBackgroundImageForm.show(),this.dom.$hasBackgroundImageForm.hide(),this.dom.$preview.css({backgroundImage:"url(https://d1lggihq2bt4jo.cloudfront.net/assets/img/workspace_shadows.png)",backgroundRepeat:"repeat-x"}),this.backgroundImageUploader.clear(),!1},backgroundColorSelected:function(e){this.dom.$preview.css({backgroundColor:e}),this.hasTransparentLogo()&&this.setLogoClassRelativeToBackgroundColor(),t.ajax({url:"/signup_backgrounds/"+Mimi.Signups.DATA.id,type:"PUT",data:"color="+e}).done(_.bind(this.savedSuccess,this)),this.savingChanges()},backgroundColorHover:function(t){this.dom.$preview.css({backgroundColor:"transparent"===t?"":Mimi.util.hexToRgb(t)}),this.hasTransparentLogo()&&this.setLogoClassRelativeToBackgroundColor()},backgroundColorLeave:function(t){this.dom.$preview.css({backgroundColor:"transparent"===t?"":Mimi.util.hexToRgb(t)}),this.hasTransparentLogo()&&this.setLogoClassRelativeToBackgroundColor()},onFormChanged:function(){this.saveChanges()},onKeyDown:function(t){var e=String.fromCharCode(t.keyCode).toLowerCase();(t.metaKey||t.ctrlKey)&&"s"===e&&this.onSubmit(t)},onSubmit:function(){return t("#hidden_from_name").val(t("#signup_from_name").val()),t("#hidden_from_email").val(t("#signup_from_email").val()),this.savingChanges(),t.ajax({url:this.dom.$form.attr("action"),type:this.dom.$form.attr("method"),data:this.dom.$form.serialize()}).done(_.bind(this.onSubmitSuccess,this)).fail(_.bind(this.onSubmitFailure,this)),!1
},onSubmitSuccess:function(t){t.success?(this.updateFormPreview(t.result),this.changesSaved()):(Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.onSubmitSuccess")+"\n"+t.error),this.saveChanges())},onSubmitFailure:function(){this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit.onSubmitFailure"))},updateFormPreview:function(t){t.form_changed&&(t.language_changed?this.updateLanguage(t):t.button_text_changed&&this.updateButtonText(t.button_text))},updateButtonText:function(e){var i=t("#webform_submit_button");i.val(e).attr("data-default-text",e)},updateLanguage:function(t){this.applyRtlClass(t.rtl),this.customField=Mimi.Signups.CustomField.get(),this.removeDropdowns(),this.dom.$formItems.html(t.html),this.setCustomFieldEditObservers(),this.updateSideTabCode(t.side_tab),Widget.Dropdown.initFromElements()},removeDropdowns:function(){var e=t("#ema_signup_form .mimi_field"),i=this;e.each(function(t,e){i.customField.removeDropdown(e)})},applyRtlClass:function(t){t?this.dom.$signupForm.addClass("rtl"):this.dom.$signupForm.removeClass("rtl")},setCustomFieldEditObservers:function(){this.customField.observersForEditingCustomFields()},updateSideTabCode:function(t){Mimi.Signups.DATA.sideTabCode=t},onBeforeUnload:function(){return this.dom.$submit.is(":enabled")||this.isEditingFieldOptions()?I18n.t("MimiFlash.signups.edit.onBeforeUnload.start")+"\n\n"+I18n.t("MimiFlash.signups.edit.onBeforeUnload.end"):void 0},isEditingFieldOptions:function(){return t(".mimi_field .combo_input").size()>0},onShareClick:function(){return Mimi.Stats.ShareDialog.show(Mimi.Signups.DATA.shareUrl,!0),!1},onEmbedClick:function(){return Mimi.Signups.EmbedDialog.show(Mimi.Signups.DATA.sideTabCode),!1},onEditTitleClick:function(){return Mimi.Signups.EditTitleDialog.show(),!1},titleize:function(t){var e=t.split("_"),i=_.map(e,function(t){return _.capitalize(t)});return i.join(" ")},createFieldItemClick:function(e){t(e.target).closest("menu").hide()},onFromAddressChange:function(){var e=t("#signup_from_email").val();this.bouncyWarning(),Mimi.DmarcAddress.isMatch(e)?this.dom.$saveButton.disable():this.onFormChanged()},bouncyWarning:function(){var e=t("#signup_from_email").val();Mimi.DmarcAddress.isMatch(e)?(t("#signup_from_email").addClass("indicator"),t("#signup_from_email").addClass("bad-sender")):(t("#signup_from_email").removeClass("indicator"),t("#signup_from_email").removeClass("bad-sender"))}}).singleton("prepare"),Mimi.Signups.Edit.DOM={preview:"#webform_standalone_preview",container:"#webform_standalone_preview .mimi_webform",logo:".mimi_container_logo img",html:"#webform_html_code",deleteForm:"#webform_delete_form",noLogoImageHeader:".mimi_webform_header.no_webform_theme_logo",hasLogoImageHeader:".mimi_webform_header.has_webform_theme_logo",hasLogoImageImage:".mimi_webform_header.has_webform_theme_logo img",noLogoImageForm:"div.no_webform_theme_logo_bg_color",hasLogoImageForm:"div.has_webform_theme_logo_bg_color",logoImageDelete:"div.has_webform_theme_logo_bg_color a.remove",logoImage:"div.has_webform_theme_logo_bg_color img",noBackgroundImageForm:"div.no_webform_theme_bg_image",hasBackgroundImageForm:"div.has_webform_theme_bg_image",backgroundImageDelete:"div.has_webform_theme_bg_image a.remove",backgroundImage:"div.has_webform_theme_bg_image img",form:"#signup_form",submit:".actions button.primary[type=submit]",sharebtn:".btn.shared",embedbtn:".btn.export",signupForm:"#ema_signup_form",saveButton:"button.btn.primary.disabled",saveButtonText:"button.btn.primary.disabled span",editTitle:".mimi_webform_header button.edit",formItems:"#form_items"}}(jQuery),function(t){Mimi.Signups.DefaultSignup=Class.create(Widget.Observer,{initialize:function(){this.$elements=t(".default_signup.btn"),this.initData(),this.initTemplates(),this.initDialogs(),this.initObservers()},initData:function(){this.data={newSignupId:null}},initTemplates:function(){this.templates={setDialog:_.template(I18n.t("js.signups.default_signup.initTemplates"))}},initDialogs:function(){this.initConfirmUnsetDialog(),this.initConfirmSetDialog()},initConfirmSetDialog:function(){var t="";t=I18n.t(Mimi.Signups.Data.defaultSignupId?"js.signups.default_signup.initConfirmSetDialog.change":"js.signups.default_signup.initConfirmSetDialog.set"),this.confirmSetDialog=new Widget.ConfirmDialog(t,"",{onOk:_.bind(this.onConfirmSetOk,this)})},onConfirmSetOk:function(){this.clearPressedButtons(),this.setSelectedDefaultSignupButton(),this.submitDefaultSignupId(this.getNewSignupId(),_.bind(this.onSubmitSetSuccess,this))},onSubmitSetSuccess:function(){Mimi.Signups.Data.defaultSignupId=this.getNewSignupId(),this.setNewSignupId(null),Widget.MimiFlash.create(I18n.t("MimiFlash.signups.default_signup.onSubmitSetSuccess"))},setSelectedDefaultSignupButton:function(){this.$elements.each(_.bind(function(e,i){var s=t(i).closest("li.signup").data("id");s===this.getNewSignupId()&&t(i).addClass("selected").removeClass("secondary")},this))},initConfirmUnsetDialog:function(){this.confirmUnsetDialog=new Widget.ConfirmDialog(I18n.t("MimiFlash.signups.default_signup.initConfirmUnsetDialog.title"),I18n.t("MimiFlash.signups.default_signup.initConfirmUnsetDialog.body"),{onOk:_.bind(this.onConfirmUnsetOk,this)})},onConfirmUnsetOk:function(){this.clearPressedButtons(),this.submitDefaultSignupId("",_.bind(this.onSubmitUnsetSuccess,this))},submitDefaultSignupId:function(e,i){t.ajax({url:"/user",type:"PUT",data:{"user[signup_id]":e}}).done(i)},onSubmitUnsetSuccess:function(){Mimi.Signups.Data.defaultSignupId=null,this.setNewSignupId(null),Widget.MimiFlash.create(I18n.t("MimiFlash.signups.default_signup.onSubmitUnsetSuccess"))},clearPressedButtons:function(){this.$elements.removeClass("selected").addClass("secondary")},initObservers:function(){this.$elements.on("click",_.bind(this.onDefaultSignupClick,this))},onDefaultSignupClick:function(e){var i=t(e.target).closest("li.signup"),s=i.data("id"),n=i.data("name");s===Mimi.Signups.Data.defaultSignupId?this.showConfirmUnsetDialog():(this.setNewSignupId(s),this.showConfirmSetDialog(n))},showConfirmUnsetDialog:function(){this.confirmUnsetDialog.show()},showConfirmSetDialog:function(t){var e=this.templates.setDialog({signupName:t});Mimi.Signups.Data.defaultSignupId||(e+=" "+I18n.t("MimiFlash.signups.default_signup.showConfirmSetDialog")),this.confirmSetDialog.setMessage(e),this.confirmSetDialog.show()},setNewSignupId:function(t){this.data.newSignupId=t},getNewSignupId:function(){return this.data.newSignupId}}).singleton()}(jQuery),function(t){Mimi.Signups.Dashboard=Class.create(Widget.Observer,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.Signups.Dashboard.DOM),this.setData(),this.dom.$list.on("click",_.bind(this.onClick,this)),Mimi.Signups.DefaultSignup.get(),Mimi.Stats.ShareDialog.setInfo(I18n.t("js.signups.dashboard.initialize"))},setData:function(){this.data=Mimi.Signups.Data},onClick:function(e){var i=t(e.target).findElement("a.btn"),s=i.parents("figure").parents("li"),n=i[0]?i.detectClass("share","delete"):null;if(i[0]&&n){switch(n){case"share":this.shareSignup(s,i);break;case"delete":this.deleteSignup(s)}return!1}},shareSignup:function(t,e){var i=_.template(I18n.t("MimiFlash.signups.dashboard.shareSignup")),s=i({name:this.getName(t)});Mimi.Stats.ShareDialog.setTitle(s),Mimi.Stats.ShareDialog.show(e.attr("data-share-url"),!0)},deleteSignup:function(t){var e=this.getName(t);this.$itemToDelete=t;var i=_.template(I18n.t("MimiFlash.signups.dashboard.deleteSignup.body")),s=i({name:e});this.confirmDialog=new Widget.ConfirmDialog(I18n.t("MimiFlash.signups.dashboard.deleteSignup.title"),s,{onOk:_.bind(this.onConfirmDelete,this)}),this.confirmDialog.show()},onConfirmDelete:function(){t.post("signups/"+this.getId(this.$itemToDelete),{_method:"DELETE"}),this.data.count--,this.data.count<=this.data.quota&&Mimi.Signups.UpgradeDialog&&Mimi.Signups.UpgradeDialog.disable(),this.$itemToDelete.fadeSlide(),this.destroyConfirmDialog()},onCancelDelete:function(){this.destroyConfirmDialog()},destroyConfirmDialog:function(){this.$itemToDelete=null,this.confirmDialog.destroy(),this.confirmDialog=null},getName:function(t){return t.find("h3").text()},getId:function(t){return t.attr("data-id")},getShareLinks:function(t){for(var e,i=t.find(".webform-share")[0],s=i.childNodes.length;s--;)if(8===i.childNodes[s].nodeType){e=i.childNodes[s];break}return e.nodeValue}}).singleton(),Mimi.Signups.Dashboard.DOM={list:"ul.webforms.other"}}(jQuery),function(){Mimi.Signups.ShareDialog=Class.create(Widget.Dialog,{initialize:function($super){$super("Share Webform",Mimi.Signups.ShareDialog.BODY,{hideTrigger:"a.back"}),this.dom=this.$element.getChildren(Mimi.Signups.ShareDialog.DOM)},show:function($super,t,e){this.dom.$name.html(t),this.dom.$links.html(e),this.initExternalScripts(e),gapi.plusone.go(),$super()},initExternalScripts:function(t){var e=t.match(/<script\s+src\s*=\s*(["'])([^\1]*?)\1/);if(e&&e[2]){var i=document.createElement("script");i.src=e[2],this.dom.$links.append(i)}}}).singleton("show"),Mimi.Signups.ShareDialog.DOM={name:"span.name",links:"div.share"},Mimi.Signups.ShareDialog.BODY='<h2>Share <span class="name"></span> using these buttons:</h2><div class="share"></div><footer><a class="back" href="#"><svg class=\'iconsvg svg_back\' viewBox=\'0 0 16 16\' aria-hidden=\'true\'>    <path fill="#000" d="M3.285 7.5l3.992-4.5v3.006c2.103 0 6.577 1.723 4.557 5.994 0-3.378-4.557-2.974-4.557-2.974v2.974l-3.992-4.5z"></path>\n</svg><span>I\'m done sharing</span></a></footer>'}(),function(t){Mimi.Signups.EmbedDialog=Class.create(Widget.Dialog,Widget.Observable,{initialize:function($super){$super(I18n.t("js.signups.embed_dialog.title"),t("#embed_dialog").html(),{hideTrigger:"section.actions a.back",fixedPosition:!1}),this.dom=_.extend(this.dom,this.$element.getChildren(Mimi.Signups.EmbedDialog.DOM)),this.initializeObservers(),this.initializeWidgets(),this.defaultWidth="400",this.minWidth=125,this.maxWidth=1e3},initializeObservers:function(){t("#webform_html_code").on("click",_.bind(this.onHighlightEmbedCode,this)),t("#styled_webform_html_code").on("click",_.bind(this.onHighlightEmbedCode,this)),t("#tab_embed_code").on("click",_.bind(this.onHighlightEmbedCode,this)),t("#iframe_width_submit").on("click",_.bind(this.onUpdateIframeWidth,this)),t("#iframe_width_input").on("keydown",_.bind(this.onWidthKeyDown,this)),t("#reset_width").on("click",_.bind(this.onSetToDefaultWidth,this)),t("#header").on("click",_.bind(this.setIframeHeader,this)),t("#popup_delay_checkbox").on("change",_.bind(this.onPopupDelayCheckboxChanged,this)),t("#popup_delay_input").on("keypress",_.bind(this.sanitizePopupDelay,this)),t("#popup_delay_input").on("input",_.bind(this.changePopupDelay,this))},initializeWidgets:function(){new Widget.Tabs("#embed_tabs",{noState:!0})},show:function($super,e){$super(),this.showTransmit(),this.getIframeDimensions(),this.dom.$sideTabCode.val(e);var i=t("#popup_delay_checkbox").prop("checked");t("#popup_delay_input").prop("disabled",!i)},onPopupDelayCheckboxChanged:function(e){t("#popup_delay_input").prop("disabled",!e.target.checked),e.target.checked||this.clearPopupDelay()},clearPopupDelay:function(){this.updateEmbedCodeDelay(""),this.transmitPopupDelay(0)},sanitizePopupDelay:function(t){var e=t.keyCode||t.which;return e<"0".charCodeAt(0)||e>"9".charCodeAt(0)?(t.die(),!1):void 0},changePopupDelay:function(e){window.clearTimeout(this.typingTimer);var i=t(e.target).val();this.typingTimer=window.setTimeout(this.transmitPopupDelay,1200,i),this.updateEmbedCodeDelay(i)},updateEmbedCodeDelay:function(e){var i,s=t("#tab_embed_code").val(),n=s.match("data-delay");i=0==e.length||0==e?this.removeDataDelayAttribute(s):n?this.updateDataDelayAttribute(e,s):this.addDataDelayAttribute(e,s),t("#tab_embed_code").val(i),Mimi.Signups.DATA.sideTabCode=i},addDataDelayAttribute:function(t,e){return e.replace(/(src=".*")/,'$1 data-name="signup_embed" data-delay="'+1e3*t+'"')},removeDataDelayAttribute:function(t){return t.replace(/data-name="signup_embed" data-delay="([0-9]+)"/,"")},updateDataDelayAttribute:function(t,e){return e.replace(/data-delay="([0-9]+)"/,'data-delay="'+1e3*t+'"')},transmitPopupDelay:function(e){var i="/signups/"+Mimi.Signups.DATA.id+"/set_popup_delay.json";t.ajax({url:i,type:"PUT",data:{popup_delay:e}})},getIframeDimensions:function(){var e="/signups/get_iframe_dimensions/"+Mimi.Signups.DATA.id,i=this.logoHeight(),s=this.headerHeight();t.get(e,{logo_height:i,header_height:s}).done(_.bind(this.getIframeDimensionsSuccess,this)).fail(_.bind(this.getIframeDimensionsFailure,this))},getIframeDimensionsSuccess:function(e){if(e.success){var i=e.result.width,s=e.result.has_logo;this.setWidthInput(i),i!==this.defaultWidth&&this.addResetWidth(),t("#styled_webform_html_code").val(e.result.iframe_embed),this.setHtmlEmbedCode(e.result.html_embed),this.removeTabsLoadingTransmitAndDisplayContent(),this.updateIncludeHeaderText(s),t("#styled_webform_html_code").select()}else this.removeTabsLoadingTransmitAndDisplayContent(),this.setWidthInput(this.defaultWidth),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.embed_dialog.getIframeDimensionsSuccess")+"\n"+e.error)},setHtmlEmbedCode:function(t){this.dom.$code.val(t)},getIframeDimensionsFailure:function(t){this.setWidthInput(this.defaultWidth),this.removeTabsLoadingTransmitAndDisplayContent(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.embed_dialog.getIframeDimensionsSuccess")+"\n"+t.error)},updateIncludeHeaderText:function(e){t("#include_header").html(e?I18n.t("MimiFlash.signups.embed_dialog.updateIncludeHeaderText.logo"):I18n.t("MimiFlash.signups.embed_dialog.updateIncludeHeaderText.header"))},onUpdateIframeWidth:function(){var e="/signups/"+Mimi.Signups.DATA.id+"/set_iframe_width.json",i=t("#iframe_width_input").val();i.parseInt()>=this.minWidth&&i.parseInt()<=this.maxWidth?(t.ajax({url:e,type:"PUT",data:{width:i}}).done(_.bind(this.onUpdateIframeWidthSuccess,this)).fail(_.bind(this.onUpdateIframeWidthFailure,this)),this.addSubmittingSpinner()):this.widthViolationErrorMessage(i.parseInt())},onUpdateIframeWidthSuccess:function(t){var e=t.result.width;t.success?(this.setWidthInput(e),this.updateAndSelectIframeEmbedCode(t.result.iframe_embed),e===this.defaultWidth?this.removeResetWidth():this.addResetWidth()):Widget.MimiFlash.error(I18n.t("MimiFlash.signups.embed_dialog.onUpdateIframeWidthSuccess")+"\n"+t.error),this.removeSubmittingSpinner()},onUpdateIframeWidthFailure:function(){this.removeSubmittingSpinner(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.embed_dialog.onUpdateIframeWidthFailure"))},onSetToDefaultWidth:function(){var e="/signups/"+Mimi.Signups.DATA.id+"/set_default_width.json";t.ajax({url:e,type:"PUT"}).done(_.bind(this.onSetToDefaultWidthSuccess,this)).fail(_.bind(this.onSetToDefaultWidthFailure,this)),this.addSubmittingSpinner("iframe_width_submit")},onSetToDefaultWidthSuccess:function(t){t.success?(this.removeResetWidth(),this.setWidthInput(this.defaultWidth),this.updateAndSelectIframeEmbedCode(t.result.iframe_embed)):Widget.MimiFlash.error(I18n.t("MimiFlash.signups.embed_dialog.onSetToDefaultWidthSuccess")+"\n"+t.error),this.removeSubmittingSpinner()},onSetToDefaultWidthFailure:function(){this.removeSubmittingSpinner(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.embed_dialog.onSetToDefaultWidthFailure"))},onHighlightEmbedCode:function(e){t(e.target).css({overflow:"hidden"}).select().css({overflow:"visible"})},setWidthInput:function(e){t("#iframe_width_input").val(e)},addSubmittingSpinner:function(){t("#iframe_width_submit").removeClass("check-mark").css({background:"url(/img/submitting_action.gif) center no-repeat",backgroundColor:"#F1F1F1"})},removeSubmittingSpinner:function(){t("#iframe_width_submit").css({background:"none",backgroundColor:"#F1F1F1"}).addClass("check-mark")},removeResetWidth:function(){t("#reset_width").css({display:"none"})},addResetWidth:function(){t("#reset_width").css({display:"inline"})},onWidthKeyDown:function(t){13===t.keyCode&&this.onUpdateIframeWidth()},removeTabsLoadingTransmitAndDisplayContent:function(){this.loadingBlock&&this.loadingBlock.visible()&&(this.loadingBlock.destroy(),t("#transmitEl").remove()),t("#tabs_content").css({display:"block"}),this.position()},showTransmit:function(){var e=t("<div>").attr("id","transmitEl").css({minHeight:80});t("#main_tabs_section").append(e),this.loadingBlock=new Widget.BlockOverlay({cover:e,zIndex:3500}),this.loadingBlock.show()},updateAndSelectIframeEmbedCode:function(e){t("#styled_webform_html_code").val(e).select()},widthViolationErrorMessage:function(t){if(t<this.minWidth){var e=_.template(I18n.t("MimiFlash.signups.embed_dialog.widthViolationErrorMessage.at_least")),i=e({number:this.minWidth});Widget.MimiFlash.error(i)}else{var s=_.template(I18n.t("MimiFlash.signups.embed_dialog.widthViolationErrorMessage.less_than")),n=s({number:this.maxWidth});Widget.MimiFlash.error(n)}},setIframeHeader:function(e){var i="/signups/"+Mimi.Signups.DATA.id+"/set_iframe_header",s=e.target;if(s.hasAttribute("type"))return t(s).addClass("saving"),t.ajax({url:i,type:"PUT"}).done(_.bind(this.setIframeHeaderSuccess,this)).fail(_.bind(this.setIframeHeaderFailure,this)),!1},setIframeHeaderSuccess:function(e){e.success?(t("#header_checkbox").replaceWith(e.result.include_header?"<input id='header_checkbox' type='checkbox' checked='checked'>":"<input id='header_checkbox' type='checkbox'>"),this.updateAndSelectIframeEmbedCode(e.result.iframe_embed)):Widget.MimiFlash.error(I18n.t("MimiFlash.signups.embed_dialog.setIframeHeaderSuccess")+"\n"+e.error)},setIframeHeaderFailure:function(){t("#header_checkbox").replaceWith("<input id='header_checkbox' type='checkbox'>"),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.embed_dialog.setIframeHeaderFailure"))},headerHeight:function(){return t("div.mimi_webform_header.no_webform_theme_logo").height()},logoHeight:function(){return t("div.mimi_webform_header.has_webform_theme_logo").height()}}).singleton("show"),Mimi.Signups.EmbedDialog.DOM={code:'textarea[name="code"]',sideTabCode:'textarea[name="side_tab_code"]'}}(jQuery),function(t){Mimi.Signups.EditTitleDialog=Class.create(Widget.Dialog,Widget.Observable,{initialize:function($super){$super(I18n.t("MimiFlash.signups.edit_title_dialog.edit_title"),Mimi.Signups.EditTitleDialog.BODY,{hideTrigger:"a.back"}),this.dom=this.$element.getChildren(Mimi.Signups.EditTitleDialog.DOM),this.dom.$ok.on("click",_.bind(this.updateTitle,this))},show:function($super){$super(),this.dom.$title.select()},updateTitle:function(e){e.preventDefault();var i="/signups/"+Mimi.Signups.DATA.id+"/update_title",s=this.dom.$title.val();return s?(this.dom.$ok.addClass("submitting"),t.ajax({url:i,type:"PUT",data:{new_title:s}}).done(_.bind(this.updateTitleSuccess,this)).fail(_.bind(this.updateTitleFailure,this)),!1):Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit_title_dialog.updateTitle"))},updateTitleSuccess:function(e){var i=t(".mimi_webform_header.mimi_webform_logo").find("h1");this.dom.$ok.removeClass("submitting"),e.success?(i.html(e.result.new_title),this.hide()):Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit_title_dialog.updateTitleSuccess")+"\n"+e.error)},updateTitleFailure:function(){this.dom.$ok.removeClass("submitting"),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.edit_title_dialog.updateTitleFailure"))}}).singleton("show"),Mimi.Signups.EditTitleDialog.DOM={ok:"button.primary",title:"input[name=title]",form:"form"},Mimi.Signups.EditTitleDialog.BODY='<form><fieldset><div class="field"><span class="full"><label for="text_to_display">'+I18n.t("MimiFlash.signups.edit_title_dialog.EditTitleDialog.title")+'</label><input type="text" name="title"></span></div><p class="actions"><a class="back" href="#"><svg class=\'iconsvg svg_back\' viewBox=\'0 0 16 16\' aria-hidden=\'true\'>    <path fill="#000" d="M3.285 7.5l3.992-4.5v3.006c2.103 0 6.577 1.723 4.557 5.994 0-3.378-4.557-2.974-4.557-2.974v2.974l-3.992-4.5z"></path>\n</svg><span>'+I18n.t("MimiFlash.signups.edit_title_dialog.EditTitleDialog.cancel")+'</span></a><button class="btn primary" type="submit"><span>'+I18n.t("MimiFlash.signups.edit_title_dialog.EditTitleDialog.ok")+"</span></button></p></fieldset></form>"}(jQuery),function(t){Mimi.Signups.CustomFieldDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.Signups.CustomFieldDialog.DOM),this.templates=Mimi.Signups.Templates.get(),this.customField=Mimi.Signups.CustomField.get(),this.createUI(),this.initializeObservers()},initializeObservers:function(){this.dom.step2.$displayNameInput.on("blur",_.bind(this.autoFillFieldName,this)),this.$element.on("keydown",_.bind(this.onKeyDown,this))},createUI:function(){this.createStep1UI(),this.createStep2UI()},createStep1UI:function(){this.step1=new Widget.Popup("#custom_field_step_1",{hideTrigger:".window_close, .close",overlay:Widget.ModalOverlay,fixedPosition:!1}),this.dom.step1.$ok.on("click",_.bind(this.onStep1Ok,this)),this.dom.step1.$back.on("click",_.bind(this.onStep1Back,this)),this.dom.step1.$windowClose.on("click",_.bind(this.removeDropdown,this))},onStep1Ok:function(t){t.preventDefault(),this.step1.hide(),this.step2.show(),this.isEdit||this.dom.step2.$displayNameInput.select()},onStep1Back:function(t){t.preventDefault(),this.step1.hide(),this.removeDropdown()},removeDropdown:function(){t("#dialog_field_type_dropdown").remove(),this.customField.removeDropdown("custom_field_dialog")},createStep2UI:function(){this.step2=new Widget.Popup("#custom_field_step_2",{hideTrigger:".window_close, .close",overlay:Widget.ModalOverlay,fixedPosition:!1}),this.dom.step2.$ok.on("click",_.bind(this.onStep2Ok,this)),this.dom.step2.$back.on("click",_.bind(this.onStep2Back,this)),this.dom.step2.$windowClose.on("click",_.bind(this.removeDropdown,this))},onStep2Ok:function(t){t.preventDefault();var e=this.dom.step2.$displayNameInput.val(),i=this.dom.step2.$fieldNameInput.val();this.validate(e,i),this.invalid||(e=e.trim().stripTags(),i=i.toLowerCase().trim().split(" ").join("_"),this.submitField(i,e),this.step2hide())},step2hide:function(){this.step2.hide(),this.removeDropdown()},validate:function(t,e){return this.invalid=!1,this.bothFieldsPresent(t,e)?/[-,'?*+#=!@$%^&(){}\[\]:;"\/<>.\\|-]/.exec(e)?(this.invalid=!0,this.fieldNameError()):void 0:(this.invalid=!0,this.missingField())},bothFieldsPresent:function(t,e){return _.blank(t)||_.blank(e)?!1:!0},missingField:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.signups.custom_field_dialog.missingField"))},fieldNameError:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.signups.custom_field_dialog.fieldNameError"))},submitField:function(t,e){var i=this.fieldType();this.isEdit?this.customField.editCustomField(t,e,this.oldFieldName,i):this.customField.addCustomField(t,e,i)},fieldType:function(){return Widget.Dropdown.getInstanceByName("custom_field_dialog").getValue()},onStep2Back:function(t){t.preventDefault(),this.step2.hide(),this.step1.show()},show:function(t,e,i){this.step1.show(),this.oldFieldName=e,this.isEdit=i||!1,this.setInputs(t,e),this.setFieldTypeDropdown()},setInputs:function(t,e){t&&e?(this.dom.step2.$displayNameInput.val(t),this.dom.step2.$fieldNameInput.val(this.sanitize(e))):(this.dom.step2.$displayNameInput.val(""),this.dom.step2.$fieldNameInput.val(""))},sanitize:function(t){return _.capitalize(t.trim().toLowerCase().replace(/[-,_'?*+#=!@$%^&(){}\[\]:;"\/<>.\\|-]/," ").replace(/\s{2,}/," ").replace(/\s$/,""))},setFieldTypeDropdown:function(){this.isEdit?this.fieldTypeDropdownForEdit():this.fieldTypeDropdownForCreate()},fieldTypeDropdownForEdit:function(){var e=t(".mimi_field span[data-field-name='"+this.oldFieldName+"']").closest(".mimi_field"),i=e.find("input.field_type").attr("data-field-type"),s={label:I18n.t("js.signups.custom_field_dialog.fieldTypeDropdownForEdit"),field_type:i,type_capitalized:this.sanitize(i)};this.insertFieldTypeDropdown(s)},insertFieldTypeDropdown:function(t){this.dom.step1.$actions.before(this.templates.customFieldDialogDropdown(t)),this.customField.initializeDropdown("#signup_")},fieldTypeDropdownForCreate:function(){var t={label:I18n.t("js.signups.custom_field_dialog.fieldTypeDropdownForCreate"),field_type:"text_field",type_capitalized:I18n.t("js.signups.custom_field_dialog.text_field")};this.insertFieldTypeDropdown(t)},autoFillFieldName:function(){if(_.blank(this.dom.step2.$fieldNameInput.val())){var t=this.dom.step2.$displayNameInput.val();this.dom.step2.$fieldNameInput.select(),this.dom.step2.$fieldNameInput.val(this.sanitize(t))}},onKeyDown:function(t){27===t.keyCode&&(this.step1.hide(),this.step2.hide(),this.removeDropdown())}}).singleton("show"),_.extend(Mimi.Signups.CustomFieldDialog,{DOM:{step1:{ok:"#custom_field_step_1 p.actions button.continue",back:"#custom_field_step_1 p.actions a.back",windowClose:"#custom_field_step_1 .window_close",actions:"#custom_field_step_1 .actions"},step2:{ok:"#custom_field_step_2 p.actions button.continue",back:"#custom_field_step_2 p.actions a.back",displayNameInput:"#custom_field_step_2 #display_name",fieldNameInput:"#custom_field_step_2 #field_name",windowClose:"#custom_field_step_2 .window_close"}}})}(jQuery),function(t){Mimi.Signups.CustomField=Class.create(Mimi.Signups.Base,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.Signups.CustomField.DOM),this.initializeObservers(),this.templates=Mimi.Signups.Templates.get()},initializeObservers:function(){t(document).on("dropdown:item:selected",_.bind(this.onDropdownItemSelect,this)),t(document).on("click",_.bind(this.customFieldBuilding,this)),this.dom.$createFieldItem.find("button.btn").on("click",_.bind(this.customFieldDialog,this)),this.observersForEditingCustomFields()},observersForEditingCustomFields:function(){t(".mimi_field .actions .btn.action").on("click",_.bind(this.customFieldDialogForEdit,this)),t(".mimi_field span.edit_options").each(_.bind(function(t,e){var i=this.getMimiField(e),s=this.getFieldType(i);if("dropdown"===s){var n=this.getFieldName(i);this.dropdownEditOptionsObserver(e,n)}else this.radioAndCheckboxEditOptionsObserver(e)},this))},prepare:function($super,t,e){$super(t,e)},onDropdownItemSelect:function(e,i){var s=t(i.element).data("value"),n=t('input[type="hidden"][value="'+s+'"]'),o=n.closest(".mimi_field.required");n[0]&&o[0]&&(o.find(".mimi_field_feedback").html(""),this.updateSubmitButton())},updateSubmitButton:function(){var e=!0;t(".mimi_field_feedback").each(function(t,i){_.blank(i.innerHTML)||(e=!1)}),e&&(this.dom.$form.removeClass("mimi_invalid"),this.dom.$submit.val(this.dom.$submit.attr("data-default-text")).enable().prop("className","submit"))},addCustomField:function(t,e,i){if(this.myFieldNamesContains(t))this.duplicateFieldError();else{this.$ul=null;var s={field_name:t,display_name:e,type:i};this.addFieldToSidebar(s),this.addFieldToPreview(s),this.updateFieldDropdownOptions()}},editCustomField:function(e,i,s,n){if(this.newNameIsDuplicate(e,s))this.duplicateFieldError();else{var o=this.getMimiField(t(".check[data-field-name='"+s+"']"));this.$ul=o.find("label").next("ul"),this.transmitForExistingElement(o),this.savingChanges();var a="/signups/"+Mimi.Signups.DATA.id+"/edit_custom_field";t.ajax({url:a,type:"PUT",data:{old_name:s,new_field:e,display_name:i,field_type:n}}).done(_.bind(this.editCustomFieldSuccess,this)).fail(_.bind(this.editCustomFieldFailure,this))}},newNameIsDuplicate:function(t,e){var i=_.reject(this.myFieldNames(),function(t){return t===e});return _.include(i,t)},duplicateFieldError:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.signups.custom_field.duplicateFieldError"))},editCustomFieldSuccess:function(t){this.removeTransmit(),t.success?(this.changesSaved(),this.updateSidebarAfterEdit(t.result),this.updatePreviewAfterEdit(t.result)):(this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.custom_field.editCustomFieldSuccess")+"\n"+t.error))},updateSidebarAfterEdit:function(e){var i=t("#field_"+e.old_name).closest("li");i.remove();var s={field_name:e.name,display_name:e.display_name};this.addFieldToSidebar(s)},updatePreviewAfterEdit:function(t){var e=this.getCheckbox(t.id),i=this.getMimiField(e);i.replaceWith(t.html),this.typeSpecificDetails(t),this.customFieldEditObserver(t.id)},typeSpecificDetails:function(e){var i=e.name,s=e.field_type,n="#signup_"+i;if("text_field"===s)t(n).select();else if("date"===s)t(n).find("span.select").each(function(e,i){Widget.Dropdown.instances[t(i).identify()]=new Widget.Dropdown(i)});else{var o=this.getMimiField(t(n)),a=o.find(".edit_options");this.isCurrentlyAdding()?(this.restoreAddingMode(e),this.toggleEditAndPreviewButton(o),this.optionsFieldObserver(e.field_type,a,i)):e.no_options?(this.addComboInput(i),this.toggleEditAndPreviewButton(o),this.optionsFieldObserver(e.field_type,a,i)):("dropdown"===e.field_type&&this.initializeDropdown(n),this.optionsFieldObserver(e.field_type,a,i))}},isCurrentlyAdding:function(){return this.$ul&&this.$ul.length},restoreAddingMode:function(t){var e=this.getCheckbox(t.id),i=this.getMimiField(e);i.find("label").after(this.$ul),this.addComboInput(t.name)},optionsFieldObserver:function(t,e,i){"dropdown"===t?this.dropdownEditOptionsObserver(e,i):this.radioAndCheckboxEditOptionsObserver(e)},initializeDropdown:function(e){Widget.Dropdown.instances[e]=new Widget.Dropdown(t(e))},radioAndCheckboxEditOptionsObserver:function(e){t(e).on("click",_.bind(function(){var i=this.getMimiField(e),s=i.find("label[data-option='option']").map(function(e,i){return t(i).text()}),n=this.getFieldName(i);return this.optionsEditClass(i),this.toggleEditAndPreviewButton(i),this.addComboAndOptions(s,n),!1},this))},removeDropdown:function(t){var e;e="string"==typeof t?t:this.getDropdownName(t);var i=this.getDropdown(e);i&&(i.destroy(),delete Widget.Dropdown.instances[i.dom.$container.identify()])},editCustomFieldFailure:function(){this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.custom_field.editCustomFieldFailure"))},addComboInput:function(e){var i="#signup_"+e,s={name:e},n=this.getMimiField(t(i));n.addClass("text"),t(i).replaceWith(this.templates.customFieldComboInput(s)),t(i).find("input").select(),t(i).find(".btn.check-mark").on("click",_.bind(this.addOption,this))},addOption:function(e){return this.$clickedElement=t(e.target),this.$mimiField=t(e.target).closest(".mimi_field"),this.noUnorderedList()&&this.buildUnorderedList(),this.$li=this.buildListItem(),this.addLI(),this.$mimiField.find("span.combo_input input").select(),!1},noUnorderedList:function(){return 0===this.$mimiField.find("ul").size()},buildUnorderedList:function(){this.$mimiField.find("span.combo_input").before("<ul></ul>")},buildListItem:function(){var t=this.$mimiField.find(".combo_input input"),e=t.val().trim();return t.val(""),_.blank(e)?void Widget.MimiFlash.error(I18n.t("MimiFlash.signups.custom_field.buildListItem")):this.templates.customFieldListItem({option:e})},addLI:function(){var t=this.$clickedElement.closest(".mimi_field ul"),e=this.$clickedElement.closest(".combo_input");t[0]?(this.removeOldLi(e),e.after(this.$li),this.observersForEditAndDelete(e.next()),e.remove(),this.showAddOptionInput(this.$mimiField)):(t=e.prev("ul"),t.append(this.$li),this.observersForEditAndDelete(t.find("li").last()))},removeOldLi:function(e){t(e).prev().remove()},observersForEditAndDelete:function(t){t.find("span.btn.edit").on("click",_.bind(this.editOption,this)),t.find("span.btn.delete").on("click",_.bind(this.deleteOption,this))},editOption:function(e){var i=t(e.target).closest("li"),s=i.closest("ul"),n=this.getMimiField(i);if(!this.isEditingAnother(s))return this.hideAddOptionInput(n),this.showEditOptionInput(i),this.setEditInputValue(i),s.find(".btn.check-mark").on("click",_.bind(this.addOption,this)),!1},isEditingAnother:function(t){return t.find(".combo_input").length>0},hideAddOptionInput:function(t){var e=t.find(".combo_input"),i=e.closest(".mimi_field ul");i[0]?this.abortEdit(e):e.hide()},showEditOptionInput:function(t){t.hide().after(this.templates.customFieldComboInput({name:"edit_option"}))},showAddOptionInput:function(e){var i=_.find(e.find(".combo_input"),function(e){return!t(e).closest("ul")[0]});t(i).show()},setEditInputValue:function(e){var i=t("#signup_edit_option input"),s=this.getOptionValue(e);i.val(s).focus()},getOptionValue:function(t){return t.data("edit-value")||t.children(":first").text()},deleteOption:function(e){var i=t(e.target).closest("li");if(!this.isEditingAnother(i.closest("ul")))return i.remove(),!1},customFieldBuilding:function(e){var i=t(".mimi_field .combo_input"),s=this.checkIfComboIsForEdit(i);if(!this.dontExecuteDocumentEvent(e,i,s)){if(s)this.abortEdit(s);else{var n=this.getMimiField(i[0]);n.removeClass("edit"),this.collectOptions(n)}return!1
}},checkIfComboIsForEdit:function(e){return _.find(e,function(e){return t(e).closest("ul")[0]})},dontExecuteDocumentEvent:function(e,i,s){if(0===i.size())return!0;if(s){if(t(e.target).closest(".combo_input")[0])return!0}else{var n=t(e.target).closest(".preview");if(n[0])return!1;var o=t(e.target).closest(".mimi_field");if(o.find(".combo_input")[0])return!0}return t(e.target).closest("#custom_field_step_1, #custom_field_step_2")[0]?!0:void 0},abortEdit:function(e){var i=this.getMimiField(e);this.showAddOptionInput(i),t(e).prev().show(),this.storeEditValue(e),e.remove()},storeEditValue:function(e){var i=t(e).prev();i.attr("data-edit-value",t(e).find("input").val())},collectOptions:function(e){var i=_.map(e.find("ul").find("li"),function(e){return t(e).children(":first").text()});0!==i.length&&(this.transmitForExistingElement(e),this.saveOptions(e,i))},saveOptions:function(e,i){this.savingChanges();var s="/signups/"+Mimi.Signups.DATA.id+"/save_field_options",n=this.getFieldName(e);t.ajax({url:s,type:"PUT",data:{options:JSON.stringify(i),field_name:n}}).done(_.bind(this.saveOptionsSuccess,this)).fail(_.bind(this.saveOptionsFailure,this))},saveOptionsSuccess:function(e){if(this.removeTransmit(),e.success){this.changesSaved();var i="#signup_"+e.result.field_name,s=this.getMimiField(t(i));t(i).prev("ul").remove(),s.removeClass("text"),this.toggleEditAndPreviewButton(s),this.updateUIAfterSaveOptions(i,e.result)}else this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.custom_field.saveOptionsSuccess")+"\n"+e.error)},toggleEditAndPreviewButton:function(t){var e=t.find(".preview");e.toggle();var i=t.find(".edit_options");i.toggle()},updateUIAfterSaveOptions:function(e,i){var s=this.getMimiField(t(e)),n=this.getFieldType(s);"dropdown"===n?this.addDropdown(e,i):this.displayOptionsInPreview(e,i)},addDropdown:function(e,i){t(e).replaceWith(i.html),this.initializeDropdown(e)},displayOptionsInPreview:function(e,i){t(e).replaceWith(i.html)},saveOptionsFailure:function(){this.saveChanges(),Widget.MimiFlash.error(I18n.t("MimiFlash.signups.custom_field.saveOptionsFailure"))},dropdownEditOptionsObserver:function(e,i){t(e).on("click",_.bind(function(){var t=this.getMimiField(e),s=this.getDropdownName(t),n=this.getDropdown(s),o=_.map(n.getItems(),function(t){return n.getItemText(t)});return this.optionsEditClass(t),this.removeDropdown(t),this.addComboAndOptions(o,i),this.toggleEditAndPreviewButton(t),!1},this))},addComboAndOptions:function(t,e){this.addComboInput(e),this.showOptions(t,e)},showOptions:function(e,i){var s=t("#signup_"+i);s.before("<ul></ul>");var n=s.prev("ul"),o=this.templates,a=Mimi.Signups.CustomField.get();_.each(e,function(t){var e=o.customFieldListItem({option:t});n.append(e),a.observersForEditAndDelete(n.find("li").last())})},alreadyHasCombo:function(){return t(".mimi_field .combo_input").length>0},finishCurrentEditError:function(){return Widget.MimiFlash.error(I18n.t("MimiFlash.signups.custom_field.finishCurrentEditError"))},customFieldDialog:function(t){t.preventDefault(),Mimi.Signups.CustomFieldDialog.show()},customFieldEditObserver:function(t){var e=this.getCheckbox(t),i=this.getMimiField(e),s=i.find(".actions .btn.action");s.on("click",_.bind(this.customFieldDialogForEdit,this))},customFieldDialogForEdit:function(e){e.preventDefault();var i=t(e.target).closest(".mimi_field"),s=i.find("label").first().text(),n=this.getFieldName(i),o=!0;Mimi.Signups.CustomFieldDialog.show(s,n,o)},optionsEditClass:function(e){t(e).removeClass("focus").addClass("edit")},getMimiField:function(e){return t(e).closest(".mimi_field")},getCheckbox:function(e){return t("#checkbox_parent_node_"+e)},getFieldType:function(e){return t(e).find(".field_type").attr("data-field-type")},getFieldName:function(e){return t(e).find(".actions .check").attr("data-field-name")},getDropdown:function(t){return Widget.Dropdown.getInstanceByName(t)},getDropdownName:function(e){var i=t(e).find("span.select input");return i.prop("name")}}).singleton("prepare","addCustomField","editCustomField"),Mimi.Signups.CustomField.DOM={createFieldItem:"#create_field_item",saveButton:"button.btn.primary.disabled",saveButtonText:"button.btn.primary.disabled span",form:"#ema_signup_form",submit:"#webform_submit_button"}}(jQuery),Mimi.Signups.Templates=Class.create({listItem:function(t){return Template.from("list_item_template")(t)},fieldItem:function(t){return Template.from("field_item_template")(t)},signupFieldPreview:function(t){return Template.from("signup_field_preview_template")(t)},signupListPreview:function(t){return Template.from("signup_list_preview_template")(t)},customFieldComboInput:function(t){return Template.from("custom_field_combo_input")(t)},customFieldListItem:function(t){return Template.from("custom_field_list_item")(t)},customFieldDialogDropdown:function(t){return Template.from("custom_field_dialog_dropdown")(t)}}).singleton(),function(t){Mimi.Signups.WixDialog=Class.create(Widget.Dialog,Widget.Observable,{initialize:function($super){$super("Mad Mimi - Wix Integration",t("#wix_dialog").html()),this.dom=this.$element.getChildren(Mimi.Signups.WixDialog.DOM),this.initializeObservers()},initializeObservers:function(){t("#webform_theme_tab").on("click",_.bind(this.show,this)),this.dom.$ok.on("click",_.bind(this.hide,this))},show:function($super){return this.alreadyShown?!1:(this.alreadyShown=!0,void $super())},hide:function($super){return $super(),t.ajax({url:this.dom.$form.prop("action"),data:this.dom.$form.serialize(),type:"put"}),!1}}).singleton(),Mimi.Signups.WixDialog.DOM={form:"#wix_form",ok:"#wix_form .actions button.primary"}}(jQuery),function(t){Mimi.SocialLinks=Class.create(Widget.Observer,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.SocialLinks.DOM),this.dialog=new Widget.Popup("#add_social_link_dialog",{overlay:Widget.ModalOverlay,hideTrigger:".window_close, .back"}),this.initializeObservers()},initializeObservers:function(){this.dom.$add.on("click",_.bind(this.onAddLink,this)),this.dom.$form.on("click","button",_.bind(this.onFormClicked,this)),this.dom.$form.on("keydown","input.url",_.bind(this.onFormKeyDown,this)),this.dom.$form.on("submit",_.bind(this.onSubmit,this)),this.dom.$icons.on("click",_.bind(this.onLinkSelected,this)),this.dom.$cancel.on("click",_.bind(this.onCancel,this)),this.$element.on("keydown",_.bind(this.onKeyDown,this)),t(window).on("beforeunload",_.bind(this.onBeforeUnload,this))},onAddLink:function(){return this.dom.$icons.html(""),_.each(this.getUnusedIcons(),function(t){this.dom.$icons.append(t.clone(!0))},this),this.dialog.show(),!1},countIcons:function(){return t("#social_links input").filter(function(e,i){return""!==t(i).val().trim()}).length-1},getUnused:function(){return t("#social_links input").filter(function(e,i){return!t(i).val().trim()})},getUnusedIcons:function(){return _.map(this.getUnused(),function(e){return t(e).parents(".field").find("img")})},onLinkSelected:function(e){return t(e.target).is("img")?(this.editLink(e.target,"",!0),this.dialog.hide(),!1):void 0},editLink:function(e,i,s){var n=e.alt,o=t("#"+n);o.show().css({opacity:1}).addClass("editing"),o.find("input").select(),s&&o.scrollToCenter()},onFormClicked:function(e){var i=t(e.currentTarget).detectClass("edit","save","delete");if(i){var s=t(e.currentTarget).parents(".field"),n=s.find("input.url");switch(i){case"edit":this.editLink(s.find("img")[0],s.find("input").val());break;case"delete":s.find("input").val(""),s.fadeOut(300),this.showOrHideMimiVoice(),this.dom.$submit.enable();break;case"save":this.handleSave(n)}return!1}},onFormKeyDown:function(e){13===e.keyCode&&this.handleSave(t(e.target))},handleSave:function(t){var e=t.parents(".field"),i=e.find(".link"),s=this.cleanUrl(t.val()),n=e.attr("data-link-pattern").replace("[[value]]",s);i.attr("href",n).html(n),e.removeClass("editing"),this.showOrHideMimiVoice(),this.dom.$submit.enable()},showOrHideMimiVoice:function(){var t=this.countIcons();0===t?(this.dom.$headersNoLinks.appearSlide(),this.dom.$jumpInArrow.fadeIn(200),this.dom.$headersHasLinks.fadeSlide()):1===t&&this.dom.$headersNoLinks.is(":visible")&&(this.dom.$headersNoLinks.fadeSlide(),this.dom.$jumpInArrow.fadeOut(200),this.dom.$headersHasLinks.appearSlide())},onKeyDown:function(t){var e=String.fromCharCode(t.keyCode).toLowerCase();return(t.metaKey||t.ctrlKey)&&"s"===e?this.onSubmit(t):void 0},onSubmit:function(){var e="/social_links/async_update/"+_.last(this.dom.$form.prop("action").split("/"));return this.dom.$form.prop("action",e),t.ajax({url:e,type:this.dom.$form.attr("method"),data:this.dom.$form.serialize()}).done(_.bind(this.onSubmitSuccess,this)).fail(_.bind(this.onSubmitFailure,this)),this.dom.$submit.disable().html(I18n.t("js.social_links.onSubmit")),!1},onSubmitSuccess:function(){this.dom.$submit.html(I18n.t("js.social_links.onSubmitSuccess"))},onSubmitFailure:function(){this.dom.$submit.enable().html(I18n.t("js.social_links.onSubmitFailure")),Widget.MimiFlash.error(I18n.t("MimiFlash.social_links.onSubmitFailure"))},onCancel:function(){this.dom.$submit.disable()},onBeforeUnload:function(){return this.dom.$submit.prop("disabled")?void 0:I18n.t("js.social_links.onBeforeUnload.start")+"\n\n"+I18n.t("js.social_links.onBeforeUnload.end")},cleanUrl:function(t){return t.trim().replace("http://","").replace("http//","").replace("mailto:","").replace("https://","").escapeHTML()}}).singleton(),Mimi.SocialLinks.DOM={add:"#social_link_add",icons:"#social_link_select .icons",form:"form.edit_social_link",headersNoLinks:".no_social_links",headersHasLinks:".has_social_links",jumpInArrow:"span.jump_in",submit:"div.actions button.primary",cancel:".actions a.btn"}}(jQuery),Mimi.Drips={FREQUENCY_ENGLISH_MAP:{Days:"Days",Weeks:"Weeks",Months:"Months","Day Interval":I18n.t("js.drips.setup.days"),"Week Interval":I18n.t("js.drips.setup.weeks"),"Month Interval":I18n.t("js.drips.setup.months")}},function(t){Mimi.Drips.Drafts={initDrafts:function(){t(".draft_switch").on("click",_.bind(this.onDraftClick,this))},onDraftClick:function(e){var i=t(e.target).closest("a"),s=i.attr("data-campaign-id"),n=i.attr("data-drip-id"),o="/drip_campaigns/"+s+"/drips/"+n,a=i.detectClass("active")?"mark_draft":"unmark_draft";return t.ajax({url:o,type:"put",data:{update_type:a}}).fail(_.bind(this.onDraftClickFailure,this)),"mark_draft"===a?i.removeClass("active"):i.addClass("active"),!1},onDraftClickFailure:function(e,i,s){var n,o=s.parameters.update_type,a=_.last(s.url.split("/")),r=t('.draft_switch[data-drip-id="'+a+'"]').first();"mark_draft"===o?(r.addClass("active"),n=I18n.t("MimiFlash.drips.drafts.make_drip_draft")):(r.removeClass("active"),n=I18n.t("MimiFlash.drips.drafts.activate_draft")),Widget.MimiFlash.error(I18n.t("MimiFlash.drips.drafts.onDraftClickFailure")+" "+n)}}}(jQuery),function(t){Mimi.Drips.Dashboard=Class.create(Widget.Observer,Mimi.Drips.Drafts,{initialize:function(){this.$element=t("#main"),this.dom=this.$element.getChildren(Mimi.Drips.Dashboard.DOM),this.dom.$newDrip.on("click",_.bind(this.onNewDrip,this)),this.dom.$list.on("click","a",_.bind(this.onDripClick,this)),this.initDrafts(),t(".view.meta .btn.primary").on("click",_.bind(this.onAddDrip,this))},onAddDrip:function(e){var i=t(e.currentTarget).closest(".btn");if(i[0])return window.location=i.attr("data-href"),!1},onNewDrip:function(){return Mimi.Drips.NewDripDialog.show(),!1},onDripClick:function(e){var i=t(e.currentTarget).detectClass("play","pause","delete");if(i){var s=t(e.currentTarget).closest("li.drip_campaign_item"),n=_.last(s.identify().split("_")).parseInt();switch(i){case"play":this.startCampaign(s,n);break;case"pause":this.stopCampaign(s,n);break;case"delete":this.deleteCampaign(s,n);break;case"publish_to_sidekicks":this.publishToSidekicks(s,n)}return!1}},isBusyPublishingToSidekick:function(t){return this.data.sidekickPublishings[t]===!0},setPublishingToSidekick:function(t,e){this.data.sidekickPublishings[t]=e},disablePublishBtn:function(t){t.closest("a.btn.publish_to_sidekicks").prop("disabled",!0).closest("span").html(I18n.t("js.drips.dashboard.publishing.busy"))},enablePublishBtn:function(t){t.closest("a.btn.publish_to_sidekicks").prop("disabled",!1).closest("span").html(I18n.t("js.drips.dashboard.publishing.notBusy"))},publishToSidekicks:function(e,i){if(!this.isBusyPublishingToSidekick(i)){this.setPublishingToSidekick(i,!0),this.disablePublishBtn(e);var s=this,n="/sidekicks/drip_campaigns/"+i+"/publishings";t.get(n).done(function(t){s.onPublishToSidekicksSuccess(t,s,e,i)}).fail(function(t){s.onPublishToSidekicksFailure(t,s,e,i)})}},onPublishToSidekicksSuccess:function(t,e,i,s){t.success?Widget.MimiFlash.create(I18n.t("MimiFlash.dripCampaigns.dashboard.publish.success")):Widget.MimiFlash.error(I18n.t("MimiFlash.dripCampaigns.dashboard.publish.failure")+"\n"+t.error),e.setPublishingToSidekick(s,!1),e.enablePublishBtn(i)},onPublishToSidekicksFailure:function(t,e,i,s){e.setPublishingToSidekick(s,!1),e.enablePublishBtn(i),Widget.MimiFlash.error(I18n.t("MimiFlash.dripCampaigns.dashboard.publish.error"))},startCampaign:function(e,i){var s=t.post("/drip_campaigns/"+i+"/enable.json").done(_.bind(this.onStartCampaignSuccess,this)).fail(_.bind(this.onStartCampaignFailure,this));s.data={$item:e,id:i},e.find("span.meta span.drip-sent").html(I18n.t("js.drips.dashboard.startCampaign")),e.find("a.btn.play").disable().find("span").html(I18n.t("js.drips.dashboard.startCampaign"))},onStartCampaignSuccess:function(t,e,i){t.success?(i.data.$item.find("span.meta span.drip-sent").removeClass("drip-paused").addClass("drip-sending").html(I18n.t("js.drips.dashboard.onStartCampaignSuccess.running")),i.data.$item.find("a.btn.play").removeClass("play").addClass("pause").enable().find("span").html(I18n.t("js.drips.dashboard.onStartCampaignSuccess.pause")),Widget.MimiFlash.create(t.result.message)):Widget.MimiFlash.error(I18n.t("MimiFlash.drips.dashboard.onStartCampaignSuccess")+"\n"+t.error)},onStartCampaignFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.drips.dashboard.onStartCampaignFailure"))},stopCampaign:function(e,i){var s=t.post("/drip_campaigns/"+i+"/disable.json").done(_.bind(this.onStopCampaignSuccess,this)).fail(_.bind(this.onStopCampaignFailure,this));s.data={$item:e,id:i},e.find("span.meta span.drip-sent").html(I18n.t("js.drips.dashboard.stopCampaign.pausing")),e.find("a.btn.pause").disable().find("span").html(I18n.t("js.drips.dashboard.stopCampaign.pausing"))},onStopCampaignSuccess:function(t,e,i){t.success?(i.data.$item.find("span.meta span.drip-sent").removeClass("drip-sending").addClass("drip-paused").html(I18n.t("js.drips.dashboard.onStopCampaignSuccess.paused")),i.data.$item.find("a.btn.pause").removeClass("pause").addClass("play").enable().find("span").html(I18n.t("js.drips.dashboard.onStopCampaignSuccess.run")),Widget.MimiFlash.create(t.result.message)):Widget.MimiFlash.error(I18n.t("MimiFlash.drips.dashboard.onStopCampaignSuccess")+"\n"+t.error)},onStopCampaignFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.drips.dashboard.onStopCampaignFailure"))},deleteCampaign:function(t,e){this.deleteConfirmDialog||(this.deleteConfirmDialog=new Widget.ConfirmDialog(I18n.t("MimiFlash.drips.dashboard.deleteCampaign.title"),I18n.t("MimiFlash.drips.dashboard.deleteCampaign.confirm")+"<br><br>"+It.it("MimiFlash.drips.dashboard.deleteCampaign.info",{b:It.tag("strong")}),{onOk:_.bind(this.onDeleteOk,this)})),this.deleteConfirmDialog.show(),this.deleteData={$item:t,id:e}},onDeleteOk:function(){this.deleteData.$item.fadeSlide();var e=t.ajax({url:"drip_campaigns/"+this.deleteData.id+".json",type:"delete"}).done(_.bind(this.onDeleteSuccess,this)).fail(_.bind(this.onDeleteFailure,this));e.data=this.deleteData},onDeleteSuccess:function(t,e,i){t.success||(Widget.MimiFlash.error(I18n.t("MimiFlash.drips.dashboard.onDeleteSuccess")+"\n"+t.error),i.data.$item.appearSlide())},onDeleteFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.drips.dashboard.onDeleteFailure"))}}).singleton(),Mimi.Drips.Dashboard.DOM={newDrip:"#new_drip_campaign",list:".objects.drip-campaigns"}}(jQuery),function(t){Mimi.Drips.NewDripDialog=Class.create(Widget.Popup,Widget.Observer,{initialize:function($super){$super("#new_drip_dialog",{overlay:Widget.ModalOverlay,hideTrigger:".window_close, .back",styles:{position:"absolute",zIndex:10000005,display:"none"}}),this.dom=this.$element.getChildren(Mimi.Drips.NewDripDialog.DOM),this.listSelect=new Mimi.AudienceListSelect(this.dom.$listSelect[0],{itemTextTemplate:Mimi.AudienceListSelect.ITEM_TEXT_FORMAT_WITH_SPAN_TEMPLATE,fixedPosition:!0}),this.dom.$form.on("submit",_.bind(this.validate,this))},show:function($super){$super(),this.dom.$nameInput.select()},validate:function(t){return this.dom.$nameInput.valPlaceholderSafe().trim()?this.dom.$listIdInput.valPlaceholderSafe().trim()?void 0:this.showError(t,this.dom.$listSelectButton):this.showError(t,this.dom.$nameInput)},showError:function(t,e){return e.errorFlash(),!1}}).singleton("show"),Mimi.Drips.NewDripDialog.DOM={form:"form",nameInput:"#drip_campaign_name",listSelect:"span.audience_list_select",listSelectButton:"span.audience_list_select button",listIdInput:"input[name=audience_list]",periodInput:"input[name='drip[period]']",frequencyInput:"input[name='drip[frequency]']",clientSendTimeInput:"input[name='drip[client_send_time]']",sendImmediatelyCheck:"#new_drip_schedule_send_immediately"},t(function(){"show"===State.get("new","false")&&Mimi.Drips.NewDripDialog.show()})}(jQuery),function(t){Mimi.Drips.Edit=Class.create(Widget.Observer,Mimi.Drips.Drafts,{initialize:function(){this.$element=t("#main"),this.dom=this.$element.getChildren(Mimi.Drips.Edit.DOM),this.toggleDripBrightness(),this.intializeObservers(),this.initDrafts();var e=State.get("drip");e&&Mimi.Drips.DripDetailsDialog.show(this.getDrip(e)),this.dom.$save.disable(),this.tabs=new Widget.Tabs(this.dom.$tabs[0],{noState:!0})},tryDisplayDripDetailsDialog:function(){var t=State.get("drip");t&&Mimi.Drips.DripDetailsDialog.show(this.getDrip(t))},performSave:function(){this.save(this.afterSave)},intializeObservers:function(){t(".add_drip").on("click",_.bind(this.onAddDrip,this)),t(".add_raw_drip").on("click",_.bind(this.onAddRawDrip,this)),t("#new_drip_not_on_weekend").on("click",_.bind(this.onCampaignChanged,this)),this.dom.$stack.on("click",_.bind(this.onStackClick,this)),this.dom.$titleField.on("keydown",_.bind(this.onCampaignChanged,this)),this.dom.$clientSendTimeButton.on("click",_.bind(this.onCampaignChanged,this)),this.dom.$pause.on("click",_.bind(this.onPauseClick,this)),this.dom.$save.on("click",_.bind(this.onSaveClick,this)),this.dom.$delete.on("click",_.bind(this.onDeleteClick,this)),this.$element.on("keydown",_.bind(this.onKeyDown,this)),t(document).on("drip:changed",_.bind(this.onDripChanged,this)),this.dom.$stack[0]&&this.makeStackSortable(),t(window).on("beforeunload",_.bind(this.onBeforeUnload,this))},onAddDrip:function(){return this.needsSaving()?this.confirmSave(this.addDrip):this.addDrip(),!1},onAddRawDrip:function(){return this.needsSaving()?this.confirmSave(this.addRawDrip):this.addRawDrip(),!1},addDrip:function(){window.location=Mimi.Drips.Data.newDripPath},addRawDrip:function(){window.location=Mimi.Drips.Data.newRawDripPath},confirmSave:function(t){if(!this.confirmSaveDialog){var e=I18n.t("MimiFlash.drips.edit.confirmSave.confirm")+"<br><br>"+I18n.t("MimiFlash.drips.edit.confirmSave.info"),i={onOk:_.bind(this.onSaveConfirmed,this),onHide:_.bind(this.onSaveCancelled,this)};this.confirmSaveDialog=new Widget.ConfirmDialog(I18n.t("MimiFlash.drips.edit.confirmSave.title"),e,i)}this.afterSave=t,this.confirmSaveDialog.show()},onSaveConfirmed:function(){this.save(this.afterSave)},onSaveCancelled:function(){this.afterSave&&(this.noSavingRequired(),this.afterSave())},onStackClick:function(e){var i=t(e.target).closest("a"),s=i[0]?i.detectClass("drip-edit","drip-details","drip-clone","drip-stats","drip-delete"):null;if(i[0]&&s){var n=i.parents("li.drip_item"),o=this.getDripId(n),a=this.getDrip(o);switch(s){case"drip-details":return Mimi.Drips.DripDetailsDialog.show(a),!1;case"drip-edit":return Widget.ModalOverlay.show(),this.needsSaving()?this.save(_.bind(this.edit,this,a)):this.edit(a),!1;case"drip-clone":return this.clone(a),!1;case"drip-delete":return this.trash(a),!1}}},onDripOrderChange:function(){this.updateDripPositions()},onDripOrderUpdate:function(){this.updateDripPositions(),this.onCampaignChanged()},onDripChanged:function(t,e){1===e.drip.position&&(Mimi.Drips.Data.campaign.send_immediately=e.sendImmediately),this.updateDripPositions(),this.save()},onCampaignChanged:function(){this.dom.$save.enable()},onKeyDown:function(t){var e=String.fromCharCode(t.keyCode).toLowerCase();(t.metaKey||t.ctrlKey)&&"s"===e&&this.onSaveClick(t)},onSaveClick:function(){return this.save(),!1},onBeforeUnload:function(){return this.needsSaving()?I18n.t("MimiFlash.drips.edit.onBeforeUnload.start")+"\n\n"+I18n.t("MimiFlash.drips.edit.onBeforeUnload.end"):void 0},onPauseClick:function(){!Mimi.Drips.Data.campaign.enabled&&Mimi.Drips.Data.campaign.send_immediately?(this.confirmPauseDialog||(this.confirmPauseDialog=new Widget.ConfirmDialog(I18n.t("MimiFlash.drips.edit.onPauseClick.title"),I18n.t("MimiFlash.drips.edit.onPauseClick.body"),{onOk:_.bind(this.onPauseOk,this)})),this.confirmPauseDialog.show()):this.togglePause()},onPauseOk:function(){this.togglePause()},togglePause:function(){Mimi.Drips.Data.campaign.enabled=!Mimi.Drips.Data.campaign.enabled,this.save()},save:function(e){this.afterSave=e;var i=Mimi.Drips.Data.campaign,s=i.drips;i.name=this.dom.$titleField.val(),i.client_send_time=this.dom.$clientSendTimeField.val(),i.drips=_.sortBy(s,function(t){return t.position}),i.skip_on_weekend=t("#new_drip_not_on_weekend").prop("checked"),this.dom.$title.html(i.name),t.post(Mimi.Drips.Data.saveCampaignPath,{_method:"put",drip_campaign:JSON.stringify(Mimi.Drips.Data.campaign)}).done(_.bind(this.onSaveSuccess,this)).fail(_.bind(this.onSaveFailure,this)),this.dom.$save.disable().html(I18n.t("js.drips.edit.save"))},onSaveSuccess:function(t){t.success?(this.dom.$pause.find("span").html(Mimi.Drips.Data.campaign.enabled?I18n.t("js.drips.edit.onSaveSuccess.pause"):I18n.t("js.drips.edit.onSaveSuccess.start")),this.dom.$save.html(I18n.t("js.drips.edit.onSaveSuccess.save")),this.afterSave&&this.afterSave()):(this.dom.$save.enable().html(I18n.t("js.drips.edit.onSaveSuccess.save")),Widget.MimiFlash.error(I18n.t("MimiFlash.drips.edit.onSaveSuccess.error")+"\n"+t.error))},onSaveFailure:function(){this.dom.$save.enable().html(I18n.t("js.drips.edit.onSaveFailure")),Widget.MimiFlash.error(I18n.t("MimiFlash.drips.edit.onSaveFailure"))},needsSaving:function(){return!this.dom.$save.prop("disabled")},noSavingRequired:function(){this.dom.$save.disable()},edit:function(e){Widget.ModalOverlay.show(),window.location=t("#drip_"+e.id).find("a.drip-edit").attr("href")},clone:function(e){var i=t("#drip_"+e.id).find("a.drip-clone"),s=t.post(i.attr("href")+".json").done(_.bind(this.onCloneSuccess,this)).fail(_.bind(this.onCloneFailure,this));i.find("span").html(I18n.t("js.drips.edit.clone")),s.drip=e},onCloneSuccess:function(e,i,s){if(e.success)try{Mimi.Drips.Data.campaign.drips.push(e.drip.data),this.dom.$stack.append(e.drip.html),t.scrollTo(this.dom.$addDrip,400),this.makeStackSortable()}catch(n){this.onCloneFailure(s)}else Widget.MimiFlash.error(I18n.t("MimiFlash.drips.edit.onCloneSuccess")+"\n"+e.error);var o=t("#drip_"+s.drip.id).find("a.drip-clone span");o.html(I18n.t("js.drips.edit.onCloneSuccess")),this.toggleDripBrightness()},onCloneFailure:function(e){Widget.MimiFlash.error(I18n.t("MimiFlash.drips.edit.onCloneFailure"));var i=t("#drip_"+e.drip.id).find("a.drip-clone span");i.html(I18n.t("js.drips.edit.onCloneFailure"))},trash:function(t){this.confirmTrashDialog||(this.confirmTrashDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onTrashOk,this)})),this.trashDrip=t,this.confirmTrashDialog.show(I18n.t("MimiFlash.drips.edit.trash.body")+" "+t.name+"?")},onTrashOk:function(){var e=this.trashDrip,i=t("#drip_"+e.id),s=t.post(i.find("a.drip-delete").attr("href")+".json",{_method:"delete"}).done(_.bind(this.onTrashSuccess,this)).fail(_.bind(this.onTrashFailure,this));s.$li=i,i.fadeSlide({after:_.bind(this.updateDripPositions,this)})},onTrashSuccess:function(t,e,i){if(t.success){var s=this.getDripId(i.$li);Mimi.Drips.Data.campaign.drips=_.select(Mimi.Drips.Data.campaign.drips,function(t){return t.id!==s}),i.$li.remove()}else i.$li.appearSlide({after:_.bind(this.updateDripPositions,this)}),Widget.MimiFlash.error(I18n.t("MimiFlash.drips.edit.onTrashSuccess")+"\n"+t.error)},onTrashFailure:function(t,e,i){i.$li.appearSlide({after:_.bind(this.updateDripPositions,this)}),Widget.MimiFlash.error(I18n.t("MimiFlash.drips.edit.onTrashFailure"))},onDeleteClick:function(){return this.confirmDeleteDialog||(this.confirmDeleteDialog=new Widget.ConfirmDialog(I18n.t("MimiFlash.drips.edit.onDeleteClick.title"),I18n.t("MimiFlash.drips.edit.onDeleteClick.body"),{onOk:_.bind(this.onDeleteOk,this)})),this.confirmDeleteDialog.show(),!1},onDeleteOk:function(){var e=t('<form style="display:none" method="post" action="'+this.dom.$delete.attr("href")+'">');e.appendTo("body");var i=t('<input type="hidden" name="_method" value="delete">');e.append(i),e.submit(),Widget.ModalOverlay.show()},updateDripPositions:function(){var e=this.dom.$stack.find("li.drip_item:not(.ui-sortable-placeholder):visible"),i=[];_.each(e,function(e){var s=this.getDripId(t(e)),n=this.getDrip(s);i[n.position]={frequency:n.frequency,period:n.period}},this),_.each(e,function(e,s){var n=t(e);0===s?(n.find(".delay_first").show(),n.find(".delay").hide()):(n.find(".delay_first").hide(),n.find(".delay").show());var o=this.getDrip(this.getDripId(n)),a=i[s+1]||i[o.position];if(o.position=s+1,o.frequency=a.frequency,o.period=a.period,n.find("span.drip-number").html(s+1),n.find("h3 a").html(o.subject),1===o.position)if(Mimi.Drips.Data.campaign.send_immediately)n.find(".delay_first").html(I18n.t("js.drips.edit.updateDripPositions"));else{var r=I18n.t("js.drip_campaigns.drip_item.send.frequency."+o.frequency,{count:parseInt(o.period)});n.find(".delay_first").html(I18n.t("js.drip_campaigns.drip_item.send.first.send_after_delay",{delay:r}))}else{var r=I18n.t("js.drip_campaigns.drip_item.send.frequency."+o.frequency,{count:parseInt(o.period)});n.find(".delay").html(I18n.t("js.drip_campaigns.drip_item.send.not_first.send_after_delay",{delay:r}))}},this)},makeStackSortable:function(){this.dom.$stack.sortable({items:".drip_item",handle:".drag",axis:"y",change:_.bind(this.onDripOrderChange,this),update:_.bind(this.onDripOrderUpdate,this)})},toggleDripBrightness:function(){this.dom.$stack.find("li figure div.content").toggleBrightness(null,"ui_dark","ui_light")},getDrip:function(t){return t=parseInt(t),_.detect(Mimi.Drips.Data.campaign.drips,function(e){return e.id===t})},getDripId:function(t){return parseInt(_.last(t.identify().split("_")),10)}}).singleton(),Mimi.Drips.Edit.DOM={title:"header.with_workspace h2 span.name",stack:"ol.drips",pause:"#action_nav button.primary_do",titleField:"#drip_details input[type=text]",clientSendTimeField:"#drip_details input[type=hidden]",clientSendTimeButton:"#drip_details button.secondary",save:"#drip_details button.primary","delete":"#action_nav a.delete",tabs:"#drip_details_section ul.tabs",addDrip:"#drip_add_promo a.add_drip.mega"}}(jQuery),function(t){Mimi.Drips.DripDetailsDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.Drips.DripDetailsDialog.DOM),this.createUI(),this.periodSelect=Widget.Dropdown.getInstanceByName("drip_campaign[period]"),this.frequencySelect=Widget.Dropdown.getInstanceByName("drip_campaign[frequency]")},createUI:function(){this.createStep1UI(),this.createStep2UI()},createStep1UI:function(){this.step1=new Widget.Popup("#drip-details-step-1",{hideTrigger:".window_close, .close",overlay:Widget.ModalOverlay,fixedPosition:!1,onHiding:_.bind(this.step1ValidateCancel,this)}),this.dom.step1.$form.on("click",_.bind(this.onStep1Click,this)),this.dom.step1.$ok.on("click",_.bind(this.onStep1Ok,this)),this.dom.step1.$back.on("click",_.bind(this.onStep1Back,this)),this.dom.step1.$subject.on("keyup",_.bind(this.step1Validate,this)),this.dom.step1.$fromName.on("keyup",_.bind(this.step1Validate,this)),this.dom.step1.$fromAddress.on("keyup",_.bind(this.step1Validate,this)),this.dom.step1.$subject.on("blur",_.bind(this.step1Validate,this)),this.dom.step1.$fromName.on("blur",_.bind(this.step1Validate,this)),this.dom.step1.$fromAddress.on("blur",_.bind(this.step1Validate,this)),this.dom.step1.$fromAddress.on("keyup",_.bind(this.warnBouncyFrom,this)),this.dom.step1.$sendImmediately.on("click",_.bind(this.step1SendImmediatelyClick,this))},createStep2UI:function(){this.step2=new Widget.Popup("#drip-details-step-2",{hideTrigger:".window_close, .close",overlay:Widget.ModalOverlay,fixedPosition:!1}),this.dom.step2.$ok.on("click",_.bind(this.onStep2Ok,this)),this.dom.step2.$back.on("click",_.bind(this.onStep2Back,this))},show:function(t){this.drip=t,t&&(this.setTitle(),this.setData(),this.step1Validate(),this.step1.show())},setTitle:function(){this.drip&&this.drip.promotion&&t(".send_promo_dialog header h1").html(this.drip.promotion.name)},setData:function(){var t=this.drip.subject,e=null==this.drip.from_address?Mimi.User.organization_name:this.drip.from_address.getEmailName(),i=null==this.drip.from_address?Mimi.User.email:this.drip.from_address.getEmailAddress();if(this.dom.step1.$subject.val(t),this.dom.step1.$fromName.val(e),this.dom.step1.$fromAddress.val(i),this.warnBouncyFrom(),this.dom.step1.$address.parents(".field")[null==Mimi.User.postal_address||""===Mimi.User.postal_address.trim()?"show":"hide"](),this.dom.step1.$linkTracking.prop("checked",this.drip.link_tracking_enabled),this.dom.step1.$facebookShare.prop("checked",this.drip.promotion.facebook_share),this.dom.step1.$twitterShare.prop("checked",this.drip.promotion.twitter_share),this.dom.step1.$plusoneShare.prop("checked",this.drip.promotion.plusone_share),this.dom.step1.$pinterestShare.prop("checked",this.drip.promotion.pinterest_share),this.dom.step1.$linkedInShare.prop("checked",this.drip.promotion.linked_in_share),this.periodSelect.setSelection(this.drip.period),this.frequencySelect.setSelection(this.drip.frequency),1===this.drip.position){this.dom.step1.$sendImmediatelyCheckField.show();var s=Mimi.Drips.Data.campaign.send_immediately;this.dom.step1.$sendImmediately.prop("checked",s),s?this.dom.step1.$sendFrequencyField.hide():this.dom.step1.$sendFrequencyField.show(),this.dom.step1.$delay_text_not_first.hide(),this.dom.step1.$delay_text_first.show()}else this.dom.step1.$sendImmediatelyCheckField.hide(),this.dom.step1.$sendFrequencyField.show(),this.dom.step1.$delay_text_first.hide(),this.dom.step1.$delay_text_not_first.show()},onStep1Click:function(e){var i=this.frequencySelect.dom.$button,s=this.periodSelect.dom.$button,n=t(e.target);n[0]!=s[0]&&n[0]!=i[0]&&(n=t(e.target).parents("#"+i.identify()+", #"+s.identify())),n[0]===s[0]?(this.frequencySelect.hide(!0),s.focus()):n[0]===i[0]?(this.periodSelect.hide(!0),i.focus()):(this.frequencySelect.hide(!0),this.periodSelect.hide(!0))},onStep1Ok:function(){if(this.step1.hide(),this.dom.step2.$name.html(this.drip.name),this.dom.step2.$subject.html(this.dom.step1.$subject.val()),this.dom.step2.$from.html(Mimi.Drips.Templates.FROM_TEMPLATE({name:this.dom.step1.$fromName.val(),address:this.dom.step1.$fromAddress.val()})),1===this.drip.position&&this.dom.step1.$sendImmediately.prop("checked"))this.dom.step2.$send.html(I18n.t("js.drip_campaigns.drip_item.send.first.send_immediately"));else{var t=this.periodSelect.getValue(),e=this.frequencySelect.getValue().split(" ")[0].toLowerCase();this.dom.step2.$send.html(I18n.t("js.drips.details_dialog."+e,{count:+t}))}return this.dom.step2.$previewLink.prop("href",this.drip.promotion.mimio_link+"/preview"),this.dom.step2.$previewLink.css({background:this.drip.promotion.outer_background_color}),this.dom.step2.$previewThumb.prop("src",this.drip.promotion.thumbnail_url),this.step2.show(),!1},onStep1Back:function(){return this.step1.hide(),!1},warnBouncyFrom:function(){var t=this.dom.step1.$fromAddress.val();Mimi.DmarcAddress.isMatch(t)?this.dom.step1.$fromAddress.addClass("bad-sender"):this.dom.step1.$fromAddress.removeClass("bad-sender")},step1Validate:function(){var t=this.dom.step1.$subject.val().trim()&&this.dom.step1.$fromName.val().trim()&&this.dom.step1.$fromAddress.val().isEmail();this.dom.step1.$ok[t?"enable":"disable"]()},step1ValidateCancel:function(){return null==this.drip.from_address||""===this.drip.from_address.trim()?(Widget.MimiFlash.error(I18n.t("MimiFlash.drips.drip_details_dialog.step1ValidateCancel.no_from")),this.dom.step1.$fromAddress.errorFlash(),!1):null==this.drip.subject||""===this.drip.subject.trim()?(Widget.MimiFlash.error(I18n.t("MimiFlash.drips.drip_details_dialog.step1ValidateCancel.no_subject")),this.dom.step1.$subject.errorFlash(),!1):!0
},step1SendImmediatelyClick:function(){var t=this.dom.step1.$sendImmediately.prop("checked");t?this.dom.step1.$sendFrequencyField.hide():this.dom.step1.$sendFrequencyField.show()},onStep2Ok:function(){return this.finalizeSave(),!1},onStep2Back:function(){return this.step2.hide(),this.step1.show(),!1},finalizeSave:function(){this.drip.subject=this.dom.step1.$subject.val(),this.drip.from_address=this.dom.step1.$fromName.val().stripHTML()+" <"+this.dom.step1.$fromAddress.val()+">",this.drip.period=this.periodSelect.getValue(),this.drip.frequency=this.frequencySelect.getValue(),this.drip.promotion.facebook_share=this.dom.step1.$facebookShare.prop("checked"),this.drip.promotion.twitter_share=this.dom.step1.$twitterShare.prop("checked"),this.drip.promotion.plusone_share=this.dom.step1.$plusoneShare.prop("checked"),this.drip.promotion.pinterest_share=this.dom.step1.$pinterestShare.prop("checked"),this.drip.promotion.linked_in_share=this.dom.step1.$linkedInShare.prop("checked"),this.drip.link_tracking_enabled=this.dom.step1.$linkTracking.prop("checked"),this.fire("drip:changed",{drip:this.drip,sendImmediately:this.dom.step1.$sendImmediately.prop("checked")}),this.step2.hide()}}).singleton("show"),Mimi.Drips.Templates={FROM_TEMPLATE:_.template("#{name} <span>&lt;#{address}&gt;</span>")},_.extend(Mimi.Drips.DripDetailsDialog,{DOM:{step1:{form:"#drip-details-step-1",ok:"#drip-details-step-1 p.actions button.primary",back:"#drip-details-step-1 p.actions a.back",fromName:"#drip-details-step-1 #send_from_name",fromAddress:"#drip-details-step-1 #send_from_email",subject:"#drip-details-step-1 #send_subject",address:"#drip-details-step-1 #user_address",linkTracking:"#drip-details-step-1 #send_enable_link_tracking",sendFrequencyField:"#drip-details-step-1 div.send_frequency",sendImmediatelyCheckField:"#drip-details-step-1 div.send_immediately_check",sendImmediately:"#send_immediately_details_check",facebookShare:"#drip-details-step-1 #facebook_share",twitterShare:"#drip-details-step-1 #twitter_share",plusoneShare:"#drip-details-step-1 #plusone_share",pinterestShare:"#drip-details-step-1 #pinterest_share",linkedInShare:"#drip-details-step-1 #linked_in_share",delay_text_first:"#drip-details-step-1 #delay_text_first",delay_text_not_first:"#drip-details-step-1 #delay_text_not_first"},step2:{ok:"#drip-details-step-2 p.actions button.primary",back:"#drip-details-step-2 p.actions a.back",name:"#drip-details-step-2 dd.name",subject:"#drip-details-step-2 dd.subject",from:"#drip-details-step-2 dd.from",send:"#drip-details-step-2 dd.send",previewLink:".send_promo_preview a",previewThumb:".send_promo_preview img"}}})}(jQuery),Mimi.Plans={},Mimi.Plans.Data=Class.create({setData:function(t){this.data=t},getPlanByNumContacts:function(t){return _.detect(this.data,function(e){return e.maxContacts===t})},getPlanById:function(t){return _.detect(this.data,function(e){return e.id.toString()===t.toString()})},planHasUnlimitedMailingCredits:function(t){return parseInt(t.mailing_credits,10)===Mimi.Plans.Data.UNLIMITED_CREDITS},getFreePlan:function(){return jQuery.grep(this.data,function(t){return t.free_plan})}}).singleton("setData"),Mimi.Plans.Data.UNLIMITED_CREDITS=Math.pow(2,31)-1,function(t){var e={featuresList:"ul#custom_plan_features",total:"#custom_plan_total"};Mimi.Plans.ChoosePlan=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#plan_create"),this.dom=this.$element.getChildren(e),this.dropdown=Widget.Dropdown.getInstanceByName("plan_id"),this.initData(),this.initTemplates(),this.initObservers(),this.initInitialPlan()},initTemplates:function(){this.freePlanFeaturesTemplate=Template.from("free_plan_features_template"),this.paidPlanFeaturesTemplate=Template.from("paid_plan_features_template"),this.freePlanTotalTemplate=Template.from("free_plan_total_template"),this.paidPlanTotalTemplate=Template.from("paid_plan_total_template")},initObservers:function(){this.dropdown.options.onItemClick=_.bind(this.itemSelected,this)},initData:function(){this.data=Mimi.Plans.Data.get()},initInitialPlan:function(){var t=this.data.getPlanById(parseInt(this.dropdown.getValue()));this.setPlanDetails(t)},itemSelected:function(t,e,i){var s=parseInt(i),n=this.data.getPlanById(s);this.setPlanDetails(n)},hasPaypal:function(){return Mimi.Plans.info.hasPaypal},setPlanDetails:function(t){var e=t.cents.centsToDollars(),i=t.mailing_credits===Mimi.Plans.Data.UNLIMITED_CREDITS?"Unlimited":t.mailing_credits.formatThousands();t.cents>0?(this.dom.$featuresList.html(this.paidPlanFeaturesTemplate({emails:i})),this.dom.$total.html(this.paidPlanTotalTemplate({price:e}))):(this.dom.$featuresList.html(this.freePlanFeaturesTemplate({emails:i})),this.dom.$total.html(this.freePlanTotalTemplate()))}}).singleton()}(jQuery),function(t){Mimi.Plans.ChangePlanColumn=Class.create(Widget.Observer,{initialize:function(e,i){if(this.$element=t(e),this.index=i,this.dom=this.$element.getChildren(Mimi.Plans.ChangePlanColumn.DOM),this.dom.$credits=t(".feature_list dd").first().find("span").eq(i),this.currentPlanCents=Mimi.Plans.ChangePlan.getCurrentChargeCents(),this.dom.$dropdown.length>0){this.dropdown=new Widget.Dropdown(this.dom.$dropdown[0],{onItemClick:_.bind(this.onPlanSelected,this)});var s=Mimi.Plans.ChangePlan.getCurrentAudienceLimit()===Mimi.Plans.ChangePlan.getMaxPlan().max_contacts;2===i&&s&&this.dropdown.setSelection(this.dropdown.getItems().last()),this.onPlanSelected()}this.dom.$button.on("click",_.bind(this.onUpgradeClick,this))},onPlanSelected:function(){var t=this.getSelectedPlan();this.updateCostText(t),this.updateCreditsText(t),this.updateButton(t)},onUpgradeClick:function(){var t=this.getSelectedPlan();t?Mimi.Plans.ChangePlan.upgrade(this.getSelectedPlanId()):window.location="mailto:support@madmimi.com?subject=I%20need%20a%20custom%20plan%20please..."},getSelectedPlan:function(){return this.dom.$dropdown.length>0?Mimi.Plans.ChangePlan.findPlan(this.getSelectedPlanId()):Mimi.Plans.ChangePlan.findFreePlan()},getSelectedPlanId:function(){return this.dom.$dropdown.length>0?parseInt(this.dropdown.getValue()):Mimi.Plans.ChangePlan.findFreePlan().id},updateCostText:function(t){if(t){var e=Math.round(t.cents/100);this.dom.$price.html("<small>$</small>"+e)}else this.dom.$price.html("???")},updateButton:function(t){t?t.cents===this.currentPlanCents?this.dom.$button.disable().addClass("your_plan").html(I18n.t("MimiFlash.plans.updateButton.your_plan")):t.cents>this.currentPlanCents?this.dom.$button.enable().removeClass("your_plan").html(I18n.t("MimiFlash.plans.updateButton.upgrade")):t.cents<this.currentPlanCents&&this.dom.$button.enable().removeClass("your_plan").html(I18n.t("MimiFlash.plans.updateButton.downgrade")):this.dom.$button.enable().removeClass("your_plan").html(I18n.t("MimiFlash.plans.updateButton.email"))},updateCreditsText:function(t){if(t){var e=2147483647===t.mailing_credits?I18n.t("js.plans.change_plan.updateCreditsText"):t.mailing_credits.formatThousands()+"*";this.dom.$credits.html(e)}else this.dom.$credits.html("???")}}),Mimi.Plans.ChangePlanColumn.DOM={dropdown:".number_of_contacts .select",plan:".number_of_contacts .select input",price:".price .dollar_price",button:"button.upgrade"},Mimi.Plans.ChangePlan=Class.create(Widget.Observer,{initialize:function(){function e(t){if(t.gaq_ab_count<10)try{_gaq.push(["_trackPageview","/plans/change_plan_b"])}catch(i){debug("Error tracking /plans/change_plan_b",i),t.gaq_ab_count++,setTimeout(e,1e3,t)}}this.gaq_ab_count=0,setTimeout(e,1e3,this),this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.Plans.ChangePlan.DOM),this.upgradeDetailsPathTemplate=Template.from("update_details_path_template"),this.initData(),this.initWizard(),this.initObservers(),this.dom.$columns.each(function(t,e){new Mimi.Plans.ChangePlanColumn(e,t)}),null!=Mimi.Plans.info.custom_plan_id&&(this.data.newServiceLevelId=Mimi.Plans.info.custom_plan_id,this.paymentConfirmed())},initData:function(){this.data={newServiceLevelId:null,updowngrade:"up",plans:Mimi.Plans.Data.get()}},initWizard:function(){var t={overlay:Widget.ModalOverlay,hideTrigger:".window_close, .back"};this.payConfirm=new Widget.Popup(this.dom.$confirmDialog,t),this.paySubmit=new Widget.Popup(this.dom.$submitDialog,t),this.paySuccess=new Widget.Popup(this.dom.$successDialog,t),this.payFail=new Widget.Popup(this.dom.$failDialog,t)},initObservers:function(){this.dom.$submitPaymentScope.on("click",_.bind(this.paymentConfirmed,this)),this.dom.$downgradeToFreeLink&&this.dom.$downgradeToFreeLink.on("click",_.bind(this.onDowngradeToFreeLink,this)),this.dom.$submitPaymentbtn.on("click",_.bind(this.trySubmitPayment,this))},upgrade:function(t){var e=this.findPlan(t);this.data.newServiceLevelId=t,this.noteUpOrDown(this.getCurrentChargeCents(),e.cents),this.updateTheWizard(e),this.confirmOrCheckout()},findPlan:function(t){return this.data.plans.getPlanById(t)},findFreePlan:function(){return this.freePlan?this.freePlan:this.data.plans.getFreePlan()?this.data.plans.getFreePlan()[0]:void 0},confirmOrCheckout:function(){if(this.isCurrentlyFree()){var t=this.upgradeDetailsPathTemplate({level:this.data.newServiceLevelId});window.location=t}else this.payConfirm.show()},ensurePlanType:function(t,e){var i=t.$element.find(".plan_summary"),s=Mimi.getServiceLevelTypes();_.each(s,function(t){i.removeClass(t)}),i.addClass(e)},hasCard:function(){return Mimi.Plans.info.hasCard},isCurrentlyFree:function(){return Mimi.Plans.info.currentlyFree},validateCVV:function(){return this.isCVVPresent()?(this.dom.$creditCardCode.removeClass("error"),!0):(this.dom.$creditCardCode.addClass("error"),!1)},isCVVPresent:function(){return!_.blank(this.grabCVV())||!this.dom.$creditCardCode.parents("li").is(":visible")},grabCVV:function(){return this.dom.$creditCardCode.val()},busySubmitting:function(){this.dom.$submitDialog.find(".plan_summary").addClass("loading"),this.dom.$submitDialog.find("p.totals").show(),this.dom.$submitDialog.find("ul.totals").hide();var t=Mimi.Plans.ChangePlan.TEMPLATES.submitbtn.busy();this.dom.$submitPaymentbtn.find("span").html(t),this.dom.$submitPaymentbtn.addClass("disabled"),this.dom.$submitPaymentbtn.prop("disabled",!0)},doneSubmitting:function(){this.dom.$submitDialog.find(".plan_summary").removeClass("loading"),this.dom.$submitDialog.find("p.totals").hide(),this.dom.$submitDialog.find("ul.totals").show();var t=this.getSuccessTotalCents(),e=this.calculateSalesTaxCents(t),i=(t+e).centsToDollars(),s=Mimi.Plans.ChangePlan.TEMPLATES.submitbtn.text({amount:i,currency:"$"});this.dom.$submitPaymentbtn.find("span").html(s),this.dom.$submitPaymentbtn.removeClass("disabled"),this.dom.$submitPaymentbtn.prop("disabled",!1)},performUpgrade:function(){this.busySubmitting();var t=Mimi.Plans.info.billingUrl+"/api/accounts/"+Mimi.Plans.info.userId+"/change_plan.json",e={plan_id:this.data.newServiceLevelId};Mimi.Plans.info.hasPaypal||(e.credit_card={credit_card_code:this.grabCVV()});var i=jQuery.ajax({url:t,type:"PUT",contentType:"application/json",data:JSON.stringify(e),dataType:"json",headers:{Authorization:"Basic "+Mimi.Plans.info.identification}});i.done(_.bind(this.interpretSuccess,this)),i.fail(_.bind(this.interpretFailure,this))},interpretSuccess:function(){this.showSuccessMessage();try{_gaq.push(this.isUpgrade()?["_trackPageview","/service_agreements/downgrade?level="+this.data.newServiceLevelId]:["_trackPageview","/service_agreements/do_upgrade?level="+this.data.newServiceLevelId])}catch(t){debug("performUpgrade",t)}},getAllServiceLevels:function(){return Mimi.Plans.info.allServiceLevels},getAudienceSize:function(){return Mimi.Plans.info.audienceSize},getAudienceSizeForServiceLevel:function(t){return Mimi.Plans.serviceLevelInfo[t].membersCount},nextServiceLevel:function(t){var e=this.getAllServiceLevels(),i=e.indexOf(t)-1;return 0>i?t:e[i]},getMonthlyCost:function(){return Mimi.Plans.serviceLevelInfo.monthlyCost},getMembersCountStr:function(){Mimi.Plans.serviceLevelInfo.membersCountStr},updateDropdownPrePostText:function(t){var e=this.getMembersCountStr(t);this.dom.$confirmUpgradeScope.find(".audience_member_limit").html(e)},showFailureMessage:function(t){this.dom.$failDialog.find(".payment_failure_reason").html(t);var e=this.upgradeDetailsPathTemplate({level:this.data.newServiceLevelId});this.dom.$upgradeDetailsLink.attr({href:e}),this.paySubmit.hide(),this.payFail.show()},showSuccessMessage:function(){this.paySubmit.hide(),this.paySuccess.show()},interpretFailure:function(t){var e="";if(423==t.status){var i=JSON.parse(t.responseText);"hard"==i.block_type?e=I18n.t("MimiFlash.plans.interpretFailure.blocked_ip"):"soft"==i.block_type&&(e=I18n.t("MimiFlash.plans.interpretFailure.retry_15_min"))}else if(400==t.status||422==t.status){{this.translate_error_from_billing(t.responseText)}e=I18n.t("MimiFlash.plans.interpretFailure.end")}else e=I18n.t("MimiFlash.plans.submitError");Widget.MimiFlash.error(e),this.doneSubmitting()},translate_error_from_billing:function(t){try{var e=JSON.parse(t)}catch(i){return t}if("string"==typeof e.errors)return e.errors;if("charge_recently_processed"in e.errors)return I18n.t("js.controllers.service_agreements_controller.errors.charge_recently_processed");if("card_already_registered"in e.errors)return I18n.t("js.controllers.service_agreements_controller.errors.card_already_registered");if("already_recieved_request"in e.errors)return I18n.t("js.controllers.service_agreements_controller.errors.already_recieved_request");if("missing_cvv"in e.errors)return I18n.t("js.controllers.service_agreements_controller.errors.missing_cvv");if("missing_card"in e.errors)return I18n.t("js.controllers.service_agreements_controller.errors.missing_credit_card");if("incorrect_details"in e.errors)return I18n.t("js.controllers.service_agreements_controller.errors.incorrect_details");if("errors"in e){var s=e.errors,n=Object.keys(s).map(function(t){return s[t]}).join(", ");return n}return I18n.t("MimiFlash.plans.submitError")},onDowngradeToFreeLink:function(e){var i=this.getFreePlan(),s=t(e.target).attr("data-value");return i=this.data.plans.getPlanById(parseInt(s,10)),this.data.newServiceLevelId=i.id,this.setDowngrade(),this.changePaymentConfirmButtonText(),this.updateTheWizard(i),this.payConfirm.show(),!1},noteUpOrDown:function(t,e){var i=parseInt(t,10),s=parseInt(e,10);s>=i?this.setUpgrade():this.setDowngrade()},setUpgrade:function(){this.data.updowngrade="up"},setDowngrade:function(){this.data.updowngrade="down"},isUpgrade:function(){return"up"===this.data.updowngrade},hasSameAudienceLimit:function(t){var e=Mimi.Plans.serviceLevelInfo[t].membersCount;return this.getCurrentAudienceLimit()===e},isOnLimitedCreditPlan:function(){return!Mimi.Plans.info.unlimitedMailingCredits},isOnMaxServiceLevel:function(){return parseInt(this.data.newServiceLevelId,10)===this.getMaxServiceLevel()},changingToUnlimitedMailingCredits:function(){if(!this.isOnLimitedCreditPlan())return!1;var t=this.data.plans.getPlanById(this.data.newServiceLevelId);return this.data.plans.planHasUnlimitedMailingCredits(t)},getMaxServiceLevel:function(){return Mimi.Plans.info.maxServiceLevel},getMaxPlanId:function(){return Mimi.Plans.info.maxServiceLevel},getMaxPlan:function(){return this.findPlan(Mimi.Plans.info.maxServiceLevel)},changePaymentConfirmButtonText:function(){var t=this.dom.$submitPaymentScope.find("span");t.html(I18n.t(this.isUpgrade()?"js.plans.changePaymentConfirmButtonText.pay":"js.plans.changePaymentConfirmButtonText.downgrade"))},getProrateUpgradeCost:function(t){return Mimi.Plans.serviceLevelInfo[t]?Mimi.Plans.serviceLevelInfo[t].prorateUpgradeCost:0},getProrateMailerApiCost:function(t){return Mimi.Plans.serviceLevelInfo[t]?Mimi.Plans.serviceLevelInfo[t].prorateMailerApiCost:0},getTaxedProrateUpgradeCost:function(t){return Mimi.Plans.serviceLevelInfo[t]?Mimi.Plans.serviceLevelInfo[t].taxedProrateUpgradeCost:0},getTaxedProrateMailerApiCost:function(t){return Mimi.Plans.serviceLevelInfo[t]?Mimi.Plans.serviceLevelInfo[t].taxedProrateMailerApiCost:0},getProrate:function(){var t=this.getProrateUpgradeCost(parseInt(this.data.newServiceLevelId,10))/100;return this.changingToUnlimitedMailingCredits()&&(t-=Mimi.Plans.info.purchasedCreditsValue),0>t&&(t=0),t.toFixed(2)},getCurrentServiceLevel:function(){return Mimi.Plans.info.currentServiceLevel},getCurrentAudienceLimit:function(){return parseInt(Mimi.Plans.info.currentAudienceLimit,10)},getCurrentChargeCents:function(){return parseInt(Mimi.Plans.info.currentCents,10)},setCurrentServiceLevel:function(t){Mimi.Plans.info.currentServiceLevel=parseInt(t,10)},getDaysUntilNextPayment:function(){return Mimi.Plans.info.daysUntilNextPayment},getPlanClass:function(t){return t.free_plan?"basic":t.max_contacts<=5e4?"pro":t.max_contacts<25e4?"silver":"gold"},getPlanName:function(t){return t.free_plan?"Free Plan":t.max_contacts<=5e4?"Pro Plan":t.max_contacts<=35e4?"Jumbo Plan":"Custom Plan"},hasDiscount:function(){return Mimi.Plans.info.hasDiscount},discountCents:function(){return Mimi.Plans.info.discountCents},discountPercentage:function(){return Mimi.Plans.info.discountPercentage},isPercentageDiscount:function(){return this.discountPercentage()>0},discountSignVal:function(){return this.isPercentageDiscount()?"":"$"},discountAmtVal:function(){if(this.isPercentageDiscount())return this.discountPercentage();var t=(this.discountCents()/100).toFixed(2);return t.split(".")[0]},discountCentsVal:function(){if(this.isPercentageDiscount())return"%";var t=(this.discountCents()/100).toFixed(2);return t.split(".")[1]},getCreditDollars:function(){return Mimi.Plans.info.creditDollars},getCreditCents:function(){return parseInt(Mimi.Plans.info.creditCents,10)},getSuccessTotalCents:function(){var t=parseInt(this.data.newServiceLevelId),e=this.getProrateUpgradeCost(t),i=this.getProrateMailerApiCost(t),s=this.getCreditCents(),n=parseInt(e,10)+parseInt(i)-parseInt(s,10);return 0>n?0:n},getSuccessTotalDollars:function(){var t=this.getSuccessTotalCents()/100;return t.toFixed(2)},getApiSalesTax:function(t){return this.getTaxedProrateMailerApiCost(t)-this.getProrateMailerApiCost(t)},getUpgradeSalesTax:function(t){return this.getTaxedProrateUpgradeCost(t)-this.getProrateUpgradeCost(t)},getTotalSalesTax:function(t){return this.getApiSalesTax(t)+this.getUpgradeSalesTax(t)},calculateSalesTaxCents:function(t){var e=Mimi.Plans.serviceLevelInfo[this.data.newServiceLevelId];if(void 0===e)return 0;var i=e.taxRate,s=parseFloat(i);return Math.round(t*s)},toDollarString:function(t){var e=this.toMoneyHash(t);return t=e.cents.leadingZero(),e.dollars+"."+t},updateSubmitTotals:function(){var t=parseInt(this.data.newServiceLevelId),e=this.getProrateUpgradeCost(t),i=this.getSuccessTotalCents(),s=this.getProrateMailerApiCost(t),n=this.getTotalSalesTax(t),o=this.toDollarString(i+n),a=Mimi.Plans.ChangePlan.TEMPLATES.submitbtn.text({amount:o,currency:"$"});this.dom.$submitPaymentbtn.find("span").html(a),this.updateWizardDollars(this.paySubmit.$element,".prorate",e),this.updateWizardDollars(this.paySubmit.$element,".sales_tax",n),this.updateWizardDollars(this.paySubmit.$element,".mailer_api",s),this.updateWizardDollars(this.paySuccess.$element,".prorate",i+s+n)},updateWizardDollars:function(t,e,i){var s=this.toMoneyHash(i);t.find(e+" .amt").html(s.dollars),t.find(e+" .cents").html(s.cents.leadingZero())},paymentConfirmed:function(t){try{void 0!==t&&t.preventDefault(),this.updateSubmitTotals(),this.payConfirm.hide(),this.paySubmit.show(),this.isUpgrade()||this.performUpgrade()}catch(e){Widget.MimiFlash.error(I18n.t("MimiFlash.plans.submitError"))}return!1},trySubmitPayment:function(){try{if(this.hasCard()||!this.isUpgrade()||Mimi.Plans.info.hasPaypal)(Mimi.Plans.info.hasPaypal||this.validateCVV())&&this.performUpgrade();else{var t=this.upgradeDetailsPathTemplate({level:this.data.newServiceLevelId});window.location=t}}catch(e){Widget.MimiFlash.error(I18n.t("MimiFlash.plans.submitError"))}return!1},toMoneyHash:function(t){var e=(t/100).toString(),i=e.split(".");return i[1]&&1===i[1].length&&(i[1]+="0"),{dollars:parseInt(i[0])||0,cents:parseInt(i[1])||0}},updateTheWizard:function(t){var e=Mimi.Plans.serviceLevelInfo[t.id]?Mimi.Plans.serviceLevelInfo[t.id].monthlyCost.replace(/\$/g,""):"0.00",i=this.getPlanClass(t),s=this.getPlanName(t),n=this.getCreditDollars(),o=this.getProrate(),a=o.split("."),r=a[0],l=a[1],d=Mimi.Plans.serviceLevelInfo[t.id]&&Mimi.Plans.serviceLevelInfo[t.id].mailerApiCost?Mimi.Plans.serviceLevelInfo[t.id].mailerApiCost.replace("$",""):null,h=n.split(".");n=h[0];var c=h[1],u=this.getSuccessTotalDollars(),m=u.split("."),p=m[0],f=m[1];"0.00"===o?this.setDowngrade():this.setUpgrade(),this.changePaymentConfirmButtonText(),this.updatePlanType(i);var g={plan_name:s,max_contacts:t.max_contacts.formatThousands()};this.updatePaymentSummaries(g),this.payConfirm.$element.find(".plan_name_header").html(s),this.updatePurchasedCreditsValue(),this.updateMonthlyAmount(e),this.updateProrateAmount(r,l,p,f),this.updateCreditAmount(n,c),this.updateMailerApiAmount(d),this.updateCvvConfirmation(o)},updatePaymentSummaries:function(t){this.updatePaymentConfirmationSummary(t),this.updatePaymentSubmitSummary(t),this.updatePaymentSuccessSummary(t)},updatePaymentConfirmationSummary:function(t){var e=Mimi.Plans.ChangePlan.TEMPLATES.paymentConfirmation.summary(t);this.payConfirm.$element.find(".payment_confirmation_summary").html(e)},updatePaymentSubmitSummary:function(t){var e=Mimi.Plans.ChangePlan.TEMPLATES.paymentSubmit.summary(t);this.paySubmit.$element.find(".payment_submit_summary").html(e)},updatePaymentSuccessSummary:function(t){var e=Mimi.Plans.ChangePlan.TEMPLATES.paymentSuccess.summary(t);this.paySuccess.$element.find(".payment_success_summary").html(e)},updateCvvConfirmation:function(t){var e=this.dom.$creditCardCode.closest("li");"0.00"!==t&&this.hasCard()?e.show():e.hide()},updateDiscount:function(){var t="";this.hasDiscount()&&(t=I18n.t("js.service_agreements.change_plan.discounted")),this.payConfirm.$element.find(".discount").html(t),this.paySuccess.$element.find(".discount").html(t)},updateDiscountAmount:function(){if(this.hasDiscount()){var t=this.discountSignVal(),e=this.discountAmtVal(),i=this.discountCentsVal();this.payConfirm.$element.find(".discount .sign").html(t),this.payConfirm.$element.find(".discount .amt").html(e),this.payConfirm.$element.find(".discount .cents").html(i),this.paySuccess.$element.find(".discount .sign").html(t),this.paySuccess.$element.find(".discount .amt").html(e),this.paySuccess.$element.find(".discount .cents").html(i),this.payConfirm.$element.find(".discount_item").show(),this.paySuccess.$element.find(".discount_item").show()}else this.paySuccess.$element.find(".discount_item").hide(),this.payConfirm.$element.find(".discount_item").hide()},updatePlanType:function(t){this.ensurePlanType(this.payConfirm,t),this.ensurePlanType(this.paySubmit,t),this.ensurePlanType(this.paySuccess,t)},updatePurchasedCreditsValue:function(){var t=this.payConfirm.$element.find(".purchased_credits_value");t[0]&&(this.changingToUnlimitedMailingCredits()&&Mimi.Plans.info.purchasedCreditsValue>0?t.removeClass("hide"):t.addClass("hide"))},updateMonthlyAmount:function(t){var e=t.split("."),i=e[0],s=e[1];this.payConfirm.$element.find(".monthly .amt").html(i),this.payConfirm.$element.find(".monthly .cents").html(s)},updateProrateAmount:function(t,e,i,s){if(this.isUpgrade()){var n=parseInt(t,10).formatThousands();this.payConfirm.$element.find(".prorate .amt").closest("li").show(),this.paySuccess.$element.find(".prorate .amt").closest("li").show(),this.payConfirm.$element.find(".prorate .amt").html(n),this.payConfirm.$element.find(".prorate .cents").html(e),this.paySuccess.$element.find(".prorate .amt").html(i),this.paySuccess.$element.find(".prorate .cents").html(s)}else this.payConfirm.$element.find(".prorate .amt").closest("li").hide(),this.paySuccess.$element.find(".prorate .amt").closest("li").hide()},updateMailerApiAmount:function(t){if(t){var e=t.split("."),i=e[0],s=e[1];this.payConfirm.$element.find(".mailer_api .amt").closest("li").show(),this.payConfirm.$element.find(".mailer_api .amt").html(i),this.payConfirm.$element.find(".mailer_api .cents").html(s)}else this.payConfirm.$element.find(".mailer_api .amt").closest("li").hide()},updateCreditAmount:function(t,e){this.isUpgrade()&&(parseInt(t,10)>0||parseInt(e,10)>0)?(this.payConfirm.$element.find(".credit .amt").closest("li").show(),this.payConfirm.$element.find(".credit .amt").html(t),this.payConfirm.$element.find(".credit .cents").html(e)):this.payConfirm.$element.find(".credit .amt").closest("li").hide()}}).singleton("upgrade","findPlan","findFreePlan","getCurrentChargeCents","getCurrentAudienceLimit","getMaxPlan"),Mimi.Plans.ChangePlan.DOM={columns:["ul.plans li.group_plan_item"],confirmDialog:"#payment_confirm_dialog",submitDialog:"#payment_submit_dialog",successDialog:"#payment_success_dialog",failDialog:"#payment_failure_dialog",hideTrigger:".window_close, .back",confirmUpgradeScope:"#upgrade_downgrade_options",submitPaymentScope:"#payment_confirm_dialog button[type=submit]",submitPaymentbtn:"#payment_submit_dialog button[type=submit]",numContacts:".num_contacts",planName:".plan_name",amount:".amt",cost:"#cost",dropdownScope:"#upgrade_downgrade_options",dropdownButtonText:"#dropdown_upgrade_text",daysUntilNextPayment:"#days_until_next_payment",upgradeDetailsLink:"#update_details_path",groupPlanItems:".group_plan_item",downgradeToFreeLink:"#downgrade_to_free_link",creditCardCode:"#credit_card_code"},Mimi.Plans.ChangePlan.TEMPLATES={paymentConfirmation:{summary:_.template(I18n.t("js.service_agreements.change_plan.payment_confirmation_summary"))},paymentSubmit:{summary:_.template(I18n.t("js.service_agreements.change_plan.payment_submit_summary"))},paymentSuccess:{summary:_.template(I18n.t("js.service_agreements.change_plan.payment_success_summary"))},submitbtn:{text:_.template(I18n.t("js.service_agreements.change_plan.payment_submit_btn_text")),busy:_.template(I18n.t("js.service_agreements.payment_submit.button"))}},Mimi.Plans.ChangePlan.PATHS={updowngradePath:_.template("/plans/do_upgrade_json?level=#{level}&cvv=#{cvv}"),redirectPath:"/audience_members"}}(jQuery),function(t){Mimi.Plans.UpgradeFromFreeDialog=Class.create(Widget.Popup,Widget.Observer,{initialize:function($super,t,e,i){var s="upgrade_dialog_"+Mimi.Plans.UpgradeFromFreeDialog.id++;e=e||"",this.options=_.extend({overlay:Widget.ModalOverlay,parent:Widget.ModalOverlay.get().element,hideTrigger:".window_close, .back",fixedPosition:!1,wrapCaption:!0,showMethod:"cssShow",hideMethod:"cssHide",cssClass:"animate",position:"none"},i),this.data={plans:Mimi.Plans.Data.get()},this.selector=t,this.template=Template.from("upgrade_from_free_dialog_template"),this.initElement(s,e),this.initObservers(),$super("#"+s,this.options)},initElement:function(e,i){this.options.wrapCaption&&(i="<p class='upgrade_dialog_caption'>"+i+"</p>"),this.$element=t("body").append(this.template({id:e,caption:i})),this.dom=this.$element.getChildren(Mimi.Plans.UpgradeFromFreeDialog.DOM),this.dom.dropdown=t("menu.origin_modal").first(),this.dropdown=new Widget.Dropdown(this.dom.$dropdownSpan)},initObservers:function(){t(document).on("dropdown:item:selected",_.bind(this.onItemSelected,this)),this.dom.$hideTrigger.on("click",_.bind(this.ensureMenuHidden,this)),this.dom.$form.on("submit",_.bind(this.onSubmit,this)),this.selector&&t(this.selector).on("click",_.bind(this.onAttachedElementClick,this))},onAttachedElementClick:function(e){e.preventDefault(),this.selector&&"a.upgrade"==this.selector&&t(e.target).closest("menu").hide();var i=t(e.target).closest("a");this.show(i)},show:function($super,e){var i=t(e).attr("data-mimi-upgrade");if(i)try{_gaq.push(["_trackPageview",i])}catch(s){debug("Error tracking "+i,s)}$super()},ensureMenuHidden:function(){this.dom.dropdown.hide()},disable:function(){t(document).off("click",this.selector)},enable:function(){this.initObservers()},getSelectedPlan:function(){return this.data.plans.getPlanById(this.dom.$plan.val())},onItemSelected:function(){var t=this.getSelectedPlan(),e="Email us";if(t){var i=t.cents.centsToDollars().formatThousands();e="Upgrade for $"+i+"/month!"}this.dom.$upgradeButton.html(e)},onSubmit:function(t){return this.dropdown.getValue().startsWith("mailto:")?(t.preventDefault(),window.location=this.dropdown.getValue(),!1):!0}}),Mimi.Plans.UpgradeFromFreeDialog.id=0,Mimi.Plans.UpgradeFromFreeDialog.formId="upgrade_from_free_dialog_form",Mimi.Plans.UpgradeFromFreeDialog.DOM={dropdownSpan:"form#"+Mimi.Plans.UpgradeFromFreeDialog.formId+" span.select",plan:".select input",upgradeButton:"button.upgrade",hideTrigger:".window_close, .back",form:"form#"+Mimi.Plans.UpgradeFromFreeDialog.formId}}(jQuery),function(t){Mimi.Plans.SoloSignup=Class.create({initialize:function(){this.dom=Mimi.Plans.SoloSignup.DOM,this.initializeObservers()},initializeObservers:function(){var t=this;this.dom.$form.submit(function(e){t.signup(e)})},signup:function(e){e.preventDefault(),this.disableButton();var i=this;t.ajax({type:"POST",url:this.dom.$form.attr("action")+".json",data:this.dom.$form.serialize(),success:function(t){i.onSignupSuccess(t)}})},disableButton:function(){this.dom.$submit.html("<span>Creating account...</span>").attr("disabled","disabled")},enableButton:function(){this.dom.$submit.html("<span>Create my account</span>").removeAttr("disabled")},onSignupSuccess:function(t){t.success?window.location.replace(t.result.redirect_url):(this.enableButton(),this.emailPasswordError(t)?this.displayEmailPasswordErrors(t):Widget.MimiFlash.error(t.error))},emailPasswordError:function(t){return!!t.error.email||!!t.error.password},displayEmailPasswordErrors:function(t){var e=this;_.each(["email","password"],function(i){var s=e.findOrCreateMessageEl(i);t.error[i]?s.show().html(i+" "+t.error[i][0]):s.hide()})},findOrCreateMessageEl:function(e){var i=t("#user_"+e);if(0!==i.length){var s=i.nextAll("small");return s.length?s:(s=t("<small>").addClass("message"),i.parent(".field").append(s),s)}}}).singleton(),Mimi.Plans.SoloSignup.DOM={$form:t("#newUserForm"),$submit:t("#new_signup_submit")}}(jQuery),function(t){var e={dropdown:"span.select",price:"dt.price",contacts:"dt.contacts",emails:"dt.emails",button:"a.btn"},i=2147483647;Mimi.Plans.NamedPlan=Class.create({initialize:function(i){this.$element=t(i),this.dom=this.$element.getChildren(e),this.initializeDropdown(),this.initializeData(),this.initializeTemplates()},initializeDropdown:function(){this.dom.$dropdown.length&&(this.dropdown=new Widget.Dropdown(this.dom.$dropdown,{onItemClick:_.bind(this.onItemSelected,this)}))},initializeData:function(){this.data=Mimi.Plans.Data.get()},initializeTemplates:function(){this.templates={price:Template.from("named_plan_price_template")}},onItemSelected:function(t,e,i){var s=parseInt(i),n=this.data.getPlanById(s);this.setPlanDetails(n)},setPlanDetails:function(t){var e=t.cents.centsToDollars(),s=t.max_contacts.formatThousands(),n=t.mailing_credits==i?"&infin;":t.mailing_credits.formatThousands(),o=this.dom.$button.attr("href").replace(/\d+$/,t.id);this.dom.$price.html(this.templates.price({price:e})),this.dom.$contacts.html(s),this.dom.$emails.html(n),this.dom.$button.attr("href",o)}})}(jQuery),function(t){var e={namedPlans:[".plans > li"]};Mimi.Plans.NamedPlans=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#plans"),this.dom=this.$element.getChildren(e),this.initializeChildren()},initializeChildren:function(){this.dom.$namedPlans.each(function(t,e){new Mimi.Plans.NamedPlan(e)})}}).singleton()}(jQuery),Mimi.Tweaks={},function(t){Mimi.Tweaks.PromotionTweaker=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#main"),this.dom=this.$element.getChildren(Mimi.Tweaks.PromotionTweaker.DOM),this.promotionTweakerId=Mimi.Tweaks.Data.promotionTweakerId,this.initializeObservers(),this.ensureState()},initializeObservers:function(){this.dom.$useCopyrightDateRange.on("click",_.bind(this.onUseDateRangeClick,this)),this.dom.$useExtraFooterContent.on("click",_.bind(this.onUseExtraFooterContentClick,this)),this.dom.$form.on("submit",_.bind(this.onSubmit,this)),this.dom.$cancel.on("click",_.bind(this.onCancel,this)),this.$element.on("keydown",_.bind(this.onKeyDown,this)),setInterval(_.bind(this.checkFormChanges,this),500),t(window).on("beforeunload",_.bind(this.onBeforeUnload,this))},ensureState:function(){this.onUseDateRangeClick(),this.onUseExtraFooterContentClick()},checkFormChanges:function(){if(!this.lastForm)return void(this.lastForm=this.serializeForm());var t=this.serializeForm();t!==this.lastForm&&this.dom.$submit.enable(),this.lastForm=t},serializeForm:function(){var t=this.dom.$form.serialize();return delete t.proceed,t},onUseDateRangeClick:function(){this.toggleSection(this.dom.$useCopyrightDateRange,this.dom.$copyrightDateRange)},onUseExtraFooterContentClick:function(){this.toggleSection(this.dom.$useExtraFooterContent,this.dom.$extraFooterContent)
},toggleSection:function(t,e){var i=t.prop("checked");t.closest("div").toggleClass("open",i),e.closest("div").toggleClass("open",i)},onKeyDown:function(t){var e=String.fromCharCode(t.keyCode).toLowerCase();return(t.metaKey||t.ctrlKey)&&"s"===e?this.onSubmit():void 0},onSubmit:function(){return t.ajax({url:this.dom.$form.attr("action"),type:this.dom.$form.attr("method"),data:this.dom.$form.serialize()}).done(_.bind(this.onSubmitSuccess,this)).fail(_.bind(this.onSubmitFailed,this)),this.dom.$submit.disable().html("<span>"+I18n.t("MimiFlash.tweaks.promotion_tweaker.onSubmit")+"</span>"),!1},onSubmitFailed:function(t,e){Widget.MimiFlash.error(I18n.t("MimiFlash.tweaks.promotion_tweaker.onSubmitFailed")+"\n"+e)},onSubmitSuccess:function(t){t.success?(Widget.MimiFlash.create(I18n.t("MimiFlash.tweaks.promotion_tweaker.onSubmitSuccess.create")),this.dom.$submit.html("<span>"+I18n.t("MimiFlash.tweaks.promotion_tweaker.onSubmitSuccess.update")+"</span>")):(this.dom.$submit.prop("disabled",!1).html("<span>"+I18n.t("MimiFlash.tweaks.promotion_tweaker.onSubmitSuccess.update")+"</span>"),Widget.MimiFlash.error(I18n.t("MimiFlash.tweaks.promotion_tweaker.onSubmitSuccess.couldnt_save")+"\n"+t.error))},onCancel:function(){this.dom.$submit.disable()},onBeforeUnload:function(){return this.dom.$submit.is(":enabled")?I18n.t("MimiFlash.tweaks.promotion_tweaker.onBeforeUnload.changes_made.start")+"\n\n"+I18n.t("MimiFlash.tweaks.promotion_tweaker.onBeforeUnload.changes_made.end"):void 0}}),Mimi.Tweaks.PromotionTweaker.DOM={copyrightDateRange:"#promotion_tweaker_copyright_start_year",useCopyrightDateRange:"#promotion_tweaker_use_date_range",extraFooterContent:"#promotion_tweaker_extra_footer_content",useExtraFooterContent:"#promotion_tweaker_use_footer",form:"form.edit_promotion_tweaker",submit:"div.actions button.primary",cancel:".actions a.btn"}}(jQuery),function(t){var e=["AA","AE","AP"];Mimi.PaymentForm=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#main"),this.dom=this.$element.getChildren(Mimi.PaymentForm.DOM),this.dom.$receiptFields=this.getFields(Mimi.PaymentForm.RECEIPT_FIELDS),this.dom.$paypalFormSubmitButton=t("#paypal_form_submit"),this.hasPaypal()?(this.dom.$paypalSection.show(),this.dom.$creditCardSection.hide(),this.dom.$requiredFields=this.getFields(Mimi.PaymentForm.SHARED_REQUIRED_FIELDS),this.dom.$changePaypalAccount.on("click",_.bind(this.openPaypalPopup,this)),this.dom.$useCreditCard.on("click",_.bind(this.changeToCreditCard,this))):(this.creditCardSetup(),this.dom.$payWithPaypal.on("click",_.bind(this.openPaypalPopup,this)));var e=I18n.t(Mimi.PaymentForm.Data.hasPaypal?"js.payment_form.confirm_dialog.contentPaypal":"js.payment_form.confirm_dialog.contentCredit");this.confirm=new Widget.ConfirmDialog(I18n.t("js.payment_form.confirm_dialog.title"),e),t(this.confirm).on("dialog:ok",_.bind(this.onSubmit,this)),this.initializePaypalForm(),this.requiredFieldsFormChanger=new Widget.FormChanger(this.dom.$country[0],"#payment_personal_details",COUNTRY_CHANGES),this.receiptFieldsFormChange=new Widget.FormChanger(this.dom.$receiptCountry[0],"#receipt_alternate",COUNTRY_CHANGES),this.countrySelect=Widget.Dropdown.getInstanceByName("service_agreement[country]"),this.receiptCountrySelect=Widget.Dropdown.getInstanceByName("service_agreement[receipt_country]"),this.displayVatNumber(this.countrySelect.getValue(),""),this.displayVatNumber(this.receiptCountrySelect.getValue(),"receipt_"),this.initObservers(),this.block=new Widget.BlockOverlay({element:t("#paypal_popup_block"),cover:t("body"),loadingClass:"",hideOnClick:!0}),this.onReceiptDetailsClick(),this.validatedAddress=null,this.enableSubmitButton()},initObservers:function(){this.dom.$receiptDetails.on("click",_.bind(this.onReceiptDetailsClick,this)),this.dom.$form.on("submit",_.bind(this.confirmChangeMethod,this)),this.countrySelect.observe("dropdown:item:selected",_.bind(this.onCountryChange,this)),this.receiptCountrySelect.observe("dropdown:item:selected",_.bind(this.onReceiptCountryChange,this)),t(document).on("address_normalization:accept",_.bind(this.onAddressNormalizationAccepted,this)),t(document).on("address_normalization:reject",_.bind(this.onAddressNormalizationRejected,this)),t(document).on("address_normalization:cancel",_.bind(this.onAddressNormalizationCanceled,this))},creditCardSetup:function(){this.dom.$requiredFields=this.getFields(Mimi.PaymentForm.SHARED_REQUIRED_FIELDS.concat(Mimi.PaymentForm.CARD_REQUIRED_FIELDS)),this.creditCard=new Widget.CreditCard("#payment_card",Mimi.PaymentForm.Data.paymentType),this.dom.$paypalSection.hide(),this.dom.$creditCardSection.show()},onCountryChange:function(){this.displayVatNumber(this.countrySelect.getValue(),"")},onReceiptCountryChange:function(){this.displayVatNumber(this.receiptCountrySelect.getValue(),"receipt_")},displayVatNumber:function(e,i){var s="."+i+"vat_number",n="#service_agreement_"+i+"vat_number";t.inArray(e,Mimi.Europe)>-1?(t(n).val(Mimi.PaymentForm.Data.initialVatNumber),t(s).show()):(t(s).hide(),t(n).val(""))},initializePaypalForm:function(){var t={trigger:"paypal_form_submit"};Mimi.PaymentForm.Data.sandbox&&(t.stage="sandbox"),window.paypal_flows=[new PAYPAL.apps.DGFlowMini(t)]},openPaypalPopup:function(){return this.dom.$paypalFormSubmitButton.click(),this.block.show(),!1},changeToCreditCard:function(){return Mimi.PaymentForm.Data.changeToCC=!0,this.creditCardSetup(),!1},confirmChangeMethod:function(t){var e=Mimi.PaymentForm.Data.hasCard&&this.hasPaypalToken(),i=Mimi.PaymentForm.Data.hasPaypal&&Mimi.PaymentForm.Data.changeToCC;return e||i?this.confirm.show():this.onSubmit(t),!1},onReceiptDetailsClick:function(){var e=(this.dom.$receiptDetails.prop("checked")?"add":"remove")+"Class";t("#receipt_alternate")[e]("open"),t("#service_agreement_payment_receipt_details")[e]("open"),t("#service_agreement_payment_receipt_details").parent()[e]("open")},hasCustomerId:function(){return Mimi.PaymentForm.Data.customerId.trim().length>0},validate:function(){var e;return e=this.hasCustomerId()?_.select(this.dom.$requiredFields,function(e){var i=e.name.slice(18,-1);if("US"!==this.validatableCountry()&&0===i.indexOf("state"))return!1;if(!this.hasPaypal()){if("credit_card_code"===i&&this.isUpgrade()&&!t(e).val())return!0;if(0===i.indexOf("credit_card"))return!1;if("card_holder_name"===i){var s=this.validateAtLeastFirstAndLast(t(e).val());return s}}var n=this.requiredFieldsFormChanger.isHidden("span[data-field="+i+"]"),o=""===t(e).val().trim();return!n&&o},this):_.select(this.dom.$requiredFields,function(e){return!this.requiredFieldsFormChanger.isHidden("span[data-field="+e.name.slice(18,-1)+"]")&&""===t(e).val().trim()},this)},validateAddress:function(){this.validatedAddress=null,Mimi.AddressValidator.validate({region:this.validatableCountry(),address:this.validatableAddress(),onSuccess:_.bind(this.onAddressValidationSuccess,this),onFailure:_.bind(this.onAddressValidationFailure,this)})},validateAtLeastFirstAndLast:function(t){var e=t.split(" ");return e.length<=1},sanitizeCreditCard:function(){var e=t(this.getField("credit_card_number")),i=e.val();e.val(i.replace(/\D/g,""))},sanitizeValues:function(){this.sanitizeCreditCard()},onFormChanged:function(){this.validate()},disableSubmitButton:function(){this.dom.$submit.addClass("disabled")},enableSubmitButton:function(){this.dom.$submit.removeClass("disabled")},isInArmedForces:function(){return t.inArray(t(this.getField("state")).val(),e)>-1},onSubmit:function(){try{this.disableSubmitButton(),this.hasPaypal()||this.sanitizeValues();var e=this.validate();if(e.length>0){this.enableSubmitButton(),t(_.first(e)).smoothScrollToCenter(),_.delay(function(){_.forEach(e,function(e){t(e).errorFlash()}),t(_.first(e)).select()},500);var i=_.map(e,function(e){var i="service_agreement_"+e.name.slice(18,-1),s=t('label[for="'+i+'"]').text().trim();return"&rarr; "+s}).join("<br>");return Widget.MimiFlash.error(I18n.t("MimiFlash.payment_form.onSubmit")+"\n"+i),!1}if(_.each(this.dom.$requiredFields,function(e){this.requiredFieldsFormChanger.isHidden("span[data-field="+e.name.slice(18,-1)+"]")&&t(e).val("")},this),this.dom.$receiptDetails.prop("checked")||this.dom.$receiptFields.each(function(){t(this).val("")}),this.disableSubmitButton(),this.validatedAddress!==this.validatableAddress()&&"US"!==this.validatableCountry()&&!this.isInArmedForces())return this.validateAddress(),!1;this.updatePaymentDetails()}catch(s){Widget.MimiFlash.error(I18n.t("MimiFlash.payment_form.submitError"))}return!1},updatePaymentDetails:function(){try{var t=this.getUpdateOrUpgradeUrl(),e=this.paymentDetailsObject();this.isUpgrade()&&(e.plan_id=Mimi.PaymentForm.Data.level);var i=jQuery.ajax({url:t,type:"PUT",contentType:"application/json",data:JSON.stringify(e),dataType:"json",headers:{Authorization:"Basic "+Mimi.PaymentForm.Data.identification}});i.done(_.bind(this.onUpdateDetailsSuccess,this)),i.fail(_.bind(this.onUpdateDetailsFailure,this))}catch(s){Widget.MimiFlash.error(I18n.t("MimiFlash.payment_form.submitError"))}},onUpdateDetailsSuccess:function(){Widget.MimiFlash.create(I18n.t("js.controllers.service_agreements_controller.payment_successful")),window.location.href=Mimi.PaymentForm.Data.redirectUrl,this.enableSubmitButton()},translate_error_from_billing:function(t){try{var e=JSON.parse(t)}catch(i){return t}if("string"==typeof e.errors)return e.errors;if("charge_recently_processed"in e.errors)return I18n.t("js.controllers.service_agreements_controller.errors.charge_recently_processed");if("card_already_registered"in e.errors)return I18n.t("js.controllers.service_agreements_controller.errors.card_already_registered");if("already_recieved_request"in e.errors)return I18n.t("js.controllers.service_agreements_controller.errors.already_recieved_request");if("missing_cvv"in e.errors)return I18n.t("js.controllers.service_agreements_controller.errors.missing_cvv");if("missing_card"in e.errors)return I18n.t("js.controllers.service_agreements_controller.errors.missing_credit_card");if("incorrect_details"in e.errors)return I18n.t("js.controllers.service_agreements_controller.errors.incorrect_details");if("errors"in e){var s=e.errors,n=Object.keys(s).map(function(t){return s[t]}).join(", ");return n}return I18n.t("MimiFlash.plans.submitError")},onUpdateDetailsFailure:function(t){var e="";if(423==t.status){var i=JSON.parse(t.responseText);"hard"==i.block_type?e=I18n.t("MimiFlash.plans.interpretFailure.blocked_ip"):"soft"==i.block_type&&(e=I18n.t("MimiFlash.plans.interpretFailure.retry_15_min"))}else if(422==t.status||400==t.status){{this.translate_error_from_billing(t.responseText)}e=I18n.t("MimiFlash.plans.interpretFailure.end")}else e=I18n.t("MimiFlash.payment_form.submitError");Widget.MimiFlash.error(e),this.enableSubmitButton()},getUpdateOrUpgradeUrl:function(){var t=Mimi.PaymentForm.Data.billingUrl;return t+=this.isUpgrade()?"/api/accounts/"+Mimi.PaymentForm.Data.userId+"/change_plan.json":Mimi.PaymentForm.Data.fixFailed?"/api/accounts/"+Mimi.PaymentForm.Data.userId+"/fix_failed_payment.json":"/api/billing_details/"+Mimi.PaymentForm.Data.userId+".json"},isUpgrade:function(){return!!Mimi.PaymentForm.Data.level},paymentDetailsObject:function(){return{receipt_details:this.receiptDetailsObject(),credit_card:this.creditCardObject(),paypal:this.paypalObject()}},creditCardObject:function(){return{credit_card_number:jQuery("#service_agreement_credit_card_number").val(),credit_card_expiry_year:jQuery('[name="service_agreement[credit_card_year]"]').val(),credit_card_expiry_month:jQuery('[name="service_agreement[credit_card_month]"]').val(),credit_card_code:jQuery("#service_agreement_credit_card_code").val(),credit_card_holder_name:jQuery("#service_agreement_card_holder_name").val()}},receiptDetailsObject:function(){var t={address1:jQuery("#service_agreement_address1").val(),city:jQuery("#service_agreement_city").val(),state:jQuery('[name="service_agreement[state]"]').val(),country:jQuery('[name="service_agreement[country]"]').val(),zip:jQuery("#service_agreement_zipcode").val(),receipt_email:jQuery("#service_agreement_email").val(),vat_number:jQuery("#service_agreement_vat_number").val(),use_receipt_details:!!jQuery("#service_agreement_payment_receipt_details").prop("checked")};return t.use_receipt_details&&(t.vat_number=jQuery("#service_agreement_receipt_vat_number").val(),t.receipt_first_name=jQuery("#service_agreement_receipt_first_name").val(),t.receipt_last_name=jQuery("#service_agreement_receipt_last_name").val(),t.receipt_address1=jQuery("#service_agreement_receipt_address1").val(),t.receipt_city=jQuery("#service_agreement_receipt_city").val(),t.receipt_state=jQuery('[name="service_agreement[receipt_state]"]').val(),t.receipt_country=jQuery('[name="service_agreement[receipt_country]"]').val(),t.receipt_zip=jQuery("#service_agreement_receipt_zipcode").val()),t},paypalObject:function(){var t=null;return this.hasPaypalToken()&&(t={token:Mimi.PaymentForm.Data.paypal_token}),t},hasPaypalToken:function(){return""!=Mimi.PaymentForm.Data.paypal_token},hasPaypal:function(){return(this.hasPaypalToken()||Mimi.PaymentForm.Data.hasPaypal)&&!Mimi.PaymentForm.Data.changeToCC},onAddressValidationSuccess:function(t){var e=this.normalizableAddress();this.addressesAreEqual(t,e)?(this.validatedAddress=this.validatableAddress(),this.updatePaymentDetails()):Mimi.AddressNormalizationDialog.show(e,t)},onAddressNormalizationAccepted:function(t,e){this.dom.$receiptDetails.prop("checked")?this.updateAddress("receipt_",e):this.updateAddress("",e),this.validatedAddress=this.validatableAddress(),_.delay(_.bind(function(){this.onSubmit()},this),500)},onAddressNormalizationRejected:function(){this.validatedAddress=this.validatableAddress(),_.delay(_.bind(function(){this.onSubmit()},this),500)},onAddressNormalizationCanceled:function(){this.validate(),this.enableSubmitButton()},onAddressValidationFailure:function(t){switch(!0){case t.isInvalid:Widget.MimiFlash.error(I18n.t("MimiFlash.payment_form.onAddressValidationFailure.invalid"));break;case t.isOverQueryLimit:Widget.MimiFlash.error(I18n.t("MimiFlash.payment_form.onAddressValidationFailure.over_query_limit"));break;case t.isServerError:Widget.MimiFlash.error(I18n.t("MimiFlash.payment_form.onAddressValidationFailure.server_error"));break;default:Widget.MimiFlash.error(I18n.t("MimiFlash.payment_form.onAddressValidationFailure.default",{error:t.error||"unknown error"}))}this.validate(),this.enableSubmitButton()},getField:function(e){return t("input[name='service_agreement["+e+"]']").get(0)},getFields:function(e){return t(_.map(e,this.getField,this))},extractAddressFromFields:function(e){return _.filter(_.map(this.getFields(e),function(e){return t(e).val()}),function(t){return t&&""!==t}).join(", ")},updateAddress:function(e,i){var s=["country","state","city","zipcode"],n=[i.country,i.state,i.city,i.zipcode],o=_.map(s,function(t){return e+t});_.each(this.getFields(o),function(e,i){t(e).val(n[i])})},validatableAddress:function(){if(this.dom.$receiptDetails.prop("checked")){var e=this.getField("receipt_state");return this.extractAddressFromFields(e&&t(e).is(":visible")?["receipt_address1","receipt_city","receipt_state","receipt_zipcode"]:["receipt_address1","receipt_city","receipt_zipcode"])}var e=this.getField("state");return this.extractAddressFromFields(e&&t(e).is(":visible")?["address1","city","state","zip"]:["address1","city","zip"])},validatableCountry:function(){return this.dom.$receiptDetails.prop("checked")?this.dom.$receiptCountry.val():this.dom.$country.val()},normalizableAddress:function(){return this.dom.$receiptDetails.prop("checked")?{address:t(this.getField("receipt_address1")).val(),country:t(this.getField("receipt_country")).val(),state:t(this.getField("receipt_state")).val(),city:t(this.getField("receipt_city")).val(),zipcode:t(this.getField("receipt_zipcode")).val()}:{address:t(this.getField("address1")).val(),country:t(this.getField("country")).val(),state:t(this.getField("state")).val(),city:t(this.getField("city")).val(),zipcode:t(this.getField("zipcode")).val()}},addressesAreEqual:function(t,e){for(var i in t)if(t[i]&&t[i]!==e[i])return!1;return!0}}).singleton(),Mimi.PaymentForm.DOM={form:"form",country:"input[name='service_agreement[country]']",receiptDetails:"#service_agreement_payment_receipt_details",receiptCountry:"input[name='service_agreement[receipt_country]']",submit:"button[type=submit]",payWithPaypal:"#pay_with_paypal",useCreditCard:"#use_credit_card",changePaypalAccount:"#change_paypal_account",paypalSection:"#paypal_section",creditCardSection:"#credit_card_section"},Mimi.PaymentForm.CARD_REQUIRED_FIELDS=["credit_card_number","card_holder_name","credit_card_month","credit_card_year","credit_card_code"],Mimi.PaymentForm.SHARED_REQUIRED_FIELDS=["address1","country","state","city","zipcode","email"],Mimi.PaymentForm.RECEIPT_FIELDS=["receipt_first_name","receipt_last_name","receipt_address1","receipt_country","receipt_state","receipt_city","receipt_zipcode"],Mimi.PaymentForm.ADDRESS_FIELDS=["address1","country","state","city","zipcode","receipt_address1","receipt_country","receipt_state","receipt_city","receipt_zipcode"]}(jQuery),function(t){Mimi.MailingCreditsPurchaseWizard=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#mailing_credit_purchase_dialog"),this.dom=this.$element.getChildren(Mimi.MailingCreditsPurchaseWizard.DOM),this.data={},this.initTemplates(),this.initDialog(),this.initObservers()},initTemplates:function(){this.templates={loading:Template.from("loading_template"),quote:Template.from("quote_template"),lineItem:Template.from("line_item_template"),purchased:Template.from("purchased_template"),error:Template.from("error_template")}},initDialog:function(){var t={overlay:Widget.ModalOverlay,hideTrigger:".window_close, .back"};this.dialog=new Widget.Popup(this.$element,t)},initObservers:function(){this.dom.$form.on("submit",_.bind(this.onFormSubmit,this)),this.dom.$backLink.on("click",_.bind(this.onBackLinkClick,this))},resetObservers:function(){this.stopObserving(),this.initObservers()},reset:function(){this.dom.$submitButton.addClass("hide"),this.resetObservers()},start:function(t){this.reset(),this.setCreditCount(t);var e=_.template(I18n.t("MimiFlash.mailing_credits.purchase_wizard.start")),i=e({amount:"<strong>"+this.getCreditCount().formatThousands()+"</strong>"});this.dom.$summary.html(this.templates.loading({caption:i})),this.dialog.show(),this.getQuote()},getQuote:function(){var e="/mailing_credits_purchases/calculate_price";this.request=t.get(e,{mailing_credits:this.getCreditCount()}).done(_.bind(this.onGetQuoteSuccess,this)).fail(_.bind(this.onGetQuoteFailure,this))},onGetQuoteSuccess:function(t){this.setQuoteContent(t)},onGetQuoteFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.mailing_credits.purchase_wizard.onGetQuoteFailure"))},setQuoteContent:function(t){var e=this.evaluateBreakdown(t.breakdown),i=t.total_mailing_credits.formatThousands(),s=this.splitCents(t.total_cents),n=s[0],o=s[1],a={line_items:e,total_credit_count:i,grand_total_dollars:n,grand_total_cents:o};this.dom.$summary.html(this.templates.quote(a)),this.dom.$submitButton.removeClass("hide"),this.updateMailingCreditsFormValue(t.total_mailing_credits),this.dialog.position()},evaluateBreakdown:function(t){var e="";return _.each(t,function(t){if(!(t.mailing_credits<1)){var i=this.splitCents(t.cents),s={credit_count:t.mailing_credits.formatThousands(),cpm:t.cpm,dollars:i[0],cents:i[1]};e+=this.templates.lineItem(s)}},this),e},updateMailingCreditsFormValue:function(t){this.dom.$mailingCreditsInput.val(t)},onFormSubmit:function(){return this.setPurchasingContent(),this.request=t.ajax({url:this.dom.$form.attr("action"),type:this.dom.$form.attr("method")||"get",data:this.dom.$form.serialize()}).done(_.bind(this.onFormSubmitSuccess,this)).fail(_.bind(this.onFormSubmitFailure,this)),!1},onFormSubmitSuccess:function(t){this.setPurchasedContent(t)},onFormSubmitFailure:function(t){this.setErrorContent(t)},setPurchasingContent:function(){var t=I18n.t("MimiFlash.mailing_credits.purchase_wizard.setPurchasingContent.caption");this.dom.$submitButton.disable(),this.dom.$submitButton.text(I18n.t("MimiFlash.mailing_credits.purchase_wizard.setPurchasingContent.button")),this.dom.$backLink.hide(),this.dom.$updatePaymentButton.hide(),this.dom.$summary.html(this.templates.loading({caption:t})),this.setStep(3)},setPurchasedContent:function(e){var i=this.splitCents(e.total_cents),s=i[0],n=i[1],o={total_credit_count:e.total_mailing_credits.formatThousands(),new_credit_balance:e.new_mailing_credit_balance.formatThousands(),grand_total_dollars:s,grand_total_cents:n},a=t('<a href="/credit_purchase_router/" class="btn primary">').html(I18n.t("js.mailing_credits.purchase_wizard.setPurchasedContent"));this.dom.$submitButton.replaceWith(a),this.dom.$summary.html(this.templates.purchased(o)),this.setStep(3)},setErrorConent:function(t){this.dom.$submitButton.prop("disabled",!1).text("Try again"),this.dom.$backLink.show(),this.dom.$updatePaymentButton.removeClass("hide").show(),this.dom.$summary.html(this.templates.error({payment_error:t})),this.setStep(2)},setStep:function(e){t(".steps_overview nav.steps li.current").removeClass("current"),t("#step_"+e).addClass("current")},onBackLinkClick:function(){this.request&&this.request.abort()},setCreditCount:function(t){"number"!=typeof t&&(t=t.parseInt()),this.data.creditCount=t},getCreditCount:function(){return this.data.creditCount},splitCents:function(t){var e=(parseInt(t,10)/100).toFixed(2),i=e.split(".");return i[0]=i[0].parseInt().formatThousands(),i}}),Mimi.MailingCreditsPurchaseWizard.DOM={title:"h1.window_title",summary:"section.order_summary",planSummary:"section.order_summary .plan_summary",calculateCreditsCount:"#credits_count",form:"form",backLink:"form a.back",mailingCreditsInput:"#mailing_credits",submitButton:"fieldset .actions button.primary",updatePaymentButton:"fieldset .actions a.update_payment"}}(jQuery),function(t){Mimi.MailingCreditsPurchase=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#mailing_credits_purchase"),this.dom=this.$element.getChildren(Mimi.MailingCreditsPurchase.DOM),this.data=Mimi.MailingCreditsPurchase.Data,this.dropdown=Widget.Dropdown.getInstanceByName(this.data.mailingCreditsSelect),this.tip=new Widget.GuideTip("#mailing_credits_tip",this.dom.$creditCountInput,{autohide:1e4}),this.initObservers(),this.setupWizard(),this.enableSubmitButton()},initObservers:function(){this.dropdown.observe("dropdown:item:selected",_.bind(this.onDropdownItemSelected,this)),this.dom.$form.on("submit",_.bind(this.onFormSubmit,this))},setupWizard:function(){this.wizard=new Mimi.MailingCreditsPurchaseWizard},enableSubmitButton:function(){this.dom.$submitButton.prop("disabled",!1).val(I18n.t("js.mailing_credits.purchase.calculate_price"))},onFormSubmit:function(){var t=this.validateForm();return t&&(this.tip.hide(),this.wizard.start(this.getCreditCount())),!1},validateForm:function(){var t=this.getCreditCount();return isNaN(t)||t<this.data.minimumPurchase?(this.tip.show(),this.dom.$creditCountInput.select(),!1):!0},onDropdownItemSelected:function(){-1==this.dropdown.getValue()&&(this.dropdown.convertToTextField(!0,!0),this.dropdown.setValue(this.data.minimumPurchase),this.dom.$mailingCreditsLabel.removeClass("hide"))},getCreditCount:function(){return this.dom.$creditCountInput.val().parseInt()}}).singleton(),Mimi.MailingCreditsPurchase.DOM={form:"#mailing_credits_quote_form",submitButton:"#mailing_credits_quote_form #submit",creditCountInput:"#mailing_credits_quote_form span.select input",mailingCreditsLabel:"#mailing_credits_label"}}(jQuery),Mimi.Account={},function(t){Mimi.Account.Language=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#set_language"),t(document).on("dropdown:item:selected",_.bind(this.languageChanged,this))},languageChanged:function(e,i){if(i.source.$element.hasClass("account_language")){var s=t(i.element),n=s.data("value");t("#user_promotion_language_id").val(n)}}})}(jQuery),function(t){Mimi.Account.Webform=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#set_webform"),t(document).on("dropdown:item:selected",_.bind(this.webformChanged,this))},webformChanged:function(e,i){if(t(i.source.element).hasClass("account_webform")){var s=t(i.element),n=s.data("value");t("#user_signup_id").val(n)}}})}(jQuery),function(t){Mimi.Account.Form=Class.create({initialize:function(){this.sensitiveDataChanged=!1,this.initializeObservers()},initializeObservers:function(){t("#user_email").on("change",_.bind(this.onSensitiveDataChange,this)),t("#user_password").on("change",_.bind(this.onSensitiveDataChange,this)),t("#user_form").on("submit",_.bind(this.onSubmit,this))},onSensitiveDataChange:function(){this.sensitiveDataChanged=!0},onSubmit:function(){var e=t("#user_password"),i=e.val();return i.length>0&&!Mimi.Password.validate(i)?(e.focus(),!1):this.requirePasswordForSensitiveFields()},requirePasswordForSensitiveFields:function(){return this.sensitiveDataChanged&&""==t("#user_password_confirmation").val()?(Mimi.Account.PasswordConfirmationDialog.show(),!1):!0}})}(jQuery),function(t){Mimi.Account.PasswordConfirmationDialog=Class.create(Widget.Dialog,Widget.Observable,{initialize:function($super){$super(I18n.t("MimiFlash.account.password_confirmation_dialog.password_confirmation"),Mimi.Account.PasswordConfirmationDialog.BODY,{hideTrigger:"a.back"}),this.dom=this.$element.getChildren(Mimi.Account.PasswordConfirmationDialog.DOM),this.dom.$ok.on("click",_.bind(this.saveAccountInfo,this))},show:function($super){$super(),this.dom.$password.focus()},saveAccountInfo:function(e){return e.preventDefault(),""===this.dom.$password.val()?this.noPasswordError():(t("#user_password_confirmation").val(this.dom.$password.val()),t("#user_form").submit(),!1)},noPasswordError:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.account.password_confirmation_dialog.error")),this.dom.$password.focus()}}).singleton("show"),Mimi.Account.PasswordConfirmationDialog.DOM={ok:"button.primary",password:"input[type=password]"},Mimi.Account.PasswordConfirmationDialog.BODY='<form><fieldset><div class="field"><span class="full"><label for="text_to_display">'+I18n.t("MimiFlash.account.password_confirmation_dialog.password")+'</label><input type="password"></span></div><p class="actions"><a class="back" href="#"><svg class=\'iconsvg svg_back\' viewBox=\'0 0 16 16\' aria-hidden=\'true\'>    <path fill="#000" d="M3.285 7.5l3.992-4.5v3.006c2.103 0 6.577 1.723 4.557 5.994 0-3.378-4.557-2.974-4.557-2.974v2.974l-3.992-4.5z"></path>\n</svg><span>'+I18n.t("MimiFlash.account.password_confirmation_dialog.cancel")+'</span></a><button class="btn primary" type="submit"><span>'+I18n.t("MimiFlash.account.password_confirmation_dialog.ok")+"</span></button></p></fieldset></form>"}(jQuery),Mimi.Promotion={},function(t){Mimi.Promotion.Snippets={initializeSnippets:function(e,i){e.on("mousedown",function(){var e=t(this.parentNode).find("textarea.code");t(i).focus().insertAtCursor(e.val()),_.defer(function(){t(i).focus()})})}}}(jQuery),function(t){Mimi.Promotion.EditRaw=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(this.DOM),this.promotionId=this.dom.$promotionId.attr("data-promotion-id"),this.dom.$importFromUrl.on("click",_.bind(this.onImportFromUrl,this)),this.dom.$importFromZip.on("click",_.bind(this.onImportFromZip,this)),t(document).on("promotion:imported",_.bind(this.onImported,this)),this.initSkipInlining(),this.initializeSnippets();var e=this.editor=ace.edit("editor"),i=e.getSession();i.setUseWorker(!1),this.saved=!0,this.preview=!1,e.setTheme("ace/theme/clouds"),i.setMode("ace/mode/html"),i.setUseSoftTabs(!1),i.setTabSize(2),e.setShowPrintMargin(!1),i.setValue(this.dom.$htmlField.val()),e.getSession().on("change",_.bind(this.setToUnsaved,this)),this.dom.$form.on("submit",_.bind(this.onSubmit,this)),this.dom.$textWrap.on("click",_.bind(this.onWrapText,this)),this.dom.$saveButton.on("click",_.bind(this.onAsyncSave,this)),this.dom.$previewLink.on("click",_.bind(this.onPreviewClick,this)),this.dom.$promotionName.on("change",_.bind(this.setToUnsaved,this)),t(document).on("promotion:save",_.bind(this.onAsyncSave,this)),t(document).on("promotion:saving",_.bind(this.saving,this))},initializeSnippets:function(){this.dom.$snippets.on("focus","textarea.code",function(e){var i=t(e.currentTarget),s=parseInt(i.css("padding-top"),10),n=parseInt(i.css("padding-bottom"),10);i.removeAttr("wrap"),_.defer(function(){i.css({height:(i.height()+s+n).px()})})}),this.dom.$snippets.on("blur","textarea.code",function(e){var i=t(e.currentTarget);i.attr("wrap","off").removeAttr("style")}),this.dom.$snippetbtns.on("mousedown",_.bind(function(e){var i=t(e.target).closest("span.combo_input").find("textarea.code").val(),s=this.editor.getSession(),n=this.editor.getSelection().getRange();s.replace(n,i),_.defer(_.bind(this.editor.focus,this.editor))},this))},onSubmit:function(){return this.dom.$htmlField.val(this.getHtml()),!0},getHtml:function(){var t=this.editor.getSession().getValue();return t.replace(/<meta.*http-equiv=["|']content-type["|'].*>/i,'<meta http-equiv="Content-Type" content="text/html; charset=utf-8">')},onAsyncSave:function(){this.fire("promotion:saving");var e=this.dom.$form.prop("action")+"/async_save_raw_html",i={raw_html:this.getHtml(),name:this.dom.$promotionName.val(),skip_inlining:!this.dom.$promotionSkipInlining.prop("checked")};t.ajax({type:"PUT",url:e,data:i}).done(_.bind(this.success,this)).fail(_.bind(this.failed,this))},success:function(t){this.dom.$saveButton.prop("disabled",!1),this.dom.$previewLink.prop("disabled",!1),t.success?(this.saved=!0,this.preview&&this.dom.$previewLink.click()):Widget.MimiFlash.error(I18n.t("MimiFlash.promotion.edit_raw.success.error")+"\n"+t.error)},failed:function(t,e){this.saved=!1,this.preview=!1,Widget.MimiFlash.error(I18n.t("MimiFlash.promotion.edit_raw.failed.error")+"\n"+e)},onPreviewClick:function(t){this.saved||(this.preview=!0,t.preventDefault(),this.fire("promotion:save"))},setToUnsaved:function(){this.saved=!1},saving:function(){this.dom.$saveButton.prop("disabled",!0),this.dom.$previewLink.prop("disabled",!0)},onImportFromUrl:function(){return this.hideImportMenu(),Mimi.Promotion.ImportUrlDialog.show(this.promotionId),!1},onImportFromZip:function(){return this.hideImportMenu(),Mimi.Promotion.ImportZipDialog.show(this.promotionId),!1},onImported:function(t,e){this.editor.getSession().setValue(e.html),_.defer(_.bind(this.editor.focus,this.editor))},initSkipInlining:function(){this.dom.$promotionSkipInlining[0]&&this.dom.$promotionSkipInlining.on("click",function(t){t.target.checked||window.alert(I18n.t("MimiFlash.promotion.edit_raw.initSkipInlining"))})},hideImportMenu:function(){Widget.Select.instances[this.dom.$importHtmlbtn.identify()].hide()},setWrap:function(t){this.editor.getSession().setUseWrapMode(t),_.defer(_.bind(this.editor.focus,this.editor))},onWrapText:function(){t("#button_text").toggleClass("hidden_text"),t("#button_text_selected").toggleClass("hidden_text"),t("#text_wrapping").toggleClass("selected"),this.setWrap(this.dom.$textWrap.hasClass("selected"))},DOM:{form:"#raw_html_form",textWrap:"#text_wrapping",importHtmlbtn:".html_import",importFromUrl:"#import_from_url",importFromZip:"#import_from_zip",promotionSkipInlining:"#promotion_skip_inlining",promotionId:"#promotion-id",snippets:[".promo_snippets textarea.code"],snippetbtns:[".promo_snippets button.insert_html"],htmlField:"#promotion_raw_html",saveButton:"button.save",previewLink:"a.btn.preview",promotionName:"#promotion_name"}}).singleton()}(jQuery),function(t){Mimi.Promotion.EditText=Class.create(Widget.Observer,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(this.DOM),this.promotion=Mimi.Promotion.Data.promotion,this.dom.$reimportbtn.on("click",_.bind(this.onReimport,this)),this.dom.$actions.on("click","button",_.bind(this.onAction,this)),this.initializeSnippets()},initializeSnippets:function(){this.dom.$snippets.on("focus","textarea.code",function(e){e.target.setAttribute("wrap","normal"),_.defer(function(){t(e.target).css({height:(e.target.scrollHeight+parseInt(t(e.target).css("padding-top"),10)+parseInt(t(e.target).css("padding-bottom"),10)).px()})})}),this.dom.$snippets.on("blur","textarea.code",function(t){t.target.setAttribute("wrap","off"),t.target.removeAttribute("style")}),this.dom.$snippetbtns.on("mousedown",_.bind(function(e){var i=t(e.target).findElement("span.combo_input").find("textarea.code").val(),s=this.dom.$textField;s.focus().insertAtCursor(i),_.defer(function(){s.focus()})},this))},onReimport:function(){return this["import"](),!1},"import":function(){t.get("reimport_edit_text.json").done(_.bind(this.onImportSuccess,this)).fail(_.bind(this.onImportFailure,this))
},onImportSuccess:function(t){t.success?this.dom.$textField.val(t.text||""):Widget.MimiFlash.error(I18n.t("MimiFlash.promotion.edit_text.onImportSuccess")+"\n"+t.error)},onImportFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.promotion.edit_text.onImportFailure"))},onAction:function(e){var i=t(e.currentTarget);switch(i.detectClass("save","schedule","send","continue")){case"save":this.afterSaving=null;break;case"schedule":this.afterSaving="schedule";break;case"send":this.afterSaving="send";break;case"continue":this.afterSaving="continue"}return this.save(),!1},save:function(){t.ajax({url:"async_save_plain_text",type:"post",dataType:"json",data:{plain_text:encodeURIComponent(this.dom.$textField.val()),name:this.dom.$nameField.val(),_method:"put"}}).done(_.bind(this.onSaveSuccess,this)).fail(_.bind(this.onSaveFailure,this)).always(_.bind(this.onSaveComplete,this)),this.dom.$savebtn.html(I18n.t("js.promotion.edit_text.save")),this.dom.$actionbtns.disable()},onSaveSuccess:function(t){t.success?(this.promotion=t.result,this.afterSave()):Widget.MimiFlash.error(I18n.t("MimiFlash.promotion.edit_text.onSaveSuccess")+" \n"+t.error),this.onSaveComplete()},onSaveFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.promotion.edit_text.onSaveFailure")),this.onSaveComplete()},onSaveComplete:function(){this.dom.$savebtn.html(I18n.t("js.promotion.edit_text.onSaveComplete")),this.dom.$actionbtns.enable()},afterSave:function(){try{switch(this.afterSaving){case"schedule":window.location=Mimi.Promotion.Data.schedulePath;break;case"send":window.location=Mimi.Promotion.Data.sendPath;break;case"continue":window.location=Mimi.Promotion.Data.dripCampaignPath}}catch(t){debug("Exception in afterSave: "+t.message)}this.afterSaving=null},scheduled:function(t){this.promotion.schedules=t},DOM:{nameField:"#promotion_name",textField:"#promotion_plain_text",reimportbtn:"#reimport_text_from_html_btn",snippetbtns:[".promo_snippets button.insert_html"],snippets:[".promo_snippets textarea.code"],actions:"footer .actions",actionbtns:["footer .actions button"],savebtn:"footer .actions button.save"}}).singleton()}(jQuery),function(t){var e={urlField:"input[type='text']",form:"form",submitbtn:".actions button",errorField:".import-error"};Mimi.Promotion.ImportUrlDialog=Class.create(Widget.Popup,Widget.Observable,{initialize:function($super){$super("#import_url",{hideTrigger:".window_close, .back",overlay:Widget.ModalOverlay,fixedPosition:!1,onHidden:_.bind(this.onHidden,this)}),this.dom=this.$element.getChildren(e),this.dom.$urlField.on("keyup",_.bind(this.onKeyUp,this)),this.dom.$form.on("submit",_.bind(this.onSubmit,this))},onHidden:function(){this.hideError(),this.unlock()},isUrlValid:function(){var t=Link.getFullUrl(this.dom.$urlField.val());return Link.isValidHttp(t)},onKeyUp:function(){this.dom.$submitbtn[this.isUrlValid()?"enable":"disable"]()},show:function($super,t){this.promotionId=t,$super(),this.dom.$urlField.select()},lock:function(){this.dom.$submitbtn.disable().html(this.dom.$submitbtn.attr("data-alt-value"))},unlock:function(){this.dom.$submitbtn.disable().html(this.dom.$submitbtn.attr("data-value")),this.dom.$submitbtn.enable()},onSubmit:function(){return this["import"](),!1},"import":function(){this.hideError(),t.post("/html_imports.json",{id:this.promotionId,url:Link.getFullUrl(this.dom.$urlField.val())}).done(_.bind(this.onImportSuccess,this)).fail(_.bind(this.onImportFailure,this)),this.lock()},onImportSuccess:function(t){t&&(t.success?(this.fire("promotion:imported",{html:t.result}),Widget.MimiFlash.create(I18n.t("MimiFlash.promotion.import_url_dialog.onImportSuccess")),this.hide()):this.showError(t.error),this.unlock())},onImportFailure:function(t){this.showError(t.error),this.unlock()},showError:function(t){console.log(t),this.dom.$errorField.html(I18n.t("js.promotion.import_url_dialog.showError")).show()},hideError:function(){this.dom.$errorField.hide()}}).singleton("show")}(jQuery),function(t){Mimi.Promotion.ImportZipDialog=Class.create(Widget.Popup,Widget.Observable,{initialize:function($super){$super("#import_zip",{hideTrigger:".window_close, .back",overlay:Widget.ModalOverlay,fixedPosition:!1}),this.dom=this.$element.getChildren(this.DOM),this.dom.$fileField.on("change",_.bind(this.onZipFileSelected,this)),this.boundSubmit=_.bind(this.onSubmit,this),this.dom.$form.on("submit",this.boundSubmit),t(document).on("upload:succeeded",_.bind(this.onUploadSuccess,this)),t(document).on("upload:failed",_.bind(this.onUploadFailure,this))},onZipFileSelected:function(){this.dom.$nameField.val(this.dom.$fileField.val()),this.dom.$submitbtn.enable()},show:function($super,t){this.promotionId=t,$super()},lock:function(){this.dom.$submitbtn.disable().html(this.dom.$submitbtn.attr("data-alt-value"))},unlock:function(){this.dom.$submitbtn.disable().html(this.dom.$submitbtn.attr("data-value")),this.dom.$submitbtn.enable()},onSubmit:function(){return this.upload(),!1},upload:function(){this.dom.$errorField.hide(),this.dom.$fileField.val()&&(this.lock(),this.dom.$form.off("submit",this.boundSubmit),this.dom.$form.submit())},onUploadSuccess:function(t,e){this.fire("promotion:imported",{html:e.data}),Widget.MimiFlash.create(I18n.t("MimiFlash.promotion.import_zip_dialog.onUploadSuccess")),this.hide()},onUploadFailure:function(t,e){this.dom.$errorField.html(I18n.t("js.promotion.import_zip_dialog.onUploadFailure")+"\n"+e.errorMessage).show(),this.unlock()},DOM:{fileField:"input[type='file']",nameField:"input[type='text']",form:"form",submitbtn:".actions button",errorField:".import-error"}}).singleton("show")}(jQuery),Composer.CORSUploader=Class.create(Widget.Observer,{initialize:function(t,e,i){this.image=t,this.onUploadCallbackObject=e,this.onUploadCallbackMethod=i,this.image.observe("composer:image:loaded",_.bind(this.removeProgressIndicator,this))},uploadFile:function(t){var e=/(image\/jpeg|image\/jpg|image\/pjpeg|image\/png|image\/x-png|image\/gif)$/i;if(t.size>0&&e.test(t.type)){var i=Composer.Data.promotion.id;if(!isNaN(i)){this.image.fire("upload:started");var s=this.createRequest();s.open("GET","/promotions/"+i+"/signput?name="+encodeURIComponent(t.name)+"&type="+t.type,!0);var n=this;s.onload=function(){200===this.status&&4===this.readyState&&(n.onUploadCallback(),n.uploadToS3(this.responseText,t))},s.send()}return!0}var o=_.template(I18n.t("js.promotion.s3_upload.uploadFile")),a=o({filename:t.name});return Widget.MimiFlash.error(a),this.image.destroy(),!1},createRequest:function(){var t=new XMLHttpRequest;return"withCredentials"in t||(t=null),t},uploadToS3:function(t,e){var i=this.createRequest(),s=this;t=JSON.parse(t),this.image.setData({id:t.id,src:t.display_url}),i.open("PUT",t.upload_url,!0),i.setRequestHeader("Content-Type",e.type),i.onload=function(t){200===this.status&&4===this.readyState?(s.image.load(),s.setProgress(100),s.image.fire("upload:succeeded"),setTimeout(_.bind(s.reprocessImage,s),2e3)):(s.image.fire("upload:failed"),s.notifyUserCreatePtAndDeleteImage(t,e.name))},i.onerror=function(t){s.notifyUserCreatePtAndDeleteImage(t,e.name)},i.upload.onprogress=function(t){if(t.lengthComputable){var e=Math.round(t.loaded/t.total*100);s.setProgress(e)}},i.send(e)},notifyUserCreatePtAndDeleteImage:function(t,e){var i=_.template(I18n.t("js.promotion.s3_upload.notifyUserCreatePtAndDeleteImage")),s=i({filename:e});Widget.MimiFlash.error(s),this.image.sendDestroyRequest()},onUploadCallback:function(){this.onUploadCallbackObject&&this.onUploadCallbackMethod&&this.onUploadCallbackObject[this.onUploadCallbackMethod]()},reprocessImage:function(){Composer.ImageList.addImage(this.image),this.image.reprocess()},setProgress:function(t){this.image.$element[0].style.background="url('https://d1lggihq2bt4jo.cloudfront.net/assets/img/loading.gif') no-repeat scroll center center white";var e="background: -moz-linear-gradient(left, rgb(153, 204, 255) "+t+"%, transparent 0%) repeat scroll 0px 0px transparent;background: -webkit-linear-gradient(left, rgb(153, 204, 255) "+t+"%, transparent 0%) repeat scroll 0px 0px transparent;background: -o-linear-gradient(left, rgb(153, 204, 255) "+t+"%, transparent 0%) repeat scroll 0px 0px transparent;background: -ms-linear-gradient(left, rgb(153, 204, 255) "+t+"%, transparent 0%) repeat scroll 0px 0px transparent;background: linear-gradient(left, rgb(153, 204, 255) "+t+"%, transparent 0%) repeat scroll 0px 0px transparent;";this.image.dom.$card.attr("style",e)},removeProgressIndicator:function(){this.image.$element.css("background","#fff"),this.image.dom.$card.css({background:"#fff",opacity:1})},setImageSize:function(){var t=this.image.dom.$image[0].naturalWidth;t>590?(this.image.width=590,this.image.height=590*this.image.dom.$image[0].naturalHeight/t):(this.image.width=this.image.dom.$image[0].naturalWidth,this.image.height=this.image.dom.$image[0].naturalHeight),this.image.ratio=this.image.width/this.image.height}}),function(t){Mimi.Promotion.Preview=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(this.DOM),this.initObservers(),this.dom.$previewOptions.hide()},initObservers:function(){t(document).on("personalization_display:display_preview_button",_.bind(this.displayPersonalizationButtons,this)),t(document).on("promotion:saved",_.bind(this.reloadPreview,this)),this.dom.$fallbacksButton.on("click",_.bind(this.displayFallbacks,this)),this.dom.$viewTagsButton.on("click",_.bind(this.displayMacros,this)),this.dom.$personalizationButton.on("click",_.bind(this.displayPersonalization,this))},displayPersonalizationButtons:function(){this.dom.$previewOptions.show(),this.dom.$viewTagsButton.hide(),this.dom.$personalizationButton.hide()},reloadPreview:function(){window.location.reload(!0)},displayFallbacks:function(){this.fire("personalization_display:fallbacks"),this.dom.$fallbacksButton.hide(),this.dom.$viewTagsButton.show()},displayMacros:function(){this.fire("personalization_display:macros"),this.dom.$viewTagsButton.hide(),this.dom.$personalizationButton.show()},displayPersonalization:function(){this.fire("personalization_display:personalization"),this.dom.$personalizationButton.hide(),this.dom.$fallbacksButton.show()},DOM:{previewOptions:".preview_options",fallbacksButton:"#fallbacks_button",viewTagsButton:"#view_tags_button",personalizationButton:"#personalization_button"}}).singleton()}(jQuery),function(t){Mimi.Promotion.Webview=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){t(document).on("personalization_display:fallbacks",_.bind(this.displayFallbacks,this)),t(document).on("personalization_display:macros",_.bind(this.displayMacros,this)),t(document).on("personalization_display:personalization",_.bind(this.displayPersonalization,this)),this.displayPreviewButton()},displayPreviewButton:function(){var e=t("#preview");if(e.length>0){var i=e[0].contentDocument||e[0].contentWindow.document,s=i.querySelectorAll(".personalization-tag-parens"),n=i.querySelectorAll(".personalization-tag-braces");s.length+n.length!==0&&this.fire("personalization_display:display_preview_button")}},displayFallbacks:function(){var e=document.getElementById("preview").contentDocument.querySelectorAll(".personalization-tag-parens");_.each(e,function(e){var i=e.getAttribute("data-value"),s=t('<span class="personalization-display-parens">');s.prop("id",t(e).identify()),s.html(i),t(e).before(s),t(e).hide()}),e=document.getElementById("preview").contentDocument.querySelectorAll(".personalization-tag-braces"),_.each(e,function(e){var i=e.getAttribute("data-value"),s=t('<span class="personalization-display-braces">');s.prop("id",t(e).identify()),s.html(i),t(e).before(s),t(e).hide()})},displayMacros:function(){var e=document.getElementById("preview").contentDocument.querySelectorAll(".personalization-display-parens");_.each(e,function(e){var i=t(e).identify(),s=e.innerHTML,n=""===s?"("+i+")":"("+i+",fallback="+s+")";t(e).html(n)}),e=document.getElementById("preview").contentDocument.querySelectorAll(".personalization-display-braces"),_.each(e,function(e){var i=t(e).identify(),s=e.innerHTML,n=""===s?"{{"+i+"}}":"{{"+i+",fallback="+s+"}}";t(e).html(n)})},displayPersonalization:function(){var e=document.getElementById("preview").contentDocument.querySelectorAll(".personalization-display-parens");_.each(e,function(e){t(e).remove()}),e=document.getElementById("preview").contentDocument.querySelectorAll(".personalization-display-braces"),_.each(e,function(e){t(e).remove()});var i=document.getElementById("preview").contentDocument.querySelectorAll(".personalization-tag-parens");_.each(i,function(e){t(e).show()}),i=document.getElementById("preview").contentDocument.querySelectorAll(".personalization-tag-braces"),_.each(i,function(e){t(e).show()})}}).singleton()}(jQuery),function(t){Mimi.Promotion.SendTest=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(this.DOM),this.initData(),this.initObservers(),this.initAutoComplete()},initObservers:function(){this.dom.$sendTest.on("submit",_.bind(this.onSubmit,this)),this.dom.$audienceMembersField.on("click",_.bind(this.onAudienceMembersFieldClick,this))},initAutoComplete:function(){var t=this.dom.$audienceMembersField;this.autoComplete=new Mimi.Audience.AutoComplete(t[0],t[0],{zIndex:10000008,limit:4,width:300})},initData:function(){this.data={recipients:""}},onAudienceMembersFieldClick:function(){this.dom.$audienceMembersField.select()},onSubmit:function(){if(!this.validateEmail())return!1;var e=this.dom.$sendTest.find("button");return this.containsEmail(this.dom.$audienceMembersField.val())?(e.addClass("disabled"),e.removeClass("send"),e.find("span").html(I18n.t("js.promotion.send_test.onSubmit.sending")),this.data.recipients=this.dom.$audienceMembersField.val().replace(/,?\s+$/,"").escapeHTML(),t.ajax({url:this.dom.$sendTest.attr("action"),type:"post",data:this.dom.$sendTest.serialize()}).done(_.bind(function(t){t.success?Widget.MimiFlash.create(I18n.t("MimiFlash.promotion.send_test.onSubmit.onSuccess")+" "+this.data.recipients+"."):Widget.MimiFlash.create(t.error,{type:"error"}),this.resetButton(e,I18n.t("js.promotion.send_test.onSubmit.send"))},this)).fail(_.bind(function(){Widget.MimiFlash.create(I18n.t("MimiFlash.promotion.send_test.onSubmit.onFailure"),{type:"error"}),this.resetButton(e,I18n.t("js.promotion.send_test.onSubmit.send"))},this)),!1):(this.dom.$audienceMembersField.addClass("error"),e.addClass("disabled"),e.find("span").html(I18n.t("js.promotion.send_test.onSubmit.invalid_email")),!1)},validateEmail:function(){return this.containsEmail(this.dom.$audienceMembersField.val())?!0:(Widget.MimiFlash.error(I18n.t("MimiFlash.promotion.send_test.validateEmail")),!1)},resetButton:function(t,e){t.find("span").html(e),t.removeClass("disabled").addClass("send")},containsEmail:function(t){var e=/([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+/;return e.test(t)},DOM:{sendTest:"#send_test",sendTestSubmitButton:"#send_test button",audienceMembersField:"#send_test #audience_members"}}).singleton()}(jQuery),Mimi.Callbacks={},Mimi.Callbacks.SelectCallbacks=function(t){function e(e){var s=t("<span/>").attr("class","switch").html("<span></span>"),n=e.parent(".field").find("input[type=text]");i(e,s,n),e.hide(),s.insertBefore(e),s.on("click",function(){e.click()}),e.on("change",function(){i(e,s,n)})}function i(t,e,i){t.is(":checked")?(e.addClass("on"),i.enable()):(e.removeClass("on"),i.disable())}var s={};return s.init=function(){t.each(t("#callbacks input[type=checkbox]"),function(i,s){e(t(s))})},s}(jQuery),function(t){Mimi.AudienceExport=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#main"),this.dom=this.$element.getChildren(Mimi.AudienceExport.DOM),this.confirmExportDialog=new Mimi.ExportFormatDialog,this.initializeObservers()},initializeObservers:function(){this.dom.$exportContactsBtn.on("click",_.bind(this.confirmExport,this)),this.dom.$primaryExportContacts.on("click",_.bind(this.confirmedExport,this)),this.dom.$dialog.find(".actions").on("click",_.bind(this.onActionClick,this))},confirmExport:function(){return this.confirmExportDialog.show(),!1},confirmedExport:function(){var e="all",i=Mimi.Audience.Dashboard.Bulk.PATHS.exportPath({id:e}),s=this.confirmExportDialog.selectedFormat(),n={exportType:s};this.confirmExportDialog.hide(),t.post(i,n).done(function(){Widget.MimiFlash.error(I18n.t("MimiFlash.audience_export.confirmedExport.onFailure"))}).fail(function(){Widget.MimiFlash.create(I18n.t("MimiFlash.audience_export.confirmedExport.onSuccess.start")+" \n"+I18n.t("MimiFlash.audience_export.confirmedExport.onSuccess.end"))})},onActionClick:function(e){var i=t(e.target).closest(".back");return i[0]?(this.confirmExportDialog.hide(),!1):void 0}}).singleton(),Mimi.AudienceExport.DOM={exportContactsBtn:"#export_contacts_button",primaryExportContacts:"#primary_export_contacts",dialog:"#export_format_dialog"},Mimi.AudienceExport.PATHS={exportPath:_.template("/exports/audience/#{id}.json")}}(jQuery),function(t){Mimi.Referral=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#main"),this.initDom(),this.initObservers()},initDom:function(){this.dom=this.$element.getChildren(Mimi.Referral.DOM)},initObservers:function(){this.initPagingObservers(),this.dom.$link.on("click",_.bind(this.onLinkClick,this)),this.dom.$updateButton.on("click",_.bind(this.onUpdateButtonClick,this))},initPagingObservers:function(){this.dom.$pagination.on("click","a",_.bind(this.updateReferrals,this))},updateReferrals:function(){return t.get(this.getAttribute("href")).done(_.bind(this.updateReferralsSuccess,this)),!1},updateReferralsSuccess:function(){this.initPagingObservers()},onLinkDialogSuccess:function(){this.dom.$submitNotice.slideUp("fast"),this.dom.sidebar.$submitDetails.slideUp("fast"),this.dom.$processingNotice.slideDown("fast"),this.dom.sidebar.$processingDetails.slideDown("fast")},onUpdateDetailsDialogSuccess:function(){Widget.MimiFlash.create("You affiliate details were successfully updated!")},onLinkClick:function(){return Mimi.AffiliateDetailsDialog.show({onSuccess:_.bind(this.onLinkDialogSuccess,this)}),!1},onUpdateButtonClick:function(){return Mimi.UpdateAffiliateDetailsDialog.show({onSuccess:_.bind(this.onUpdateDetailsDialogSuccess,this)}),!1}}).singleton(),Mimi.Referral.DOM={pagination:".pagination",link:[".submit_affiliate_information"],submitNotice:"#affiliate_details_submit_notice",processingNotice:"#affiliate_details_processing_notice",header:".affiliate > header",updateButton:".update_affiliate_details a",sidebar:{submitDetails:"aside .submit_affiliate_details",processingDetails:"aside .processing_affiliate_details"}}}(jQuery),Mimi.DmarcAddress=Class.create({isMatch:function(t){var e=new RegExp("@"+Mimi.PRejectDomains.join("|@").replace(".","."));return e.test(t)}}).singleton("isMatch"),Mimi.Triggers={},function(t){Mimi.Triggers.Mailing=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.initObservers()},initObservers:function(){t(document).on("trigger:mailing:load",_.bind(this.loadMailing,this)),t(document).on("trigger:mailing:submit",_.bind(this.saveMailingDetails,this))},loadMailing:function(e,i){var s="/promotions_dedicated_mailings/"+i.promotionId;t.get(s).done(_.bind(this.showMailingPage,this))},showMailingPage:function(e){t(document).trigger("trigger:mailing:show",{mailing:e})},saveMailingDetails:function(e,i){this.clearErrors();var s=i.form;this.validateForm()?this.submitForm(s):(this.displayErrors(),t(document).trigger("trigger:mailing:error"))},validateForm:function(){return this.errors={},this.validateFromName(),this.validateFromEmail(),this.validateSubject(),0===this.errorMessage.length},validateFromName:function(){var e=t("#schedule_from_name").val();this.isBlank(e)&&(t("input#schedule_from_name").parent().addClass("error"),this.errorMessage=this.errorMessage+I18n.t("MimiFlash.mailing.name_error"))},validateFromEmail:function(){var e=t("#schedule_from_email").val();this.isBlank(e)?(t("input#schedule_from_email").parent().addClass("error"),this.errorMessage=this.errorMessage+I18n.t("MimiFlash.mailing.blank_email_error")):this.isEmail(e)||this.hasValidEmailFallback(e)||(t("input#schedule_from_email").parent().addClass("error"),this.errorMessage=this.errorMessage+I18n.t("MimiFlash.mailing.invalid_email_error"))},validateSubject:function(){var e=t("#schedule_subject").val();this.isBlank(e)&&(t("input#schedule_subject").parent().addClass("error"),this.errorMessage=this.errorMessage+I18n.t("MimiFlash.mailing.subject_error"))},hasValidEmailFallback:function(t){t=t.replace("(","").replace(")","");var e=_.last(t.split("=")),i=_.last(t.split(","));return i.replace(" ","")!=="fallback="+e?!1:this.isEmail(e)},submitForm:function(e){t.ajax({url:e.action,type:"post",data:t(e).serialize()}).done(_.bind(this.submitSuccess,this)).fail(_.bind(this.submitError,this))},displayErrors:function(){this.errorMessage=I18n.t("MimiFlash.mailing.error_heading")+this.errorMessage,Widget.MimiFlash.error(this.errorMessage)},clearErrors:function(){this.errorMessage="",t("#edit_trigger_dialog .error").removeClass("error")},submitSuccess:function(){t(document).trigger("trigger:mailing:saved")},submitError:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.mailing.unknown_error"))},isBlank:function(t){return!t||0===t.toString().trim().length},isEmail:function(t){var e=/^([a-zA-Z0-9_\.\-\&])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return e.test(t.trim())}}).singleton(),Mimi.Triggers.Mailing.get()}(jQuery),function(t){Mimi.Triggers.UI=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.initObservers(),this.initializeEditDialog(),this.initializeTemplateSettings()},initObservers:function(){t("#new_trigger_link").on("click",_.bind(this.showNewPage,this)),t("li.trigger").each(_.bind(function(e,i){this.initTriggerItemObservers(t(i))},this)),t(document).on("trigger:save:success",_.bind(this.handleSave,this)),t(document).on("trigger:remove:success",_.bind(this.removeTriggerElement,this)),t(document).on("trigger:toggle:success",_.bind(this.toggleTriggerElement,this)),t(document).on("trigger:error",_.bind(this.showUnknownError,this)),t(document).on("trigger:save:failure",_.bind(this.showTriggerErrors,this)),t(document).on("trigger:mailing:show",_.bind(this.showTriggerMailing,this)),t(document).on("trigger:mailing:error",_.bind(this.showMailingError,this)),t(document).on("trigger:mailing:saved",_.bind(this.closeDialogBox,this))},initTriggerItemObservers:function(t){t.find(".edit").on("click",_.bind(this.showEditPage,this)),t.find(".edit_trigger").on("click",_.bind(this.showEditPage,this)),t.find(".delete").on("click",_.bind(this.deleteTrigger,this)),t.find(".start a").on("click",_.bind(this.toggleTrigger,this)),t.find(".pause a").on("click",_.bind(this.toggleTrigger,this))},initializeTemplateSettings:function(){this.templateSettings={interpolate:/\{\{\=(.+?)\}\}/g,evaluate:/\{\{(.+?)\}\}/g}},initializeEditDialog:function(){this.editTriggerDialog=new Widget.Popup("#edit_trigger_dialog",{hideTrigger:".window_close, .back",overlay:Widget.ModalOverlay,fixedPosition:!1})},deleteTrigger:function(e){var i=t(e.currentTarget).closest("li.trigger").attr("data-id");return this.fire("trigger:delete",{id:i}),!1},toggleTrigger:function(e){var i=t(e.currentTarget).closest("li.trigger").attr("data-id");return this.fire("trigger:toggle",{id:i}),!1},showNewPage:function(e){e.preventDefault();var i=t("#new_trigger_dialog").html(),s=_.template(i);t("#edit_trigger_dialog").html(s),this.hideLoader(),this.editTriggerDialog.$element.find("span.select").each(function(){Widget.Dropdown.instances[t(this).identify()]=new Widget.Dropdown(this)}),this.editTriggerDialog.show(),this.editTriggerDialog.$element.find("form").on("submit",_.bind(this.fireSubmit,this))},showEditPage:function(e){e.preventDefault();var i=t(e.currentTarget).closest("li.trigger").attr("data-id"),s=Mimi.Triggers.DATA[i];_.templateSettings={interpolate:/\{\{\=(.+?)\}\}/g,evaluate:/\{\{(.+?)\}\}/g};var n=t(".trigger-form-template").html(),o=_.template(n)(s);t("#edit_trigger_dialog").html(o),this.editTriggerDialog.$element.find("span.select").each(function(){Widget.Dropdown.instances[t(this).identify()]=new Widget.Dropdown(this)}),this.hideLoader(),this.editTriggerDialog.$element.find("input[name=audience_list]").val(s.audience_list_id),this.editTriggerDialog.show(),this.editTriggerDialog.$element.find("form").on("submit",_.bind(this.fireSubmit,this))},fireSubmit:function(t){return this.clearErrors(),this.showLoader(),this.hideStep1(),this.fire("trigger:submit",{form:t.currentTarget}),!1},handleSave:function(e,i){var s=i.id;0===t("li.trigger[data-id="+s+"]").length?this.addTrigger(s):this.updateTrigger(s),this.initTriggerItemObservers(t('li.trigger[data-id="'+s+'"]:eq(0)'))},showTriggerErrors:function(e,i){var s=i.errors;if(this.hideLoader(),this.showStep1(),422===i.status){var n=[];s.name&&(n.push(I18n.t("MimiFlash.triggers.name_error")),t("input#trigger_name").parent().addClass("error")),s.audience_list_id&&(n.puhs(I18n.t("MimiFlash.triggers.audience_error")),t('label[for="trigger_audience_list"]').parent().addClass("error")),s.promotion_id&&(n.push(I18n.t("MimiFlash.triggers.promotion_error")),t('label[for="trigger_promotion_id"]').parent().addClass("error")),Widget.MimiFlash.error(n.length?I18n.t("MimiFlash.triggers.error_heading")+n.join(" "):I18n.t("MimiFlash.triggers.unknown_error"))}else Widget.MimiFlash.error(I18n.t("MimiFlash.triggers.unknown_error"))},clearErrors:function(){t("#edit_trigger_dialog .error").removeClass("error")},addTrigger:function(e){_.templateSettings=this.templateSettings;var i=Mimi.Triggers.DATA[e],s=t(".trigger-item-template").html(),n=_.template(s)(i);0===t("li.trigger").size()?(t("ul.triggers").append(n),t(".mimi_voice_main").remove()):t("li.trigger").last().after(n),this.fire("trigger:mailing:load",{promotionId:i.promotion_id})},updateTrigger:function(e){_.templateSettings=this.templateSettings;var i=Mimi.Triggers.DATA[e],s=t(".trigger-item-template").html(),n=_.template(s)(i);t("li.trigger[data-id="+e+"]").replaceWith(n),this.fire("trigger:mailing:load",{promotionId:i.promotion_id})},showTriggerMailing:function(e,i){var s=i.mailing;_.templateSettings=this.templateSettings;var n=t(".mailing-form-template").html(),o=_.template(n)(s);t("#schedule-dialog-step-2").html(o),t("#schedule-dialog-step-2 form").on("submit",_.bind(this.submitMailing,this)),this.showStepOverview(),this.showStep2(),this.hideLoader(),t("#schedule-dialog-step-2 .back").on("click",_.bind(this.backToStep1,this))},submitMailing:function(t){return this.hideStep2(),this.showLoader(),this.fire("trigger:mailing:submit",{form:t.currentTarget}),!1},showMailingError:function(){this.showStepOverview(),this.showStep2(),this.hideLoader()},backToStep1:function(){return this.hideStep2(),this.showStep1(),!1},closeDialogBox:function(){this.editTriggerDialog.hide()},showLoader:function(){t("#schedule_loader").show()},hideLoader:function(){t("#schedule_loader").hide()},hideStep1:function(){t("#schedule-dialog-step-1").hide(),this.hideStepOverview()},showStep1:function(){t("nav.steps_2 li").addClass("current"),t("nav.steps_2 li").removeClass("finished"),t("nav.steps_2 li").removeClass("current"),t("#schedule-dialog-step-1").show(),this.showStepOverview()},hideStep2:function(){t("#schedule-dialog-step-2").hide(),this.hideStepOverview()},showStep2:function(){t("nav.steps_2 li").removeClass("current"),t("nav.steps_2 li").addClass("finished"),t("nav.steps_2 li").addClass("current"),t("#schedule-dialog-step-2").show(),this.showStepOverview()},hideStepOverview:function(){t("#edit_trigger_dialog .steps_overview").hide()},showStepOverview:function(){t("#edit_trigger_dialog .steps_overview").show()},removeTriggerElement:function(e,i){var s=i.id;t("li.trigger[data-id="+s+"]").remove()},toggleTriggerElement:function(e,i){var s=i.id;t("li.trigger[data-id="+s+"] .pause").hasClass("hidden")?(t("li.trigger[data-id="+s+"] .pause").removeClass("hidden"),t("li.trigger[data-id="+s+"] .start").addClass("hidden")):(t("li.trigger[data-id="+s+"] .pause").addClass("hidden"),t("li.trigger[data-id="+s+"] .start").removeClass("hidden"))},showUnknownError:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.triggers.unknown_error"))}}).singleton()}(jQuery),function(t){Mimi.Addons.Triggers=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.initObservers(),this.enableLinks()},enableLinks:function(){t("li.trigger a, #new_trigger_link").removeAttr("disabled")},initObservers:function(){t(document).on("trigger:submit",_.bind(this.submitForm,this)),t(document).on("trigger:delete",_.bind(this.deleteTrigger,this)),t(document).on("trigger:toggle",_.bind(this.toggleTrigger,this))},submitForm:function(e,i){var s=i.form;t.ajax({url:s.action,type:"post",data:t(s).serialize(),dataType:"json"}).done(_.bind(this.submitSuccess,this)).fail(_.bind(this.submitError,this))},submitSuccess:function(e){Mimi.Triggers.DATA[e.id]=e,t(document).trigger("trigger:save:success",{id:e.id})},submitError:function(t){this.fire("trigger:save:failure",{errors:t,status:t.status})},deleteTrigger:function(e,i){var s=i.id;return window.confirm(I18n.t("js.triggers.delete_confirm_message"))&&t.ajax({url:"/triggers/"+s,type:"delete"}).done(_.bind(function(){this.removeTrigger(s)},this)).fail(_.bind(this.displayErrorMessage,this)),!1},toggleTrigger:function(e,i){var s=i.id;return t.ajax({url:"/triggers/"+s+"/toggle",type:"put"}).done(_.bind(function(){this.toggleButton(s)},this)).fail(_.bind(this.displayErrorMessage,this)),!1},removeTrigger:function(e){t(document).trigger("trigger:remove:success",{id:e})},toggleButton:function(e){t(document).trigger("trigger:toggle:success",{id:e})},displayErrorMessage:function(){t(document).trigger("trigger:error")}}).singleton()}(jQuery),Mimi.Sidekicks={},function(t){Mimi.Sidekicks.Settings=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.Sidekicks.DOM),this.tabs=new Widget.Tabs(this.dom.$tabs,{noState:!0}),this.publishingSettingDropdown=new Widget.Dropdown(this.dom.$publishingSelect.closest("span.select"),{onItemClick:_.bind(this.onPublishSettingsChange,this)}),this.dripPublishingSettingDropdown=new Widget.Dropdown(this.dom.$dripPublishingSelect.closest("span.select"),{onItemClick:_.bind(this.onDripPublishSettingsChange,this)})},onPublishSettingsChange:function(t,e,i,s){this.updateSettings("publishing_setting",i,s)},onDripPublishSettingsChange:function(t,e,i,s){this.updateSettings("drip_publishing_setting",i,s)},updateSettings:function(e,i,s){var n=this,o="sidekick_config["+e+"]",a={};a[o]=i,t.put(Mimi.Sidekicks.Paths.updateConfig,a).done(function(){Widget.MimiFlash.create(I18n.t("MimiFlash.sidekicks.settings.update_success"))}).fail(function(){Widget.MimiFlash.error(I18n.t("MimiFlash.sidekicks.settings.update_failure")),"publishing_setting"===e?n.publishingSettingDropdown.setSelection(s):n.dripPublishingSettingDropdown.setSelection(s)})}}).singleton(),Mimi.Sidekicks.Paths={updateConfig:"/sidekick_config.json"},Mimi.Sidekicks.DOM={publishingSelect:"[name=sidekick_publishing_id]",dripPublishingSelect:"[name=sidekick_drip_publishing_id]",tabs:"#publishing_settings_tabs"}}(jQuery),function(t){t(window).load(function(){t("body").addClass("loaded")})}(jQuery),Mimi.Stats={},function(t){Mimi.Stats.TipManager={tipEvents:function(e){var i=this,s=e.data("tip"),n=t(s.element);n.mouseleave(function(){e.data("tip_hovered",!1),i.setHideTimeout(e)}).mouseenter(function(){e.data("tip_hovered",!0),i.showTip(e)})},setHideTimeout:function(t){var e=this;t.data("tip_hovered")||t.data("link_hovered")||t.data("hideTimeout",setTimeout(function(){e.hideTip(t)},50))},linkEvents:function(t){var e=this;t.mouseenter(function(){t.data("link_hovered",!0),e.showTip(t)}).mouseleave(function(){t.data("link_hovered",!1),e.setHideTimeout(t)})},tipVisible:function(e){var i=e.data("tip");return t(i.element).is(":visible")},showTip:function(t){clearTimeout(t.data("hideTimeout")),this.tipVisible(t)||t.data("tip").show()},createTip:function(e){var i=t("<div/>").attr({id:"js_toggle_"+e.data("state"),"class":"guide_tip spaced",style:"display: none"}).append("<div class='tip_contents clicks'>"+e.data("value")+"</div>");t(document.body).append(i);var s=new Widget.GuideTip(i.attr("id"),e[0],{position:"center farTop",offset:"0 -5"});e.data("tip",s),this.tipEvents(e),this.linkEvents(e)},hideTip:function(t){t.data("tip").hide()}}}(jQuery),function(t){Mimi.Stats.PromotionStats=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#main"),this.dom=this.$element.getChildren(this.DOM),this.data={selectedLinks:[]},this.isListeningForPush=!1,this.initializeEvents(),this.initializeWidgets(),this.loadPromotionAttempts(),this.chart();
var e=State.get("dashboard");e&&(t("#promotion_stats a.back")[0].href+="#selected="+e,State.del("dashboard")),Mimi.Stats.Data.delivering?this.initializeDelivering():this.showButtonsForState("delivered"),Mimi.Stats.ShareDialog.setTitle("Share these statistics"),Mimi.Stats.ShareDialog.setInfo("Anyone who you share this URL with will be able to view this chart but will not have access to your list. You may disable this share in your addons area.")},initializeWidgets:function(){this.dom.$addToLists.each(function(t,e){new Mimi.AudienceListSelect(e,{keepStartText:!0,onItemClick:_.bind(this.onAddToExistingList,this),onListCreated:_.bind(this.onAddToNewList,this)})},this),this.grabButtons(),this.tabs=new Widget.Tabs(this.dom.$tabs[0],{stateKey:"view"});var e=this.getCurrentWhich(),i=t("#stats_"+e),s=i.find("input.search");s.val(State.get("search",""))},initializeEvents:function(){t(window).on("scroll",_.bind(this.onWindowScrolled,this)),t(document).on("tab:switched",_.bind(this.onTabSwitched,this)),t(document).on("toolbar:clicked",_.bind(this.onSumClicked,this)),this.$element.on("keyup",_.bind(this.onSearchKeyUp,this)),this.$element.on("click",_.bind(this.onButtonClick,this)),this.dom.$header.on("click",_.bind(this.onToggleViewClicked,this)),this.dom.$tabs.on("mouseover",_.bind(this.onMouseOverTab,this)),this.dom.$tabs.on("mouseleave",_.bind(this.onMouseLeaveTab,this)),this.dom.$mailingLinks.on("mouseover",_.bind(this.onMouseOverLink,this)),this.dom.$mailingLinks.on("click",_.bind(this.onMailingLinkClick,this)),this.dom.$mailingLinks.find("li").on("mouseleave",_.bind(this.onMouseLeaveLink,this)),this.dom.$percbtn.on("click",_.bind(this.onPercClick,this)),this.dom.$sharebtn.on("click",_.bind(this.onShareClick,this))},initializeDelivering:function(){this.delivering=!0,this.wasDelivering=!0,this.updateStats(),this.dom.$pausebtn&&(this.dom.$pausebtn.on("click",_.bind(this.onPause,this)),this.dom.$deliverbtn.on("click",_.bind(this.onDeliver,this)),this.dom.$cancelbtn.on("click",_.bind(this.onCancel,this)),this.dom.$pausebtn.prop("onclick",null),this.dom.$deliverbtn.prop("onclick",null),this.dom.$cancelbtn.prop("onclick",null))},initializePromotionAttemptsListener:function(){var t="update_promotion_attempts_stats_"+this.getCurrentWhich()+"_"+Mimi.User.id,e=Mimi.Pusher.pusher.subscribe(t);e.bind("update_lists",function(){Mimi.Stats.PromotionStats.get().isListeningForPush=!1,Mimi.Pusher.pusher.unsubscribe(t),Mimi.Stats.PromotionStats.get().loadPromotionAttempts(null,null,!0,null)})},updateStats:function(){if(this.delivering)this.fetchStats(5e3);else if(this.wasDelivering){var t=new Date;Widget.MimiFlash.sticky(Mimi.Stats.Data.name+" has finished sending on "+Time.formatDate(t)),this.dom.$sendingMeta.html("Sent "+Time.formatDate(t)),this.fetchStats(1e4),this.wasDelivering=!1}else this.fetchStats(3e4)},fetchStats:function(e){this.boundFetch||(this.boundFetch=_.bind(function(){t.get(Mimi.Stats.Urls.stats+".json").done(_.bind(this.onUpdateStatsSuccess,this)).always(_.bind(this.onUpdateStatsComplete,this))},this)),_.delay(this.boundFetch,e)},onUpdateStatsSuccess:function(t){var e=t.responseJSON;if(e.success){this.stats=e.result,Mimi.Stats.Data.counts=this.stats.counts;var i=this.$chartElement&&this.$chartElement.data("chart");i?i.updateData(this.statsInPercents()):this.chart(),this.updateStatsNumbers(),this.updateState()}},onUpdateStatsComplete:function(){this.updateStats()},updateStatsNumbers:function(){var e=this.percentages,i=this.stats.counts.total;_.each(_.pairs(this.stats.counts),function(s){var n=s[0],o=s[1],a=o;e&&(a=0>=i?0:100*o/i,a=a.toFixed(10>a?1:0)+"<span class='sign' style='background:none;opacity:0.6'>&#37;</span>"),t(".number_"+n).html(a)})},updateState:function(){this.delivering=this.stats.delivering||this.stats.paused,this.delivering?(this.dom.$sendingMeta.addClass("promo-sending"),this.showButtonsForState(this.stats.paused?"paused":"delivering")):(this.dom.$sendingMeta.removeClass("promo-sending"),this.showButtonsForState("delivered"))},onTabSwitched:function(t,e){if(e.source===this.tabs){var i=this.getCurrentWhich(),s=this.data[i];this.isListeningForPush=!1,this.currentWhich!==i&&(!this.viewCollapsed,this.currentWhich=i,s&&s.search?State.set("search",s.search):State.del("search"),s||this.loadPromotionAttempts(i))}},onSumClicked:function(t,e){var i=this.getCurrentWhich(),s=this.data[i],n=e.button.href.lhash().depref("#stats_");s.substats!==n&&(this.deselectMailingLinks(),this.loadPromotionAttempts(i,n,!0))},onWindowScrolled:function(){var e=document.body.scrollHeight,i=t(window).height(),s=this.getCurrentWhich(),n=this.data[s];i>=e-Mimi.Stats.PromotionStats.LAZY_LOAD_GAP&&!n.request&&this.loadPromotionAttempts(s)},onButtonClick:function(e){var i=t(e.currentTarget).closest(".export");return i[0]?(this.onExportClick(i[0]),!1):void 0},onExportClick:function(e){if(e){var i=this.getCurrentWhich(),s=this.data[i],n=e.href,o={which:s.substats,search:s.search,"mailing_links[]":"clicked"===s.substats?this.data.selectedLinks:[]},a=t.get(n,o).done(_.bind(this.exportSuccess,this)).fail(_.bind(this.exportFailure,this));a.button=e}},exportSuccess:function(t,e,i){t.success?window.open(t.url):Widget.MimiVoice.get().show(i.button,"Your export is processing. You'll receive an email when the export is complete.")},exportFailure:function(){Widget.MimiVoice.error("Oh no! Something went wrong while trying to set up that export.")},onAddToExistingList:function(e){var i=t(e).find(".name").html().trim();this.confirmAddToList(i)},onAddToNewList:function(t){this.confirmAddToList(t)},confirmAddToList:function(t){t=t.trim(),this.addToListMemo=t,this.addToListConfirmDialog||(this.addToListConfirmDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onAddToListOk,this)}));var e=this.getCurrentWhich();this.addToListConfirmDialog.show("Add to "+t+"?","Are you sure you want to add these "+e+" contacts to the "+t+" list?")},onAddToListOk:function(){var e=this.getCurrentWhich(),i=this.data[e],s={which:i.substats,search:i.search,"mailing_links[]":"clicked"===i.substats?this.data.selectedLinks:[],list_name:this.addToListMemo};t.post(Mimi.Stats.Urls.addToList+".json",s).done(_.bind(this.addToListSuccess,this))},addToListSuccess:function(t,e,i){Widget.MimiFlash.create(t.success?"Your "+i.parameters.which+" audience has been added to the "+i.parameters.list_name+" list.":"Your "+i.parameters.which+" audience is being added to the "+i.parameters.list_name+" list. You'll receive an email when it is complete.")},onPause:function(){return t.get(this.dom.$pausebtn.prop("href")+".json").done(_.bind(this.onPauseSuccess,this)).fail(_.bind(this.onPauseFailure,this)),!1},onPauseSuccess:function(t){t.success?(this.stats=t.result,this.updateState()):Widget.MimiFlash.error("Oops, I had some trouble there.\n"+t.error)},onPauseFailure:function(){Widget.MimiFlash.error("Oops! Something went wrong while trying to pause this promotion.")},onDeliver:function(){return t.get(this.dom.$deliverbtn.prop("href")+".json").done(_.bind(this.onDeliverSuccess,this)).fail(_.bind(this.onDeliverFailure,this)),!1},onDeliverSuccess:function(t){t.success?(this.stats=t.result,this.updateState(),t.result.alert&&Widget.MimiFlash.error(t.result.alert)):Widget.MimiFlash.error("Oops, I had some trouble there.\n"+t.error)},onDeliverFailure:function(){Widget.MimiFlash.error("Oops! Something went wrong while trying to run this promotion.")},onCancel:function(){return t.post(this.dom.$cancelbtn.prop("href")+".json").done(_.bind(this.onCancelSuccess,this)).fail(_.bind(this.onCancelFailure,this)),!1},onCancelSuccess:function(t){t.success?(this.stats=t.result,this.updateState()):Widget.MimiFlash.error("Oops, I had some trouble there.\n"+t.error)},onCancelFailure:function(){Widget.MimiFlash.error("Oops! Something went wrong while trying to cancel this promotion.")},onToggleViewClicked:function(){this.viewCollapsed?this.expandView():this.collapseView()},collapseView:function(){t("#stats_view").animate({height:"50px"},200),this.viewCollapsed=!0},expandView:function(){t("#stats_view").animate({height:"340px"},200),this.viewCollapsed=!1},onSearchKeyUp:function(e){if(t(e.target).hasClass("search")){var i=this.getCurrentWhich(),s=this.data[i];s.timeout&&clearTimeout(s.timeout),s.timeout=_.delay(_.bind(this.loadPromotionAttempts,this),500,i)}},loadPromotionAttempts:function(e,i,s,n){e=e||this.getCurrentWhich();var o=this.getDataFor(e),a=o.$searchInput.val();if(i=i||o.substats,this.shouldLoadPromotionAttempts(e,i,a,o,s)){var r=this.getParametersFor(e,i,a,o);o.request=t.get(Mimi.Stats.Urls.attempts+".json",r).done(_.bind(this.promotionAttemptsLoaded,this)).fail(_.bind(this.promotionAttemptsFailed,this)),o.request.which=e,o.request.substats=i,o.request.force=s,o.request.retries=n||0,o.timeout=null,o.clear&&o.$tbody[0].rows.length>0?o.loadingBlock.show():o.$tbody.append(o.$placeholder)}},getDataFor:function(t){var e=this.data[t];return e||(e=this.initializeDataFor(t)),e.page+=1,e},initializeDataFor:function(e){var i=t("#stats_"+e),s=i.find("input.search"),n=i.find("tbody"),o=i.find(".toggle_set");return this.data[e]={page:0,search:"",substats:e,$searchInput:s,$tbody:n,$placeholder:n[0]?n[0].rows[0]:t(),loadingBlock:new Widget.BlockOverlay({insert:i[0],cover:n[0]}),sumToolbar:o[0]&&new Widget.Toolbar(o[0],{singleSelect:!0})}},shouldLoadPromotionAttempts:function(t,e,i,s,n){return s.$tbody?(n&&(s.page=1,s.clear=!0),s&&s.request?(s.reload=!0,!1):n?!0:!(s.completed||Mimi.Stats.Data.counts[t]<=(s.page-1)*Mimi.Stats.PromotionStats.PAGE_SIZE)||s.search!==i||e&&s.substats!==e?!0:!1):!1},getParametersFor:function(t,e,i,s){return e&&s.substats!==e&&(s.substats=e,s.page=1,s.clear=!0),{which:s.substats!==s.which?s.substats:t,page_size:Mimi.Stats.PromotionStats.PAGE_SIZE,search:this.getSearchParametersFor(i,s),"mailing_links[]":"clicked"===e?this.data.selectedLinks:[],page:s.page}},getSearchParametersFor:function(t,e){return t?State.set("search",t):State.del("search"),t||e.search!==t?(e.search!==t&&(e.clear=!0,e.page=1),e.search=t,t):null},promotionAttemptsLoaded:function(e,i,s){if(!e||e.success)return this.promotionAttemptsFailed(s,null);var n,o=s.which,a=t("#stats_"+o).find("tbody"),r=this.data[o];if(0===e.length){var l=t("li.stats_"+o+" a span.number");if(l.length>0){var d=l[0].innerHTML;0!==parseInt(d)&&(r.loadingBlock.show(),this.isListeningForPush=!0,this.initializePromotionAttemptsListener())}}r.request=!1,r.completed=e.length<Mimi.Stats.PromotionStats.PAGE_SIZE,n=_.map(e,function(t){return Mimi.Stats.PromotionStats.ROW_TEMPLATE(t)}),r.clear&&!this.isListeningForPush?(r.clear=!1,a.html(n.join(""))):this.isListeningForPush||(r.$placeholder.remove(),a.append(n.join(""))),r.loadingBlock&&r.loadingBlock.visible()&&!this.isListeningForPush?r.loadingBlock.hide():r.$placeholder.parent()&&!this.isListeningForPush&&r.$placeholder.remove(),r.reload&&(r.reload=!1,this.loadPromotionAttempts(o))},promotionAttemptsFailed:function(t){try{var e=t.which,i=this.data[e];i.request=!1,i.page-=1,t.retries<3?this.loadPromotionAttempts(e,t.substats,t.force,t.retries+1):(i.loadingBlock&&i.loadingBlock.visible()?i.loadingBlock.hide():i.$placeholder.parent()&&i.$placeholder.remove(),Widget.MimiFlash.create("Oops. I couldn't load the recipients for "+e))}catch(s){Widget.MimiFlash.create("Oops. I couldn't load the recipients.")}},getCurrentWhich:function(){return this.tabs.getCurrentTabId().depref("#stats_")},statsInPercents:function(){var t=this.stats.counts,e=t.sent-t.engaged-t.bounced-t.opt_out-t.spam;return{Untraced:parseFloat((100*e/t.sent).toFixed(2)),Viewed:parseFloat((100*t.viewed/t.sent).toFixed(2)),Clicked:parseFloat((100*t.clicked/t.sent).toFixed(2)),Shared:parseFloat((100*t.shared/t.sent).toFixed(2)),Bounced:parseFloat((100*t.bounced/t.sent).toFixed(2)),Unsubscribed:parseFloat((100*t.opt_out/t.sent).toFixed(2)),"Marked Spam":parseFloat((100*t.spam/t.sent).toFixed(2))}},chart:function(){var e=t("#stats_view .stats_graph"),i=e.closest("#stats_view").hasClass("ui_dark");!e.data("chart")&&Widget.PieChart.supported&&(this.stats=Mimi.Stats.Data,this.stats&&this.stats.counts&&this.stats.counts.sent>0&&e.data("chart",new Widget.PieChart(e[0],this.statsInPercents(),{canvasWidth:e.width()+40,canvasHeight:e.height(),chartEdgeOffset:35,maxExtension:20,labelFont:"12px helvetica neue, sans-serif",labelColor:"#666666",labelShadowColor:"#fff",isDarkBg:i,labelBgColor:"rgba(255,255,255,0.9)",labelRadius:13,showPercents:!1})),this.$chartElement=e)},onMouseOverTab:function(e){var i=t(e.target).closest("li");if(i){var s=i.detectClass("stats_sent","stats_engaged","stats_accepted","stats_shared","stats_bounced","stats_opt_out","stats_spam"),n=t("#stats_view .stats_graph").data("chart");if(s&&n){var o=Mimi.Stats.PromotionStats.CHART_MAP[s];n.extendSectors(o.names,o.label||o.names)}}},onMouseLeaveTab:function(){var e=t("#stats_view .stats_graph").data("chart");e&&e.cancelExtension()},onMouseOverLink:function(e){var i=t(e.target).closest(".mailing_link");i[0]&&(this.showLinkTipTimeout&&clearTimeout(this.showLinkTipTimeout),this.showLinkTipTimeout=setTimeout(function(){Widget.MimiVoice.show(i,decodeURI(i.attr("data-url"))+"<div class='small'>"+decodeURI(i.attr("data-term"))+"</div>")},900))},onMouseLeaveLink:function(){Widget.MimiVoice.hide(),clearTimeout(this.showLinkTipTimeout)},onMailingLinkClick:function(e){var i=t(e.currentTarget).closest("a.mailing_link");if(i[0]){var s=i.prop("id").depref("mailing_link_"),n=this.data.engaged;return n.sumToolbar.select(1),i.hasClass("selected")?(i.removeClass("selected"),this.data.selectedLinks=_.reject(this.data.selectedLinks,function(t){return t===s})):(i.addClass("selected"),this.data.selectedLinks.push(s)),this.loadPromotionAttempts("engaged","clicked",!0),!1}},deselectMailingLinks:function(){this.data.selectedLinks=[],this.dom.$mailingLinks.find("a.mailing_link").removeClass("selected")},onPercClick:function(){return this.dom.$percbtn.toggleClass("selected"),this.percentages=this.dom.$percbtn.hasClass("selected"),this.updateStatsNumbers(),!1},onShareClick:function(){return Mimi.Stats.ShareDialog.show(Mimi.Stats.Urls.share),!1},grabButtons:function(){if(this.dom.$buttonBar){var t=this.allButtons={},e=this.dom;_.each(_.values(this.BUTTON_STATE_MAP),function(i){i.each(function(i){var s=e["$"+i+"btn"];s&&s.parent()&&(t[i]=s.show().remove())})})}},showButtonsForState:function(t){this.dom.$buttonBar&&(_.values(this.allButtons).each(function(t){t.parentNode&&t.remove()}),_.each(this.BUTTON_STATE_MAP[t],function(t){this.dom.$buttonBar.append(this.allButtons[t])},this))},TABS:"sent engaged accepted shared bounced opt_out spam".split(" "),DOM:{header:"#stats_toggle",buttonBar:"#stats_toggle .button_bar",sharebtn:"#stats_toggle .btn.shared",pausebtn:"#stats_toggle .btn.pause",deliverbtn:"#stats_toggle .btn.play",cancelbtn:"#stats_toggle .btn.cancel",percbtn:"#stats_toggle .btn.perc",otherbtn:"#stats_toggle .btn.sent",editbtn:"#stats_toggle .btn.edit",backbtn:"#stats_toggle .btn.back",tabs:"#stats_tabs",mailingLinks:"#mailing_links",addToLists:[".audience_list_select"],sendingMeta:".sending_meta"},BUTTON_STATE_MAP:{delivering:"pause cancel".split(" "),paused:"deliver cancel".split(" "),delivered:"perc share other edit back".split(" ")}}).singleton(),Mimi.Stats.PromotionStats.CHART_MAP={stats_sent:{names:["Untraced","Viewed","Clicked","Shared","Bounced","Unsubscribed","Marked Spam"],label:"Sent"},stats_engaged:{names:["Viewed","Clicked","Shared"],label:"Engaged"},stats_accepted:{names:["Untraced","Viewed","Clicked","Shared"],label:"Accepted"},stats_shared:{names:["Shared"]},stats_bounced:{names:["Bounced"]},stats_opt_out:{names:["Unsubscribed"]},stats_spam:{names:["Marked Spam"]}},_.extend(Mimi.Stats.PromotionStats,{ROW_TEMPLATE:_.template('<tr><td><span class="#{state_class} hide_overflow nowrap"><a href="/audience_members/#{audience_member_id}">#{email}</a></span></td><td><a href="/audience_members/#{audience_member_id}">#{name}</a></td></tr>'),PAGE_SIZE:30,LAZY_LOAD_GAP:220})}(jQuery),function(t){Mimi.Stats.CompareStats=Class.create(Widget.Observer,{initialize:function(){this.$element=t("#main"),this.dom=this.$element.getChildren(Mimi.Stats.CompareStats.DOM),this.initializeEvents(),this.tabs=new Widget.Tabs(this.dom.$tabs[0],{stateKey:"view"}),this.initializeChart(),this.dom.$table.find("table").each(function(e,i){t(i).find("tbody th").each(function(e,i){t(i).toggleBrightness(t(i).css("background-color"),"ui_dark","ui_light")})}),Mimi.Stats.ShareDialog.setTitle(I18n.t("js.stats.compare_stats.share_dialog.title")),Mimi.Stats.ShareDialog.setInfo(I18n.t("js.stats.compare_stats.share_dialog.info"))},initializeEvents:function(){t(document).on("tab:switched",_.bind(this.onTabSwitched,this)),this.dom.$table.on("click",_.bind(this.onActionClick,this)),this.dom.$exportbtn.on("click",_.bind(this.onExportClick,this)),this.dom.$sharebtn.on("click",_.bind(this.onShareClick,this)),this.dom.$exportClonesbtn&&(this.dom.$exportClonesbtn.enable(),this.dom.$exportClonesbtn.on("click",_.bind(this.onExportClonesClick,this))),this.dom.methods.$scaled.on("click",_.bind(this.onScaledClick,this)),this.dom.methods.$relative.on("click",_.bind(this.onRelativeClick,this)),this.dom.methods.$counts.on("click",_.bind(this.onCountsClick,this)),this.dom.$buttonBars.on("mouseover",_.bind(this.onButtonBarMouseOver,this)),this.dom.$buttonBars.on("mouseout",_.bind(this.onButtonBarMouseOut,this)),this.dom.$chart.on("mouseover",_.bind(this.onChartMouseOver,this)),this.dom.$chart.on("mouseout",_.bind(this.onChartMouseOut,this))},initializeChart:function(){this.chartData=_.map(Mimi.Stats.CompareStats.Data,function(e){var i=t("#promotion_bar_"+e.id);return _.extend(e,{header:t("#promotion_header_"+e.id).find("li.number")[0],thumb:i.find("a.thumb")[0],bar:i.find("a.bar")[0],title:i.find("a.title")[0],count:i.find("span.count")[0],outOf:i.find("span.out_of")[0],total:i.find("span.total")[0]})}),this.setMethod("scaled")},onTabSwitched:function(t,e){e.source===this.tabs&&(Widget.MimiVoice.hide(),this.updateChart())},onActionClick:function(e){this.deleteLink=t(e.target).closest("a.delete")[0],this.deleteLink&&(e.preventDefault(),this.confirmDeleteDialog||(this.confirmDeleteDialog=new Widget.ConfirmDialog(I18n.t("js.stats.compare_stats.confirm_delete_dialog.title"),I18n.t("js.stats.compare_stats.confirm_delete_dialog.info"),{onOk:_.bind(this.onDeleteOk,this)})),this.confirmDeleteDialog.show())},onDeleteOk:function(){var e=this.deleteLink.href.split("/"),i=e[e.length-1],s=t.ajax({url:this.deleteLink.href,type:"delete"}).done(_.bind(this.onDeleteSuccess,this)).fail(_.bind(this.onDeleteFailure,this));s.id=i,this.hideStats(i)},onDeleteSuccess:function(t,e,i){t.success||this.onDeleteFailure(i)},onDeleteFailure:function(t){this.hideStats(t.id,!0),Widget.MimiFlash.error(I18n.t("MimiFlash.stats.compare_stats.onDeleteFailure"))},hideStats:function(e,i){t(".stat_"+e)[i?"show":"hide"]()},onExportClick:function(){window.open(Mimi.Stats.CompareStats.Urls["export"])},onExportClonesClick:function(){return t.post(this.dom.$exportClonesbtn.attr("href")),Widget.MimiFlash.create(I18n.t("MimiFlash.stats.compare_stats.onExportClonesClick")),!1},onShareClick:function(){Mimi.Stats.ShareDialog.show(Mimi.Stats.CompareStats.Urls.share)},onScaledClick:function(){return this.setMethod("scaled"),!1},onRelativeClick:function(){return this.setMethod("relative"),!1},onCountsClick:function(){return this.setMethod("counts"),!1},setMethod:function(t){this.dom.methods.$all.removeClass("selected"),this.dom.methods["$"+t].addClass("selected"),this.chartMethod=t,this.updateChart()},onButtonBarMouseOver:function(e){var i=t(e.target).closest("a.btn");if(i[0]){var s=i.attr("data-title");s&&s.length>0&&Widget.MimiVoice.delayedShow(i[0],s,.3)}},onButtonBarMouseOut:function(){Widget.MimiVoice.delayedHide(1)},onChartMouseOver:function(e){var i=t(e.target).closest("a.subbar");i[0]&&Widget.MimiVoice.delayedShow(i[0],i.attr("data-title"),.3)},onChartMouseOut:function(){Widget.MimiVoice.delayedHide(1)},updateChart:function(){Widget.MimiVoice.hide();var t=this.getCurrentWhich();this.updateChartWith(t,"sent")},updateChartWith:function(t){var e,i,s;switch(this.chartMethod){case"scaled":e=this.calcScaledChart(t),s=!0,i=_.map(_.range(0,11),function(t){return 10*t});break;case"relative":e=this.calcRelativeChart(t),s=!0;var n=e.highest<.1?2:e.highest<.2?1:0;i=_.map(_.range(0,11),function(t){return(Math.round(t*e.highest*1e3)/100).toFixed(n)});break;case"counts":e=this.calcCountsChart(t),s=!1,i=_.map(_.range(0,11),function(t){return Math.round(t*e.max/10).formatThousands(0)})}this.setLineValues(i,s),this.drawBars(e.bars,t)},determinePercentage:function(t,e){var i="accepted"===name?"sent":"total";return 0===t.counts[i]?0:Math.min(Math.round(100*e/t.counts[i]),100)},determineWidth:function(t){return.01*t},calcScaledChart:function(t){var e=_.map(this.chartData,function(e){var i=this.totalBarValue(t,e),s=e.counts[t],n="accepted"===t?i:s,o=this.determinePercentage(e,s),a=this.determineWidth(o),r={count:s,value:n,percentage:o,width:a,data:e};return r.subbars=_.map(Mimi.Stats.CompareStats.SCALE.subbars[t],function(t){var s=e.counts[t],n=0===s?0:Math.min(s/i,1);return{name:t,value:s,width:n}}),r},this);return{bars:e}},calcRelativeChart:function(t){var e=this.highestChartRatio(t),i=_.map(this.chartData,function(i){var s=i.counts.sent,n=i.counts[t],o=n,a=0===e?0:Math.min(o/s/e,1),r={total:s,count:n,value:o,percentage:"accepted"===t?0===i.counts.sent?0:Math.min(Math.round(100*n/i.counts.sent),100):0===i.counts.total?0:Math.min(Math.round(100*n/i.counts.total),100),width:Math.round(680*a),data:i};return s="accepted"===t?s:n,r.subbars=_.map(Mimi.Stats.CompareStats.SCALE.subbars[t],function(t){var e=i.counts[t],n=0===s?0:Math.min(e/s,1);return{name:t,value:e,width:Math.round(n*r.width)}}),r},this);return{bars:i,highest:e}},calcCountsChart:function(t){var e=this.maxChartValue("accepted"===t?"sent":t),i=_.map(this.chartData,function(i){var s=i.counts.sent,n=i.counts[t],o=0===e?0:Math.min(n/e,1),a="accepted"===t?0===i.counts.sent?0:Math.min(Math.round(100*n/i.counts.sent),100):0===i.counts.total?0:Math.min(Math.round(100*n/i.counts.total),100),r={total:s,count:n,value:n,percentage:a,width:Math.round(680*o),data:i};return r.subbars=_.map(Mimi.Stats.CompareStats.SCALE.subbars[t],function(t){var s=i.counts[t],n=0===e?0:Math.min(s/e,1);return{name:t,value:s,width:Math.round(680*n)}}),r},this);return{bars:i,max:e}},maxChartValue:function(t){var e=_.map(this.chartData,function(e){return e.counts[t]});return _.max(e)},totalBarValue:function(t,e){return _.inject(Mimi.Stats.CompareStats.SCALE.subbars[t],function(t,i){return t+=e.counts[i]},0)},highestChartRatio:function(t){var e=_.map(this.chartData,function(e){var i=e.counts.sent,s=e.counts[t],n="accepted"===t?i:s;return 0===i?0:Math.min(n/i,1)},this);return _.max(e)},drawBars:function(t,e){_.each(t,function(t){this.setBarValues(t,e),this.drawSubbars(t,e)},this)},setBarValues:function(e,i){var s=e.data;t(s.count).html(e.count),e.total?(t(s.total).html(e.total),t(s.total).show(),t(s.outOf).show()):(t(s.total).hide(),t(s.outOf).hide()),t(s.header).html(e.percentage+" <span class='sign'>%</span>");var n=e.data.thumb.href.split("#")[0]+"#view=stats_"+i;s.thumb.href=n,s.bar.href=n,s.title.href=n},drawSubbars:function(e){t(e.data.bar).html("");var i=0,s={accepted:I18n.t("stats.legend.accepted"),hard_bounced:I18n.t("stats.legend.hard_bounced"),soft_bounced:I18n.t("stats.legend.soft_bounced"),other_bounced:I18n.t("stats.legend.other_bounced"),viewed:I18n.t("stats.legend.viewed"),clicked:I18n.t("stats.legend.clicked"),forwarded:I18n.t("stats.legend.forwarded"),shared:I18n.t("stats.legend.shared"),tweeted:I18n.t("stats.legend.tweeted"),facebooked:I18n.t("stats.legend.facebooked"),plusoned:I18n.t("stats.legend.plusoned"),pinned:I18n.t("stats.legend.pinned"),linked_in:I18n.t("stats.legend.linked_in"),subscribed:I18n.t("stats.legend.subscribed"),forwarded:I18n.t("stats.legend.forwarded"),spam:I18n.t("stats.legend.spam"),conversion_value:I18n.t("stats.legend.ga")};_.each(e.subbars,function(n,o){var a=t('<a class="subbar '+n.name+'">').attr({"data-title":s[n.name]+" ("+n.value.formatThousands(0)+")",style:"z-index: "+(1e3-o)}).html("<span class='meta'>&nbsp</span>");t(e.data.bar).append(a),a.animate({width:(i+n.width).percent()},600),i+=n.width})},setLineValues:function(e,i){this.dom.lines.$signs[i?"show":"hide"](),this.dom.lines.$numbers.show();var s;this.dom.lines.$numbers.each(function(i,n){var o=e[i];o===s?t(n).hide().next().hide():t(n).html(o),s=o})},getCurrentWhich:function(){return this.tabs.getCurrentTabId().depref("#stats_")}}).singleton(),Mimi.Stats.CompareStats.DOM={chart:"div.stats_graph_compare",tabs:"#stats_tabs",table:"#secondary_comparison_table",buttonBars:"header.with_workspace",exportbtn:"a.export",exportClonesbtn:"a.export_clones",sharebtn:"a.shared",lines:{signs:[".graph_lines .sign"],numbers:[".graph_lines .number"]},methods:{scaled:".chart_method.scaled",relative:".chart_method.relative",counts:".chart_method.counts",all:[".chart_method"]}},Mimi.Stats.CompareStats.SCALE={width:680,bar:"<span class='subbar'></span>",subbars:{accepted:["accepted"],bounced:["hard_bounced","soft_bounced","other_bounced"],viewed:["viewed"],engaged:["clicked","forwarded","shared"],shared:["tweeted","facebooked","plusoned","pinned","linked_in"],subscribed:["subscribed"],forwarded:["forwarded"],spam:["spam"],ga:["conversion_value"]}}}(jQuery),function(t){Mimi.Stats.ShareDialog=Class.create(Widget.Dialog,Widget.Observable,{initialize:function($super){$super(I18n.t("MimiFlash.stats.share_dialog.share_this"),Mimi.Stats.ShareDialog.BODY,{hideTrigger:"a.back"}),this.dom=_.extend(this.dom,this.$element.getChildren(Mimi.Stats.ShareDialog.DOM))},setInfo:function(t){this.dom.$info.html(t)},show:function($super,t,e){this.reset(),$super(),e?this.showUrl(t):this.fetchUrl(t)},reset:function(){this.dom.$loading.show(),this.dom.$result.hide()},showUrl:function(t){this.dom.$loading.hide(),this.dom.$result.show(),this.dom.$url.val(t).select()},fetchUrl:function(e){t.post(e).done(_.bind(this.onFetchUrlSuccess,this)).fail(_.bind(this.onFetchUrlFailure,this))},onFetchUrlSuccess:function(t){t.success?this.showUrl(t.url):(this.hide(),Widget.MimiFlash.error(I18n.t("MimiFlash.stats.share_dialog.onFetchUrlSuccess")+" "+t.error))},onFetchUrlFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.stats.share_dialog.onFetchUrlFailure"))}}).singleton("show","setTitle","setInfo"),Mimi.Stats.ShareDialog.DOM={loading:"div.loading",result:"div.field",info:"p.info",url:'input[name="url"]'},Mimi.Stats.ShareDialog.BODY='<form><fieldset><div class="loading" style="height:100px;">&nbsp;</div><div class="field"><span class="full"><label for="share_url">'+I18n.t("MimiFlash.stats.share_dialog.link_to")+'</label><input type="text" id="share_url" name="url"></span><p class="info"></p></div><p class="actions"><a class="back" href="#">'+I18n.t("MimiFlash.stats.share_dialog.close")+"</span></a></p></fieldset></form>"}(jQuery),function(t){Mimi.Stats.Overview={init:function(e){this.loggedIn=e.loggedIn,this.unifiedCounts=e.unifiedCounts,this.stats=e.stats,this.urls=e.urls,this.tabNames=e.tabNames,this.engagedStats=e.engagedStats,this.audienceSize=e.audienceSize,this.nonUniqueStats=e.nonUniqueStats,this.excludePercStats=e.excludePercStats,this.showClicksFirst=e.showClicksFirst,this.showEmptyClicks=e.showEmptyClicks,this.type=e.type,this.statsUrl=this.urls.stats[this.type],this.clickPerformanceLoaded=!1,this.clickPerformanceUrl=this.urls.stats.clickPerformance,this.clickPerformanceContentUrl=this.urls.stats.clickPerformanceContent,this.originalType=e.type,this.shouldUpdateFilters=!1,this.isDelivering=this.stats.delivering,this.mailingId=e.mailingId,this.pieCharts=[],this.filtersToUpdate=[],this.shouldPoll=e.shouldPoll,this.initStatsPoller(),this.initButtonsTabsAndCharts(),this.dialog=new Widget.Popup("#audience_lists_dialog",{hideTrigger:".window_close, #ok",overlay:Widget.ModalOverlay,fixedPosition:!1}),t(this.dom.numberOfLists).click(_.bind(this.openListsDialog,this))},initStatsPoller:function(){this.shouldPoll&&(this.statsPoller=Mimi.Stats.Poller,this.statsPoller.init({overview:this,lastStatsResult:this.unifiedCounts.promotion}))},initButtonsTabsAndCharts:function(){t(this.dom.clickPerfbtn).click(_.bind(this.onClickPerformanceClick,this)),t(this.dom.overviewTabNames).click(_.bind(this.onOverviewTabNameClick,this)),t("ul#extra_tabs li a.clicksEmpty, .stats_sidebar_thumb a.clicksEmpty").click(_.bind(this.onEmptyClickPerformanceClick,this)),window.onpopstate=_.bind(this.onpopstate,this),this.buttons=Mimi.Stats.Buttons,this.buttons.init(this.stats,this.urls,this,this.unifiedCounts),this.overviewTabs=Mimi.Stats.OverviewTabs,this.overviewTabs.init(this.loggedIn,this.unifiedCounts,this.urls,this.audienceSize,this),this.initPieCharts(),this.removeAnchorsFromZeroStats(),this.showClicksFirst?this.showClicks():this.showEmptyClicks&&this.showEmptyClickPerformance()},initPieCharts:function(){var e=this;_.each(e.pieCharts,function(e){var i=t("#"+e.parentId).find(".toggle_set").find("a");i.unbind("mouseenter"),i.unbind("mouseleave")}),e.pieCharts=[],_.each(t(".stats_graph"),function(i){t(i).empty(),e.pieCharts.push(new Mimi.Stats.Chart(t(i)))})},onpopstate:function(t){var e;t.state&&("stats"===t.state.mode||void 0!==t.state.view?(this.showStats(),"mailing"===this.originalType?(e=this.overviewTabs.tabs.findTab(t.state.view),this.overviewTabs.tabs.show(e,!1)):(e=this.overviewTabs.promotionTabs.findTab(t.state.view),this.overviewTabs.promotionTabs.show(e,!1))):"clicks"===t.state.mode?this.showClicks(!1):"empty_clicks"===t.state.mode&&this.showEmptyClickPerformance(!1))},startPoller:function(){this.shouldPoll&&this.statsPoller.start()},updateStats:function(t,e){var i=this;if("mailing"===this.originalType)_.each(["mailing","promotion"],function(s){var n=i.getAsyncUpdatedStats(s,t);n&&i.updateStatCounts(s,n,!1,e)});else{var s=this.getAsyncUpdatedStats("promotion",t);this.updateStatCounts("promotion",s,!1,e)}},getAsyncUpdatedStats:function(t,e){var i=e[0];return"mailing"===t?void 0!==i.mailings?void 0!==i.mailings.dedicated_mailing?i.mailings.dedicated_mailing:i.mailings[this.mailingId]:null:i},updateStatCounts:function(t,e,i,s){this.filtersToUpdate=[],i=i||!1;var n=this,o=!0;_.each(e,function(e,a){(e>n.unifiedCounts[t][a]||i)&&(o=!1,n.updateStatCount(t,a,e,s))}),o&&this.startPoller(),this.updateAllCounts(t,e),this.togglePercentage(),this.initPieCharts(),this.shouldUpdateFilters&&"mailing"===t&&(this.shouldUpdateFilters=!1,this.updateFilters())},refreshAllStatsCounts:function(e){var i=this;t.get(i.statsUrl+".json").done(function(t){i.onRefreshAllStatsCountsSuccess(t,e)}).always(function(){i.refreshAllStatsQueued=!1,i.refreshAllStatsQueuedAlready=!1})},onRefreshAllStatsCountsSuccess:function(t,e){t.success&&(this.statsPoller.recordChangeInStats(t),this.updateStats([t.result.counts],e))},enqueueRefreshAllStats:function(t){var e=this;void 0===this.refreshAllStatsQueued||this.refreshAllStatsQueued===!1?(this.refreshAllStatsQueued=!0,this.refreshAllStatsCounts(t)):(void 0===e.refreshAllStatsQueuedAlready||e.refreshAllStatsQueuedAlready===!1)&&setTimeout(function(){e.refreshAllStatsQueuedAlready=!0,e.enqueueRefreshAllStats(t)},5e3)},updateStatCount:function(e,i,s,n){n=null==n?n:!0,this.updateTabContent(e,i,s),this.updateTabCount(e,i,s),this.updateFilterCount(e,i,s),this.updateStatProgressCounter(e,i,s),n&&this.shouldRefreshPromotionAttempts(e,i)&&(this.overviewTabs.resetCurrentPromotionAttemptsCount(e,i),this.overviewTabs.loadPromotionAttempts(null,null,!0,null,this.overviewTabs.currentPromotionAttemptsRowCount(),1)),t.inArray(i,this.engagedStats)>-1&&(this.filtersToUpdate.push(i),this.shouldUpdateFilters=!0)},updateStatProgressCounter:function(e,i,s){"mailing"===e&&"sent"===i&&t("span#in_progress_stats span.number_"+i).text(s)},shouldRefreshPromotionAttempts:function(t,e){return this.overviewTabs.currentSubstats(t)===e},togglePercentage:function(t){var e=this;"mailing"===this.originalType?_.each(["mailing","promotion"],function(i){e.doTogglePercentage(e.unifiedCounts[i],i,t)}):e.doTogglePercentage(e.unifiedCounts.promotion,"promotion",t)},doTogglePercentage:function(e,i,s){var n=this,o=e.sent,a=void 0===s?n.buttons.isPercentageOn():s,r=n.excludePercStats;_.each(e,function(e,s){var l=s,d=e;a&&!_.include(r,l)?(d=0>=o?0:100*d/o,d=d.toFixed(10>d?1:0)+"<span class='sign' style='background:none;opacity:0.6'>&#37;</span>"):d=n.formatNumber(d),t("."+i+"_stats_container .number_"+l).html(d)})},isToggleButton:function(e){return t(e).length>0},updateTabContent:function(e,i,s){var n="."+e+"_stats_container a.toggle span.number_"+i;if(this.isToggleButton(n)){var o=this.formatNumber(s);"opt_out"===i&&0!==o&&(o="-"+o),t(n).text(o),this.overviewTabs.unifiedCounts[e][i]=s,this.updateToggleButtonCount(e,i,s)
}},formatNumber:function(t){var e=Number(t);return isNaN(e)?t:e.formatThousands()},updateTabCount:function(e,i,s){if(t.inArray(i,this.tabNames)>-1){var n="."+e+"_stats_container li."+e+"_stats_"+i+" a span.number_"+i;t(n).text(this.formatNumber(s))}},updateFilterCount:function(e,i,s){var n='#filters_container .filters a[data-share="'+i+'"] > .count';t(n).text(this.formatNumber(s))},updateFilters:function(){if(this.urls.filters){var e=this,i="mailing";t.get(this.urls.filters,function(s){t("#filters_container").html(s),e.overviewTabs.initializeFilterEvents(),e.overviewTabs.determineActionButtonVisibility(),e.overviewTabs.reSelectAllLinkFilters(),_.each(e.filtersToUpdate,function(t){e.shouldRefreshPromotionAttempts(i,t)&&(e.overviewTabs.resetCurrentPromotionAttemptsCount(i,t),e.overviewTabs.loadPromotionAttempts(null,null,!0,null,e.overviewTabs.currentPromotionAttemptsRowCount(),1))})})}},updateToggleButtonCount:function(e,i,s){var n="div."+e+"_stats_container header div a.stats_"+i;t(n).attr("data-value",s);var o=JSON.parse(t(n).attr("data-chart"));o.value=s,t(n).attr("data-chart",JSON.stringify(o)),0===s?(t(n).addClass("off"),t(n).removeAttr("href")):t(n).hasClass("off")&&(t(n).removeClass("off"),t(n).attr("href","#stats_"+i)),this.overviewTabs.ensureOneButtonSelectedIfAnyStats(e)},removeAnchorsFromZeroStats:function(){var e="div header div span a.toggle";t(e).each(function(e,i){var s=t(i),n=parseInt(s.attr("data-value"));0===n&&s.removeAttr("href")})},updateAllCounts:function(t,e){this.unifiedCounts[t]=e,this.overviewTabs.setCounts(t,e)},onClickPerformanceClick:function(t){t.preventDefault(),this.showClicks()},onEmptyClickPerformanceClick:function(t){t.preventDefault(),this.showEmptyClickPerformance()},showEmptyClickPerformance:function(e){e=e||!0,t(this.dom.statsContainer).hide(),t(this.dom.clicksContainer).hide(),t(this.dom.emptyClickPerformanceContainer).show(),this.hideAllTabs(),t(this.dom.emptyClickPerfbtn).parent().addClass("current"),e&&history.pushState&&history.pushState({mode:"empty_clicks"},"",this.clickPerformanceUrl)},onOverviewTabNameClick:function(t){this.showStats(t.currentTarget.className)},showStats:function(e){t(this.dom.statsContainer).show(),t(this.dom.clicksContainer).hide(),t(this.dom.emptyClickPerformanceContainer).hide(),t(this.dom.clickPerfbtn).parent().removeClass("current"),t(this.dom.emptyClickPerfbtn).parent().removeClass("current");var i=window.location.pathname;i===this.clickPerformanceUrl&&void 0!==e&&history.replaceState&&history.replaceState({mode:"stats",view:e},"",this.statsUrl)},showClicks:function(e){e=e||!0,t(this.dom.statsContainer).hide(),t(this.dom.emptyClickPerformanceContainer).hide(),t(this.dom.clicksContainer).show(),this.hideAllTabs(),t(this.dom.clickPerfbtn).parent().addClass("current"),e&&history.pushState&&history.pushState({mode:"clicks"},"",this.clickPerformanceUrl);var i=this;i.clickPerformanceLoaded||t.get(i.clickPerformanceContentUrl).success(function(e){t(i.dom.clicksContainer).html(e),i.clickPerformanceLoaded=!0})},hideAllTabs:function(){void 0!==this.overviewTabs&&(void 0!==this.overviewTabs.tabs&&this.overviewTabs.tabs.hideAll(),void 0!==this.overviewTabs.promotionTabs&&this.overviewTabs.promotionTabs.hideAll()),t(this.dom.clickPerfbtn).parent().removeClass("current"),t(this.dom.emptyClickPerfbtn).parent().removeClass("current")},openListsDialog:function(){return this.dialog.show(),!1},dom:{clickPerfbtn:"ul#extra_tabs li a.clicksExist",emptyClickPerfbtn:"ul#extra_tabs li a.clicksEmpty",emptyClickPerformanceContainer:"div#empty_click_performance",statsContainer:"section.tab-ui div.statsCol",clicksContainer:"section.tab-ui div.clicksCol",overviewTabNames:"#stats_tabs li, #promotion_stats_tabs li",numberOfLists:"#audience_lists_number"}}}(jQuery),function(t){Mimi.Stats.OverviewTabs={PAGE_SIZE:30,LAZY_LOAD_GAP:220,ROW_TEMPLATE:_.template('<tr><td>#{recipient_label}<span class="count">#{count}</span></td></tr>'),UNCOUNTED_ROW_TEMPLATE:_.template("<tr><td>#{recipient_label}</td></tr>"),FORWARD_ROW_TEMPLATE:_.template('<tr><td>#{recipient_label}<span class="count">forwarded #{count} times</span></td></tr>'),AUDIENCE_MEMBER_LINK_TEMPLATE:_.template('<a href="/audience_members/#{audience_member_id}">#{email}</a>'),UNKNOWN_RECIPIENT_LABEL:"Unknown recipient",PA_LOAD_ATTEMPT_THRESHOLD:5,init:function(e,i,s,n,o){this.$mailingLinks=t("#mailing_links"),this.$addToLists=t(".audience_list_select"),this.$exportbtn=t(".btn.export"),this.$primaryExportContacts=t("#primary_export_contacts"),this.$cancelExport=t("#export_format_dialog .actions .back"),this.$dialog=t("#export_format_dialog"),this.$exportXLS=t("#XLS_export"),this.$exportInfo=t("#export_info"),this.loggedIn=e,this.unifiedCounts=i,this.urls=s,this.audienceSize=n,this.overview=o,this.currentPromotionAttemptsCount={mailing:{},promotion:{}},this.currentPageSize={},this.type=o.originalType,this.data={mailing:{selectedLinks:[]},promotion:{selectedLinks:[]}},this.fixLegacyStateValue(),this.initializeWidgets(),this.initializeEvents(),this.setTypeFromState();var a=this.ensureOneButtonSelectedIfAnyStats();this.determineActionButtonVisibility(null),a&&this.loadPromotionAttempts(this.getCurrentWhich(),this.currentSubstats(),!0),this.toggleHeaderDetails(),this.scrollToCurrentTab()},fixLegacyStateValue:function(){var t="view",e=State.get(t);e&&e.startsWith("stats_")&&("mailing"===this.type?State.set(t,"mailing_"+e):State.set(t,"promotion_"+e)),"mailing_stats_sent"===State.get(t)&&State.set(t,"mailing_stats_accepted"),void 0===State.get(t)||-1===State.get(t).indexOf("stats_opt_out")&&-1===State.get(t).indexOf("stats_subscribed")||("mailing"===this.type?State.set(t,"mailing_stats_growth"):State.set(t,"promotion_stats_growth")),void 0!==State.get(t)&&-1!==State.get(t).indexOf("stats_shared")&&("mailing"===this.type?State.set(t,"mailing_stats_engaged"):State.set(t,"promotion_stats_engaged"))},setTypeFromState:function(){var t=State.get("view");t&&t.startsWith("promotion_stats_")&&(this.type="promotion")},scrollToCurrentTab:function(){var e=State.get("view");e&&e.startsWith("promotion_")&&t("html, body").animate({scrollTop:t(".tab-ui-normal-lists").offset().top},500)},initializeWidgets:function(){this.initializeAudienceListSelectWidget(),this.initializeTabsWidget(),this.confirmExportDialog=new Mimi.ExportFormatDialog},initializeAudienceListSelectWidget:function(){var t=this;_.each(this.$addToLists,function(e){new Mimi.AudienceListSelect(e,{keepStartText:!0,onItemClick:_.bind(t.onAddToExistingList,t),onListCreated:_.bind(t.onAddToNewList,t)})})},initializeTabsWidget:function(){"mailing"===this.type?(this.tabs=new Widget.Tabs(t("#stats_tabs")[0],{stateKey:"view"}),this.promotionTabs=new Widget.Tabs(t("#promotion_stats_tabs")[0],{stateKey:"view",showOnInit:!1})):this.promotionTabs=new Widget.Tabs(t("#promotion_stats_tabs")[0],{stateKey:"view"})},initializeEvents:function(){this.$primaryExportContacts.on("click",_.bind(this.onExportButtonClick,this)),this.$cancelExport.on("click",_.bind(this.onCancelExport,this)),t(document).on("tab:before_switched",_.bind(this.onBeforeTabSwitched,this)),t(document).on("tab:switched",_.bind(this.onTabSwitched,this)),t(document).on("toolbar:clicked",_.bind(this.onSumClicked,this)),t(window).on("scroll",_.bind(this.onWindowScrolled,this)),this.$mailingLinks.length&&this.initializeFilterEvents(),_.each(t(".js_tooltip"),function(e){Mimi.Stats.TipManager.createTip(t(e))}),this.exportObserver()},exportObserver:function(){this.$exportbtn.on("click",_.bind(this.confirmExport,this))},initializeFilterEvents:function(){this.$mailingLinks=t("#mailing_links"),this.$mailingLinks.on("click","a.share_type",_.bind(this.onShareTypeClick,this)),this.$mailingLinks.on("click","a.mailing_link",_.bind(this.onMailingLinkClick,this))},confirmExport:function(){return this.$exportInfo.addClass("hide"),this.confirmExportDialog.show(),!1},onCancelExport:function(){this.confirmExportDialog.hide()},onBeforeTabSwitched:function(t,e){this.setCurrentTypeFromTab(e),this.overview.hideAllTabs()},onTabSwitched:function(){var t=this.getCurrentWhich(),e=this.data[this.type][t];this.determineActionButtonVisibility(t);var i=this.ensureOneButtonSelectedIfAnyStats(this.type),s=this.currentSubstats(this.type,t);i&&!e&&this.loadPromotionAttempts(t,s,!0)},onSumClicked:function(e,i){var s=t(i.button),n=this.getCurrentWhich(),o=s.attr("href");if(o){var a=o.depref("#stats_");0!==this.unifiedCounts[this.type][a]&&(this.resetCurrentPromotionAttemptsCount(this.type,a),this.determineActionButtonVisibility(n),this.deselectMailingLinks(),this.loadPromotionAttempts(n,a))}},setCurrentTypeFromTab:function(t){var e=t.tab.className;this.type=void 0!==e&&-1!==e.indexOf("promotion")?"promotion":"mailing",this.overview.type=this.type,this.toggleHeaderDetails()},toggleHeaderDetails:function(){"mailing"===this.type?(t("#promotion_details").hide(),t("#mailing_details").show()):(t("#mailing_details").hide(),t("#promotion_details").show())},onWindowScrolled:function(){var t=document.body.scrollHeight,e=document.getViewport(),i=this.getCurrentWhich(),s=this.data[this.type][i];e.bottom>=t-this.LAZY_LOAD_GAP&&s&&!s.request&&this.loadPromotionAttempts(i)},getMailingLinks:function(){var t=[],e=this.substats();return _.indexOf(["clicked","total_clicked"],e)>=0&&(t=this.data[this.type].selectedLinks),t},onExportButtonClick:function(e){var i=t(e.currentTarget),s=this.getCurrentWhich(),n=this.data[this.type][s],o=this.urls.stats[this.type]+"/stats_export",a=this.confirmExportDialog.selectedFormat(),r={which:n.substats,exportType:a,"mailing_links[]":this.getMailingLinks()};return t.get(o,r).success(_.bind(this.exportSuccess,i[0])).error(_.bind(this.exportFailure,this)),this.confirmExportDialog.hide(),!1},exportSuccess:function(t){t.success?open(t.url):Widget.MimiFlash.create(I18n.t("MimiFlash.stats.overview_tabs.exportSuccess"))},exportFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.stats.overview_tabs.exportFailure"))},onAddToExistingList:function(e){var i=t(e).find(".name").html().trim();this.confirmAddToList(i)},onAddToNewList:function(t){this.confirmAddToList(t)},confirmAddToList:function(e){e=t.trim(e),this.addToListMemo=e,this.addToListConfirmDialog||(this.addToListConfirmDialog=new Widget.ConfirmDialog({onOk:_.bind(this.onAddToListOk,this)}));var i=_.template(I18n.t("MimiFlash.stats.overview_tabs.confirmAddToList.title")),s=i({list_name:e}),n=_.template(I18n.t("MimiFlash.stats.overview_tabs.confirmAddToList.body")),o=n({list_name:e});this.addToListConfirmDialog.show(s,o)},onAddToListOk:function(){var e=this.substats(),i={which:e,"mailing_links[]":this.getMailingLinks(),list_name:this.addToListMemo};t.post(this.urls.addToList[this.type]+".json",i).success(_.bind(this.addToListSuccess,this))},resetCurrentPromotionAttemptsCount:function(t,e){this.currentPromotionAttemptsCount[t][e]=0},substats:function(){var t=this.getCurrentWhich(),e=this.data[this.type][t];return e.substats},addToListSuccess:function(t){if(t.success){var e=_.template(I18n.t("MimiFlash.stats.overview_tabs.addToListSuccess.success")),i=e({list_name:this.addToListMemo});Widget.MimiFlash.create(i)}else{var s=_.template(I18n.t("MimiFlash.stats.overview_tabs.addToListSuccess.fail")),n=s({list_name:this.addToListMemo});Widget.MimiFlash.create(n)}},loadPromotionAttempts:function(e,i,s,n,o,a){if(this.loggedIn){e=e||this.getCurrentWhich();var r=this.getDataFor(e);if(i=i||r.substats,this.shouldLoadPromotionAttempts(e,i,r,s)){var l=this.getParametersFor(e,i,r,o,a);r.request=t.get(this.urls.attempts[this.type]+".json",l).success(_.bind(this.promotionAttemptsLoaded,this)).error(_.bind(this.promotionAttemptsFailed,this)),r.request.which=e,r.request.substats=i,r.request.force=s,r.request.retries=n||0,r.timeout=null,r.$tbody.show(),r.clear&&r.$tbody[0]&&r.$tbody[0].rows.length>0?r.loadingBlock.show():r.$tbody.append(r.$placeholder)}}},getDataFor:function(t){var e=this.data[this.type][t];return e||(e=this.initializeDataFor(t)),e.page+=1,e},currentSubstats:function(e,i){e=e||this.type,i=i||this.getCurrentWhich();var s=t("#"+e+"_stats_"+i).find(".toggle.on"),n=null;return n=s.length?s.data("state"):i},initializeDataFor:function(e){this.determineActionButtonVisibility(e),this.ensureOneButtonSelectedIfAnyStats(this.type);var i=t("#"+this.type+"_stats_"+e),s=i.find("tbody"),n=i.find(".toggle_set");return this.data[this.type][e]={page:0,substats:this.currentSubstats(this.type,e),$tbody:s,$placeholder:s.length?t(s[0].rows[0]).remove():t(),loadingBlock:new Widget.BlockOverlay({insert:i[0],cover:s[0]}),sumToolbar:n[0]?new Widget.Toolbar(n[0],{singleSelect:!0,ignoreClickClass:"off"}):!1}},determineActionButtonVisibility:function(e){e=e||this.getCurrentWhich();var i=this.currentSubstats(this.type,e),s=t("#"+this.type+"_stats_"+e),n=s.find(".audience_list_select"),o=_.indexOf(["opt_out","spam","hard_bounced","soft_bounced","other_bounced","bounced"],i)>=0,a=t(".table_actions"),r=s.find(".js_attempts_box"),l=t("#mailing_links ul");l.hide(),t(".mailing_link").removeClass("selected");var d=_.find(l,function(e){return t(e).data("state")===i});d&&"mailing"===this.type?(r.addClass("wrap-67 right"),t(d).show()):r.removeClass("wrap-67 right"),o?n.hide():n.show();var h=this.unifiedCounts[this.type][i];0===h?(a.hide(),this.toggleEmptyStatHelperText(e,!0)):(a.show(),this.toggleEmptyStatHelperText(e,!1))},ensureOneButtonSelectedIfAnyStats:function(e){e=e||this.type;var i=!1,s=this,n=s.getCurrentWhich(),o="#"+e+"_stats_"+n+" header .toggle_set a",a=t(o+".on");if(0===a.length){var r=t(o).filter(function(){return"0"!==t(this).attr("data-value")});if(r.length>0){s.toggleEmptyStatHelperText(n,!1);var l=t(r[0]);l.addClass("on"),l.removeClass("off"),l.click(),s.determineActionButtonVisibility(n),i=!0}else s.toggleEmptyStatHelperText(n,!0)}else i=!0;return i},toggleEmptyStatHelperText:function(e,i){var s=t("#"+this.type+"_stats_"+e+"_empty");i?s.show():s.hide()},shouldLoadPromotionAttempts:function(t,e,i,s){return i.$tbody?(s&&(i.page=1,i.clear=!0),i&&i.request?(i.reload=!0,!1):s?!0:!(i.completed||this.unifiedCounts[this.type][e]<=(i.page-1)*this.PAGE_SIZE)||e&&i.substats!==e?!0:!1):!1},getParametersFor:function(t,e,i,s,n){e&&i.substats!==e&&(i.substats=e,i.page=1,i.clear=!0);var o=_.include(["clicked","total_clicked"],e),a=i.substats||this.currentSubstats(this.type,t);"engaged"===a&&(a=this.currentSubstats(this.type,t));var r=this.determinePageSize(e,s);null==n&&(n=i.page);var l={which:a,page_size:r,"mailing_links[]":o?this.data[this.type].selectedLinks:[],page:n,include_stats_counts:"true"};return l},determinePageSize:function(t,e){var i=this.PAGE_SIZE;return null!=e&&e>i?(i=e,this.currentPageSize[t]=e):null!=this.currentPageSize[t]&&(i=this.currentPageSize[t]),i},promotionAttemptsLoaded:function(e,i,s){var n=s.which,o=this.currentSubstats(this.type,n),a=t("#"+this.type+"_stats_"+n).find("tbody"),r=this.data[this.type][n],l=this.renderPromoAttemptTemplate(o,e.attempts);this.overview.isDelivering||this.overview.updateStats([e.stats],!1),r.request=!1,r.clear?(r.clear=!1,a.html(l.join(""))):(r.$placeholder.remove(),a.append(l.join(""))),r.loadingBlock&&r.loadingBlock.visible()?r.loadingBlock.hide():r.$placeholder.parent()&&r.$placeholder.remove(),r.reload&&(r.reload=!1,this.loadPromotionAttempts(n)),this.currentPromotionAttemptsCount[this.type][o]=this.calculatePromoAttemptsCount(e.attempts,o),r.completed=this.currentPromotionAttemptsCount[this.type][o]>=this.unifiedCounts[this.type][o],this.toggleEmptyStatHelperText(n,0===this.unifiedCounts[this.type][o])},renderPromoAttemptTemplate:function(t,e){var i=this;return _.map(e,function(e){return e.recipient_label=e.audience_member_id?i.AUDIENCE_MEMBER_LINK_TEMPLATE(e):e.email?e.email:i.UNKNOWN_RECIPIENT_LABEL,"forwarded"===t?i.FORWARD_ROW_TEMPLATE(e).replace("1 times","1 time"):null===e.count?i.UNCOUNTED_ROW_TEMPLATE(e):i.ROW_TEMPLATE(e)})},currentPromotionAttemptsRowCount:function(e){return e=e||this.getCurrentWhich(),t("#"+this.type+"_stats_"+e+" tbody tr").length},calculatePromoAttemptsCount:function(t,e){var i=this.currentPromotionAttemptsCount[this.type][e];return null==i&&(i=0),_.each(t,function(t){i+=null!=t.count?t.count:1}),i},promotionAttemptsFailed:function(t){try{var e=t.which,i=this.data[this.type][e];i.request=!1,i.page-=1,t.retries<3?this.loadPromotionAttempts(e,t.substats,t.force,t.retries+1):(i.loadingBlock&&i.loadingBlock.visible()?i.loadingBlock.hide():i.$placeholder.parent()&&i.$placeholder.remove(),Widget.MimiFlash.create(I18n.t("MimiFlash.stats.overview_tabs.promotionAttemptsFailed")+" "+e))}catch(s){this.showFailedPALoadFlash()}},showFailedPALoadFlash:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.stats.overview_tabs.showFailedPALoadFlash"))},getCurrentWhich:function(){return"mailing"===this.type&&this.tabs.hasCurrentTab()?this.tabs.getCurrentTabId().depref("#mailing_stats_"):(this.type="promotion",this.promotionTabs.getCurrentTabId().depref("#promotion_stats_"))},onShareTypeClick:function(e){e.preventDefault();var i=t(e.currentTarget),s=this.getCurrentWhich(),n=this.data[this.type][s],o=i.data("share");n.substats!==o&&(this.deselectMailingLinks(),i.addClass("selected"),this.data[this.type].selectedLinks.push(o),this.resetCurrentPromotionAttemptsCount(this.type,o),this.loadPromotionAttempts(s,o,!0))},onMailingLinkClick:function(e){e.preventDefault();var i=t(e.currentTarget);if(0!==i.length){var s=i.attr("data-mailing_link_id");i.hasClass("selected")?(i.removeClass("selected"),this.data[this.type].selectedLinks=_.reject(this.data[this.type].selectedLinks,function(t){return t===s})):(i.addClass("selected"),this.data[this.type].selectedLinks.push(s));var n=this.getCurrentWhich(),o=this.currentSubstats(this.type,n);this.resetCurrentPromotionAttemptsCount(this.type,o),this.loadPromotionAttempts(n,o,!0)}},deselectMailingLinks:function(){this.data[this.type].selectedLinks=[],this.$mailingLinks.find("a.share_type").removeClass("selected")},reSelectAllLinkFilters:function(){this.reSelectLinkFilters("mailing_link_id"),this.reSelectLinkFilters("share")},reSelectLinkFilters:function(t){var e=this;_.each(e.data[this.type].selectedLinks,function(i){var s="ul[data-state='"+e.currentSubstats()+"'] li a[data-"+t+"='"+i+"']";e.$mailingLinks.find(s).addClass("selected")})},setCounts:function(t,e){this.unifiedCounts[t]=e}}}(jQuery),function(){var t=5e3,e=3e3,i=6e4,s=3e5;Mimi.Stats.Poller={init:function(e){this.overview=e.overview,this.currentPollPeriod=t,this.lastStatsResult=e.lastStatsResult,this.statsHaveChanged=!1,this.pollStartedAt=null},start:function(){this.overview.isDelivering||null!=this.pollStartedAt||(this.pollStartedAt=(new Date).getTime(),this.performPoll())},performPoll:function(){this.overview.enqueueRefreshAllStats(!0)},continuePolling:function(){return(new Date).getTime()-this.pollStartedAt<s},pollTimeoutPeriod:function(){return this.statsHaveChanged?(this.currentPollPeriod=t,this.currentPollPeriod):this.currentPollPeriod+e>i?i:this.currentPollPeriod+=e},recordChangeInStats:function(t){if(!this.overview.isDelivering&&this.continuePolling()){var e=this,i=t.result.counts.promotion||t.result.counts;this.lastStatsResult&&(this.statsHaveChanged=!this.statsAreEqual(this.lastStatsResult,i)),this.lastStatsResult=i,setTimeout(function(){e.performPoll()},e.pollTimeoutPeriod())}},statsAreEqual:function(t,e){return t.accepted==e.accepted&&t.bounced==e.bounced&&t.viewed==e.viewed&&t.total_viewed==e.total_viewed&&t.engaged==e.engaged&&t.total_clicked==e.total_clicked&&t.clicked==e.clicked&&t.growth==e.growth&&t.spam==e.spam}}}(jQuery),function(t){Mimi.Stats.Buttons={init:function(t,e,i){this.loadButtons(),this.stats=t,this.urls=e,this.overview=i,this.initializeEvents(),this.overview.isDelivering?this.initializeDelivering():this.updateState()},loadButtons:function(){this.buttonBar=t("#stats_toggle .button_bar"),this.shareBtn=t("#stats_toggle .btn.shared"),this.pauseBtn=t("#stats_toggle .btn.pause"),this.deliverBtn=t("#stats_toggle .btn.play"),this.cancelBtn=t("#stats_toggle .btn.cancel"),this.percBtn=t("#stats_toggle .btn.perc"),this.otherBtn=t("#stats_toggle .btn.sent"),this.editBtn=t("#stats_toggle .btn.edit"),this.backBtn=t("#stats_toggle .btn.back"),this.sendingMeta=t(".sending_meta"),this.allButtons={delivering:[this.pauseBtn,this.cancelBtn],paused:[this.deliverBtn,this.cancelBtn],delivered:[this.percBtn,this.shareBtn,this.otherBtn,this.editBtn,this.backBtn]}},initializeEvents:function(){this.percBtn.on("click",_.bind(this.onPercClick,this)),this.shareBtn.length&&this.shareBtn.on("click",_.bind(this.onShareClick,this)),this.pauseBtn.length&&(this.pauseBtn.on("click",_.bind(this.onPause,this)),this.deliverBtn.on("click",_.bind(this.onDeliver,this)),this.cancelBtn.on("click",_.bind(this.onCancel,this)),this.pauseBtn.attr("onclick",null),this.deliverBtn.attr("onclick",null),this.cancelBtn.attr("onclick",null))},onShareClick:function(t){t.preventDefault(),Mimi.Stats.ShareDialog.setInfo(I18n.t("MimiFlash.stats.buttons.onShareClick"));var e=this.urls.share[Mimi.Stats.OverviewTabs.type];Mimi.Stats.ShareDialog.show(e)},initializeDelivering:function(){this.overview.isDelivering=!0,this.wasDelivering=!0,this.updateStats(),this.updateState()},updateStats:function(){if(this.overview.isDelivering)this.overview.enqueueRefreshAllStats(),this.fetchStats(5e3);else if(this.wasDelivering){var t=new Date,e=_.template(I18n.t("MimiFlash.stats.buttons.updateStats")),i=e({promo:this.stats.name,time:Time.formatDate(t)});Widget.MimiFlash.sticky(i),this.overview.startPoller(),this.wasDelivering=!1}},fetchStats:function(e){this.boundFetch||(this.boundFetch=_.bind(function(){t.get(this.urls.stats[this.overview.originalType]+".json").success(_.bind(this.onUpdateStatsSuccess,this)).error(_.bind(this.onUpdateStatsComplete,this))},this)),_.delay(this.boundFetch,e)},onUpdateStatsSuccess:function(t){t.success&&(this.stats=t.result,this.updateState(),this.updateStats())},onUpdateStatsComplete:function(){this.updateStats()},isPercentageOn:function(){return this.percBtn.hasClass("selected")},onPercClick:function(t){t.preventDefault(),this.percBtn.toggleClass("selected"),this.overview.togglePercentage(this.isPercentageOn())},updateState:function(){this.overview.isDelivering=this.stats.delivering||this.stats.paused,this.overview.isDelivering?(this.sendingMeta&&this.sendingMeta.addClass("promo-sending"),this.showButtonsForState(this.stats.paused?"paused":"delivering")):(this.sendingMeta&&this.sendingMeta.removeClass("promo-sending"),this.showButtonsForState("delivered"))},onPause:function(e){e.preventDefault(),t.post(this.pauseBtn.attr("href")+".json").done(_.bind(this.onPauseSuccess,this)).error(_.bind(this.onPauseFailure,this))},onPauseSuccess:function(t){t.success?(this.stats=t.result,this.updateState()):Widget.MimiFlash.error(I18n.t("MimiFlash.stats.buttons.onPauseSuccess")+"\n"+t.error)},onPauseFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.stats.buttons.onPauseFailure"))},onDeliver:function(e){e.preventDefault(),t.post(this.deliverBtn.attr("href")+".json").success(_.bind(this.onDeliverSuccess,this)).error(_.bind(this.onDeliverFailure,this))},onDeliverSuccess:function(t){t.success?(this.stats=t.result,this.updateState(),t.result.alert&&Widget.MimiFlash.error(t.result.alert)):Widget.MimiFlash.error(I18n.t("MimiFlash.stats.buttons.onDeliverSuccess")+"\n"+t.error)},onDeliverFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.stats.buttons.onDeliverFailure"))},onCancel:function(e){e.preventDefault(),t.post(this.cancelBtn.attr("href")+".json").success(_.bind(this.onCancelSuccess,this)).error(_.bind(this.onCancelFailure,this))},onCancelSuccess:function(t){t.success?(this.stats=t.result,this.updateState()):Widget.MimiFlash.error(I18n.t("MimiFlash.stats.buttons.onCancelSuccess")+"\n"+t.error)},onCancelFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.stats.buttons.onCancelFailure"))},showButtonsForState:function(e){this.hideAllButtons();var i=this;_.each(this.allButtons[e],function(e){i.buttonBar.append(t(e).show())}),this.initializeEvents()},hideAllButtons:function(){_.each(_.values(this.allButtons),function(t){_.each(t,function(t){t&&t.remove()})})}}}(jQuery),function(t){Mimi.Stats.Chart=Class.create({initialize:function(t){this.$chartElement=t,this.parentId=this.$chartElement.parents(".tabs_content").attr("id"),this.data=this.prepareData(),this.chart=this.drawChart(),this.initializeEvents()},initializeEvents:function(){var e=t("#"+this.parentId).find(".toggle_set").find("a");e.on("mouseenter",_.bind(this.onMouseEnter,this)).on("mouseleave",_.bind(this.onMouseLeave,this))},onMouseEnter:function(e){var i=t(e.currentTarget),s=this.sector(i);this.chart&&s&&this.chart.extendSectors(this.parts(s),this.label(s))},onMouseLeave:function(){this.chart&&this.chart.cancelExtension()},drawChart:function(){return!this.chart&&Widget.PieChart.supported?new Widget.PieChart(this.$chartElement[0],this.chartData(),{canvasWidth:this.width()+40,canvasHeight:this.height(),chartEdgeOffset:10,maxExtension:10,labelRadius:3,showPercents:!1,labelColor:"#000",labelShadowColor:"",labelEdgeOffset:17,labelBgColor:"#fff"}):void 0},sector:function(t){return t.attr("data-state")},label:function(t){return this.data[t].label},parts:function(t){return this.data[t].parts?this.data[t].parts:[t]},width:function(){return this.$chartElement.width()},height:function(){return this.$chartElement.height()},chartData:function(){var t={},e=_.inject(this.data,function(t,e){return t+e.value},0);return _.each(this.data,function(i,s){t[s]=parseFloat((100*i.value/e).toFixed(2))}),t},prepareData:function(){var e={},i=this;return _.each(t("#"+this.parentId).find(".toggle_set").find("a"),function(s){var n=t(s),o=s.attributes["data-chart"].value;e[i.sector(n)]=JSON.parse(o)}),e}})}(jQuery),function(t){Mimi.Stats.Clicks={initializeClicksMap:function(){var e=this;this.tips?this.destroyClicksMap():t("#clicks_map iframe").on("unload",_.bind(this.destroyClicksMap,this)),this.tips=[],t("#clicks_map_loading").hide();var i=t("#clicks_map iframe");i.show(),i.height(i.contents().height()),_.each(i.contents().find("a[data-link-stats]"),function(s){var n=t(s);e.tips.push(e.createTip(n,i)),e.clickLink(n),e.hoverLink(n),e.leaveLink(n)})},destroyClicksMap:function(){_.invoke(this.tips,"hide")},setHideTimeout:function(t){var e=this;t.data("tip_hovered")||t.data("link_hovered")||t.data("hideTimeout",setTimeout(function(){e.hideTip(t)},50))},createTip:function(e,i){var s=this,n=t("#js_link_stat_"+e.data("mailing_link_id"));n.mouseleave(function(){e.data("tip_hovered",!1),s.setHideTimeout(e)}).mouseenter(function(){e.data("tip_hovered",!0),s.showTip(e)});var o=new Widget.GuideTip("#"+n.attr("id"),e[0],{anchor:i[0]});e.data("tip",o),e.wrap('<div class="mimi_link_stats_wrap">'),e.html('<div class="link_stats_html">'+e.html()+"</div>");var a=n.data("value"),r=n.data("background-color"),l=n.data("color");return e.prepend('<span class="mimi_indicator colored" style="background-color: '+r+"; color: "+l+';"><span class="beak" style="border-top-color: '+r+'"></span>'+(void 0===a?"0":a)+"</span>"),o},clickLink:function(t){t.click(function(t){t.preventDefault()})},hoverLink:function(t){var e=this;t.mouseenter(function(){t.data("link_hovered",!0),e.showTip(t)})},tipVisible:function(e){var i=e.data("tip");return t(i.element).is(":visible")},leaveLink:function(t){var e=this;t.mouseleave(function(){t.data("link_hovered",!1),e.setHideTimeout(t)})},showTip:function(e){if(clearTimeout(e.data("hideTimeout")),!this.tipVisible(e)){this.hidePercent(e),e.addClass("mimi_link_stats_hover");var i=e.data("tip"),s=t(i.$element),n=e.offset().left+e.outerWidth()/2-s.outerWidth()/2,o=e.offset().top-s.outerHeight()-5;i.show(),i.position("farleft fartop",[n,o])}},hideTip:function(t){t.data("tip").hide(),t.removeClass("mimi_link_stats_hover"),this.showPercent(t)},showPercent:function(t){t.find("span.mimi_indicator").fadeIn()},hidePercent:function(t){t.find("span.mimi_indicator").fadeOut()}}}(jQuery),function(t){Mimi.LiveSupport=Class.create(Widget.Observer,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.LiveSupport.DOM),this.initObservers(),this.timezoneSelector=Widget.Dropdown.instances[this.dom.$timezone.identify()],this.currentTimezone=this.timezoneSelector.dom.$textSpan.html()},initObservers:function(){var e=this;t(document).on("dropdown:item:selected",function(t,i){e.setTimezone(i.element.innerHTML)})},setTimezone:function(){}}),Mimi.LiveSupport.DOM={timezone:".timezone"}}(jQuery),Mimi.Mailings={},function(t){Mimi.Mailings.Mailing=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#main"),this.initData(),this.initDom(),this.initDisplay(),this.initPaths(),this.initTemplates(),this.initObservers()},initObservers:function(){this.dom.form.$subject.on("keyup",_.bind(this.onSummaryKeyup,this)),this.dom.form.$address.on("keyup",_.bind(this.onAddressChange,this)),this.dom.form.$audienceMembers.on("input",_.bind(this.onExtraRecipientsKeyup,this)),t(document).on("time_picker:updated",_.bind(this.setSummarySchedule,this)),t(document).on("date_picker:updated",_.bind(this.setSummarySchedule,this)),this.dom.form.$email.on("change",_.bind(this.onEmailChange,this)),this.dom.form.$responsiveTemplate.on("change",_.bind(this.onResponsiveTemplate,this)),this.dom.form.$secondSend.on("change",_.bind(this.onSecondSendChange,this)),this.dom.form.$secondSendSubject.on("keyup",_.bind(this.onSecondSendSubjectKeyup,this))},initTemplates:function(){this.templates={include:Template.from("included_summary_list_template"),exclude:Template.from("excluded_summary_list_template")}},initPaths:function(){this.paths={update:Mimi.Mailings.paths.update,send:Mimi.Mailings.paths.send,stats:Mimi.Mailings.paths.stats,schedule:Mimi.Mailings.paths.schedule,cancel:Mimi.Mailings.paths.cancel}},initDom:function(){var e=t("#preview"),i=t("#details"),s=t("#recipients");this.dom={summary:{$container:e,$subject:e.find(".subject"),$schedule:e.find(".schedule"),$to:e.find(".to"),$notTo:e.find(".not_to")},form:{$container:i,$name:t("#send_from_name"),$email:t("#send_from_email"),$subject:t("#send_subject"),$address:t("#user_address"),$secondSend:t("#second_send"),$secondSendSubject:t("#second_send_subject"),$preventResend:t("#send_dedupe"),$linkTracking:t("#send_enable_link_tracking"),$responsiveTemplate:t("#use_responsive_template"),$facebookShare:t("#facebook_share"),$twitterShare:t("#twitter_share"),$plusoneShare:t("#plusone_share"),$pinterestShare:t("#pinterest_share"),$linkedInShare:t("#linked_in_share"),$audienceMembers:t("#audience_members")},recipients:{$container:s,$extra:s.find("#audience_members"),$extraLabel:s.find("label[for=audience_members]")}}},initDisplay:function(){this.setSummary(),this.setFormDetails(),this.setDateTimePickerMinimumDate()},initData:function(){this.data={attributes:Mimi.Mailings.mailingData,state:{busy:!1},includeListIds:[],excludeListIds:[],client_scheduled_at:null,publish:!1,extraRecipientCount:0}},onSummaryKeyup:function(){this.data.attributes.subject=this.dom.form.$subject.val().trim(),this.setSummarySubject(),this.data.attributes.subject.length>0&&this.removeValidationError(this.dom.form.$subject)},onSecondSendSubjectKeyup:function(){this.data.attributes.second_send_subject=this.dom.form.$secondSendSubject.val().trim(),this.data.attributes.second_send_subject.length>0&&this.removeValidationError(this.dom.form.$secondSendSubject)},onExtraRecipientsKeyup:function(){this.setSummaryTo(),this.checkIfExtraRecipientsOverMaxLimit(),this.checkIfExtraRecipientsOverLimit()},onAddressChange:function(){this.dom.form.$address.hasClass("error")&&(this.validateAddress(),this.updateFormItemError("address"))},onSecondSendChange:function(){this.getFormCheckboxAttr("secondSend")&&this.dom.form.$secondSendSubject.focus()},onEmailChange:function(){var t=this.dom.form.$email;if(t.hasClass("error")){var e=t.val().trim();this.isEmail(e)&&this.removeValidationError(t)}},onResponsiveTemplate:function(){var t=this.dom.form.$responsiveTemplate,e=this.getAttr("disallowed_custom_html_used");t.prop("checked")&&e&&Widget.MimiFlash.create(t.data("warning"))},checkIfExtraRecipientsOverMaxLimit:function(){this.getAudienceMembersCount()>Mimi.Mailings.maxExtraEmails?this.dom.recipients.$extra.addClass("error-max-recipients error"):this.dom.recipients.$extra.removeClass("error-max-recipients error")},checkIfExtraRecipientsOverLimit:function(){this.fire(Mimi.Mailings.overAudienceLimit&&this.data.extraRecipientCount>Mimi.Mailings.singleEmailLimit?"mailing:extra_recipients:over_limit":"mailing:extra_recipients:not_over_limit")},tryFireInvalidFields:function(){this.hasInvalidFields()&&this.fire("mailing:invalid",{invalid:this.invalid})},hasInvalidFields:function(){if(this.invalid){var t=_.map(_.keys(this.invalid),function(t){return 0!==_.size(this.invalid[t])
},this);return _.any(t)}return!1},updateFormErrors:function(){this.invalid&&(this.updateFormItemError("name"),this.updateFormItemError("email"),this.updateFormItemError("address"),this.updateFormItemError("subject"),this.updateFormItemError("secondSendSubject"),this.updateScheduleFormItemError(),this.updateRecipientsFormItemError())},updateRecipientsFormItemError:function(){var t=this.dom.recipients.$extra,e=this.dom.recipients.$extraLabel;0===_.size(this.invalid["additional recipients"])?(t.removeClass("error"),e.removeClass("errorLabel")):(t.addClass("error"),e.addClass("errorLabel"))},updateScheduleFormItemError:function(){if(Mimi.Mailings.isScheduled){var e=t("#schedule_when");0===_.size(this.invalid.schedule)?e.removeClass("error"):e.addClass("error")}},updateFormItemError:function(t){var e=this.dom.form["$"+t];if(e[0]){var i=e.parent().find("label");0===_.size(this.invalid[t])?(e.removeClass("error"),i.removeClass("errorLabel")):(e.addClass("error"),i.addClass("errorLabel"))}},removeValidationError:function(t){var e=t.parent().find("label");t.removeClass("error"),e.removeClass("errorLabel")},validate:function(){this.invalid={},this.validateFromName(),this.validateFromEmail(),this.validateSubject(),this.validateSecondSendSubject(),this.data.attributes.second_send||(this.validateRecipients(),this.validateExtraRecipients()),this.validateAddress(),this.validateSchedule(),this.tryFireInvalidFields(),this.updateFormErrors()},validateExtraRecipients:function(){var t="additional recipients",e=this.dom.recipients.$extra.val();if(this.invalid[t]=[],this.isBlank(e)||this.containsEmail(e)){if(this.getAudienceMembersCount()>Mimi.Mailings.maxExtraEmails){var i=_.template(I18n.t("js.mailings.mailing.validateExtraRecipientsLimit")),s=i({limit:Mimi.Mailings.maxExtraEmails});this.invalid[t].push(s)}}else this.invalid[t].push(I18n.t("js.mailings.mailing.validateExtraRecipients"))},validateSchedule:function(){if(Mimi.Mailings.isScheduled){this.invalid.schedule=[];var t=this.getClientSchedule();this.isBlank(t)&&this.invalid.schedule.push(I18n.t("js.mailings.mailing.validateSchedule.isBlank"))}},validateRecipients:function(){this.invalid.recipients=[],this.isAllAudience()||this.getAudienceMembersCount()+_.size(this.data.includeListIds)===0&&this.invalid.recipients.push(I18n.t("js.mailings.mailing.validateRecipients"))},validateFromName:function(){var t=this.getFormAttr("name");this.invalid.name=[],this.isBlank(t)&&this.invalid.name.push(I18n.t("js.mailings.mailing.validateFromName"))},validateFromEmail:function(){var t=this.getFormAttr("email");this.invalid.email=[],this.isBlank(t)?this.invalid.email.push(I18n.t("js.mailings.mailing.validateFromEmail.isBlank")):this.isEmail(t)||this.hasValidEmailFallback(t)||this.invalid.email.push(I18n.t("js.mailings.mailing.validateFromEmail.isInvalid"))},hasValidEmailFallback:function(t){t=t.replace(/\(/g,"").replace(/\)/g,"");var e=_.last(t.split("=")),i=_.last(t.split(","));return i.replace(/ /g,"")!=="fallback="+e?!1:this.isEmail(e)},validateSubject:function(){var t=this.getFormAttr("subject");this.invalid.subject=[],this.isBlank(t)&&this.invalid.subject.push(I18n.t("js.mailings.mailing.validateSubject"))},validateSecondSendSubject:function(){var t=this.getFormAttr("subject"),e=this.getFormAttr("secondSendSubject");if(this.invalid.secondSendSubject=[],this.getFormCheckboxAttr("secondSend")){var i;this.isBlank(e)?i=I18n.t("js.mailings.mailing.validateSecondSendSubject.isBlank"):e==t&&(i=I18n.t("js.mailings.mailing.validateSecondSendSubject.isNotUnique")),i&&this.invalid.secondSendSubject.push(i)}},validateAddress:function(){if(this.dom.form.$address[0]){var t=this.getFormAttr("address");this.invalid.address=[],this.isBlank(t)&&this.invalid.address.push(I18n.t("js.mailings.mailing.validateAddress"))}},isBlank:function(t){return!t||0===t.toString().trim().length},isEmail:function(t){var e=/^([+a-zA-Z0-9_\.\-&])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,})+$/;return e.test(t)},containsEmail:function(t){var e=/([+a-zA-Z0-9_\.\-&])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,})+/;return e.test(t)},isBusy:function(){return this.data.state.busy},setBusy:function(t){this.data.state.busy=t},getCleanFromName:function(){return('"'+this.getFormAttr("name").replace('"',"")+'"').trim().stripTags()},getMailingAttributes:function(){var t={"mailing[from_address]":this.getCleanFromName()+" <"+this.getFormAttr("email")+">","mailing[prevent_resend]":this.getFormCheckboxAttr("preventResend"),"mailing[disable_link_tracking]":!this.getFormCheckboxAttr("linkTracking"),"mailing[subject]":this.getFormAttr("subject"),"mailing[second_send_subject]":this.getFormSecondSendSubject()};return this.data.attributes.second_send||_.extend(t,{"mailing[all_audience]":this.getAttr("all_audience")}),t},getPromotionAttributes:function(){return{"promotion[use_responsive_template]":this.getFormCheckboxAttr("responsiveTemplate"),"promotion[facebook_share]":this.getFormCheckboxAttr("facebookShare"),"promotion[plusone_share]":this.getFormCheckboxAttr("plusoneShare"),"promotion[twitter_share]":this.getFormCheckboxAttr("twitterShare"),"promotion[pinterest_share]":this.getFormCheckboxAttr("pinterestShare"),"promotion[linked_in_share]":this.getFormCheckboxAttr("linkedInShare")}},getUserAttributes:function(){return this.dom.form.$address[0]?{"user[postal_address]":this.getFormAttr("address")}:{}},getAudienceMembers:function(){var t=this.dom.recipients.$extra.valPlaceholderSafe();return t.trim()},getAudienceMembersCount:function(){var t=this.getAudienceMembers(),e=t.split(/,?\s+/),i=_.reject(e,function(t){return-1===t.indexOf("@")||0===t.trim().length});return this.data.extraRecipientCount=_.size(i),_.size(i)},getClientSchedule:function(t){if(Mimi.Mailings.isScheduled){var e=this.getClientScheduleAsDate(),i=e.getHours().leadingZero()+":"+e.getMinutes().leadingZero();return Mimi.DateTimePicker.get().is24hourClock()||(i=Mimi.DateTimePicker.get().convert24hourTime(i)),t?I18n.l("time.formats.short",e):e.getFullYear()+"-"+(e.getMonth()+1).leadingZero()+"-"+e.getDate().leadingZero()+" "+i}return null},getClientScheduleAsDate:function(){return Mimi.DateTimePicker.get().getSelectedDateAsDate()},setClientSchedule:function(t){this.data.client_scheduled_at=t},getClientScheduleWithTimezone:function(){var t=!0;return this.getClientSchedule(t)+" "+Mimi.DateTimePicker.get().getTimezone()},getSendParameters:function(){var t={from_email:this.getFormAttr("email"),from_name:this.getFormAttr("name"),facebook_share:this.getFormCheckboxAttr("facebookShare"),twitter_share:this.getFormCheckboxAttr("twitterShare"),plusone_share:this.getFormCheckboxAttr("plusoneShare"),pinterest_share:this.getFormCheckboxAttr("pinterestShare"),linked_in_share:this.getFormCheckboxAttr("linkedInShare"),client_scheduled_at:this.getClientSchedule(),prevent_resend:this.getFormCheckboxAttr("preventResend"),disable_link_tracking:!this.getFormCheckboxAttr("linkTracking"),use_responsive_template:this.getFormCheckboxAttr("responsiveTemplate"),subject:this.getFormAttr("subject"),second_send_subject:this.getFormSecondSendSubject()};return this.data.attributes.second_send||_.extend(t,{"list_ids[]":this.data.includeListIds,"excluded_list_ids[]":this.data.excludeListIds,audience_members:this.getFormAttr("audienceMembers"),all_audience:this.getAttr("all_audience")}),this.dom.form.$address[0]&&(t.user_address=this.getFormAttr("address")),_.extend(t,this.getFiltersAttributes()),t},getFiltersAttributes:function(){if(this.data.filters){var t={};for(var e in this.data.filters){var i=this.data.filters[e];i&&(t["filters["+e+"][]"]=i)}return t}return{}},truthy:function(t){return"on"===t?!0:!1},send:function(){if(!this.isBusy()&&(this.validate(),!this.hasInvalidFields())){this.setBusy(!0);var e=this.getSendParameters();t.ajax({url:this.paths.send,type:"put",data:e}).done(_.bind(this.onSendSuccess,this)).fail(_.bind(this.onSendFailure,this)),this.fire("mailing:send:started")}},onSendSuccess:function(t){this.setBusy(!1),t.success?this.fire("mailing:send:successful",{needsApproval:t.result.needs_approval}):this.fire("mailing:send:failed",{reason:t.error,code:t.code,mailingId:t.resourceId}),this.fire("mailing:send:completed")},onSendFailure:function(){this.setBusy(!1),this.fire("mailing:send:failed",{reason:I18n.t("js.mailings.mailing.onSendFailure")}),this.fire("mailing:send:completed")},cancelSend:function(){this.isBusy()||(this.setBusy(!0),t.post(this.paths.cancel).done(_.bind(this.onCancelSuccess,this)).fail(_.bind(this.onCancelFailure,this)),this.fire("mailing:cancel:started"))},onCancelSuccess:function(t){this.setBusy(!1),t.success?this.fire("mailing:cancel:successful"):this.fire("mailing:cancel:failed",{reason:t.error}),this.fire("mailing:cancel:completed")},onCancelFailure:function(){this.setBusy(!1),this.fire("mailing:cancel:failed"),this.fire("mailing:cancel:completed")},schedule:function(){this.isBusy()||(this.validate(),this.hasInvalidFields()||(this.setBusy(!0),t.ajax({url:this.paths.schedule,type:"put",data:{publish:this.data.publish}}).done(_.bind(this.onScheduleSuccess,this)).fail(_.bind(this.onScheduleFailure,this)),this.fire("mailing:schedule:started")))},onScheduleSuccess:function(t){this.setBusy(!1),t.success?this.fire("mailing:schedule:successful"):this.fire("mailing:schedule:failed",{reason:t.error}),this.fire("mailing:schedule:completed")},onScheduleFailure:function(){this.setBusy(!1),this.fire("mailing:schedule:failed"),this.fire("mailing:schedule:completed")},save:function(e){if(!this.isBusy()){if(e===!1&&(this.validate(),this.hasInvalidFields()))return!1;this.setBusy(!0);var i=_.extend({client_scheduled_at:this.getClientSchedule()},this.getMailingAttributes(),this.getUserAttributes(),this.getPromotionAttributes(),this.getFiltersAttributes());this.data.attributes.second_send||_.extend(i,{"list_ids[]":this.data.includeListIds,"excluded_list_ids[]":this.data.excludeListIds,audience_members:this.getAudienceMembers()}),t.ajax({url:this.paths.update,type:"put",data:i}).done(_.bind(this.onSaveSuccess,this)).fail(_.bind(this.onSaveFailure,this)),this.fire("mailing:save:started")}},onSaveSuccess:function(t){t.success?(this.setAttributes(t.result),this.updatePreviouslyScheduledTable(),this.setSummary(),this.fire("mailing:save:successful")):this.fire("mailing:save:failed",{error:t.error}),this.setBusy(!1),this.fire("mailing:save:completed")},onSaveFailure:function(){this.setBusy(!1),this.fire("mailing:save:failed"),this.fire("mailing:save:completed")},setAttributes:function(t){this.data.attributes=t},setFormDetails:function(){this.setFormName(),this.setFormEmail(),this.setFormSubject(),this.setFormSecondSend(),this.setFormSecondSendSubject(),this.setFormAddress(),this.setFormPreventResend(),this.setFormLinkTracking(),this.setFormResponsiveTemplate(),this.setFormFacebookShare(),this.setFormTwitterShare(),this.setFormPlusoneShare(),this.setFormPinterestShare(),this.setFormLinkedInShare()},getFormAttr:function(t){return this.dom.form["$"+t].valPlaceholderSafe()},getFormCheckboxAttr:function(t){return this.dom.form["$"+t].prop("checked")},getAttr:function(t){return this.data.attributes[t]},setAttr:function(t,e){this.data.attributes[t]=e},setFormName:function(){this.dom.form.$name.val(this.getAttr("from_name"))},setFormEmail:function(){this.dom.form.$email.val(this.getAttr("from_email"))},setFormSubject:function(){this.dom.form.$subject.val(this.getAttr("subject")||"")},setFormSecondSend:function(){this.dom.form.$secondSend.prop("checked",!!this.getAttr("second_send_subject"))},getFormSecondSendSubject:function(){return this.getFormCheckboxAttr("secondSend")?this.getFormAttr("secondSendSubject"):""},setFormSecondSendSubject:function(){this.dom.form.$secondSendSubject.val(this.getAttr("second_send_subject")||"")},setFormAddress:function(){this.dom.form.$address[0]&&this.dom.form.$address.val(this.getAttr("postal_address"))},setFormPreventResend:function(){this.dom.form.$preventResend.prop("checked",this.getAttr("prevent_resend"))},setFormLinkTracking:function(){this.dom.form.$linkTracking.prop("checked",!this.getAttr("disable_link_tracking"))},setFormResponsiveTemplate:function(){this.dom.form.$responsiveTemplate.prop("checked",this.getAttr("use_responsive_template"))},setFormFacebookShare:function(){this.dom.form.$facebookShare.prop("checked",this.getAttr("facebook_share"))},setFormTwitterShare:function(){this.dom.form.$twitterShare.prop("checked",this.getAttr("twitter_share"))},setFormPlusoneShare:function(){this.dom.form.$plusoneShare.prop("checked",this.getAttr("plusone_share"))},setFormPinterestShare:function(){this.dom.form.$pinterestShare.prop("checked",this.getAttr("pinterest_share"))},setFormLinkedInShare:function(){this.dom.form.$linkedInShare.prop("checked",this.getAttr("linked_in_share"))},setSummary:function(){this.setSummarySubject(),this.setSummaryTo(),this.setSummarySchedule()},setSummarySchedule:function(){var t;Mimi.Mailings.isScheduled?(t=!0,this.getClientSchedule()&&this.dom.summary.$schedule.html(this.getClientScheduleWithTimezone()),this.toggleSummarySchedule(t)):(t=!1,this.toggleSummarySchedule(t))},toggleSummarySchedule:function(e){var i=t("#preview .summary_schedule");e?i.show():i.hide()},setSummarySubject:function(){this.dom.summary.$subject.html(this.data.attributes.subject)},setSummaryTo:function(){if(this.data.attributes.second_send)this.dom.summary.$to.text(I18n.t("js.mailings.mailing.setSummaryTo.second_send"));else{var e=this.getAudienceMembersCount();if(t(".summary_count_to").remove(),e>0){var i=I18n.t(1===e?"js.mailings.mailing.setSummaryTo.audience_member":"js.mailings.mailing.setSummaryTo.audience_members");this.dom.summary.$to.append('<div class="summary_count_to">+'+e+" "+i+"<div>")}}},setDateTimePickerMinimumDate:function(){var t=this.data.attributes.second_send_original_mailing_scheduled_at;t&&Mimi.DateTimePicker.get().setMinimumDateTime(new Date(Date.parse(t)+864e5))},updatePreviouslyScheduledTable:function(){var e=t("#previous_schedule_"+Mimi.Mailings.id+" span.details");e[0]&&setInterval(function(){t.get(_.template(Mimi.Mailings.paths.schedule_detail)({mailing_id:Mimi.Mailings.id})).done(function(t){e.html(t)})},1e3)},getTo:function(){return this.dom.summary.$to.html()},getNotTo:function(){return this.dom.summary.$notTo.html()},getTotal:function(){return this.data.totalSize},isAllAudience:function(){return this.data.attributes.all_audience},setAllAudience:function(t){this.data.attributes.all_audience=t},getListIds:function(t){return _.map(_.toArray(t),function(t){return t.getListId()})},addListsToSummary:function(t,e,i){var s=_.map(_.toArray(i),function(t){return this.templates[e](t.asHash())},this);this.dom.summary["$"+t].html(s.join(""))},setIncludedLists:function(t){this.data.includeLists=t,this.data.includeListIds=this.getListIds(t),this.isAllAudience()?this.dom.summary.$to.html(I18n.t("js.mailings.mailing.setIncludedLists")):this.addListsToSummary("to","include",t)},setExcludedLists:function(e){this.data.excludeLists=e,this.data.excludeListIds=this.getListIds(e);var i=t(".excluded_list_summary");0===_.size(e)?i.hide():i.show(),this.addListsToSummary("notTo","exclude",e)},invalidateLists:function(){this.data.includeLists&&this.addListsToSummary("to","include",this.data.includeLists),this.data.excludeLists&&this.addListsToSummary("notTo","exclude",this.data.excludeLists)},setFilters:function(t){this.data.filters=t},isOverCreditLimit:function(){return!this.data.attributes.credit_check.passed},creditShortage:function(){return this.data.attributes.credit_check.credit_shortage},setPublish:function(t){this.data.publish=t}}).singleton()}(jQuery),function(t){Mimi.Mailings.MailingStats=Class.create(Widget.Observer,Widget.Observable,{initialize:function(t,e){this.data={mailing_id:e,promotion_id:t},this.busy=!1,this.paths={stats:"/promotions/#{promotion_id}/mailings/#{mailing_id}/stats.json"}},statsPath:function(){return _.template(this.paths.stats)({mailing_id:this.data.mailing_id,promotion_id:this.data.promotion_id})},fetchStats:function(e){this.busy||(this.busy=!0,t.get(this.statsPath()).done(_.bind(function(t){this.onFetchSuccess(t,e)},this)).fail(_.bind(this.onFetchFailure,this)).always(_.bind(function(){this.busy=!1},this)))},onFetchSuccess:function(t,e){t.success?(e(t.result),this.fire("mailing:stats:fetch:successful",{result:t.result})):this.fire("mailing:stats:fetch:failed",{reason:t.error})},onFetchFailure:function(){this.fire("mailing:stats:fetch:failed")}})}(jQuery),function(t){Mimi.Mailings.NewDashboard=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#main").parents("body"),this.dom=this.$element.getChildren(Mimi.Mailings.NewDashboard.DOM),this.initData(),this.initDialogs(),this.initListItems(),this.initDisplay(),this.initObservers(),this.initMailing(),this.initSendDialog(),this.initMailingStats(),this.revealPageElements(),this.simpleUpgrade=new Widget.SimpleUpgrade("send_dialog")},initAutoComplete:function(){var t=this.dom.$singleEmails;this.data.autoComplete=new Mimi.Audience.AutoComplete(t,t)},initMailing:function(){this.updateMailingData(),this.data.mailing.setSummary()},initSendDialog:function(){this.data.sendDialog.setMailing(this.data.mailing)},initData:function(){window.tabs=new Widget.Tabs(Mimi.Mailings.NewDashboard.DOM.tabs.id),this.data={lists:{},filters:{},text:{buttons:{enabled:I18n.t("js.mailings.new_dashboard.initData.enabled"),disabled:I18n.t("js.mailings.new_dashboard.initData.disabled")}},display:{success:!0},mailing:Mimi.Mailings.Mailing.get(),sendDialog:Mimi.Mailings.SendDialog.get(),sendingDialog:Mimi.Mailings.SendingDialog.get(),schedule:Mimi.Mailings.Schedule.get(),preppingSendOverlay:new Widget.BlockOverlay({cover:t("#main").find("section")[0]}),calendarPicker:Mimi.Mailings.Calendar.get(),newSenderExplanationDialog:Mimi.Mailings.NewSenderExplanationDialog.get(),exceededTestSendsDialog:Mimi.Mailings.ExceededTestSendsDialog.get(),filterDialog:Mimi.Mailings.FilterDialog.get(),untitledSubjectWarningDialog:Mimi.Mailings.UntitledSubjectWarningDialog.get(),templates:{freeAudienceOverageCaption:Template.from("free_audience_overage_caption")}},this.data.preppingSendOverlay.hide()},initDialogs:function(){if(this.data.purchaseCreditsDialog=new Widget.Popup("#purchase_credits_dialog",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1}),Mimi.Mailings.childUser&&(this.data.childNoCreditsDialog=new Widget.Popup("#child_no_credits_dialog",{hideTrigger:".close_btn",overlay:Widget.ModalOverlay,fixedPosition:!1})),Mimi.Mailings.freeUser&&null==Mimi.User.shopper_id){var t=I18n.t("js.mailings.new_dashboard.initDialogs.creditCaption");this.data.upgradeCreditsDialog=new Mimi.Plans.UpgradeFromFreeDialog(null,t),this.data.upgradeDialog=new Mimi.Plans.UpgradeFromFreeDialog(null,this.data.templates.freeAudienceOverageCaption(),{wrapCaption:!1})}else this.data.upgradeDialog=new Widget.Popup("#upgrade_dialog",{hideTrigger:".window_close, .close_btn",overlay:Widget.ModalOverlay,fixedPosition:!1})},initMailingStats:function(){var t=this.data.mailing.getAttr("promotion_id"),e=this.data.mailing.getAttr("id");this.data.mailingsStats=new Mimi.Mailings.MailingStats(t,e)},initObservers:function(){this.$element.on("click",_.bind(this.onClick,this)),this.$element.on("keydown",_.bind(this.onKeydown,this)),this.data.mailing.observe("mailing:save:started",_.bind(this.onMailingSaveStarted,this)),this.data.mailing.observe("mailing:save:completed",_.bind(this.onMailingSaveCompleted,this)),this.data.mailing.observe("mailing:save:successful",_.bind(this.onMailingSaveSuccess,this)),this.data.mailing.observe("mailing:save:failed",_.bind(this.onMailingSaveFailure,this)),this.data.mailing.observe("mailing:send:started",_.bind(this.onMailingSendStarted,this)),this.data.mailing.observe("mailing:send:completed",_.bind(this.onMailingSendCompleted,this)),this.data.mailing.observe("mailing:send:successful",_.bind(this.onMailingSendSuccess,this)),this.data.mailing.observe("mailing:send:failed",_.bind(this.onMailingSendFailure,this)),this.data.mailing.observe("mailing:cancel:started",_.bind(this.onMailingCancelStarted,this)),this.data.mailing.observe("mailing:cancel:completed",_.bind(this.onMailingCancelCompleted,this)),this.data.mailing.observe("mailing:cancel:successful",_.bind(this.onMailingCancelSuccess,this)),this.data.mailing.observe("mailing:cancel:failed",_.bind(this.onMailingCancelFailure,this)),this.data.mailing.observe("mailing:schedule:started",_.bind(this.onMailingScheduleStarted,this)),this.data.mailing.observe("mailing:schedule:completed",_.bind(this.onMailingScheduleCompleted,this)),this.data.mailing.observe("mailing:schedule:successful",_.bind(this.onMailingScheduleSuccess,this)),this.data.mailing.observe("mailing:schedule:failed",_.bind(this.onMailingScheduleFailure,this)),this.data.mailing.observe("mailing:invalid",_.bind(this.onMailingInvalid,this)),Mimi.Mailings.overAudienceLimit&&(this.data.mailing.observe("mailing:extra_recipients:over_limit",_.bind(this.onMailingRecipientsOverLimit,this)),this.data.mailing.observe("mailing:extra_recipients:not_over_limit",_.bind(this.onMailingRecipientsNotOverLimit,this))),window.tabs.observe("tab:switched",_.bind(this.onTabsSwitched,this)),this.data.schedule.observe("schedule:delete:failure",_.bind(this.onScheduleFailure,this)),this.data.schedule.observe("schedule:delete:error",_.bind(this.onScheduleError,this)),this.data.sendingDialog.observe("mailing:send:cancel",_.bind(this.onCancelMailing,this)),t(document).on("mailings:calendar:valid",_.bind(this.onCalendarValid,this)),t(document).on("mailings:calendar:invalid",_.bind(this.onCalendarInvalid,this)),this.dom.$recipientsContainer.on("submit",_.bind(this.onRecipientsSubmit,this)),t("#send_from_email").on("keyup",_.bind(this.showDmarcToolTip,this)),Mimi.Mailings.isScheduled&&this.dom.tabs.$scheduleContinuebtn.on("click",_.bind(this.onScheduleContinue,this)),this.data.filterDialog&&this.data.filterDialog.observe("mailing:filter:save",_.bind(this.onMailingListFiltered,this)),t(document).on("mailing:list:count:successful",_.bind(this.onMailingListCountSuccessful,this)),t(document).on("mailing:list:count:failed",_.bind(this.onMailingListCountFailed,this))},onMailingListFiltered:function(t,e){var i=e.listItem,s=e.filter;this.markListItemAsIncluded(i,!0),s?i.setFilter(s):i.resetFilter(),Mimi.Mailings.filters[i.getListId()]=s,this.data.filters[i.getListId()]=s},onMailingListCountSuccessful:function(){this.updateMailingData(),this.data.mailing.invalidateLists(),this.data.mailing.setSummary()},onMailingListCountFailed:function(t,e){var i=e.reason||e.error||"";Widget.MimiFlash.error(I18n.t("MimiFlash.mailings.new_dashboard.onMailingListCountFailed")+" "+i)},initDisplay:function(){this.data.mailing.isAllAudience()?this.toggleSelectAll():this.markIncludedLists(),this.markExcludedLists(),this.setSingleEmails(),Mimi.Mailings.isScheduled||this.removeRecipientsBackbtn(),this.updateUiFromTabState()},revealPageElements:function(){t("[data-action=show_on_load]").css({visibility:"visible"})},initListItems:function(){var e=this;t(Mimi.Mailings.NewDashboard.DOM.lists["class"]).each(function(i,s){var n=t(s).attr("id");e.data.lists[n]=new Mimi.Mailings.List(n)})},showDmarcToolTip:function(){this.isYahooFromAddress()?t("#send_from_email").addClass("bad-sender"):t("#send_from_email").removeClass("bad-sender")},onScheduleContinue:function(){var t=Mimi.Mailings.Calendar.get();return this.data.calendarValid?void(this.data.calendarValid===!1?this.onCalendarInvalid():this.data.calendarValid===!0?this.onCalendarValid():null===this.data.calendarValid&&this.dom.tabs.$scheduleContinuebtn.addClass("disabled").html(I18n.t("js.mailings.new_dashboard.onScheduleContinue"))):void t.validateDate()},onMailingRecipientsOverLimit:function(){var t=!1;if(this.toggleDashboardActions(t),!this.data.warnedAboutLimit){var e=_.template(I18n.t("MimiFlash.mailings.new_dashboard.onMailingRecipientsOverLimit")),i=e({limit_number:Mimi.Mailings.singleEmailLimit});Widget.MimiFlash.stickyError(i),this.data.warnedAboutLimit=!0}},onMailingRecipientsNotOverLimit:function(){var t=!0;this.toggleDashboardActions(t)},onCalendarInvalid:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.mailings.new_dashboard.onCalendarInvalid")),this.dom.tabs.$scheduleContinuebtn.removeClass("disabled").html(I18n.t("js.mailings.new_dashboard.onCalendarInvalid")),this.data.calendarValid=!1},onCalendarValid:function(){if(this.data.calendarValid)return void window.tabs.nextTab();this.dom.tabs.$scheduleContinuebtn.removeClass("disabled").html(I18n.t("js.mailings.new_dashboard.onCalendarValid"));var t=this.data.schedule.getScheduleInput();this.data.mailing.setClientSchedule(t),this.data.mailing.setSummarySchedule(),this.data.calendarValid=!0},onTabsSwitched:function(){this.updateUiFromTabState()},onKeydown:function(t){var e=t.keyCode?t.keyCode:t.which;if(13===e)this.onEnterDown(t);else{var i=String.fromCharCode(t.which||t.keyCode).toLowerCase();if("s"===i&&(t.ctrlKey||t.metaKey)&&!t.altKey)return this.saveMailingData(!0),!1}},onEnterDown:function(){return this.data.untitledSubjectWarningDialog.visible()?(this.changeUntitledSubject(),!1):void 0},onMailingInvalid:function(t,e){var i=e.invalid;if(i){this.data.preppingSendOverlay.hide();var s=I18n.t("MimiFlash.mailings.new_dashboard.onMailingInvalid")+"\n";_.each(i,function(t,e){_.each(t,function(t){s+=this.humanizeKey(e)+" "+t+"\n"},this)},this),Widget.MimiFlash.error(s),this.chooseInvalidTab(i)}},chooseInvalidTab:function(e){Mimi.Mailings.isScheduled&&_.size(e.schedule)>0?window.tabs.show(t("#new_mailing_tabs .schedules_tab")[0]):_.size(e.recipients)>0||_.size(e["additional recipients"])>0?window.tabs.show(t("#new_mailing_tabs .recipients_tab")[0]):_.any(["name","email","address","subject"],function(t){return _.size(e[t])>0})&&window.tabs.show(t("#new_mailing_tabs .details_tab")[0])},onDashboardSave:function(){var t=!1;this.data.preppingSendOverlay.show(),this.saveMailingData(t)&&this.data.preppingSendOverlay.hide()},onMailingSendStarted:function(){this.data.text.buttons.disabled=I18n.t("js.mailings.new_dashboard.onMailingSendStarted");var t=!1;this.toggleDashboardActions(t)},onMailingSendCompleted:function(){this.data.text.buttons.disabled=I18n.t("js.mailings.new_dashboard.onMailingSendCompleted");var t=!0;this.toggleDashboardActions(t)},onMailingSendSuccess:function(t,e){if(this.data.sendDialog.hide(),e.needsApproval){var i=new Widget.Popup("#new_sender_without_url_dialog",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1});i.show()}else this.data.sendingDialog.setTitle(I18n.t("js.mailings.new_dashboard.onMailingSendSuccess")+' "'+this.data.mailing.getAttr("subject")+'"'),this.data.sendingDialog.show(),this.pollMailingStatus()},onMailingSendFailure:function(t,e){var i=e.reason,s=e.code;this.isApprovalMessage(s)?(this.data.sendDialog.hide(),this.data.newSenderExplanationDialog.setMailingId(e.mailingId),this.data.newSenderExplanationDialog.show()):this.isOverTestSendLimitMessage(s)?(this.data.sendDialog.hide(),this.data.exceededTestSendsDialog.show()):this.isOverCreditLimitMessage(s)?null==Mimi.User.shopper_id?this.simpleUpgrade.show(i):(this.data.sendDialog.hide(),this.data.upgradeDialog.show()):Widget.MimiFlash.error(I18n.t("MimiFlash.mailings.new_dashboard.onMailingSendFailure")+" "+i)},onMailingCancelStarted:function(){this.data.text.buttons.disabled=I18n.t("js.mailings.new_dashboard.onMailingCancelStarted");var t=!1;this.toggleDashboardActions(t)},onMailingCancelCompleted:function(){this.data.text.buttons.disabled=I18n.t("js.mailings.new_dashboard.onMailingCancelCompleted");var t=!0;this.toggleDashboardActions(t)},onMailingCancelSuccess:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.mailings.new_dashboard.onMailingCancelSuccess"))},onMailingCancelFailure:function(t,e){var i=e.reason;Widget.MimiFlash.error(I18n.t("MimiFlash.mailings.new_dashboard.onMailingCancelFailure")+" "+i)},isApprovalMessage:function(t){return t==Mimi.MailingValidationErrors.approvalMessage},isOverTestSendLimitMessage:function(t){return t==Mimi.MailingValidationErrors.overTestSendLimitMessage},isOverCreditLimitMessage:function(t){return t==Mimi.MailingValidationErrors.overCreditLimitMessage},onMailingScheduleStarted:function(){this.data.text.buttons.disabled=I18n.t("js.mailings.new_dashboard.onMailingScheduleStarted");var t=!1;this.toggleDashboardActions(t)},onMailingScheduleCompleted:function(){this.data.text.buttons.disabled=I18n.t("js.mailings.new_dashboard.onMailingScheduleCompleted")},onMailingScheduleSuccess:function(){window.location=Mimi.Mailings.paths.promotions},onMailingScheduleFailure:function(t,e){var i=e.error||"",s=!0;this.toggleDashboardActions(s),Widget.MimiFlash.error(I18n.t("MimiFlash.mailings.new_dashboard.onMailingScheduleFailure")+" "+i)},onScheduleFailure:function(t){Widget.MimiFlash.error(I18n.t("MimiFlash.mailings.new_dashboard.onScheduleFailure")+" "+t)},onScheduleError:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.mailings.new_dashboard.onScheduleError"))},isOverCreditLimit:function(){return this.data.mailing.isOverCreditLimit()},isOverAudienceLimit:function(){if(!Mimi.Mailings.overAudienceLimit)return!1;var t=this.$selectAllbtn(),e=t?t.hasClass(Mimi.Mailings.css.selected):!1;return this.data.mailing.getAudienceMembersCount()<=5&&0===this.includedLists().length&&!e?!1:!0},onDashboardSaveCompleted:function(){try{this.data.preppingSendOverlay.visible()&&(this.data.preppingSendOverlay.hide(),this.updateSendDialog(),this.isOverAudienceLimit()?this.handleOverAudienceLimit():this.isOverCreditLimit()?this.handleOverCreditLimit():(this.simpleUpgrade.reset(),this.data.sendDialog.show()))}catch(t){}},onMailingSaveFailure:function(t,e){this.data.preppingSendOverlay.visible()&&this.data.preppingSendOverlay.hide(),Widget.MimiFlash.error(I18n.t("MimiFlash.mailings.new_dashboard.onMailingSaveFailure")+" "+e.error)},onClick:function(t){this.tryHandleListItemAction(t),this.tryHandleDashboardAction(t)},pollMailingStatus:function(){var e=this.data.mailing.getAttr("promotion_id"),i=this.data.mailing.getAttr("id"),s="/promotions/"+e+"/mailings/"+i+".json",n=setInterval(function(){t.get(s).done(function(t){t.stats_available&&(clearInterval(n),window.location=Mimi.Mailings.paths.stats)})},3e3)},handleOverAudienceLimit:function(){var t="/mailing/audience/limit";this.$element.attr("data-mimi-upgrade",t),Mimi.Mailings.freeUser&&null==Mimi.User.shopper_id?this.data.upgradeDialog.show(this.$element):(this.data.upgradeDialog.show(),Mimi.TrackEvent.track("upgrade_dialog_shown","audience_packs"))},handleOverCreditLimit:function(){Mimi.Mailings.childUser?this.showChildNoCreditsDialog():Mimi.Mailings.freeUser&&null==Mimi.User.shopper_id?this.showUpgradeFromFreeDialog():this.showPurchaseCreditsDialog()},showChildNoCreditsDialog:function(){this.data.childNoCreditsDialog.show()},showPurchaseCreditsDialog:function(){t("#credit_shortage").html(this.data.mailing.creditShortage().formatThousands()),this.data.purchaseCreditsDialog.show()},showUpgradeFromFreeDialog:function(){var t="/mailing/credits/limit";this.$element.attr("data-mimi-upgrade",t),this.data.upgradeCreditsDialog.show(this.$element)},onMailingSaveStarted:function(){var t=!1;this.toggleDashboardActions(t)},onMailingSaveCompleted:function(){var t=!0;this.toggleDashboardActions(t),this.onDashboardSaveCompleted()},onMailingSaveSuccess:function(){this.data.display.success&&Widget.MimiFlash.create(I18n.t("MimiFlash.mailings.new_dashboard.onMailingSaveSuccess")),this.data.display.success=!0},onCancelMailing:function(){this.data.mailing.cancelSend(),this.data.pe&&this.data.pe.stop()},onRecipientsSubmit:function(){return this.saveMailingData(!1),!1},removeRecipientsBackbtn:function(){this.dom.tabs.$detailsBackbtn.hide()},$currentTab:function(){var e=t(Mimi.Mailings.NewDashboard.DOM.tabs.id);return e.find("li.current")},isDetailsTab:function(){return this.$currentTab().hasClass("details_tab")},isRecipientsTab:function(){return this.$currentTab().hasClass("recipients_tab")},isSchedulesTab:function(){return this.$currentTab().hasClass("schedules_tab")},updateUiFromTabState:function(){var e=t("#preview").find(".actions"),i=e.find(".next_tab"),s=e.find(".send_preview");if(this.isDetailsTab())i.hide(),s.show(),this.trySetAutoCompleteDisplay(!1),this.showDmarcToolTip();else if(this.isRecipientsTab()||this.isSchedulesTab()){if(i.show(),s.hide(),this.isRecipientsTab())try{this.initAutoComplete()}catch(n){}this.trySetAutoCompleteDisplay(!0)}else this.trySetAutoCompleteDisplay(!1)},trySetAutoCompleteDisplay:function(t){try{this.data.autoComplete.setDisplayAutoComplete(t)}catch(e){}},toggleDashboardActions:function(e){var i=t(".dashboard-action"),s=this;i.each(e?function(e,i){"save"===t(i).attr("data-action")&&t(i).html(s.data.text.buttons.enabled),t(i).removeClass("disabled")
}:function(e,i){"save"===t(i).attr("data-action")&&t(i).html(s.data.text.buttons.disabled),t(i).addClass("disabled")})},tryHandleDashboardAction:function(e){var i=t(e.target).closest(".dashboard-action");if(i[0]){this.data.mailing.setPublish("publish"===i.attr("data-meta"));var s=i.attr("data-action");switch(s){case"select_all":e.die(),this.toggleSelectAll(),this.isOverAudienceLimit()&&(this.data.upgradeDialog.show(),Mimi.TrackEvent.track("upgrade_dialog_shown","audience_packs"),this.uncheckSelectAll());break;case"save-recipients":e.die(),this.saveMailingData(!1);break;case"save":e.die(),this.saveMailingData(!0);break;case"send-preview":e.die(),this.data.display.success=!1,this.checkUntitledSubjectOrSave();break;case"send-preview-skip-yahoo":this.checkUntitledSubjectOrSave();break;case"send-preview-skip-untitled-warning":e.die(),this.hideUntitledWarningDialog(),this.onDashboardSave();break;case"change-untitled-subject":e.die(),this.changeUntitledSubject()}}},isYahooFromAddress:function(){var t=this.data.mailing.getFormAttr("email");return Mimi.DmarcAddress.isMatch(t)},checkUntitledSubjectOrSave:function(){this.hasUntitledSubject()?this.showUntitledWarningDialog():this.onDashboardSave()},hasUntitledSubject:function(){var t=this.data.mailing.getFormAttr("subject");return _.startsWith(t,I18n.t("js.models.promotion.default_name"))},showUntitledWarningDialog:function(){var t=this.data.mailing.getFormAttr("subject");this.data.untitledSubjectWarningDialog.show(t)},hideUntitledWarningDialog:function(){this.data.untitledSubjectWarningDialog.hide()},changeUntitledSubject:function(){var t=this.data.untitledSubjectWarningDialog.getSubject();this.data.mailing.setAttr("subject",t),this.data.mailing.setFormSubject(),this.data.mailing.setSummarySubject(),this.hideUntitledWarningDialog(),this.onDashboardSave()},updateSendDialog:function(){this.data.sendDialog.updateUI()},saveMailingData:function(t){return this.updateMailingData(),this.data.mailing.save(t)},updateMailingData:function(){var t=this.data.mailing;if(t.setIncludedLists(this.includedLists()),t.setExcludedLists(this.excludedLists()),t.setFilters(this.filters()),t.setSummaryTo(),this.data.schedule.isScheduled()){var e=this.data.schedule.getScheduleInput();t.setClientSchedule(e)}},tryHandleListItemAction:function(e){var i=t(e.target).closest(".list-action");if(i[0]){var s=i.attr("data-value"),n=i.attr("data-action"),o=this.findList(s);return"add"===n?(e.die(),this.markListItemAsIncluded(o)):"remove"===n?(e.die(),this.markListItemAsExcluded(o)):"filter"===n&&this.showListItemFilterDialog(o),this.updateMailingData(),this.data.mailing.setSummary(),!1}},$selectAllbtn:function(){return this.dom.lists.$selectAll[0]?this.dom.lists.$selectAll.find(".list-action[data-action=select_all]"):null},toggleSelectAll:function(){var t=this.$selectAllbtn();if(t){var e=!t.hasClass(Mimi.Mailings.css.selected);e?(t.addClass(Mimi.Mailings.css.selected),setTimeout(function(){t.prop("checked",!0)},10),this.data.mailing.setAllAudience(!0),_.each(this.listItems(),function(t){t.disableCheck()})):(t.removeClass(Mimi.Mailings.css.selected),setTimeout(function(){t.prop("checked",!1)},10),this.data.mailing.setAllAudience(!1),_.each(this.listItems(),function(t){t.enableCheck()}))}this.updateMailingData(),this.data.mailing.setSummary()},uncheckSelectAll:function(){var t=this.$selectAllbtn().hasClass(Mimi.Mailings.css.selected);t&&this.toggleSelectAll()},markExcludedLists:function(){var t=this;_.each(Mimi.Mailings.excludedLists,function(e){var i=t.findList(e);i&&i.markAsExcluded()})},markIncludedLists:function(){var t=this;_.each(Mimi.Mailings.includedLists,function(e){var i=t.findList(e);i&&i.markAsChecked()})},markListItemAsIncluded:function(t,e){t.markAsChecked(e),t.isIncluded()&&this.isOverAudienceLimit()&&(this.handleOverAudienceLimit(),t.markAsUnchecked()),this.invalidateListItemFilters(t)},markListItemAsExcluded:function(t){t.markAsExcluded(),this.invalidateListItemFilters(t)},showListItemFilterDialog:function(t){this.data.filterDialog&&(this.data.filterDialog.setListItem(t),this.data.filterDialog.show())},setSingleEmails:function(){this.dom.$singleEmails.val(Mimi.Mailings.singleEmails)},listItems:function(){return _.values(this.data.lists)},includedLists:function(){var t=[];return _.each(this.listItems(),function(e){e.isIncluded()&&t.push(e)}),t},excludedLists:function(){var t=[];return _.each(this.listItems(),function(e){e.isExcluded()&&t.push(e)}),t},findList:function(t){return this.data.lists["list_"+t]},filters:function(){return Mimi.Mailings.filters},invalidateListItemFilters:function(t){if(!t.isIncluded()){var e=t.getListId();Mimi.Mailings.filters[e]&&delete Mimi.Mailings.filters[e],t.resetFilter()}},humanizeKey:function(e){var i=I18n.t("js.audience.new_dashboard.humanizeKey."+e);if(i.match(/missing.*translation/)){var s=e.match(/((?:^|[A-Z _-])[^A-Z _-]+)/g),n=t.map(s,function(t,e){return _[0==e?"capitalize":"decapitalize"](t)});return n.join(" ")}return i}}).singleton(),Mimi.Mailings.NewDashboard.DOM={tabs:{id:"#new_mailing_tabs",scheduleContinuebtn:".schedule_continue_btn",detailsBackbtn:".recipients_back_btn"},lists:{"class":".list_item_actionable",selectAll:".select_all"},recipientsContainer:"#recipients",singleEmails:"#audience_members",newMailingDashboard:"#new_mailing_dashboard"}}(jQuery),function(t){Mimi.Mailings.List=Class.create(Widget.Observer,Widget.Observable,{initialize:function(e){this.$element=t("#"+e),this.initDom(),this.initData()},initData:function(){this.data={},this.setListId(),this.setListName(),this.setListSize(),this.setState(Mimi.Mailings.state.unselected)},initDom:function(){this.dom={$includeButton:this.$element.find("span.list-action[data-action=add]"),$filterButton:this.$element.find("span.list-action[data-action=filter]"),$excludeButton:this.$element.find("span.list-action[data-action=remove]"),$statusIcon:this.$element.find("span.list[data-action=status]")}},toggleCheck:function(t){!t&&this.dom.$includeButton.hasClass(Mimi.Mailings.css.selected)?(this.dom.$includeButton.removeClass(Mimi.Mailings.css.selected),this.setState(Mimi.Mailings.state.unselected)):(this.setState(Mimi.Mailings.state.included),this.dom.$includeButton.addClass(Mimi.Mailings.css.selected))},toggleExclude:function(){this.dom.$excludeButton.hasClass(Mimi.Mailings.css.selected)?(this.setState(Mimi.Mailings.state.unselected),this.dom.$excludeButton.removeClass(Mimi.Mailings.css.selected)):(this.setState(Mimi.Mailings.state.excluded),this.dom.$excludeButton.addClass(Mimi.Mailings.css.selected))},setListId:function(){this.data.listId=this.$element.data("value")},getListId:function(){return this.data.listId},getListSize:function(){return this.data.listSize},setListSize:function(t){void 0===t&&(t=this.$element.data("count")),this.data.listSize=t},getListName:function(){return this.data.listName},setListName:function(){this.data.listName=this.$element.data("name")},setState:function(t){this.data.state=t,this.clearStatusIcon(),this.isIncluded()?this.dom.$statusIcon.addClass(Mimi.Mailings.css.included):this.isExcluded()?this.dom.$statusIcon.addClass(Mimi.Mailings.css.excluded):this.isUnselected()&&this.dom.$statusIcon.addClass(Mimi.Mailings.css.unselected)},getFilter:function(){return this.data.filter},resetFilter:function(){this.data.filter=null,this.fetchCount()},setFilter:function(t){this.data.filter=t,this.fetchCount()},asHash:function(){return{id:this.getListId(),size:this.getListSize(),name:this.getListName()}},clearState:function(){var t=Mimi.Mailings.css,e=t.selected+" "+t.disabled;this.setState(Mimi.Mailings.state.unselected),this.dom.$includeButton.removeClass(e),this.dom.$excludeButton.removeClass(e)},clearStatusIcon:function(){this.dom.$statusIcon.removeClass(Mimi.Mailings.css.excluded),this.dom.$statusIcon.removeClass(Mimi.Mailings.css.included),this.dom.$statusIcon.removeClass(Mimi.Mailings.css.unselected)},isIncluded:function(){return this.data.state===Mimi.Mailings.state.included},isExcluded:function(){return this.data.state===Mimi.Mailings.state.excluded},isUnselected:function(){return this.data.state===Mimi.Mailings.state.unselected},isFiltered:function(){return!!this.getFilter()},markAsChecked:function(t){t!==!0&&(t=!1),this.toggleCheck(t),this.dom.$excludeButton.removeClass(Mimi.Mailings.css.selected)},markAsUnchecked:function(){this.clearState(),this.dom.$includeButton.removeClass(Mimi.Mailings.css.selected)},markAsExcluded:function(){this.toggleExclude(),this.dom.$includeButton.removeClass(Mimi.Mailings.css.selected)},disableCheck:function(){this.dom.$includeButton.addClass("disabled"),this.dom.$filterButton.addClass("disabled")},enableCheck:function(){this.dom.$includeButton.removeClass("disabled"),this.dom.$filterButton.removeClass("disabled")},fetchCount:function(){var e=Mimi.Mailings.paths.list_size.replace("#{id}",this.getListId()),i={};this.isFiltered()&&(i={"filter[]":this.getFilter()}),t.get(e,i).done(_.bind(this.onFetchCountSuccess,this)).fail(_.bind(this.onFetchCountFailure,this))},onFetchCountSuccess:function(t){var e=t.result.list_size;this.$element.find("span.count").html(e),this.setListSize(e),this.fire("mailing:list:count:successful")},onFetchCountFailure:function(){this.fire("mailing:list:count:failed")}}),Mimi.Mailings.css={selected:"selected",included:"list-selected",excluded:"list-removed",unselected:"list-unselected",disabled:"disable"},Mimi.Mailings.state={included:"included",excluded:"excluded",unselected:"unselected"}}(jQuery),function(t){Mimi.Mailings.SendDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("#send_dialog"),this.initDom(),this.initDialog(),this.initObservers(),this.initData(),this.initSuppressedMembersWindow()},initData:function(){this.data={mailing:null}},initObservers:function(){this.$element.on("click",".send-dialog-action",_.bind(this.onClick,this))},initDom:function(){this.dom=this.$element.getChildren(Mimi.Mailings.SendDialog.DOM)},initDialog:function(){this.dialog=new Widget.Popup("#send_dialog",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1})},initSuppressedMembersWindow:function(){this.suppressedMembersWindow=new Widget.Popup("#suppressed_members_window",{hideTrigger:".window_close, .continue",overlay:Widget.ModalOverlay,fixedPosition:!1,onHidden:_.bind(this.show,this)})},onClick:function(e){var i=t(e.currentTarget).attr("data-action");return"cancel"===i?this.triggerCancel():"send"===i&&this.triggerSend(),!1},setMailing:function(t){this.data.mailing=t},updateUI:function(){this.setFrom(),this.setSubject(),this.setTo(),this.setNotTo(),this.setSchedule(),this.setSendbtnText(),this.showOrHideCreditRequirement()},setSendbtnText:function(){var t,e;Mimi.Mailings.isScheduled?(t='<svg class=\'iconsvg svg_schedule\' viewBox=\'0 0 16 16\' aria-hidden=\'true\'>    <path fill-rule="evenodd" d="M15.4 8.5a7 7 0 1 0-14 0 7 7 0 0 0 14 0zm-12.25 0a5.25 5.25 0 1 1 10.5 0 5.25 5.25 0 0 1-10.5 0z" id="dial"/> <path d="M4.933 5.923s.19-.55.574-.87c.383-.322.958-.415.958-.415l3.29 3.92s-.216.735-.565 1.027c-.348.293-.967.26-.967.26l-3.29-3.922z" id="finger"/> <path d="M10.27 5.525s.516.22.838.603c.32.383.448.93.448.93L8.21 9.864s-.687-.256-.98-.604c-.29-.348-.306-.927-.306-.927l3.346-2.808z" id="thumb"/>\n</svg>',e=I18n.t("js.mailings.send_dialog.setSendBtnText.schedule")):(t='<svg class=\'iconsvg svg_send\' viewBox=\'0 0 16 16\' aria-hidden=\'true\'>    <path d="M1 9.607l13.25-8.274-9.582 9.794.33 2.452.875-1.924L15 1l-3.487 12.58L7.6 12.136 4.67 15l-1.06-4.24L1 9.608z" id="send"/><path d="M2.67 7.36l11.58-6.027-9.582 9.794.33 2.452.875-1.924L15 1l-3.687 10.127-3.712 1.01L4.67 15l-1.06-4.24-.94-3.4z" id="send_fold" opacity="0"/>\n</svg>',e=I18n.t("js.mailings.send_dialog.setSendBtnText.send")),this.dom.buttons.$send.html(t+"<span>"+e+"</span>")},showOrHideCreditRequirement:function(){this.dom.$requiredCreditWarning&&(Mimi.Mailings.unlimitedCredits?this.dom.$requiredCreditWarning.hide():this.dom.$requiredCreditWarning.show())},setSubject:function(){this.dom.$subject.html(this.data.mailing.getAttr("subject"))},setFrom:function(){var t=this.data.mailing.getAttr("from_name"),e=this.data.mailing.getAttr("from_email");this.dom.$from.html('"'+t+'", '+e)},setTo:function(){this.dom.$to.html(this.data.mailing.getTo()),this.performHardCount()},setNotTo:function(){var t=this.data.mailing.getNotTo().trim();0===t.length?this.dom.$notToField.hide():this.dom.$notToField.show(),this.dom.$notTo.html(t)},setSchedule:function(){var t=!0,e=this.data.mailing.getClientSchedule(t);Mimi.Mailings.Calendar.timezone&&(e+=" "+Mimi.Mailings.Calendar.timezone),Mimi.Mailings.isScheduled?this.dom.$scheduleField.show():this.dom.$scheduleField.hide(),this.dom.$schedule.html(e)},triggerSend:function(){Mimi.Mailings.isScheduled?this.data.mailing.schedule():this.data.mailing.send()},triggerCancel:function(){this.dialog.hide()},show:function(){this.dialog.show()},hide:function(){this.dialog.hide()},performHardCount:function(){this.data.mailing.data.attributes.hard_count_allowed&&(this.dom.$totalToField.show(),t.get(Mimi.Mailings.paths.audience_count+".json").done(_.bind(this.onPerformHardCountSuccess,this)).fail(_.bind(this.onPerformHardCountFailure,this)))},onPerformHardCountSuccess:function(t){var e=t.result.total_count;this.dom.$requiredCreditCount.html(e),this.dom.$total.html("<span class='count'>"+e+"</span>"),this.checkForSuppressed(e)},onPerformHardCountFailure:function(){this.dom.$totalToField.hide(),this.dom.$requiredCreditCount.html(I18n.t("js.mailings.send_dialog.onPerformHardCountFailure"))},checkForSuppressed:function(e){var i=this.data.mailing.data.attributes.suppressed_members,s=i?i.length:0;if(s>0){var n=_.template(I18n.t("js.mailings.send_dialog.checkForSuppressed")),o=n({number:"<span class='count'>"+(e+s)+"</span>",suppressed_number:"<span class='count'>"+s+"</span>"});o+=' <span id=suppressed_members><svg class=\'iconsvg svg_pencil\' viewBox=\'0 0 16 16\' aria-hidden=\'true\'>    <path d="M3.604 9.81l2.83 2.828L12.2 6.87 9.372 4.043 3.604 9.81zM10.3 3.114l2.83 2.828 1.647-1.648-2.83-2.828L10.3 3.114zM2.392 13.85l3.062-.233-2.828-2.83-.234 3.063z" id="pencil"/><path d="M.6 14h7.5a.5.5 0 0 0 0-1H.6a.5.5 0 0 0 0 1z" id="line" opacity="0"/>\n</svg></span>',this.dom.$total.html(o),t("#suppressed_members").on("click",_.bind(this.showSuppressedMembersWindow,this))}},showSuppressedMembersWindow:function(){this.hide(),this.suppressedMembersWindow.show(),this.populateSuppressedMembersTable()},populateSuppressedMembersTable:function(){var e=this.data.mailing.data.attributes.suppressed_members,i=t("#suppressed_members_window table tbody"),s=Template.from("suppressed_member_table_row");i.html("");var n=this;_.each(e,function(t){var e={email:t.email,name:t.name,id:t.id};i.append(s(e));var o=i.find("a").last();o.on("click",_.bind(n.unsuppress,n))})},unsuppress:function(e){var i=this.getMember(t(e.target).closest("a")),s=Mimi.Audience.Dashboard.Add.get(),n=s.suppressionReasonSentence(i.reason);return this.memberId=i.id,this.unsuppressDialog||(this.unsuppressDialog=new Widget.ConfirmDialog(I18n.t("MimiFlash.mailings.send_dialog.unsuppress.title"),I18n.t("MimiFlash.mailings.send_dialog.unsuppress.body")+"<p class='info'>"+n+"</p>",{onOk:_.bind(this.onUnsuppressOk,this),onHide:_.bind(this.suppressedMembersWindow.show,this.suppressedMembersWindow)},I18n.t("MimiFlash.mailings.send_dialog.unsuppress.button"))),this.unsuppressDialog.show(),this.hideSuppressedMembersWindow(),!1},hideSuppressedMembersWindow:function(){this.suppressedMembersWindow.options.onHidden=_.bind(Widget.ModalOverlay.show,this),this.suppressedMembersWindow.hide(),this.suppressedMembersWindow.options.onHidden=_.bind(this.show,this)},onUnsuppressOk:function(){t.ajax({url:"/suppressed_audience_members/"+this.memberId,type:"delete"}).fail(_.bind(this.onUnsuppressFailed,this)).always(_.bind(this.onUnsuppressComplete,this))},onUnsuppressFailed:function(t){Widget.MimiFlash.error(I18n.t("MimiFlash.mailings.send_dialog.onUnsuppressFailed")+" "+t)},onUnsuppressComplete:function(t){t.success?(Widget.MimiFlash.create(t.result.email+" "+I18n.t("MimiFlash.mailings.send_dialog.onUnsuppressComplete.success")),this.removeMemberFromTable(t.result.id),this.saveMailing()):Widget.MimiFlash.error(I18n.t("MimiFlash.mailings.send_dialog.onUnsuppressComplete.fail"))},removeMemberFromTable:function(e){var i=t('#suppressed_members_window a[data-value="'+e+'"]').closest("tr");i.remove(),0===t("#suppressed_members_window table tbody tr").size()&&this.suppressedMembersWindow.hide()},saveMailing:function(){Mimi.Mailings.NewDashboard.get().data.display.success=!1,this.dom.$total.html('<img src="https://d1lggihq2bt4jo.cloudfront.net/assets/img/loading.gif" alt="Loading...">'),this.data.mailing.save(),this.data.mailing.observe("mailing:save:completed",_.bind(this.setTo,this))},getMember:function(e){var i=this.data.mailing.data.attributes.suppressed_members;return _.detect(i,function(i){return i.id===t(e).data("value")})}}).singleton(),Mimi.Mailings.SendDialog.DOM={buttons:{send:"button[type=submit].send-dialog-action",cancel:"a.cancel"},subject:".subject",from:".from",to:".to",notTo:".not_to",notToField:".not_to_field",total:".total_to",totalToField:".total_to_field",schedule:".schedule",scheduleField:".schedule_field",requiredCreditWarning:".credit_requirement",requiredCreditCount:".credits_required"}}(jQuery),function(t){Mimi.Mailings.NewSenderExplanationDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("#new_sender_explanation_dialog"),this.dom=this.$element.getChildren(Mimi.Mailings.NewSenderExplanationDialog.DOM),this.initDialog(),this.initObservers()},initObservers:function(){this.dom.$submit.on("click",_.bind(this.onSubmitClick,this)),this.dom.$noPresence.on("click",_.bind(this.showNoPresence,this)),this.dom.$websiteInput.on("change keyup paste",_.bind(this.checkUrlValidation,this))},initDialog:function(){this.dialog=new Widget.Popup("#new_sender_explanation_dialog",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1})},showNoPresence:function(){if(this.dom.$noPresence.is(":checked")){var t=I18n.t("js.mailings.new_sender.continue");this.dom.$submit.removeClass("disabled"),this.dom.$websiteInput.prop("disabled",!0).val("")}else{var t=I18n.t("js.mailings.new_sender.submit");this.checkUrlValidation(),this.dom.$websiteInput.prop("disabled",!1)}this.dom.$submit.text(t)},checkUrlValidation:function(){""!=this.dom.$websiteInput.val()?this.dom.$submit.removeClass("disabled"):this.dom.$submit.addClass("disabled")},onSubmitClick:function(){return this.dom.$submit.addClass("disabled"),this.dom.$form.submit(),!1},setMailingId:function(t){this.dom.$mailingId.val(t)},show:function(){this.dialog.show()}}).singleton(),Mimi.Mailings.NewSenderExplanationDialog.DOM={form:"form",mailingId:"#mailing_id",websiteInput:"#website_input_field",noPresence:"#no_presence",textarea:"textarea",submit:"a.submit"}}(jQuery),function(t){Mimi.Mailings.ExceededTestSendsDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("#exceeded_test_sends_dialog"),this.initDialog(),this.initObservers()},initObservers:function(){this.$element.on("click",".sending-dialog-action",_.bind(this.onClick,this))},initDialog:function(){this.dialog=new Widget.Popup("#exceeded_test_sends_dialog",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1})},onClick:function(e){var i=t(e.currentTarget).data("action");return"close"===i?(t(this).find("span").html("Going..."),t(this).addClass("disabled"),window.location="/promotions",!1):void 0},show:function(){this.dialog.show()}}).singleton()}(jQuery),function(t){Mimi.Mailings.SendingDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("#send_promotion_dialog"),this.initDom(),this.initDialog(),this.initObservers()},initObservers:function(){this.$element.on("click",".sending-dailog-action",_.bind(this.onClick,this))},initDom:function(){this.dom=this.$element.getChildren(Mimi.Mailings.SendingDialog.DOM)},initDialog:function(){this.dialog=new Widget.Popup("#send_promotion_dialog",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1})},onClick:function(e){var i=t(e.currentTarget).attr("data-action");return"cancel_mailing"===i?(this.dialog.hide(),this.fire("mailing:send:cancel"),!1):void 0},show:function(){this.dialog.show()},setTitle:function(t){this.dom.$windowTitle.html(t)}}).singleton(),Mimi.Mailings.SendingDialog.DOM={buttons:{close:"a.cancel"},windowTitle:".window_title",statsLink:"a.promo_stats_link"}}(jQuery),function(t){Mimi.Mailings.FilterDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=t("#filter_dialog"),this.initTemplates(),this.initDom(),this.initObservers(),this.initDialog(),this.initData(),this.initUI()},initTemplates:function(){this.templates={list:Template.from("filter_dialog_list_template"),listGroup:Template.from("filter_dialog_list_group_template"),listGroupItem:Template.from("filter_dialog_list_group_item_template")}},initData:function(){this.data={listItem:null,lists:Mimi.Mailings.listFilters}},initObservers:function(){this.$element.on("click",_.bind(this.onClick,this)),this.$element.on("change",_.bind(this.onSelect,this))},initDom:function(){this.dom=this.$element.getChildren(Mimi.Mailings.FilterDialog.DOM)},initDialog:function(){this.dialog=new Widget.Popup("#filter_dialog",{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1})},initUI:function(){var t="";for(var e in this.data.lists){var i=this.data.lists[e],s=_.map(i.groups||[],_.bind(function(t){var e=_.map(t.events,_.bind(function(t){return this.templates.listGroupItem({listId:i.id,id:t.id,title:t.title})},this)).join("");return this.templates.listGroup({title:t.title,html:e})},this)).join("");t+=this.templates.list({id:i.id,html:s})}this.dom.$list_fields.html(t),this.updateCheckboxes()},setListItem:function(t){this.data.listItem=t,this.updateUI()},updateUI:function(){this.updateTitle(),this.updateCheckboxes(),this.hideLists(),this.showActiveList()},show:function(){this.dialog.show()},hide:function(){this.dialog.hide()},onClick:function(e){var i=t(e.target).closest(".filter-dialog-action");if(i.length>0){var s=i.attr("data-action");return"cancel"===s?this.triggerCancel():"save"===s&&this.triggerSave(),!1}},onSelect:function(e){t(e.target).hasClass("select_all")?t(e.target).prop("checked")&&(this.selectAll(),this.unselectOthers()):this.unselectAll()},triggerSave:function(){this.dialog.hide(),this.fire("mailing:filter:save",{listItem:this.getListItem(),filter:this.serializeFilter()})},triggerCancel:function(){this.dialog.hide()},updateTitle:function(){this.dom.$title.html("Filter your "+this.getListData().title+" list")},updateCheckboxes:function(){var e=Mimi.Mailings.filters;this.$element.find(".select_one, .select_all").prop("checked",!1),this.$element.find(".filter_dialog_list_group").each(function(i,s){var n=t(s).data("id"),o=e[n];if(o)_.each(o,function(e){var i=t(s).find(".select_one[value="+e+"]");i.prop("checked",!0)});else{var a=t(s).find(".select_all");a.prop("checked",!0)}})},showActiveList:function(){this.$element.find(".filter_dialog_list_group[data-id="+this.getListData().id+"]").show()},hideLists:function(){this.$element.find(".filter_dialog_list_group").hide()},selectAll:function(){this.$element.find("#select_all").prop("checked",!0)},unselectAll:function(){this.$element.find("#select_all").prop("checked",!1)},unselectOthers:function(){this.$element.find(".select_one").prop("checked",!1)},getListItem:function(){return this.data.listItem},getListData:function(){return this.data.listItem?this.data.lists[this.getListItem().getListId()]:null},serializeFilter:function(){var e=this.$element.find("#select_all"),i=this.$element.find(".select_one:checked");return e.is(":checked")?null:_.map(i,function(e){return t(e).val()})}}).singleton("show"),Mimi.Mailings.FilterDialog.DOM={buttons:{send:"button[type=submit]",cancel:"a.back"},list_fields:"#list_fields",title:".window_title"}}(jQuery),function(t,e){e.DatePicker=function(){this.picker=t(".date_picker_month_day"),this.monthAnchors=this.picker.find("div.month table tbody tr.months td a"),this.previousYear=this.picker.find("div.month a.year_previous"),this.previousMonth=this.picker.find("div.day a.month_previous"),this.initStartingValues(),this.initEvents()},e.DatePicker.prototype={initEvents:function(){var e=this;this.initMonthEvents(),t("#date_picker .date *").click(function(t){t.preventDefault(),e.show()}),t(".close_month_day").click(function(t){t.preventDefault(),e.hide()}),this.previousYear.click(function(t){t.preventDefault(),e.changeYear(parseInt(e.getCurrentlyShownYear())-1)}),this.picker.find("div.month a.year_next").click(function(t){t.preventDefault(),e.changeYear(parseInt(e.getCurrentlyShownYear())+1)}),this.previousMonth.click(function(t){t.preventDefault(),e.decrementMonth()}),this.picker.find("div.day a.month_next").click(function(t){t.preventDefault(),e.incrementMonth()})},decrementMonth:function(){var t=e.date.getNumOfMonth(this.getCurrentlyShownMonth());if(0===t){var i=parseInt(this.getCurrentlyShownYear())-1;this.changeToDate(new Date(i,11,1))}else this.changeMonth(e.date.getMonthByNum(t-1))},incrementMonth:function(){var t=e.date.getNumOfMonth(this.getCurrentlyShownMonth());if(11===t){var i=parseInt(this.getCurrentlyShownYear())+1;this.changeToDate(new Date(i,0,1))}else this.changeMonth(e.date.getMonthByNum(t+1))},initMonthEvents:function(){var e=this;this.disablePastMonths(),this.monthAnchors.click(function(i){i.preventDefault(),t(this).hasClass("disabled")||e.onMonthClick(t(this))})},disablePastMonths:function(){var i=this;this.monthAnchors.each(function(){var s=t(this);s.removeClass("disabled");var n=new Date(i.getCurrentlyShownYear(),e.date.getNumOfMonth(s.text()),1);i.isMonthInPast(n)&&s.addClass("disabled")})},isMonthInPast:function(t){var e=new Date;return t.getFullYear()<e.getFullYear()||t.getFullYear()===e.getFullYear()&&t.getMonth()<e.getMonth()},show:function(){this.initStartingValues(),this.refreshCalendar(),this.picker.addClass("visible")},hide:function(){this.picker.removeClass("visible")},onDateClick:function(t){t.parent().hasClass("otherDay")||(this.dateAnchors.removeClass("day_active"),t.addClass("day_active"),this.changeSelectedDate(t.text()))},onMonthClick:function(t){this.monthAnchors.removeClass("month_active"),t.addClass("month_active"),this.changeMonth(t.text())},changeMonth:function(t){var i=new Date(this.getCurrentlyShownYear(),e.date.getNumOfMonth(t),1);this.isMonthInPast(i)||(this.setCurrentlyShownMonth(t),this.refreshCalendar())},changeYear:function(t){var i=new Date(t,e.date.getNumOfMonth(this.getCurrentlyShownMonth()),1);this.isMonthInPast(i)?this.changeToDate(new Date):(this.setCurrentlyShownYear(t),this.refreshCalendar())},changeToDate:function(t){this.setCurrentlyShownYear(t.getFullYear()),this.setCurrentlyShownMonth(e.date.getMonthByNum(t.getMonth())),this.refreshCalendar()},disableBackwardsTimeTravel:function(){this.previousYear.removeClass("disabled"),this.previousMonth.removeClass("disabled");var t=this.getCurrentlyShownYear(),i=new Date;(new Date).getFullYear()===t&&(this.previousYear.addClass("disabled"),i.getMonth()===e.date.getNumOfMonth(this.getCurrentlyShownMonth())&&this.previousMonth.addClass("disabled"))},refreshCalendar:function(){this.disableBackwardsTimeTravel(),this.disablePastMonths(),this.setYearEasterEgg(),this.buildCalendar()},changeSelectedDate:function(i){this.setCurrentlyShownDay(e.date.ordinalize(i));var s=this.getCurrentlyShownMonth()+" "+this.getCurrentlyShownYear();t("#date_picker .date .date_month_year").text(s),t(document).trigger("date_picker:updated"),this.hide()},getCurrentlyShownDay:function(){return parseInt(t("#date_picker .date .date_day").text())},setCurrentlyShownDay:function(e){t("#date_picker .date .date_day").text(e)},getCurrentlyShownMonth:function(){return this.picker.find("span.month_current").text()},setCurrentlyShownMonth:function(e){this.picker.find("span.month_current").text(e),this.monthAnchors.each(function(){var i=t(this);i.removeClass("month_active"),i.text()===e&&i.addClass("month_active")})},getCurrentlyShownYear:function(){return parseInt(this.picker.find("span.year_current").text())},setCurrentlyShownYear:function(t){this.picker.find("span.year_current").text(t)},setYearEasterEgg:function(){var i=e.date.getYearEasterEgg(this.getCurrentlyShownYear());""===i&&(i="&nbsp;"),t(".date_picker_month_day tr.header_row th.year_easter_egg").html(i)},getSelectedDate:function(){return new Date(this.getCurrentlyShownYear(),e.date.getNumOfMonth(this.getCurrentlyShownMonth()),this.getCurrentlyShownDay())},setDate:function(i){this.setCurrentlyShownDay(e.date.ordinalize(i.getDate()));var s=e.date.getMonthByNum(i.getMonth())+" "+i.getFullYear();t("#date_picker .date .date_month_year").text(s)},setMinimumDate:function(t){this.minimumDate=t,this.buildCalendar()},getMinimumDate:function(){return this.minimumDate||e.date.getYesterdayAtMidnight()},initStartingValues:function(){var i=t("#date_picker .date .date_month_year").text().split(" "),s=i.pop(),n=i.join(" ");this.setCurrentlyShownMonth(n),this.setCurrentlyShownYear(s);var o=this.getCurrentlyShownDay();this.setCurrentlyShownDay(e.date.ordinalize(o)),this.currentSelectedDate=new Date(s,e.date.getNumOfMonth(n),o)},buildCalendar:function(){var i=this,s=this.picker.find(".day table tbody");s.empty();for(var n=e.date.getNumOfMonth(this.getCurrentlyShownMonth()),o=e.date.daysInMonth(n+1,this.getCurrentlyShownYear()),a=e.date.getNumWeeksInMonth(n,this.getCurrentlyShownYear()),r=1,l=e.date.getTodayAtMidnight(),d=this.getMinimumDate(),h=new Date(this.getCurrentlyShownYear(),n,1),c=h.getDay(),u=0;a>u;u++){var m=t(document.createElement("tr"));m.addClass("days");for(var p=0;7>p;p++){var f=new Date(this.getCurrentlyShownYear(),n,r,0,0,0),g=t(document.createElement("td"));0===u?c>p?g.addClass("otherDay").html('<a href="#">-</a>'):d>=f?(g.addClass("otherDay").html('<a href="#">'+r+"</a>"),r++):(g.html('<a href="#">'+r+"</a>"),r++):d>=f?(g.addClass("otherDay").html('<a href="#">'+r+"</a>"),r++):o>=r?(g.html('<a href="#">'+r+"</a>"),f.getTime()===l.getTime()&&g.find("a").addClass("today"),f.getTime()===i.currentSelectedDate.getTime()&&g.find("a").addClass("day_active"),r++):g.addClass("otherDay").html('<a href="#">-</a>'),m.append(g)}s.append(m)}this.dateAnchors=this.picker.find(".day table tbody tr.days td a"),this.dateAnchors.click(function(e){e.preventDefault(),i.onDateClick(t(this))})}}}(jQuery,Mimi),function(t,e){e.TimePicker=function(){this.$sunHandle=t("#handle"),this.sunHandleWidth=this.$sunHandle.width(),this.C=65,this.OFFSET=136,this.day=1440,this.clock=t(".date_hour .time"),this.sun=t("#date_picker img.sun"),this.sunDownThreshold=162,this.is24hourClock=t("#date_picker").data("use-24-clock"),this.initSkyWidth(),this.initEvents(),t(document).ready(function(){e.DateTimePicker.get().timePicker.redraw()})},e.TimePicker.prototype={initSkyWidth:function(){this.$sky=t("#click_zone"),this.skyWidth=this.$sky.width()},initEvents:function(){var e=this;t(window).resize(function(){e.redraw()}),t("#date_picker .date_hour span").click(function(t){e.toggleAmPm(t)}),this.$sunHandle.draggable({containment:"#date_picker",start:function(){e.$sunHandle.stop(!0,!1).addClass("drag")},drag:function(t,i){var s=i.position.left;i.position.top=e.y(s),e.setClockFromX(s),e.animateSun(s)},stop:function(){e.$sunHandle.removeClass("drag")}}),this.$sky.on("click",function(t){var i=t.pageX-e.$sky.offset().left-e.sunHandleWidth/2;0>i&&(i=0),i>e.skyWidth-e.sunHandleWidth&&(i=e.skyWidth-e.sunHandleWidth),e.setClockFromX(i,15),e.animateSunAndHandle(e.getClock24())}),this.clock.on("blur",function(){e.setClockFromX(e.animateSunAndHandle(e.getClock24()))}),this.clock.on("keyup",function(){e.adjustIncorrect24hourTime(),e.animateSunAndHandle(e.getClock24())}),this.clock.on("keypress",function(e){if(t(this).val().length>5)return e.preventDefault(),!1;var i=[8,9,13,35,36,37,39,58],s=i.join(",").match(new RegExp(e.which));!e.which||49<=e.which&&e.which<=57||48===e.which&&t(this).attr("value")||s||e.preventDefault()}),this.clock.on("click",function(t){t.die()})},redraw:function(){this.initSkyWidth(),this.animateSunAndHandle(this.getClock24())},normalize:function(t){return isNaN(t)?0:t/(this.skyWidth-this.sunHandleWidth)},radians:function(t){return 2*Math.PI*this.normalize(t)},y:function(t){return this.C*Math.cos(this.radians(t))+this.OFFSET},time:function(t,e){if(e||(e=1),t>=this.skyWidth-this.sunHandleWidth)return"23:59";var i=this.normalize(t)*this.day,s=Math.floor(i/60),n=Math.floor(Math.round(i-60*s)/e)*e;return 60===n&&(s+=1,n=0),this.formatTime(s,n)},formatTime:function(t,e){return(10>t?"0":"")+t+":"+(10>e?"0":"")+e
},setClockFromX:function(t,e){this.setClock(this.time(t,e))},setClock:function(e){var i=this.convert24hourTime(e),s=i.split(" ");i=s[0];var n="PM"===s[1];this.clock.val(this.is24hourClock?e:i),n?this.setPM():this.setAM(),t(document).trigger("time_picker:updated")},xFromTime:function(t){var e=t.split(":");if(2===e.length){var i=Math.min(Math.max(parseInt(e[0],10),0),24),s=Math.min(Math.max(parseInt(e[1],10),0),60);return isNaN(i)&&(i=0),isNaN(s)&&(s=0),24===i&&(s=0),(60*i+s)/this.day*(this.skyWidth-this.sunHandleWidth)}},setSun:function(t){var e=this.xFromTime(t);return this.$sunHandle.stop(!0,!1).css({left:e,top:this.y(e)}),e},animateSunAndHandle:function(t){var e=this,i=this.xFromTime(t);return this.$sunHandle.stop(!0,!1).animate({left:i},{step:function(){e.$sunHandle.css({top:e.y(parseInt(e.$sunHandle.css("left"),10))})}}),this.animateSun(i),i},animateSun:function(t){var e=this.y(t);this.changeColor(e);var i=.6*e+70;this.sun.stop(!0,!1).animate({top:i})},changeColor:function(e){var i="#63b8ea",s="#005C84";e>this.sunDownThreshold&&(i="#5593B8",s="#071424"),t("div.sky").stop(!0,!1).animate({backgroundColor:i},500),t("#date_picker .timesect").stop(!0,!1).animate({color:s},500)},buildTimeWithDate:function(t){return t.setHours(this.getHours24()),t.setMinutes(this.getMinutes()),t},getHours:function(){return parseInt(this.clock.val().split(":")[0])},getHours24:function(){var t=this.getHours(),e=t;return this.is24hourClock===!1&&(12!==t||this.isTimePM()?12!==t&&this.isTimePM()&&(e=t+12):e=0),e},getMinutes:function(){return parseInt(this.clock.val().split(":")[1])},setTime:function(t){var e=t.getHours().leadingZero()+":"+t.getMinutes().leadingZero();this.setClock(e),this.animateSunAndHandle(this.getClock24())},isTimePM:function(){return t(".date_hour .pm").hasClass("current")},setPM:function(){t(".date_hour .am").removeClass("current"),t(".date_hour .pm").addClass("current")},setAM:function(){t(".date_hour .pm").removeClass("current"),t(".date_hour .am").addClass("current")},getClock24:function(){return this.getHours24()+":"+this.getMinutes()},toggleAmPm:function(e){var i=t(e.target);if(!i.hasClass("current")){var s=parseInt(this.getHours24());i.hasClass("am")?s-=12:s+=12,this.setClock(this.formatTime(s,this.getMinutes())),this.animateSunAndHandle(this.getClock24())}},adjustIncorrect24hourTime:function(){if(!this.is24hourClock){var t=this.getHours();if(t>12){var e=this.getMinutes();e=isNaN(e)?0:e,this.setClock(this.formatTime(t,e))}}},convert24hourTime:function(t){return"24:00"===t?"12:00 AM":(t=t.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/)||[t],t.length>1&&(t=t.slice(1),t[5]=+t[0]<12?" AM":" PM",t[0]=+t[0]%12||12,t[0]=t[0]<10?"0"+t[0]:t[0]),t.join(""))}}}(jQuery,Mimi),function(t,e){e.DateTimePicker=function(){return e.DateTimePicker.prototype._singletonInstance?e.DateTimePicker.prototype._singletonInstance:(e.DateTimePicker.prototype._singletonInstance=this,this.datePicker=new e.DatePicker,void(this.timePicker=new e.TimePicker))},e.DateTimePicker.get=function(){return new e.DateTimePicker},e.DateTimePicker.prototype={getTimezone:function(){return this.timezone},setTimezone:function(t){this.timezone=t},getSelectedDateAsDate:function(){var t=this.datePicker.getSelectedDate();return this.timePicker.buildTimeWithDate(t)},setDateTime:function(t){var e=t instanceof Date?t:new Date(t.toString().replace("at",""));this.timePicker.setTime(e),this.datePicker.setDate(e)},setMinimumDateTime:function(t){this.datePicker.setMinimumDate(t)},is24hourClock:function(){return this.timePicker.is24hourClock},convert24hourTime:function(t){return this.timePicker.convert24hourTime(t)}}}(jQuery,Mimi),function(t){Mimi.Mailings.Calendar=Class.create(Widget.Observable,Widget.Observer,{SLIDE_DURATION:250,NUM_MONTHS_AHEAD:6,initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(this.constructor.DOM),this.initData(),this.createUI(),this.selectedDate={},this.visiblePicker="date",this.initDatePicker(),this.initEvents()},initData:function(){this.data={}},initEvents:function(){this.dom.$scheduleInputEl.on("keydown",_.bind(function(t){return 13===t.keyCode?(_.delay(_.bind(this.validateDate,this),10),!1):void 0},this)),this.dom.$scheduleInputEl.on("blur",_.bind(this.validateDate,this))},createUI:function(){this.createCalendarPicker()},createCalendarPicker:function(){this.calendar=new Widget.Popup("#calendar-picker",{anchor:"#schedule_when_calendar",position:"right fartop",styles:{zIndex:10000005},fixedPosition:!0,repositioning:!1});var e=this.calendar.$element.find(".calendar_month_selector button span");e.html(Mimi.date.getCurrentMonth()+" "+Mimi.date.getCurrentYear());var i=Mimi.date.getCurrentDate(),s=_.find(this.calendar.$element.find("td a"),function(t){return parseInt(t.innerHTML,10)===i}),n=t(s).parent();n.addClass("today"),this.$todayEl=n},initDatePicker:function(){this.$element.on("click","#schedule_when_calendar",_.bind(this.onSchedule,this)),this.initDatePicking(),this.initTimePicking(),this.initMonthSelector()},buildCalendar:function(){var e=this.calendar.$element.find("tbody");e.html("");for(var i=this.getCurrentlyShownMonth(),s=Mimi.date.getNumOfMonth(this.getCurrentlyShownMonth()),n=Mimi.date.getNumDaysPerMonth(i),o=Mimi.date.getNumWeeksInMonth(s,this.getCurrentlyShownYear()),a=1,r=Mimi.date.getTodayAtMidnight(),l=Mimi.date.getYesterdayAtMidnight(),d=new Date(this.getCurrentlyShownYear(),s,1),h=d.getDay(),c=0;o>c;c++){for(var u=t("<tr>"),m=0;7>m;m++){var p=new Date(this.getCurrentlyShownYear(),s,a,0,0,0),f=t("<td>");0===c?h>m?f.addClass("disabled").html('<a href="#">-</a>'):l>=p?(f.addClass("disabled").html('<a href="#">'+a+"</a>"),a++):(f.html('<a href="#">'+a+"</a>"),a++):l>=p?(f.addClass("disabled").html('<a href="#">'+a+"</a>"),a++):n>=a?(f.html('<a href="#">'+a+"</a>"),p.getTime()===r.getTime()&&f.addClass("today"),a++):f.addClass("disabled").html('<a href="#">-</a>'),u.append(f)}e.append(u)}},onSchedule:function(){return this.buildCalendar(),this.selectPrevSelectedDay(),this.calendar.show(),this.$todayEl.focus(),!1},selectPrevSelectedDay:function(){this.selectedDate.day&&_.find(this.calendar.$element.find("td"),_.bind(function(e){var i=t(e),s=parseInt(i.text(),10)===this.selectedDate.day&&!i.detectClass("disabled","otherDay");i.removeClass("selected"),s&&i.addClass("selected")},this))},initDatePicking:function(){this.calendar.$element.on("click","tbody a",_.bind(function(e){var i=t(e.currentTarget).parents("td"),s=!i.detectClass("disabled","otherDay");return s&&this.onDateElementSelected(e.target),!1},this))},showTimePicker:function(){this.visiblePicker="time",this.dom.$scrollerEl.animate({left:"-271px"},this.SLIDE_DURATION,_.bind(function(){var t=this.dom.$timePickerEl.find("li a");t.focus()},this))},showDatePicker:function(){this.visiblePicker="date",this.dom.$scrollerEl.animate({left:"0px"},this.SLIDE_DURATION,_.bind(function(){this.$todayEl.focus()},this))},initTimePicking:function(){this.dom.$timePickerEl.on("click","li a",_.bind(function(t){return this.onTimeElementSelected(t.currentTarget),!1},this)),this.dom.$timePickerEl.on("click",".previous",_.bind(function(){return this.showDatePicker(),!1},this)),t(document).on("keydown",_.bind(function(t){return 8===t.keyCode&&"time"===this.visiblePicker?(this.showDatePicker(),!1):void 0},this))},onDateElementSelected:function(t){var e=parseInt(t.innerHTML,10),i=this.dom.$monthSelectorEl.html(),s=i.split(" ")[0],n=parseInt(i.split(" ")[1],10);this.updateDate({year:n,month:s,day:e}),this.showTimePicker()},onTimeElementSelected:function(t){this.updateDate({hours:t.innerHTML.substring(0,2),minutes:t.innerHTML.substring(3,5)}),this.calendar.hide(),this.displayDate(),this.dom.$scrollerEl.css({left:""}),this.dom.$scheduleInputEl.val("")},updateDate:function(t){"year"in t&&(this.selectedDate.year=t.year),"month"in t&&(this.selectedDate.month=t.month),"day"in t&&(this.selectedDate.day=t.day),"hours"in t&&(this.selectedDate.hours=t.hours),"minutes"in t&&(this.selectedDate.minutes=t.minutes)},getSelectedDateAsDate:function(){var t="number"==typeof this.selectedDate.month?this.selectedDate.month:Mimi.date.getNumOfMonth(this.selectedDate.month);return new Date(this.selectedDate.year,t,this.selectedDate.day,parseInt(this.selectedDate.hours,10),parseInt(this.selectedDate.minutes,10))},displayDate:function(){var t="number"==typeof this.selectedDate.month?Mimi.date.getMonthByNum(this.selectedDate.month):this.selectedDate.month;this.dom.$dateTimeEl.html(t+" "+this.selectedDate.day+", "+this.selectedDate.year+" at "+parseInt(this.selectedDate.hours,10).toPaddedString(2)+":"+parseInt(this.selectedDate.minutes,10).toPaddedString(2)),this.dom.$monthSelectorEl.html(this.selectedDate.month+" "+this.selectedDate.year),this.dom.$choiceEl.show()},getCurrentlyShownMonth:function(){return this.dom.$monthSelectorEl.html().match(/^\w+/)[0]},getCurrentlyShownYear:function(){return parseInt(this.dom.$monthSelectorEl.html().match(/^\w+\s+(\w+)/)[1],10)},initMonthSelector:function(){if(!this.monthSelector){var t=this.calendar.$element.find(".calendar_month_selector");this.monthSelector=Widget.Select.instances[t.identify()]}if(this.monthSelector){this.monthSelector.dom.$menu.on("click","ul li a",_.bind(this.onMonthSelected,this));var e,i=Mimi.date.getCurrentMonth();this.monthSelector.dom.$menu.find("ul").html(""),_.each(Mimi.date.getFollowingMonths(this.NUM_MONTHS_AHEAD),function(t){"January"===t&&"January"!==i&&(e=!0);var s="<li><a"+(e?' class="next-year"':"")+">"+t+"</a></li>";this.monthSelector.dom.$menu.find("ul").append(s)},this),this.dom.$nextMonthEl.on("click",_.bind(function(){return this.selectNextMonth(),!1},this)),this.dom.$prevMonthEl.on("click",_.bind(function(){return this.selectPrevMonth(),!1},this))}},onMonthSelected:function(t,e){this.monthSelector.hide();var i=Mimi.date.getCurrentYear(),s=e.hasClassName("next-year")?i+1:i;return this.dom.$monthSelectorEl.html(e.innerHTML+" "+s),this.buildCalendar(),!1},selectNextMonth:function(){var t=this.getCurrentlyShownMonth(),e=this.getCurrentlyShownYear(),i=Mimi.date.getNextMonth(t),s=Mimi.date.getNumOfMonth(i)-Mimi.date.getNumOfMonth(Mimi.date.getCurrentMonth()),n=this.getCurrentlyShownYear()!==Mimi.date.getCurrentYear();n&&(s=12-Mimi.date.getNumOfMonth(Mimi.date.getCurrentMonth())+Mimi.date.getNumOfMonth(i)),s>=this.NUM_MONTHS_AHEAD||(Mimi.date.getNumOfMonth(i)<Mimi.date.getNumOfMonth(t)&&e++,this.dom.$monthSelectorEl.html(i+" "+e),this.buildCalendar())},selectPrevMonth:function(){var t=this.getCurrentlyShownMonth(),e=this.getCurrentlyShownYear(),i=Mimi.date.getPrevMonth(t),s=Mimi.date.getNumOfMonth(Mimi.date.getCurrentMonth())>=Mimi.date.getNumOfMonth(this.getCurrentlyShownMonth())&&this.getCurrentlyShownYear()===Mimi.date.getCurrentYear();s||(Mimi.date.getNumOfMonth(i)>Mimi.date.getNumOfMonth(t)&&e--,this.dom.$monthSelectorEl.html(i+" "+e),this.buildCalendar())},validateDate:function(){var t=this.dom.$scheduleInputEl.valPlaceholderSafe(),e=this.dom.$dateTimeEl.html().trim();return t||e?!t&&e?!0:(this.parseDate(t),null):!1},submit:function(){var t=this.getSelectedDateAsDate();return t>new Date?(this.scheduleDialog.hide(),this.scheduleDialog2.show(),this.validateAudienceSelection()):Widget.MimiFlash.error("Sorry, I just can't schedule mailings in the past."),this.calendar.hide(),!1},parseDate:function(){var e=this.dom.$scheduleInputEl.valPlaceholderSafe();e&&t.get("/promotions/async_chronic",{raw_scheduled_at:e}).done(_.bind(this.onParseDateSuccess,this))},onParseDateSuccess:function(t){t.success?this.onDateValidationSuccess(t):this.onDateValidationFailure()},onDateValidationSuccess:function(t){this.dom.$dateTimeEl.html(t.scheduled_at),this.dom.$choiceEl.show(),this.fire("mailings:calendar:valid")},onDateValidationFailure:function(){this.lastValidated={},this.dom.$choiceEl.hide(),this.dom.$scheduleInputEl.val(""),this.onSchedule(),this.fire("mailings:calendar:invalid")},onResponse:function(t){t.success?(this.scheduleDialog3.hide(),Widget.MimiFlash.create("Great, your promotion has been scheduled for "+Time.formatDate(this.getSelectedDateAsDate())+"."),this.promotion.scheduled(t.result)):this.onFailure(t.error||"")},onFailure:function(t){var e=this.dom.$sendError;e.html(t||"Error. Please try again.").show(),e.data("hideTimeout")&&clearTimeout(e.data("hideTimeout")),e.data("hideTimeout",setTimeout(function(){e.animate({opacity:0},400,function(){e.hide().css({opacity:1})})},1e4))}}).singleton(),Mimi.Mailings.Calendar.DOM={choiceEl:".date_picker .choice",dateTimeEl:".date_picker .choice .date_time",scheduleInputEl:"#schedule_when",submitbtn:'#schedule-dialog button[type="submit"]',scheduleRepeat:"#schedule-dialog #schedule_repeat",previousSchedules:"#previous_schedule",schedulesList:"#schedules_list",deleteSchedulebtn:"#previous_schedule .delete",scrollerEl:"#calendar-picker .scroller",monthSelectorEl:"#calendar-picker .calendar_month_selector span",monthSelectorMenu:"#calendar-picker .calendar_month_selector menu",nextMonthEl:"#calendar-picker .calendar_next_month",prevMonthEl:"#calendar-picker .calendar_prev_month",datePickerEl:"#calendar-picker .calendar_contents:nth-child(1)",timePickerEl:"#calendar-picker .calendar_contents:nth-child(2)"}}(jQuery),function(t){Mimi.Mailings.Schedule=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#schedule_form"),this.initDom(),this.initObservers(),this.initConfirmation(),this.initData()},initData:function(){this.data={"delete":{id:null,path:null}}},initConfirmation:function(){this.confirmDialog=new Widget.ConfirmDialog("Delete schedule","Are you sure you want to delete this schedule?",{onOk:_.bind(this.deleteSchedule,this)})},initDom:function(){if(this.dom={$container:t("#previous_schedule"),$userTime:t("#schedule_when"),$scheduleInput:this.$element.find(".choice .date_time"),$timezone:this.$element.find(".choice .timezone"),$deleteBtns:this.$element.find(".actions .delete")},this.dom.$userTime){var e=this.dom.$userTime;setTimeout(function(){try{e.select()}catch(t){}},100)}},initObservers:function(){this.hasPreviousSchedules()&&this.$element.on("click","[data-type=schedule]",_.bind(this.onScheduleButtonClick,this)),this.dom.$deleteBtns.on("click",_.bind(function(t){this.onDeleteSelected(t),t.target.removeAttribute("onclick")},this)),t(document).on("schedule:deleted",_.bind(this.onScheduleDeleted,this))},getBlockOverlay:function(){return this.blockOverlay||(this.blockOverlay=new Widget.BlockOverlay({cover:t("#main section")[0],className:"loading"})),this.blockOverlay},onScheduleButtonClick:function(e){switch(t(e.currentTarget).data("action")){case"delete-schedule":this.onDeletePrevious(e);break;case"edit-schedule":this.getBlockOverlay().show()}},getScheduleInput:function(){var t=this.dom.$scheduleInput.html();return 0===t.length?"":t},onDeletePrevious:function(e){var i=t(e.currentTarget).attr("data-action");return"delete-schedule"===i?(e.preventDefault(),this.data["delete"].id=t(e.currentTarget).attr("data-value"),this.data["delete"].path=t(e.currentTarget).attr("href"),this.confirmDialog.show(),!1):void 0},onDeleteSelected:function(e){e.preventDefault();var i=t(e.target).closest("a.delete");return this.data["delete"].path=i.attr("href"),this.data["delete"].redirect="/promotions",this.confirmDialog.show(),!1},toggleSchedule:function(e,i){var s=t("#previous_schedule_"+e+", #previous_schedule_"+e+" + .second_send");i?s.hide():s.show()},deleteSchedule:function(){var e=this,i=!0,s=this.data["delete"].id,n=this.data["delete"].path;this.toggleSchedule(s,i),this.tryHidePreviousSchedules(),t.ajax({url:n,type:"delete"}).done(function(t){e.onDeleteSuccess(t,s)}).fail(function(){e.onDeleteFailure(s)})},onDeleteSuccess:function(t,e){if(t.success)this.data["delete"].redirect&&(document.location=this.data["delete"].redirect),this.tryHidePreviousSchedules(),this.fire("schedule:delete:successful",{schedules:t.result});else{var i=!1;this.toggleSchedule(e,i),this.fire("schedule:delete:failure",{reason:t.error})}},tryHidePreviousSchedules:function(){var e=t(".previous_schedule:visible");0===e.size()&&t("#previous_schedule").hide()},onDeleteFailure:function(t){var e=!1;this.toggleSchedule(t,e),this.fire("schedule:delete:error")},hasPreviousSchedules:function(){return this.dom.$container[0]?!0:!1},isScheduled:function(){return Mimi.Mailings.isScheduled},onScheduleDeleted:function(t,e){this.toggleSchedule(e.id,!0),this.tryHidePreviousSchedules()}}).singleton()}(jQuery),function(t){Widget.SimpleUpgrade=Class.create({initialize:function(t){this.data={plans:Mimi.Plans.Data.get()},this.initElement(t),this.initObservers()},show:function(t){this.dom.$error.html(t),this.panels.show(1)},reset:function(){this.dom.$error.html(""),this.panels.show(0)},backButtonClick:function(){return this.reset(),!1},initElement:function(i){this.$element=t("#"+i),this.$element.is(".popover_container")||(this.$element=this.$element.find(".popover_container")),this.dom=this.$element.getChildren(e),this.panels=new Widget.MultiPanel(this.$element)},initObservers:function(){this.dom.$panelsBackButton.on("click",_.bind(this.backButtonClick,this)),t(document).on("dropdown:item:selected",_.bind(this.itemSelected,this))},getSelectedPlan:function(){return this.data.plans.getPlanById(this.dom.$plan.val())},itemSelected:function(){var t=this.getSelectedPlan(),e="";if(t){var i=t.cents.centsToDollars().formatThousands();e+="Upgrade for $"+i+"/month!"}this.dom.$upgradeButton.html(e)}});var e={panelsBackButton:"span.previous",plan:".select input",upgradeButton:"button.upgrade",error:".error_message"}}(jQuery),Mimi.Mailings.UntitledSubjectWarningDialog=Class.create(Widget.Observable,Widget.Observer,{initialize:function(){this.$element=jQuery("#untitled_subject_warning_dialog"),this.initDom(),this.initDialog()},initDom:function(){this.dom=this.$element.getChildren(Mimi.Mailings.UntitledSubjectWarningDialog.DOM)},initDialog:function(){this.dialog=new Widget.Popup("#untitled_subject_warning_dialog",{hideTrigger:".close_dialog",overlay:Widget.ModalOverlay,fixedPosition:!1})},hide:function(){this.dialog.hide()},show:function(t){this.setSubject(t),this.dialog.show()},visible:function(){return this.dialog.visible()},setSubject:function(t){this.dom.$subjectLabel.html(t),this.dom.$subjectInput.val(t)},getSubject:function(){return this.dom.$subjectInput.val()}}).singleton(),Mimi.Mailings.UntitledSubjectWarningDialog.DOM={subjectLabel:"#change_send_subject_label",subjectInput:"#change_send_subject"},jQuery(function(){if(Mimi.User){var t=Mimi.User.pusher_token,e=new Pusher("027fb8cc93e63a8ea2eb",{authEndpoint:"/pusher/auth",disabledTransports:["sockjs"]});e.connection.bind("connected",function(){Mimi.Pusher.socketId=e.connection.socket_id});var i=e.subscribe("exec_"+t);i.bind("flash",function(t){debug("flash",t);var e=t[0],i=t[1];Widget.MimiFlash[e](i)}),i.bind("event",function(t){debug("event",t);var e=t[0],i=t[1];jQuery(document).trigger(e,i)}),i.bind("redirect",function(t){debug("redirect",t);var e=t[0],i=t[1].toLowerCase(),s=t[2];if(s&&(window.onbeforeunload=null),"get"===i)window.location=e;else{var n=document.createElement("form");n.style.display="none",document.body.appendChild(n),n.method="POST",n.action=e;var o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name","_method"),o.setAttribute("value",i),n.appendChild(o),n.submit()}}),Mimi.Pusher={pusher:e,trackPresence:function(t,i){var s=e.subscribe("presence-"+t),n=function(){i(s.members)};s.bind("pusher:subscription_succeeded",n),s.bind("pusher:member_added",n),s.bind("pusher:member_removed",n)}}}}),function(t){Mimi.listUpdater=Class.create({updateAudienceLists:function(){var e=!!t("#audience_lists")[0];if(e){var i=[];t.get("/list_counter").done(function(e){i=e;for(var s=Mimi.AudienceList.List.get(),n=0;n<i.size();n++)if("nil"===i[n].id){var o=t(s.findList("signups").select("span.notify span"));i[n].size>0?(o.show(),o.html(i[n].size+" new over the last week")):o.hide()}else s.setListSize(i[n])})}},updateCurrentList:function(e){var i=!!_.size(e),s=!!t("#audience_lists")[0];if(i&&s){var n=e[0],o=e[1],a=this;isNaN(parseInt(n,10))||t.get("/audience_members/search?id="+n).done(function(e){var i=_.first(e.result.audience),s=t("#audience_lists .current a")[0].dataset.value,n=t("#audience_lists .automatic_audience_lists .current a")[0],r=Template.from("audience_member_template");"all"===s&&!i.suppressed||"suppressed"===s&&!i.suppressed||"signups"===s&&!i["recent_signup?"]?a.displayNewAudienceMember(i,r):!o||-1===o.indexOf(s)&&o!==s||(r=Template.from(n?"special_list_audience_member_template":"audience_member_template"),a.displayNewAudienceMember(i,r))})}},displayNewAudienceMember:function(e,i){t("#audience_member_rows").prepend(i(e));for(var s=0;s<t("#audience_member_row_"+e.id+" td").size();s++)t("#audience_member_row_"+e.id+" td:eq("+s+")").highlight({duration:250}),setTimeout(function(){t("#audience_member_row_"+e.id+" td:eq("+s+")").attr("style","")},2500)}})}(jQuery),function(t){Mimi.Participants={init:function(){this.initObservers()},initObservers:function(){this.initNewUserDialog(),this.initEditUserPermissions(),this.initToggleUserPermissions()},initToggleUserPermissions:function(){var e=this;t(document).on("click",".user_edit_permissions",function(){var i=t(this),s=i.data("user-id"),n=i.data("path"),o=i.data("update-path"),a="#user_permissions_form_container_"+s;t.post(n).done(function(e){t(a).html(e)}).fail(function(t,e){Widget.MimiFlash.error(e)}).always(function(){e.addPermissionsSubmitHandler(s,o);var t=i.data("edit-permissions-popup");t&&t.position()})})},initEditUserPermissions:function(){t(document).on("click",".user_edit_permissions",function(){var e=t(this).data("edit-permissions-popup");return e||(e=new Widget.Popup("#user_edit_permissions_"+t(this).attr("data-user-id"),{hideTrigger:".window_close, .back"}),t(this).data("edit-permissions-popup",e)),e.show(),!1})},initNewUserDialog:function(){var e=new Widget.Popup("#new_user_dialog",{overlay:Widget.ModalOverlay,hideTrigger:".window_close, .back"});t("#new_user_action").on("click",function(){return e.show(),!1})},addPermissionsSubmitHandler:function(e,i){var s="#user_permissions_form_"+e;t(s).on("submit",function(){return t.post(i,t(s).serialize()).done(function(i){t("#permissions-list-count-"+e).html(i),t("#user_edit_permissions_"+e).toggle(),Widget.MimiFlash.create(I18n.t("js.participants.addPermissionsSubmitHandler"))}).fail(function(i,s){t("#user_edit_permissions_"+e).toggle(),Widget.MimiFlash.error(s)}),!1})}}}(jQuery),function(t){Mimi.BigCommerce=Class.create(Widget.Observer,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.BigCommerce.DOM),this.dialog=new Widget.Popup("#link_store_form",{overlay:Widget.ModalOverlay,hideTrigger:".window_close, .back"}),this.initializeObservers()},initializeObservers:function(){this.dom.$linkStoreButton.on("click",_.bind(this.showLinkStoreForm,this)),this.dom.$saveCredentialsButton.on("click",_.bind(this.linkStore,this)),this.dom.$checkCredentialsButton.on("click",_.bind(this.checkCredentials,this)),this.dom.$unlinkStoreButton.on("click",_.bind(this.unlinkStore,this)),this.dom.$importButton.on("click",_.bind(this.startImport,this)),t(document).on("import:finished",_.bind(function(t,e){var i=e[0][0];/BigCommerce/.test(i.type)&&this.importFinished()},this))},showLinkStoreForm:function(){return this.dialog.show(),!1},linkStore:function(e){var i=t(e.currentTarget).closest("form"),s=this;return this.dom.$linkingLoader.show(),t.ajax({url:i.attr("action"),type:i.attr("method"),data:i.serialize()}).done(function(t){s.linkingFinished(t)}).fail(function(){Widget.MimiFlash.create(I18n.t("MimiFlash.big_commerce.linkStore.onFailure"))}).always(function(){s.dom.$linkingLoader.hide()}),!1},linkingFinished:function(t){t.linked?(Widget.MimiFlash.create(I18n.t("MimiFlash.big_commerce.linkingFinished.success")),this.dialog.hide(),this.dom.$linkStoreButton.hide(),this.dom.$grabOneHere.hide(),this.dom.$importButton.show(),this.dom.$settingsMaintenanceBar.show()):Widget.MimiFlash.create(I18n.t("MimiFlash.big_commerce.linkingFinished.fail"))},checkCredentials:function(e){var i=t(e.currentTarget).closest("form").prop("action");return t.post(i).fail(function(){Widget.MimiFlash.create(I18n.t("MimiFlash.big_commerce.checkCredentials.onFailure"))}).done(function(t){Widget.MimiFlash.create(t.credentials_valid?I18n.t("MimiFlash.big_commerce.checkCredentials.onSuccess.credentials_valid"):I18n.t("MimiFlash.big_commerce.checkCredentials.onSuccess.else"))}),!1},unlinkStore:function(e){var i=e.currentTarget.getAttribute("href");return t.post(i).fail(function(){Widget.MimiFlash.create(I18n.t("MimiFlash.big_commerce.unlinkStore.onFailure"))}).done(_.bind(function(){Widget.MimiFlash.create(I18n.t("MimiFlash.big_commerce.unlinkStore.onSuccess")),this.dom.$linkStoreButton.show(),this.dom.$grabOneHere.show(),this.dom.$importButton.hide(),this.dom.$settingsMaintenanceBar.hide()},this)),!1},startImport:function(e){var i=t(e.currentTarget).closest("form").prop("action");return t.post(i).fail(function(){Widget.MimiFlash.create(I18n.t("MimiFlash.big_commerce.startImport.onFailure"))}).done(_.bind(function(t){Widget.MimiFlash.create(I18n.t("MimiFlash.big_commerce.startImport.onSuccess")),this.importStarted(t.import_started_at)},this)),!1},importStarted:function(t){this.dom.$importButton.slideUp();var e=this.dom.importStatus;e.$currentImportStatus.slideDown(),e.$importStartedAtTime.replaceWith(t)},importFinished:function(){this.dom.$importButton.slideDown(),this.dom.importStatus.$currentImportStatus.slideUp()}}).singleton(),Mimi.BigCommerce.DOM={linkStoreButton:"#link_store",saveCredentialsButton:"#update_big_commerce",linkingLoader:"#radio_loader",importButton:"#import",settingsMaintenanceBar:"#settings_maintenance",grabOneHere:"#grab_one_here",checkCredentialsButton:"#check_credentials",unlinkStoreButton:"#unlink_store",importStatus:{currentImportStatus:"#current_import_status",importStartedAtTime:"#import_started_at_time"}}}(jQuery),function(t){Mimi.Spree=Class.create(Widget.Observer,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.Spree.DOM),this.initDialog(),this.initObservers()},initDialog:function(){this.dialog=new Widget.Popup("#link_store_form",{overlay:Widget.ModalOverlay,hideTrigger:".window_close, .back"})},initObservers:function(){this.dom.$linkStoreButton.on("click",_.bind(this.onLinkStoreButtonClicked,this)),this.dom.$saveCredentialsButton.on("click",_.bind(this.onSaveCredentialsButtonClicked,this)),this.dom.$checkCredentialsButton.on("click",_.bind(this.onCheckCredentialsButtonClicked,this)),this.dom.$unlinkStoreButton.on("click",_.bind(this.onUnlinkStoreButtonClicked,this)),this.dom.$importButton.on("click",_.bind(this.onImportButtonClicked,this)),t(document).on("import:finished",_.bind(this.onImportFinished,this))},onLinkStoreButtonClicked:function(){return this.dialog.show(),!1},onSaveCredentialsButtonClicked:function(e){var i=t(e.currentTarget).closest("form");return this.onSaveCredentialsLoading(),t.post(i.prop("action"),i.serialize()).done(_.bind(this.onSaveCredentialsSuccess,this)).fail(_.bind(this.onSaveCredentialsFailure,this)).always(_.bind(this.onSaveCredentialsComplete,this)),!1},onSaveCredentialsLoading:function(){this.dom.$linkingLoader.show()},onSaveCredentialsComplete:function(){this.dom.$linkingLoader.hide()},onSaveCredentialsFailure:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.spree.save_credentials.failure.general"))},onSaveCredentialsSuccess:function(t){t.linked?(Widget.MimiFlash.create(I18n.t("MimiFlash.spree.save_credentials.success")),this.dialog.hide(),this.dom.$linkStoreButton.hide(),this.dom.$grabOneHere.hide(),this.dom.$importButton.show(),this.dom.$settingsMaintenanceBar.show()):Widget.MimiFlash.create(I18n.t("MimiFlash.spree.save_credentials.failure.not_linked"))},onCheckCredentialsButtonClicked:function(e){var i=t(e.currentTarget).closest("form").prop("action");return t.post(i).fail(_.bind(this.onCheckCredentialsFailure,this)).done(_.bind(this.onCheckCredentialsSuccess,this)),!1},onCheckCredentialsFailure:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.spree.check_credentials.failure"))},onCheckCredentialsSuccess:function(t){Widget.MimiFlash.create(t.credentials_valid?I18n.t("MimiFlash.spree.check_credentials.success.credentials_valid"):I18n.t("MimiFlash.spree.check_credentials.success.else"))},onUnlinkStoreButtonClicked:function(e){var i=t(e.currentTarget).attr("href");return t.ajax({url:i,type:"delete"}).fail(_.bind(this.onUnlinkStoreFailure,this)).done(_.bind(this.onUnlinkStoreSuccess,this)),!1},onUnlinkStoreFailure:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.spree.unlink_store.failure"))},onUnlinkStoreSuccess:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.spree.unlink_store.success")),this.dom.$linkStoreButton.show(),this.dom.$grabOneHere.show(),this.dom.$importButton.hide(),this.dom.$settingsMaintenanceBar.hide()},onImportButtonClicked:function(e){var i=t(e.currentTarget).closest("form").prop("action");return t.post(i).done(_.bind(this.onImportSuccess,this)).fail(_.bind(this.onImportSuccess,this)),!1},onImportFailure:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.spree.import.failure"))},onImportSuccess:function(t){Widget.MimiFlash.create(I18n.t("MimiFlash.spree.import.success")),this.dom.$importButton.slideUp(),this.dom.importStatus.$currentImportStatus.slideDown(),this.dom.importStatus.$importStartedAtTime.replaceWith(t.import_started_at)},onImportFinished:function(t,e){/Spree/.test(e.type)&&(this.dom.$importButton.slideDown(),this.dom.$importStatus.currentImportStatus.slideUp())}}).singleton(),Mimi.Spree.DOM={linkStoreButton:"#link_store",saveCredentialsButton:"#update_spree",linkingLoader:"#radio_loader",importButton:"#import",settingsMaintenanceBar:"#settings_maintenance",grabOneHere:"#grab_one_here",checkCredentialsButton:"#check_credentials",unlinkStoreButton:"#unlink_store",importStatus:{currentImportStatus:"#current_import_status",importStartedAtTime:"#import_started_at_time"}}}(jQuery),function(t){Mimi.Admin={},Mimi.Admin.ManageIntegrations=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.Admin.ManageIntegrations.DOM)},addCategory:function(e){var i=t("<option>").val(e.id).html(e.name).prop("selected",!0);this.dom.$categoryDropdown.append(i)}}).singleton(),Mimi.Admin.ManageIntegrations.DOM={categoryDropdown:"#integration_category_id"}}(jQuery),function(t){Mimi.Integrations={},Mimi.Integrations.GalleryCategory=Class.create(Widget.Observer,{initialize:function(){t(document).on("dropdown:item:selected",_.bind(this.categoryChanged,this)),this.overlay=new Widget.BlockOverlay({cover:t("#main section")[0]}),this.integrationItem=Template.from("integration_item"),this.$integrationsList=t("#integrations_list")},categoryChanged:function(e,i){window.test=i.element;var s=t(i.element).data("value");this.showLoader(),t.get(s).done(_.bind(function(t){this.hideLoader(),this.showCategory(t)},this))},showLoader:function(){this.overlay.show()},hideLoader:function(){this.overlay.hide()},showCategory:function(t){this.$integrationsList.html(""),_.each(t,function(t){this.$integrationsList.append(this.integrationItem(t))},this)}}).singleton()}(jQuery),function(t){Mimi.Admin.IntegrationCategory=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.Admin.IntegrationCategory.DOM),this.dialog=new Widget.Popup("#add_integration_category_form",{overlay:Widget.ModalOverlay,hideTrigger:".window_close, .back"}),this.initializeObservers()},initializeObservers:function(){this.dom.$addAdminCategoryButton.on("click",_.bind(this.showAddIntegrationCategoryForm,this)),this.dom.$form.on("submit",_.bind(this.createCategory,this)),this.dom.$createAdminCategoryButton.on("click",_.bind(this.createCategory,this))},showAddIntegrationCategoryForm:function(){return this.dialog.show(),!1},createCategory:function(){t.ajax({url:this.dom.$form.attr("action"),type:this.dom.$form.attr("method")||"get",data:this.dom.$form.serialize()}).done(_.bind(function(t){this.onCategoryAdded(t),this.dialog.hide()},this)).fail(function(t){Widget.MimiFlash.create(t.errors[0])})}}).singleton(),Mimi.Admin.IntegrationCategory.DOM={addAdminCategoryButton:"#add_admin_category",form:"#new_integration_category",createAdminCategoryButton:"#create_admin_category"}}(jQuery),function(t){Mimi.Admin.IpBlocks=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("body"),this.dom=this.$element.getChildren(Mimi.Admin.IpBlocks.DOM),this.dialog=new Widget.Popup("#add_blocked_ip_dialog",{overlay:Widget.ModalOverlay,hideTrigger:".window_close, .back"}),this.dom.$addBlockedIpButton.on("click",_.bind(this.openDialog,this))
},openDialog:function(){this.dialog.show()}}).singleton(),Mimi.Admin.IpBlocks.DOM={addBlockedIpButton:"#add_blocked_ip"}}(jQuery),function(t){Mimi.Admin.Webinars=Class.create(Widget.Observer,{initialize:function(){this.$element=t("body"),this.tabs=new Widget.Tabs(t("#webinar_tabs")[0],{noState:!0}),t("#mimi_webinars_tab").on("click",_.bind(this.mimiTabSelected,this)),t("#gem_webinars_tab").on("click",_.bind(this.gemTabSelected,this))},mimiTabSelected:function(){t("#new_webinar_button").html("Add new Mimi Webinar"),this.toggleUser(),t("#new_webinar_button").css({"background-color":"#ffa41f","border-color":"rgba(173, 103, 0, 0.65)","text-shadow":"0 -1px 0 #ad6700","box-shadow":"inset 0 -4px 0 rgba(240, 143, 0, 0.85)"}),t("#new_webinar_button").attr("href","/admin_webinars/new?product=mimi")},gemTabSelected:function(){t("#new_webinar_button").html("Add new GEM Webinar"),this.toggleUser(),t("#new_webinar_button").css({"background-color":"#00a93d","border-color":"rgba(0, 56, 20, 0.65)","text-shadow":"0 -1px 0 #003814","box-shadow":"inset 0 -4px 0 rgba(0, 123, 44, 0.85)"}),t("#new_webinar_button").attr("href","/admin_webinars/new?product=gem")},toggleUser:function(){t("#gem_user").toggle(),t("#mimi_user").toggle()}}).singleton()}(jQuery),Mimi.ExportFormatDialog=Class.create(Widget.Popup,{initialize:function($super){$super("#export_format_dialog",{hideTrigger:".window_close, .back",overlay:Widget.ModalOverlay,fixedPosition:!1})},selectedFormat:function(){return jQuery("input[name=export_format]:checked","#export_format_dialog").val()}}),function(t){Mimi.AffiliateDetails=Class.create({initialize:function(){this.initData(),this.initDefaults()},initData:function(){this.data=Mimi.AffiliateDetails.DATA||{},this.data.remind_at&&(this.data.remind_at=new Date(Date.parse(this.data.remind_at)))},initDefaults:function(){this.defaults=Mimi.AffiliateDetails.DEFAULTS||{}},getData:function(){return this.data},getDataOrDefault:function(){var t=this.getData();for(var e in t)t[e]=t[e]||this.defaults[e];return t},shouldRequest:function(){var t=this.addonEnabled(),e=!this.detailsPresent()||this.shouldRequestTaxForm();return t&&e},shouldForceRequest:function(){var t=this.shouldRequest(),e=this.hasClaims(),i=this.shouldRemind(),s=!this.hasReminder()||this.reminderExpired(),n=this.detailsPresent()&&this.shouldRequestTaxForm();return t&&(e||i||n)&&s},shouldRequestTaxForm:function(){return this.data.should_submit_tax_form===!0},addonEnabled:function(){return this.data.addon_enabled},canPostpone:function(){return null==this.data.can_postpone||this.data.can_postpone===!0},hasReminder:function(){return!!this.data.remind_at},hasClaims:function(){return this.data.has_claims},reminderExpired:function(){return this.hasReminder()&&this.data.remind_at<=new Date},shouldRemind:function(){return this.reminderExpired()},detailsPresent:function(){return this.data.details_present},detailsProvided:function(){this.data.details_present=!0},isUSPerson:function(){return this.data.us_person},updateData:function(t){this.data=_.extend(this.data,t),this.data.details_present=!0},updatePaypalAddress:function(t){t&&(this.defaults.paypal_email=t)},submitData:function(t,e){var i=new FormData;for(var s in t)i.append(s,t[s]);this.handlePostRequest(i,Mimi.AffiliateDetails.URL.affiliateDetailsPath,e)},postpone:function(e){t.ajax({url:Mimi.AffiliateDetails.URL.postponeAffiliateDetailsPath,type:"put"}).done(_.bind(function(t){this.onPostponeSuccess(t,e)},this)).fail(_.bind(function(){this.onPostponeFailure(e)},this))},onPostponeSuccess:function(t,e){this.updateData(t),e.onSuccess&&e.onSuccess()},onPostponeFailure:function(t){t.onFailure&&t.onFailure()},submitUSPerson:function(t,e){var i=new FormData;i.append("affiliate_details[us_person]",t),this.handlePostRequest(i,Mimi.AffiliateDetails.URL.affiliateDetailsUSPersonPath,e)},uploadTaxForm:function(t,e){var i=new FormData;i.append("affiliate_details[tax_form]",t),this.handlePostRequest(i,Mimi.AffiliateDetails.URL.affiliateDetailsTaxFormPath,e)},submitTaxFormData:function(t,e){var i=new FormData;for(var s in t)i.append("affiliate_details["+s+"]",t[s]);this.handlePostRequest(i,Mimi.AffiliateDetails.URL.affiliateDetailsTaxFormPath,e)},handlePostRequest:function(t,e,i){var s=new XMLHttpRequest;s.open("POST",e),s.onreadystatechange=_.bind(function(){if(4===s.readyState)if(200===s.status){var t=JSON.parse(s.responseText);this.updateData(t),i.onSuccess&&i.onSuccess(t)}else i.onFailure&&i.onFailure({status:s.status,error:s.responseText})},this),s.send(t)}}).singleton("shouldForceRequest","shouldRequest","shouldRequestTaxForm","detailsProvided","canPostpone","submitData","postpone","uploadTaxForm","getData","getDataOrDefault","updatePaypalAddress","submitUSPerson","submitTaxFormData")}(jQuery),function(t){var e=["p","c","s"],i=/^\d{3}-\d{2}-\d{4}$/,s=/^\d{2}-\d{7}$/;Mimi.AffiliateDetailsDialogBase=Class.create(Widget.Observer,Widget.Observable,{initialize:function(e){var i="#"+e;this.dom.$requiredFields=t(i+" input"),this.requiredFieldsFormChanger=new Widget.FormChanger(this.dom.$country,i,COUNTRY_CHANGES),this.dialog=new Widget.Popup(i,{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!0}),this.initData(),this.initObservers()},initData:function(){this.steps=[]},initObservers:function(){this.dom.$form.on("submit",_.bind(this.onFormSubmit,this)),this.dom.$nonUsPersonForm.on("submit",_.bind(this.onNonUSPersonFormSubmit,this)),this.dom.$nonUsPersonTaxFormField.on("change",_.bind(this.onNonUSTaxFormFieldChanged,this)),this.dom.buttons.$close.on("click",_.bind(this.onCloseClicked,this)),this.dom.buttons.$back.on("click",_.bind(this.onBackClicked,this)),this.dom.buttons.$choose.on("click",_.bind(this.onChooseClicked,this)),this.dom.w9Fields.$taxClassCheckboxes.on("change",_.bind(this.w9TaxClassificationChecked,this)),this.dom.w9Fields.$numericFields.on("keydown",_.bind(this.makeFieldNumeric,this)),this.dom.buttons.$submitUSPerson.on("click",_.bind(this.onUSPersonFormSubmit,this)),this.dom.buttons.$backW9Flow.on("click",_.bind(this.backwardsUsPersonStep,this)),this.dom.buttons.$continueW9Flow.on("click",_.bind(this.forwardUsPersonStep,this))},initializeW9Steps:function(){this.usPersonCurrentStep=0,this.usPersonTotalSteps=5,this.forwardUsPersonStep(),this.dom.buttons.$submitUSPerson.hide(),this.dom.buttons.$continueW9Flow.show()},show:function(t){this.options=_.extend(this.options,t||{}),this.fillForm(),this.dialog.show(),this.dialog.position()},validate:function(){return _.select(this.dom.$requiredFields,function(e){var e=t(e),i=e.attr("type"),s="text"===i||"email"===i||"hidden"===i,n=e.parent("[data-field]"),o=n&&n.is(":visible"),a=_.blank(e.val());return s&&o&&a})},highlightValidationErrors:function(e){_.delay(function(){_.invoke(e,"errorFlash"),_.first(e).select()},500);var i=this;e=_.filter(e,function(e){return t(e).attr("name")});var s=t.map(e,function(e){return"&rarr; "+i.extractNameFromField(t(e),"affiliate_details")});Widget.MimiFlash.error(I18n.t("MimiFlash.affiliate_details_dialog.onSubmit")+"\n"+s.join("<br>"))},switchToPreviousStep:function(){return this.steps.length>1?(this.steps.pop(),this.switchToStep(this.steps[this.steps.length-1])):void this.dialog.hide()},switchToStep:function(t){this.hideAllSteps(),this.dom.steps["$"+t].show(),this.steps[this.steps.length-1]!==t&&this.steps.push(t),this.dialog.position()},switchToNoticeStep:function(){this.switchToStep("notice")},switchToFormStep:function(){this.switchToStep("form")},switchToLegalStep:function(){this.switchToStep("legal")},switchToSuccessStep:function(){this.switchToStep("success")},switchToUSPersonStep:function(){this.initializeW9Steps(),this.switchToStep("usPerson")},switchToNonUSPersonStep:function(){this.switchToStep("nonUsPerson")},onConfirmClicked:function(){return this.confirmDetails(),!1},onContinueClicked:function(){this.switchToFormStep()},onBackClicked:function(){this.switchToPreviousStep()},onChooseClicked:function(){this.submitUSPerson()},onCloseClicked:function(){this.dialog.hide(),this.fireSuccessEvent()},confirmDetails:function(){this.submitForm()},onFormSubmit:function(){return this.submitForm(),!1},submitForm:function(){var e=this.validate();if(e.length>0)this.highlightValidationErrors(e);else{var i=this.dom.$form.find("input"),s={};_.each(i,function(e){var e=t(e);"file"===e.attr("type")?e[0].files.length>0&&(s[e.attr("name")]=e[0].files[0]):s[e.attr("name")]=e.val()}),Mimi.AffiliateDetails.submitData(s,{onSuccess:_.bind(this.onSubmitFormSuccess,this),onFailure:_.bind(this.onSubmitFormFailure,this)})}},onSubmitFormSuccess:function(){this.switchToLegalStep()},onSubmitFormFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.affiliate_details_dialog.onSubmitFailure")),this.fireFailureEvent(),this.dialog.hide()},fillForm:function(){var t=Mimi.AffiliateDetails.getDataOrDefault();for(var e in this.dom.fields){var i=t[e.replace(/^\$/,"")],s=this.dom.fields[e];s.is("[type=checkbox]")?s.prop("checked",i):s.val(i)}for(var n in this.dom.dropdownContainers){var o=this.dom.dropdownContainers[n],a=o.find("span").attr("id"),r=Widget.Dropdown.instances[a];r.setSelection(t[n.replace(/^\$/,"")])}this.dom.$nonUsPersonTaxFormField.val(""),this.dom.$nonUsPersonTaxFormFilename.val("")},submitUSPerson:function(){Mimi.AffiliateDetails.submitUSPerson(this.isUSPerson(),{onSuccess:_.bind(this.onSubmitUSPersonSuccess,this),onFailure:_.bind(this.onSubmitUSPersonFailure,this)})},onSubmitUSPersonSuccess:function(){this.isUSPerson()?this.switchToUSPersonStep():this.switchToNonUSPersonStep()},onSubmitUSPersonFailure:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.affiliate_details_dialog.onSubmitUSPersonFailure")),this.fireFailureEvent(),this.dialog.hide()},onUSPersonFormSubmit:function(){if(!this.validateUSPersonForm())return!1;var e=this.dom.w9Fields.$usPersonToSubmit,i={};return t.each(e,function(e,s){var s=t(s);"hidden"!==s.attr("type")&&(i[s.attr("name")]="checkbox"===s.attr("type")?s.is(":checked"):s.val())}),i["tax_form[social_security_number]"]=this.getSSN(),i["tax_form[employer_id]"]=this.getEmployerId(),Mimi.AffiliateDetails.submitTaxFormData(i,{onSuccess:_.bind(this.onUSPersonFormSubmitSuccess,this),onFailure:_.bind(this.onUSPersonFormSubmitFailure,this)}),!1},extractNameFromField:function(t,e){return t.attr("name").slice(e.length+1,-1).humanize()},validateUSPersonForm:function(){var n="";switch(this.usPersonCurrentStep){case 1:var o=this.dom.w9Fields.$usPersonName;_.blank(o.val())&&(n+=this.extractNameFromField(o,"tax_form"));break;case 2:var a=_.select(this.dom.w9Fields.$taxClassCheckboxes,function(e){return t(e).is(":checked")});if(a.length<1){n=I18n.t("MimiFlash.affiliate_details_dialog.w9_errors.no_checkbox_checked");break}if(a.length>1){n=I18n.t("MimiFlash.affiliate_details_dialog.w9_errors.too_many_checkboxes_checked");break}var r=t(a[0]),l=t.trim(this.dom.w9Fields.$taxClass.val());if(r.prop("id")===this.dom.w9Fields.$usPersonTaxClassLLC.prop("id")){if(_.blank(l)||e.indexOf(l.toLowerCase())<0){n=I18n.t("MimiFlash.affiliate_details_dialog.w9_errors.no_classification_code");break}}else this.dom.w9Fields.$taxClass.val("");r.prop("id")!==this.dom.w9Fields.$usPersonTaxClassOther.prop("id")&&this.dom.w9Fields.$otherText.val("");break;case 4:var d=this.dom.w9Fields.$usPersonAddress;_.blank(d.val())&&(n+=this.extractNameFromField(d,"tax_form"));var h=this.dom.w9Fields.$usPersonCityStateZip;_.blank(h.val())&&(n.length>0&&(n+="\n&rarr; "),n+=this.extractNameFromField(h,"tax_form"));break;case 5:var c=this.getSSN(),u=this.getEmployerId();if(_.blank(c)&&_.blank(u)||!_.blank(c)&&!_.blank(u)){n=I18n.t("MimiFlash.affiliate_details_dialog.w9_errors.ssn_and_employer_id_error");break}if(!_.blank(c)&&!i.test(c)){n=I18n.t("MimiFlash.affiliate_details_dialog.w9_errors.ssn_9_digits");break}if(!_.blank(u)&&!s.test(u)){n=I18n.t("MimiFlash.affiliate_details_dialog.w9_errors.employer_id_9_digits");break}}return _.blank(n)?!0:(Widget.MimiFlash.error(I18n.t("MimiFlash.affiliate_details_dialog.onSubmit")+"\n&rarr; "+n),!1)},getSSN:function(){var e=t.trim(this.dom.w9Fields.$usPersonSSN1.val()),i=t.trim(this.dom.w9Fields.$usPersonSSN2.val()),s=t.trim(this.dom.w9Fields.$usPersonSSN3.val());return _.blank(e)||_.blank(i)||_.blank(s)?"":[e,i,s].join("-")},getEmployerId:function(){var e=t.trim(this.dom.w9Fields.$usPersonEmployerID1.val()),i=t.trim(this.dom.w9Fields.$usPersonEmployerID2.val());return _.blank(e)||_.blank(i)?"":e+"-"+i},makeFieldNumeric:function(e){-1!==t.inArray(e.keyCode,[46,8,9,27,13,110,190])||65==e.keyCode&&e.ctrlKey===!0||67==e.keyCode&&e.ctrlKey===!0||88==e.keyCode&&e.ctrlKey===!0||e.keyCode>=35&&e.keyCode<=39||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()},onUSPersonFormSubmitSuccess:function(){this.switchToSuccessStep()},onUSPersonFormSubmitFailure:function(t){400===t.status?(Widget.MimiFlash.error(I18n.t("MimiFlash.affiliate_details_dialog.onUSPersonFormSubmitFailure.custom_error",{error:t.error})),this.dom.$usPersonForm.find("input").errorFlash()):(Widget.MimiFlash.error(I18n.t("MimiFlash.affiliate_details_dialog.onUSPersonFormSubmitFailure.default_error")),this.fireFailureEvent(),this.dialog.hide())},w9TaxClassificationChecked:function(t){var e=t.target.id;this.dom.w9Fields.$taxClassCheckboxes.not("#"+e).prop("checked",!1),this.dom.w9Fields.$otherText.prop("disabled",e!==this.dom.w9Fields.$usPersonTaxClassOther.prop("id")),this.dom.w9Fields.$taxClass.prop("disabled",e!==this.dom.w9Fields.$usPersonTaxClassLLC.prop("id"))},onNonUSPersonFormSubmit:function(){return this.validateTaxForm(this.dom.$nonUsPersonForm)&&Mimi.AffiliateDetails.uploadTaxForm(this.dom.$nonUsPersonForm.find("input")[0].files[0],{onSuccess:_.bind(this.onNonUSPersonFormSubmitSuccess,this),onFailure:_.bind(this.onNonUSPersonFormSubmitFailure,this)}),!1},onNonUSPersonFormSubmitSuccess:function(){this.switchToSuccessStep()},onNonUSPersonFormSubmitFailure:function(t){400===t.status?(Widget.MimiFlash.error(I18n.t("MimiFlash.affiliate_details_dialog.onNonUSPersonFormSubmitFailure.custom_error",{error:t.error})),this.dom.$nonUsPersonForm.find("input").errorFlash()):(Widget.MimiFlash.error(I18n.t("MimiFlash.affiliate_details_dialog.onNonUSPersonFormSubmitFailure.default_error")),this.fireFailureEvent(),this.dialog.hide())},onNonUSTaxFormFieldChanged:function(){this.dom.$nonUsPersonTaxFormFilename.val(this.dom.$nonUsPersonTaxFormField.val())},hideAllSteps:function(){for(var t in this.dom.steps)this.dom.steps[t].hide()},validateTaxForm:function(t){var e=t.find("input"),i=e.val(),s=_.last(i.split("."));return"pdf"!==s.toLowerCase()?(this.highlightValidationErrors(e),!1):!0},isUSPerson:function(){return this.dom.fields.$us_person.is(":checked")},fireSuccessEvent:function(){this.options.onSuccess&&this.options.onSuccess()},fireFailureEvent:function(){this.options.onFailure&&this.options.onFailure()},forwardUsPersonStep:function(){if(!this.validateUSPersonForm())return!1;switch(this.usPersonCurrentStep){case this.usPersonTotalSteps:return this.onUSPersonFormSubmit(),!1;case this.usPersonTotalSteps-1:this.dom.buttons.$submitUSPerson.show(),this.dom.buttons.$continueW9Flow.hide();default:this.hideAllUSPersonCurrentStep(),this.usPersonCurrentStep++,this.getUsPersonStep(this.usPersonCurrentStep).show()}return!1},backwardsUsPersonStep:function(){switch(this.usPersonCurrentStep){case 1:return this.switchToPreviousStep(),!1;case this.usPersonTotalSteps:this.dom.buttons.$submitUSPerson.hide(),this.dom.buttons.$continueW9Flow.show();default:this.hideAllUSPersonCurrentStep(),this.usPersonCurrentStep--,this.getUsPersonStep(this.usPersonCurrentStep).show()}return!1},getUsPersonStep:function(e){return t("#affiliate_details_us_person_"+e)},hideAllUSPersonCurrentStep:function(){for(var t=this.usPersonTotalSteps;t>0;t--)this.getUsPersonStep(t).hide()}})}(jQuery),function(t){Mimi.AffiliateDetailsDialog=Class.create(Mimi.AffiliateDetailsDialogBase,{initialize:function($super){this.options={},this.$element=t("#affiliate_details_dialog"),this.$element[0]&&(this.dom=this.$element.getChildren(Mimi.AffiliateDetailsDialog.DOM),$super("affiliate_details_dialog"),this.dialog=new Widget.Popup("#affiliate_details_dialog",{hideTrigger:"",overlay:Widget.ModalOverlay,fixedPosition:!0,escClose:!1,autoHide:!1}))},initObservers:function($super){$super(),this.dom.buttons.$remindLater.on("click",_.bind(this.onRemindLaterClicked,this)),this.dom.$windowClose.on("click",_.bind(this.onWindowCloseClicked,this)),this.dom.buttons.$continueBtn.on("click",_.bind(this.onContinueClicked,this))},show:function(t){this.options=_.extend(this.options,t||{}),this.dom.buttons.$remindLater.toggle(Mimi.AffiliateDetails.canPostpone()),this.fillForm(),this.dialog.show(),this.dialog.position(),this.switchToNoticeStep()},autoShow:function(){Mimi.AffiliateDetails.shouldForceRequest()&&this.show()},onRemindLaterClicked:function(){this.remindLater()},onWindowCloseClicked:function(){Mimi.AffiliateDetails.canPostpone()?this.remindLater():this.dialog.hide()},remindLater:function(){this.dialog.hide(),Mimi.AffiliateDetails.postpone({onSuccess:_.bind(this.onRemindLaterSuccess,this),onFailure:_.bind(this.onRemindLaterFailed,this)})},onRemindLaterSuccess:function(){Widget.MimiFlash.create(I18n.t("MimiFlash.affiliate_details_dialog.onRemindLaterSuccess")),this.firePostponeEvent()},onRemindLaterFailed:function(){Widget.MimiFlash.error(I18n.t("MimiFlash.affiliate_details_dialog.onRemindLaterFailure")),this.fireFailureEvent()},firePostponeEvent:function(){this.options.onPostpone&&this.options.onPostpone()}}).singleton("show","autoShow"),Mimi.AffiliateDetailsDialog.DOM={windowClose:".window_close",form:"#affiliate_details_form",fields:{first_name:"input[name='affiliate_details[first_name]']",last_name:"input[name='affiliate_details[last_name]']",paypal_email:"input[name='affiliate_details[paypal_email]']",phone:"input[name='affiliate_details[phone]']",address:"input[name='affiliate_details[address]']",country:"input[name='affiliate_details[country]']",state:"input[name='affiliate_details[state]']",city:"input[name='affiliate_details[city]']",zip:"input[name='affiliate_details[zip]']",email:"input[name='affiliate_details[email]']",us_person:"input[name='affiliate_details[us_person]']"},steps:{notice:"#affiliate_details_notice",form:"#affiliate_details_form",legal:"#affiliate_details_legal",success:"#affiliate_details_success",usPerson:"#affiliate_details_us_person",nonUsPerson:"#affiliate_details_non_us_person"},dropdownContainers:{country:"span[data-field=country]",state:"span[data-field=state]"},buttons:{close:[".actions .close"],continueW9Flow:[".actions .continue_flow"],backW9Flow:[".actions .back_flow"],submitUSPerson:[".actions .submit"],choose:[".actions .choose"],back:[".actions .previous_step"],remindLater:[".actions .remind_later"],continueBtn:[".actions .continue"]},w9Fields:{otherText:"#tax_form_tax_classification_other",taxClass:"#tax_form_tax_classification_code",taxClassCheckboxes:["input.tax_classification"],usPersonName:"#tax_form_name",usPersonTaxClassOther:"#tax_form_other",usPersonTaxClassLLC:"#tax_form_llc",usPersonAddress:"#tax_form_address",usPersonCityStateZip:"#tax_form_city_state_zip",numericFields:["input.numeric_field"],usPersonSSN1:"#tax_form_social_security_number1",usPersonSSN2:"#tax_form_social_security_number2",usPersonSSN3:"#tax_form_social_security_number3",usPersonEmployerID1:"#tax_form_employer_id1",usPersonEmployerID2:"#tax_form_employer_id2",usPersonToSubmit:["input.w9_to_submit"]},country:"input[name='affiliate_details[country]']",usPersonTaxFormFilename:"#affiliate_details_us_person input[type=text]",usPersonForm:"#affiliate_details_us_person",nonUsPersonTaxFormField:"#affiliate_details_non_us_person #affiliate_details_tax_form",nonUsPersonTaxFormFilename:"#affiliate_details_non_us_person input[type=text]",nonUsPersonForm:"#affiliate_details_non_us_person",usPersonLabel:"#affiliate_details_legal label[for=us_person]"},t(function(){Mimi.AffiliateDetailsDialog.autoShow()})}(jQuery),function(t){Mimi.UpdateAffiliateDetailsDialog=Class.create(Mimi.AffiliateDetailsDialogBase,{initialize:function($super){this.options={},this.$element=t("#update_affiliate_details_dialog"),this.dom=this.$element.getChildren(Mimi.UpdateAffiliateDetailsDialog.DOM),$super("update_affiliate_details_dialog")},show:function($super,t){$super(t),this.switchToFormStep()},onCloseClicked:function(){this.dialog.hide()},onSubmitUSPersonSuccess:function(){this.isUSPerson()?this.switchToUSPersonStep():this.switchToNonUSPersonStep()},onUSPersonFormSubmitSuccess:function(){this.dialog.hide(),this.fireSuccessEvent()},onNonUSPersonFormSubmitSuccess:function(){this.dialog.hide(),this.fireSuccessEvent()}}).singleton("show"),Mimi.UpdateAffiliateDetailsDialog.DOM={form:"#affiliate_details_form",fields:{first_name:"input[name='affiliate_details[first_name]']",last_name:"input[name='affiliate_details[last_name]']",paypal_email:"input[name='affiliate_details[paypal_email]']",phone:"input[name='affiliate_details[phone]']",address:"input[name='affiliate_details[address]']",country:"input[name='affiliate_details[country]']",state:"input[name='affiliate_details[state]']",city:"input[name='affiliate_details[city]']",zip:"input[name='affiliate_details[zip]']",email:"input[name='affiliate_details[email]']",tax_form:"input[name='affiliate_details[tax_form]']",us_person:"input[name='affiliate_details[us_person]']"},steps:{form:"#affiliate_details_form",legal:"#affiliate_details_legal",usPerson:"#affiliate_details_us_person",nonUsPerson:"#affiliate_details_non_us_person"},dropdownContainers:{country:"span[data-field=country]",state:"span[data-field=state]"},buttons:{close:[".actions .close"],submit:[".actions .confirm"],continueW9Flow:[".actions .continue_flow"],backW9Flow:[".actions .back_flow"],submitUSPerson:[".actions .submit"],choose:[".actions .choose"],back:[".actions .previous_step"],remindLater:[".actions .remind_later"],continueBtn:[".actions .continue"]},w9Fields:{otherText:"#tax_form_tax_classification_other",taxClass:"#tax_form_tax_classification_code",taxClassCheckboxes:["input.tax_classification"],numericFields:["input.numeric_field"],usPersonTaxClassOther:"#tax_form_other",usPersonTaxClassLLC:"#tax_form_llc",usPersonName:"#tax_form_name",usPersonAddress:"#tax_form_address",usPersonCityStateZip:"#tax_form_city_state_zip",usPersonSSN1:"#tax_form_social_security_number1",usPersonSSN2:"#tax_form_social_security_number2",usPersonSSN3:"#tax_form_social_security_number3",usPersonEmployerID1:"#tax_form_employer_id1",usPersonEmployerID2:"#tax_form_employer_id2",usPersonToSubmit:["input.w9_to_submit"]},country:"input[name='affiliate_details[country]']",usPersonForm:"#affiliate_details_us_person",nonUsPersonTaxFormField:"#affiliate_details_non_us_person #affiliate_details_tax_form",nonUsPersonTaxFormFilename:"#affiliate_details_non_us_person input[type=text]",nonUsPersonForm:"#affiliate_details_non_us_person",usPersonLabel:"#affiliate_details_legal label[for=us_person]"}}(jQuery),function(){Mimi.AddressValidator=Class.create(Widget.Observable,{initialize:function(){this.geocoder=new google.maps.Geocoder},validate:function(t){this.requestAPI(t)},requestAPI:function(t){this.geocoder.geocode({address:t.address,region:t.region},_.bind(function(e,i){i===google.maps.GeocoderStatus.OK?this.onGeocodeSuccess(e,i,t):this.onGeocodeFailure(e,i,t)},this))},onGeocodeSuccess:function(t,e,i){var s=this.suggestAddress(t);this.fireSuccessEvent(s,i.onSuccess)},onGeocodeFailure:function(t,e,i){var s=t&&t[0]?t[0].error_message:null,n={status:e,error:s,isOverQueryLimit:e===google.maps.GeocoderStatus.OVER_QUERY_LIMIT,isServerError:e===google.maps.GeocoderStatus.UNKNOWN_ERROR,isInvalid:e===google.maps.GeocoderStatus.ZERO_RESULTS||e===google.maps.GeocoderStatus.REQUEST_DENIED||e===google.maps.GeocoderStatus.INVALID_REQUEST};n.isInvalid&&this.shouldIgnoreInvalidAddressForRegion(i.region)?this.fireSuccessEvent({},i.onSuccess):this.fireFailureEvent(n,i.onFailure)},suggestAddress:function(t){var e=this.extractComponent(t,["country"]),i=this.extractComponent(t,["locality"]),s=this.extractComponent(t,["administrative_area_level_1"]),n=this.extractComponent(t,["postal_code"]),o={};return e&&(o.country=e),i&&(o.city=i),s&&(o.state=s),n&&(o.zipcode=n),o},extractComponent:function(t,e){var i=t[0].address_components,s=null;return _.each(e,function(t){_.each(i,function(e){_.each(e.types,function(i){i===t&&(s=e.short_name),s}),s}),s}),s},shouldIgnoreInvalidAddressForRegion:function(t){return"US"!==t},fireSuccessEvent:function(t,e){e&&e(t),this.fire("address:validation:success",t)},fireFailureEvent:function(t,e){e&&e(t),this.fire("address:validation:failure",t)}}).singleton("validate")}(jQuery),function(t){Mimi.AddressNormalizationDialog=Class.create(Widget.Observer,Widget.Observable,{initialize:function(){this.$element=t("#address_normalization_dialog"),this.dom=this.$element.getChildren(Mimi.AddressNormalizationDialog.DOM),this.requiredFieldsFormChanger=new Widget.FormChanger(this.dom.fields.$country[0],"#address_normalization_dialog",COUNTRY_CHANGES),this.initTemplates(),this.initDialog(),this.initObservers()},initTemplates:function(){this.templates={suggestedLabel:Mimi.AddressNormalizationDialog.SUGGESTED_LABEL_TEMPLATE}},initDialog:function(){this.dialog=new Widget.Popup(this.$element[0],{hideTrigger:".window_close",overlay:Widget.ModalOverlay,fixedPosition:!1,onHidden:_.bind(this.onDialogHidden,this)})},initObservers:function(){this.dom.$form.on("change",_.bind(this.onFormChanged,this)),this.dom.$form.on("submit",_.bind(this.onFormSubmit,this)),this.dom.buttons.$reject.on("click",_.bind(this.onRejectClicked,this)),t(document).on("dropdown:item:selected",_.bind(this.onFormChanged,this))},show:function(t,e){this.updateForm(t,e),this.dialog.show()},updateForm:function(t,e){var i=_.clone(t);_.extend(i,e),this.accepted=this.rejected=!1;for(var s in this.dom.fields)this.dom.fields[s].val(i[this.cleanFieldName(s)]);for(var n in this.dom.dropdownContainers){var o=this.dom.dropdownContainers[n].find(".select"),a=o.attr("id"),r=Widget.Dropdown.instances[a];r.setSelection(i[this.cleanFieldName(n)])}_.delay(_.bind(function(){for(var s in this.dom.fields){var n=this.cleanFieldName(s);e[n]&&i[n]!==t[n]?this.createSuggestedLabelFor(s):this.removeSuggestedLabelFor(s)}},this),500)},onFormSubmit:function(t){return t&&t.die(),this.accepted=!0,this.dialog.hide(),this.fire("address_normalization:accept",this.serializeForm()),!1},onRejectClicked:function(){this.rejected=!0,this.dialog.hide(),this.fire("address_normalization:reject")},onDialogHidden:function(){this.accepted||this.rejected||this.fire("address_normalization:cancel")},onFormChanged:function(){this.removeAllSuggestedLabels()},serializeForm:function(){var t={};for(var e in this.dom.fields)t[this.cleanFieldName(e)]=this.dom.fields[e].val();return t},createSuggestedLabelFor:function(t){var e=this.getSuggestedLabelFor(t);if(0==e.length){var i=this.$element.find("[data-field="+this.cleanFieldName(t)+"] > label");if(i.append(this.templates.suggestedLabel),this.dom.fields[t].addClass("suggested"),this.dom.dropdownContainers[t]){var s=this.dom.dropdownContainers[t].find(".select");s.addClass("suggested")}}},removeSuggestedLabelFor:function(t){var e=this.getSuggestedLabelFor(t);if(e&&(e.remove(),this.dom.fields[t].removeClass("suggested"),this.dom.dropdownContainers[t])){var i=this.dom.dropdownContainers[t].find(".select");i.removeClass("suggested")}},removeAllSuggestedLabels:function(){for(var t in this.dom.fields)this.removeSuggestedLabelFor(t)},getSuggestedLabelFor:function(t){return this.$element.find("[data-field="+this.cleanFieldName(t)+"] .suggested_label")},cleanFieldName:function(t){return t.toString().replace("$","")}}).singleton("show"),Mimi.AddressNormalizationDialog.DOM={form:"form",fields:{address:"input[name=address]",country:"input[name=country]",state:"input[name=state]",city:"input[name=city]",zipcode:"input[name=zipcode]"},dropdownContainers:{country:"[data-field=country]",state:"[data-field=state]"},buttons:{reject:".actions .back",submit:".actions .primary"}},Mimi.AddressNormalizationDialog.SUGGESTED_LABEL_TEMPLATE="<span class='suggested_label'>"+I18n.t("js.address_normalization_dialog.suggested")+"</span>"}(jQuery),Mimi.GEM={},Mimi.GEM.UserChecker=function(t){function e(){t.get("/logins/check_user?target_uid="+i).done(function(){window.location.reload()}).fail(function(){n>0?(setTimeout(e,o),n--):window.location="/logins/no_user"})}var i,s={},n=18,o=5e3;return s.init=function(t){i=t,setTimeout(e,o)},s}(jQuery),jQuery(document).ready(function(){var t=jQuery(".side_switch section");t.mouseenter(function(){jQuery(this).addClass("hover")}),t.mouseleave(function(){jQuery(this).removeClass("hover")})}),jQuery(document).ready(function(){function t(){var t=jQuery(this).data("trigger");e.polaroid.removeClass("active"),jQuery(".polaroid[data-trigger="+t+"]").addClass("active"),e.personaCloudItem.removeClass("active"),jQuery(".persona_cloud__item[data-trigger="+t+"]").addClass("active"),jQuery(".reason").addClass("disappear"),jQuery(".reason[data-target="+t+"]").removeClass("disappear"),jQuery(".prop").removeClass("active"),jQuery(".prop[data-target="+t+"]").addClass("active"),e.personaCloud.addClass("disappear"),e.reasonH2.removeClass("disappear")}var e={polaroids:jQuery(".polaroids"),polaroid:jQuery("a.polaroid"),personaCloudItem:jQuery(".persona_cloud__item"),big:jQuery("big"),reasonH2:jQuery(".reason h2"),personaCloud:jQuery(".persona_cloud"),personaClose:jQuery(".persona_cloud .close"),keywordActive:jQuery(".keyword.initial"),loggedInItems:jQuery(".call_to_action_email.logged_in input, .call_to_action_email.logged_in button"),CTAInput:jQuery(".call_to_action_email input")};jQuery(window).load(function(){e.polaroids.css("opacity",1),e.keywordActive.addClass("fadein"),e.loggedInItems.attr("disabled","disabled"),e.CTAInput.attr("value","")}),e.polaroid.click(t),e.personaCloudItem.click(t),e.big.click(function(){e.reasonH2.toggleClass("disappear"),e.personaCloud.toggleClass("disappear")}),e.personaClose.click(function(){e.reasonH2.toggleClass("disappear"),e.personaCloud.toggleClass("disappear")})}),function(t){var e=function(e){var i=t(e).find("path#pencil"),s=t(e).find("path#line"),n=new TimelineMax({repeat:-1,repeatDelay:.5});TweenLite.killTweensOf([i,s]),n.fromTo(i,.6,{rotation:0,scale:1,xPercent:0,yPercent:0,opacity:1},{rotation:-25,scale:.8,xPercent:-50,yPercent:30,opacity:1,ease:Power1.easeIn}).add("lineDraw").to(i,.45,{rotation:-15,scale:.8,xPercent:30,yPercent:30,opacity:1,ease:Power1.easeIn},"lineDraw").fromTo(s,.45,{scaleX:0,opacity:0,transformOrigin:"left center"},{scaleX:.7,opacity:1,ease:Power1.easeIn},"lineDraw+=0.1").add("lineFadeOut","+=0.5").to(i,.35,{rotation:0,scale:1,xPercent:0,yPercent:0,opacity:1,ease:Power1.easeIn},"lineFadeOut").to(s,.2,{opacity:0,scaleX:.5,transformOrigin:"left center"},"lineFadeOut"),t(this).on("mouseleave",function(){n.repeat(0)})};t("body").on("mouseenter",".btn.edit",function(){e(this)});var i=function(e,i,s,n){var o=t(e).find("path#lid"),a=t(e).find("path#bin");TweenLite.to(o,.1,{rotation:i,y:s,transformOrigin:"left bottom",ease:Power1.ease}),TweenLite.to(a,.1,{y:n,ease:Power1.ease})};t("body").on("mouseenter",".btn.delete",function(){i(this,-12,0,.25)}),t("body").on("mouseleave",".btn.delete",function(){i(this,0,0,0)});var s=function(e,i,s){var n=t(e).find("path");TweenLite.to(n,.5,{rotation:i,scale:s,transformOrigin:"center",ease:Back.easeOut.config(2)})};t("body").on("mouseenter",".btn.add",function(){s(this,180,-1)}),t("body").on("mouseleave",".btn.add",function(){s(this,0,1)});var n=function(e,i,s,n){var o=t(e).find(".svg_caret_down path");t(e).parent().hasClass("dir-up")?TweenLite.to(o,.2,{rotationY:i,scaleY:s,y:n,transformOrigin:"center",transformPerspective:1e3,ease:Power2.easeIn}):TweenLite.to(o,.2,{rotationY:i,scaleY:s,y:n,transformOrigin:"center",transformPerspective:1e3,ease:Power2.easeIn})},o=function(e,i){var s=t(e).find(".svg_caret_down path");t(e).parent().hasClass("dir-up")?TweenLite.to(s,.2,{scaleY:i,y:"-=15%",transformOrigin:"center",ease:Power2.easeIn}):TweenLite.to(s,.2,{scaleY:i,y:"-=15%",transformOrigin:"center",ease:Power2.easeIn})},a=function(e,i){var s=t(e).find(".svg_caret_down path");t(e).parent().hasClass("dir-up")?TweenLite.to(s,1,{scaleY:i,y:"0%",transformOrigin:"center",ease:Elastic.easeOut.config(2,.2)}):TweenLite.to(s,1,{scaleY:i,y:"0%",transformOrigin:"center",ease:Elastic.easeOut.config(2,.2)})};t("body").on("mouseenter",".select .btn, .language_select .btn",function(){n(this,0,.85,0)}),t("body").on("mouseleave",".select .btn, .language_select .btn",function(){n(this,0,1,0,0)}),t("body").on("mousedown",".select .btn, .language_select .btn",function(){o(this,.75)}),t("body").on("click",".select .btn, .language_select .btn",function(){a(this,1)
});var r=function(e,i,s){var n=t(e).find(".btn .svg_caret_down");TweenLite.to(n,.1,{svgOrigin:"7.5 0",y:s,scaleY:i})};t("body").on("mouseenter",".select.dir-up",function(){r(this,-1,"-=5%"),t("body").on("blur",".select.dir-up",function(){r(this,1,"0%")})}),t("body").on("mouseleave",".select.dir-up",function(){t(this).children(".btn").is(":focus")||r(this,1,"0%")});var l=function(e,i,s,n){var o=t(e).find(".svg_action path");TweenLite.to(o,i,{rotation:s,transformOrigin:"center",ease:n})};t("body").on("mouseenter",".btn.action, .btn.configure, #madmimi_logo .btn.edit.simple",function(){l(this,10,1440,Power0.easeNone)}),t("body").on("mouseleave",".btn.action, .btn.configure, #madmimi_logo .btn.edit.simple",function(){l(this,4,0,Elastic.easeOut.config(1,.3))});var d=function(e){var i=t(e).find(".svg_pie_chart #pie"),s=[t(e).find(".svg_pie_chart #bar1"),t(e).find(".svg_pie_chart #bar2"),t(e).find(".svg_pie_chart #bar3")],n=t(e).find(".svg_pie_chart #peace0"),o=t(e).find(".svg_pie_chart #peace"),a=new TimelineMax({repeat:-1,repeatDelay:.5});TweenLite.killTweensOf([i,s,o,n]),TweenLite.set([o,n],{opacity:0}),a.set(i,{morphSVG:"#pie",transformOrigin:"center"}).fromTo(i,.75,{scale:1,y:0,rotation:0,xPercent:0,opacity:1,transformOrigin:"center"},{scale:.64,y:3,rotation:"-=45",xPercent:-25,opacity:1,ease:Back.easeOut.config(3)}).to(i,.5,{rotation:180,y:3,xPercent:50,opacity:0,transformOrigin:"center",ease:Back.easeInOut.config(8)}).staggerFromTo(s,.25,{scaleY:0,opacity:0,transformOrigin:"bottom"},{scaleY:1,opacity:1,ease:Power3.easeOut},.15,"-=0.25").staggerTo(s,.25,{scaleY:.2,opacity:0,ease:Power3.easeIn},.15).fromTo(i,.8,{rotation:-360,scale:.64,opacity:0,y:3,xPercent:-100,transformOrigin:"center"},{rotation:0,scale:1,opacity:1,y:0,xPercent:0,ease:Elastic.easeOut.config(1.25,.6)}).to(i,.5,{morphSVG:"#pie2",ease:Power2.easeIn}).to(n,.15,{opacity:1,ease:Power2.easeIn}).to(n,.5,{morphSVG:"#peace",ease:Power2.easeOut}).add("peaceFadeOut","+=0.5").to(n,.5,{morphSVG:"#peace0",opacity:0,ease:Power3.easeIn},"peaceFadeOut").to(i,1,{morphSVG:"#pie",opacity:1,ease:Elastic.easeOut.config(1.25,.8)}),t(e).on("mouseleave",function(){a.repeat(0)})};t("body").on("mouseenter",".btn.stats",function(){d(this)});var h=function(e){var i=t(e).find(".svg_refresh path"),s=.3,n=Power2.ease,o=new TimelineMax({repeat:-1,repeatDelay:.5});o.to(i,s,{rotation:-25,ease:n,transformOrigin:"center"}).to(i,s,{rotation:0,ease:n}).to(i,s,{rotation:25,ease:n}).to(i,s,{rotation:0,ease:n}),t(e).on("mouseleave",function(){o.repeat(0)})};t("body").on("mouseenter",".btn.refresh",function(){h(this)});var c=function(e){var i=t(e).find(".svg_clone g"),s=new TimelineMax({repeat:-1});s.to(i,.36,{yPercent:-20,ease:SlowMo.ease.config(.3,.7,!0),transformOrigin:"center"}),t(e).on("mouseleave",function(){s.repeat(0)})};t("body").on("mouseenter",".btn.clone",function(){c(this)});var u=function(e,i,s,n,o,a,r,l,d){var h=t(e).find(".svg_image path#night"),c=t(e).find(".svg_image circle#sun"),u=t(e).find(".svg_image circle#moon");TweenLite.to(c,.45,{x:i,y:s,scale:n,opacity:o,ease:Power1.easeIn}),TweenLite.to(h,.4,{opacity:a,ease:Power1.easeInOut}),TweenLite.to(u,.5,{x:r,y:l,opacity:d,ease:Power3.easeIn})};t("body").on("mouseenter",".btn.image",function(){u(this,1,3,.25,0,.25,-.5,-1.25,1)}),t("body").on("mouseleave",".btn.image",function(){u(this,0,0,1,1,0,0,0,0)});var m=new Date,p=m.getHours(),f=m.getMinutes(),g=p>12?p-12:p,_=parseInt(6*f),b=parseInt(30*g+_/360*30),v=function(e,i,s,n,o){var a=t(e).find(".svg_schedule path#finger"),r=t(e).find(".svg_schedule path#thumb"),l="8.5 8.5";TweenLite.killTweensOf([a,r]),TweenLite.to(r,s,{rotation:n-50,svgOrigin:l,ease:i}),TweenLite.to(a,s,{rotation:o+45,svgOrigin:l,ease:i})};t("body").on("mouseenter",".btn.schedule",function(){v(this,Power4.easeOut,4,b+360,_+1800)}),t("body").on("mouseleave",".btn.schedule",function(){v(this,Power4.easeOut,3,50,315)});var y=function(e,i,s,n,o){var a=function(i){return t(e).find(".svg_drag "+i)},r=a(Mimi.ABtest.useEither("path#arrow","#arrow_n")),l=a(Mimi.ABtest.useEither("path#dots","#arrow_s"));TweenLite.to(r,i,{transformOrigin:Mimi.ABtest.useEither("center","bottom"),scaleY:s,ease:o}),Mimi.ABtest.isControlGroup()?TweenLite.to(l,1.5*i,{opacity:n,ease:Power0.linear}):TweenLite.to(l,i,{transformOrigin:"top",scaleY:s,ease:o})};t("body").on("mouseenter",".btn.drag",function(){y(this,.5,1.2,.25,Power2.easeOut)}),t("body").on("mouseleave",".btn.drag",function(){y(this,.5,1,1,Power2.easeOut)}),t("body").on("mousedown",".btn.drag",function(){y(this,1,1.3,0,Elastic.easeOut.config(1.75,.4))}),t("body").on("mouseup",".btn.drag",function(){y(this,1,1,1,Elastic.easeOut.config(2.5,.3))});var w=function(e){var i=t(e).find(".svg_send #send");TweenLite.killTweensOf(i);var s=new TimelineMax({repeat:-1,repeatDelay:0}).to(i,.35,{morphSVG:"#send_fold",ease:Power2.easeOut}).to(i,.35,{morphSVG:"#send",ease:Power3.easeOut});t(e).on("mouseleave",function(){s.repeat(0)})};t("body").on("mouseenter",".btn.send",function(){w(this)});var C,S,k,M,T,D;t("body").on("click",".btn",function(e){S=t(this),S.addClass("fx").append("<i class='stage'></i>"),C=S.find(".stage"),C.prepend("<span class='circle'></span>"),k=C.find(".circle"),k.height()||k.width()||(M=Math.max(C.outerWidth(),C.outerHeight()),k.css({height:M,width:M})),D=e.pageY-C.offset().top-k.height()/2,T=e.pageX-C.offset().left-k.width()/2,TweenLite.set(k,{top:D+"px",left:T+"px",opacity:1});var i=function(){C.remove(),S.removeClass("fx")};TweenLite.to(k,.5,{scale:2.5,opacity:0,ease:Power0.easeNone,onComplete:i})})}(jQuery);var version="1.0.0";